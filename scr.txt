//==================================================
//      Design Your Own Mission
//       Ingame mission builder
//        for GTA San Andreas
//     by Dutchy3010 and PatrickW
//           (c) 2008-2014 
//==================================================
//
//==================================================
// scmdebug: (install SAdebug.asi to view onscreen)
// 0662: - PRINTSTRING "STRING"
// 0663: - PRINTINT "INTEGER" 42
// 0664: - PRINTFLOAT "FLOAT" 5.6
// 00CC: - BREAKPOINT
//==================================================
//
//
//==================================================
//  Release info:
//==================================================
//
//=============================================
// ------------------ V8.2 ------------------
// Fix traffic and ped types in various area's
// Fix bug with giving actors a route animation during an edit action, whe there wasn't a route previously
// Player drive animation control thread was not always properly ended.
// Crash when playing ambient mp3 but no objective present
// Routes get mixedup when editing a player animation objective.
// Some vehicles dont keep moving in a blended-in cutscene transition
// No jetpack when choosing extend vehicle route
// Lock up after pressing yes when "extending route" for player animation and objective actor
// Free route point when deleting player animation objective
// Minimap not visible when going outside after manually starting a dsl mission in an interior.
//
//=============================================
// ------------------ V8.1 ------------------
// Show objective number when browsing with the teleport to objective tool
// bugfix: player as non-driving passenger animation, throws out driver at end.
// follow player cammodes, still let you choose an actor
// Fix crash, when car or actor used in an "actor" cammode, hets hidden right after the cutscene
// Improved resposiveness to checkpoints, in complex missions with lots of "must survive" items.
// Added AIM animation and a couple of normal ones
// Added quick browsing for animations (GH)
//
//=============================================
// ------------------ V8.0 ------------------
// v objective texts not always cleared 
// v skipping a moving cutscene doesn't end the movement
// v fixes crashes when using fire objects
// v fixes hide/spawn problems when adding new objectives in the middle
// v Add quick-browse (gh) for cars, actors and objects
// v now CLEO4 is required
// v PARTICLE effect and various explosions
// v Two new cutscene modes: 1st person and 3rd person
// v slowmo and shaking cam for cutscenes
// v scroll (gh) through previous camera locations
// v objective objects
// v  - touch
// v  - damage
// v  - photograph
// v  - shoot
// v addmoney objective
// v submoney objective
// v skip_fade for cutscene
// v skip_wide for cutscene  
// v extend route
// -------public beta v8 -------------
// fix cancel-cutscene-menu bug
// clear cs prperties when creating a new cutscene
// fix wrong text on skip fading menu
// revert fix for texts that outlive short cutscenes
// fix crash when adding animated actor with route, without defining routepoints
// fix health 200 bar on teleport
// increased max amount of rewardmoney in storyline mode
// new stuff:
// Added fast respawn option for pickups
// Player Animations added
// 3 player cutscene camera modes
// import/export of objective texts
//==================================================
// See historical_changelog.txt for more history
//
//=============================================
// ------------- BACKLOG ------------------
//=============================================
// - Check and verify leave car behaviour of actors:
//    - Do non driver actors get out, 
//    - Do they still obbey their initial commands,
//    - Works for objective actors?
//    - Works for player? 
// -------- ideas for next version --------------------------------------
// - follow actor objective (set route, min distance, max distance. In mission: spookbar, passed when actor reaches destination. )
// - objective actor with route: option for mission fail, if end of route
// - add introtext (box) objective
// - new actor properties:
//    - markers on normal actors (might store marker handles in heap-mem ?)
//    - names for actors  (use for health bar & mission failed with must survive actor)
//    - walking styles
//    - fighting styles
//    - actor immunities ?
//    - weapons skills
//    - lungs?
// - Mission passed, should keep the last active scene/camera. Not return/standupplayer, etc as soon as it is displayed.
// - destroy all similar cars                            (Can be coded in the properties as is done for actors) 
// ------- wild ideas for future versions -------------------------------------- 
// - new actor animation: attach to nearest car.
//       - use "turret" opcodes
//      ?? store offset in point table?
// - Drive cars as on rails... thus no physics on it..
// - new car option:
//         06C1: create_searchlight 58@ on_car 40@ with_offset 0.0 1.0 -0.5 radius 0.4 target 2193.73 -1166.85 34.06 radius 4.0 
//         06B6: set_searchlight 58@ follow_actor $ACTOR_SWEET speed 0.2 
//      ?? How to determine correct searchlight offset, or let the user specify and store in point-table.
// - New actor objective: Pick up ?                      (Better solution than the actor be able to enter missioncar)) 
// - multiple CJ's (meaning multiple cloths available)                               ( Can't get it stable yet ) (somehow  rebuild just crashes after DYOM has been run ) 
// - Clothing for Player as CJ.
// - Make actors Swim
// - group cars/peds/animation/interiors during selection (with menu's or so)
// - RIOT mode everywhere, possible with cheat triggering?
// - Spawn test vehicle should not erase the vehicle when you get out of it, but erase it if you don't use it for a set amount of time. 
// - option to use alternative to jetpack, when defining routes.
//----------------
//==========================================
// Routine index (select and press ctrl-F,F3,F3....)
//==========================================
{
:MAIN_LOOP
//--------------- Text handling routines
:TEXT_init
:TEXT_show
:TEXT_show_perm
:TEXT_clear
:TEXT_save
:TEXT_load
:TEXT_input
:TEXT_edit
:TEXT_num_input
:TEXT_copy
//-----------------Sound handling routines
:MAKE_SOUND_NAME
:SOUND_GO
:SOUND_STOP
:MAKE_AMB_NAME
:AMB_GO
:AMB_STOP
:AMB_RESTART
:GENERATE_AUDIOCODE
//--------------- Actor loading thread/routines
:ACTOR_LOAD_THREAD
:generic_actor_load
:generic_actor_unload
//--------------- Actor animation thread
:ANIMATION_THREAD
//--------------- Mainmenu routines
:ROUTINE_enterspace_release
:GEN_MENU
:GEN_CONFIRM_ACTION
:DESIGNMODE_ON
:DESIGNMODE_OFF
:MAINMENU_THREAD
:MENUSNIFFER
:MAINMENU
:MAINMENULOOP
//-----------------load/save file handling
:SELECT_FILE
:SF_CANCEL
:SAVE_FILE
:SAVE_NAMED_FILE
:PUBLISH_FILE
:STORE_FILE
:CLEAR_NAMED_FILE
:SET_NAMED_FILE
:GET_NAMED_FILE
:LOAD_FILE
:LOAD_NAMED_FILE
:READ_FILE
:SAVE_STORYLINE
:LOAD_STORYLINE
:SAVE_PROGRESS
:LOAD_PROGRESS
//----------------- find near xxx routines
:FIND_NEAR_ACTOR
:FIND_NEAR_CAR
:FIND_NEAR_PICKUP
:FIND_NEAR_OBJECT
:FIND_NEAR_TRIGGER
:FIND_NEAR_OBJECTIVE
:FIND_NEAR_SELECT
//----------------- point chain routines
:FIND_FREE_POINT
:DUPLICATE_POINT_CHAIN
:FREE_POINT_CHAIN
//----------------- selectors/choice/entry routines
:SELECT_ACTOR_MODEL
:SELECT_WEAPON_MODEL
:SELECT_ANIMATION
:KEEP_ROUTE_MENU

:SELECT_CAR_MODEL
:SELECT_CAR_MODEL_EDIT
:CARMODEL_SELECTION

:SELECT_PICKUP_MODE
:PICKUPMENU2
:SELECT_PICKUP_MODEL
:PICK_WEAPON_PICKUP
:PICK_OTHER_PICKUP
:PICKUP_LOCATION

:MOVE_CAM_AROUND_OBJECT
:MOVE_AROUND_CAM

:SELECT_TRIGGER_FILE
:SELECT_ICON
:SELECT_TRIGGER_AFTER
:ENCODE_REWARD
:DECODE_REWARD
:SELECT_TRIGGER_REWARD
:RWMENU

:SELECT_CAMERA_POSITION
:SELECT_CAMERA_MODE

:SELECT_MARKER_COLOR
:SELECT_MARKER_MODEL
:SELECT_OBJECT_DISTANCE
:SELECT_DAYTIME
:SELECT_OBJECTIVE_DAYTIME
:SELECT_WEATHER
:SELECT_OBJECTIVE_WEATHER
:SELECT_OBJECTIVE_WANTED
:SELECT_OBJECTIVE_WANTEDMAX
:SELECT_OBJECTIVE_WANTEDMIN
:SELECT_OBJECTIVE_PEDS
:SELECT_SPECIAL_DURATION
:SELECT_TIME
:SELECT_TIMELIMIT
:SELECT_OBJ_TIME_LIMIT
:SELECT_SHOW_TIMEOUT

:EFFECT_GETNAME
:OBJECT_APPEAR
:ROUTE_OBJECT
:MOVE_OBJECT
:SELECT_OBJECT
:SELECT_OBJECT_GEN
//====================================== create/destroy DESIGNITEMS
:CLEAR_DESIGN_ITEMS
:CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
:DUMMY_OBJECT
:DUMMY_CAR
:DUMMY_ACTOR
:DUMMY_PICKUP
:DUMMY_TRIGGER
:DUMMY_PLAYER
:SHOW_DESIGN_ITEMS
:SHOW_DESIGN_ITEMS_OBJECTIVESONLY

//----------------- player routines
:PLAYER_MENU
:EDIT_PLAYER
:DEFINE_PLAYER
//----------------- actor routines
:ACTOR_MENU
:ACTOR_SET_LOCATION
:ACTOR_CLEAR_ROUTE
:actor_add_duplicate 
:ADDACTOR
:SPAWNACTOR
:HIDEACTOR
:EDITACTOR
:DELETE_ACTOR
//----------------- vehicle routines
:CARMENU
:CAR_SET_LOCATION
:ADDCAR
:SPAWNCAR
:HIDECAR
:EDITCAR
:DELETE_CAR
//----------------- pickup routines
:PICKUP_CAM
:PICKUP_COPY_OUT
:PICKUP_COPY_IN
:ADDPICKUP
:SPAWNPICKUP
:HIDEPICKUP
:EDITPICKUP
:DELETE_PICKUP
//----------------- object routines
:OBJECTMENU
:OBJECT_CAM
:OBJECT_DESTROY
:ADDOBJECT
:SPAWNOBJECT
:HIDEOBJECT
:EDITOBJECT
:DELETE_OBJECT
//----------------- trigger routines
:ADDTRIGGER
:EDITTRIGGER
:DELETE_TRIGGER
//----------------- OBJECTIVES routines
:EDIT_OBJECTIVE
:COPY_OBJECTIVE
:GEN_OBJECTIVE_CAMERA
:DELETE_OBJECTIVE
:MOVE_OBJECTIVE
:SELECT_OBJECTIVE
:NEW_OBJECTIVE
:NEW_OBJTEXT
:EDIT_OBJTEXT

:OBJECTIVE_ACTOR_MENU
:ADD_OBJECTIVE_ACTOR
:EDIT_OBJECTIVE_ACTOR

:OBJECTIVE_CAR_MENU
:ADD_OBJECTIVE_CAR
:EDIT_OBJECTIVE_CAR

:OBJECTIVE_PICKUP_MENU
:ADD_OBJECTIVE_PICKUP
:EDIT_OBJECTIVE_PICKUP

:ADD_OBJECTIVE_MARKER
:EDIT_OBJECTIVE_MARKER

:ADD_OBJECTIVE_TELEPORT
:EDIT_OBJECTIVE_TELEPORT

:CSMENU
:ADD_OBJECTIVE_CUTSCENE
:EDIT_OBJECTIVE_CUTSCENE

:ADD_OBJECTIVE_COUNTDOWN
:EDIT_OBJECTIVE_COUNTDOWN

:ADD_OBJECTIVE_TELECAR
:EDIT_OBJECTIVE_TELECAR

:ADD_OBJECTIVE_TIMEOUT
:EDIT_OBJECTIVE_TIMEOUT

:ADD_OBJECTIVE_WEATHER
:EDIT_OBJECTIVE_WEATHER

:ADD_OBJECTIVE_SETTIME
:EDIT_OBJECTIVE_SETTIME

:ADD_OBJECTIVE_PEDS
:EDIT_OBJECTIVE_PEDS

:ADD_OBJECTIVE_WANTED
:EDIT_OBJECTIVE_WANTED

:ADD_OBJECTIVE_TIMELIMIT
:EDIT_OBJECTIVE_TIMELIMIT

:ADD_OBJECTIVE_TIMERON
:EDIT_OBJECTIVE_TIMERON

:ADD_OBJECTIVE_NOWEAPON
:EDIT_OBJECTIVE_NOWEAPON

:ADD_OBJECTIVE_PHONE
:EDIT_OBJECTIVE_PHONE

:OBJECTIVE_OBJECT_MENU
:ADD_OBJECTIVE_OBJECT
:EDIT_OBJECTIVE_OBJECT

:ADD_OBJECTIVE_ADDMONEY
:EDIT_OBJECTIVE_ADDMONEY

:ADD_OBJECTIVE_SUBMONEY
:EDIT_OBJECTIVE_SUBMONEY

:ADD_OBJECTIVE_ANIMATION
:EDIT_OBJECTIVE_ANIMATION

//--------------------- Helper threads
:DYOMINTRO_THREAD
:INTRO_THREAD
:SPHERE_THREAD
:HUNGER_THREAD
:INFO_THREAD
:HELI_PILOT
:HELI_CHECK
:PLANE_PILOT
:CAR_DRIVER
:PROX_MOVE
:PERM_MOVE
//---------------------- Parachute thread
:PLCHUTE
//----------------------- Storyline routines
:story_enable_missions
:load_mission
:run_mission
:STORYLINE_THREAD
:STORYLINE_CLEANUP
:XPLO_THREAD
//==================================== MISSIONS
:INITIAL
// Main mission player
:DYOM_MISSION

// interior selection tool
:INTTOOL_MISSION
// jumpto Marker tool
:JTOMTOOL_MISSION
// jumpto objective tool
:JTOCTOOL_MISSION
}

//==================================================
// DO NOT EDIT OBJECTLIST, ONLY ADD ITEMS AT THE END
// TO MAINTAIN BACKWARDS COMPATIBILITY
//==================================================
DEFINE OBJECTS 388
DEFINE OBJECT SANNY BUILDER 3.04      
DEFINE OBJECT CJ_MONEY_BAG // Object number -1
DEFINE OBJECT TRAFFICCONE // Object number -2
DEFINE OBJECT CLOTHESP // Object number -3
DEFINE OBJECT GREEN_GLOOP // Object number -4
DEFINE OBJECT BRIEFCASE // Object number -5
DEFINE OBJECT KMB_RHYMESBOOK // Object number -6
DEFINE OBJECT IMY_SHASH_WALL // Object number -7
DEFINE OBJECT HEALTH // Object number -8
DEFINE OBJECT BODYARMOUR // Object number -9
DEFINE OBJECT BRIBE // Object number -10
DEFINE OBJECT KEYCARD // Object number -11
DEFINE OBJECT GUNPARA // Object number -12
DEFINE OBJECT INFO // Object number -13
DEFINE OBJECT CAMERAPICKUP // Object number -14
DEFINE OBJECT MONEY // Object number -15
DEFINE OBJECT CIGAR_GLOW    -16
DEFINE OBJECT WATERJUMP1 // Object number -17
DEFINE OBJECT LANDJUMP2 // Object number -18
DEFINE OBJECT WATERJUMPX2 // Object number -19
DEFINE OBJECT DYN_RAMP // Object number -20
DEFINE OBJECT AD_JUMP // Object number -21
DEFINE OBJECT ROADWORKBARRIER1 // Object number -22
DEFINE OBJECT DYN_ROADBARRIER_2 // Object number -23
DEFINE OBJECT DYN_ROADBARRIER_3 // Object number -24
DEFINE OBJECT DYN_ROADBARRIER_4 // Object number -25
DEFINE OBJECT IMY_TRACK_BARRIER // Object number -26
DEFINE OBJECT BARRIER_4ANDY // Object number -27
DEFINE OBJECT WS_APGATE // Object number -28
DEFINE OBJECT GATE_AUTOL // Object number -29
DEFINE OBJECT GATE_AUTOR // Object number -30
DEFINE OBJECT WONGS_GATE // Object number -31
DEFINE OBJECT CT_GATEXR // Object number -32
DEFINE OBJECT KMB_SHUTTER // Object number -33
DEFINE OBJECT SFCOPDR // Object number -34
DEFINE OBJECT AD_FLATDOOR // Object number -35
DEFINE OBJECT KB_BANDIT_U // Object number -36
DEFINE OBJECT ROULETTE_TBL // Object number -37
DEFINE OBJECT OTB_MACHINE // Object number -38
DEFINE OBJECT CJ_COIN_OP_3 // Object number -39
DEFINE OBJECT CJ_COIN_OP_2 // Object number -40
DEFINE OBJECT CJ_COIN_OP_1 // Object number -41
DEFINE OBJECT CJ_COIN_OP // Object number -42
DEFINE OBJECT SWANK_CONSOLE // Object number -43
DEFINE OBJECT SNESISH // Object number -44
DEFINE OBJECT LOW_CONSOLE // Object number -45
DEFINE OBJECT VENDMACHFD // Object number -46
DEFINE OBJECT VENDIN3 // Object number -47
DEFINE OBJECT CJ_SPRUNK1 // Object number -48
DEFINE OBJECT CJ_CANDYVENDOR // Object number -49
DEFINE OBJECT CJ_EXT_CANDY // Object number -50
DEFINE OBJECT CJ_EXT_SPRUNK // Object number -51
DEFINE OBJECT ICESCART_PROP // Object number -52
DEFINE OBJECT CHILLIDOGCART // Object number -53
DEFINE OBJECT NOODLECART_PROP // Object number -54
DEFINE OBJECT GYM_BIKE // Object number -55
DEFINE OBJECT GYM_BENCH1 // Object number -56
DEFINE OBJECT GYM_TREADMILL // Object number -57
DEFINE OBJECT GYM_MAT1 // Object number -58
DEFINE OBJECT BSKBALL_LAX // Object number -59
DEFINE OBJECT VGSXREFBBALLNET // Object number -60
DEFINE OBJECT VGSXREFBBALLNET2 // Object number -61
DEFINE OBJECT K_POOLTABLESM // Object number -62
DEFINE OBJECT NEIL_SLOT // Object number -63
DEFINE OBJECT CJ_SLOT_BANK // Object number -64
DEFINE OBJECT BLCK_JACK // Object number -65
DEFINE OBJECT WHEEL_O_FORTUNE // Object number -66
DEFINE OBJECT WOODENBOX // Object number -67
DEFINE OBJECT NF_BLACKBOARD // Object number -68
DEFINE OBJECT GEN_DOOREXT03 // Object number -69
DEFINE OBJECT GEN_DOOREXT07 // Object number -70
DEFINE OBJECT GEN_DOORSHOP02 // Object number -71
DEFINE OBJECT GEN_DOOREXT04 // Object number -72
DEFINE OBJECT GEN_DOORSHOP3 // Object number -73
DEFINE OBJECT CUNTGIRLDOOR // Object number -74
DEFINE OBJECT PIZZAHIGH // Object number -75
DEFINE OBJECT CJ_PIZZA_1 // Object number -76
DEFINE OBJECT CJ_PIZZA_2 // Object number -77
DEFINE OBJECT BURGERHIGH // Object number -78
DEFINE OBJECT CJ_BURG_1 // Object number -79
DEFINE OBJECT CJ_BURG_2 // Object number -80
DEFINE OBJECT CIGAR // Object number -81
DEFINE OBJECT TRDCSGRGDOOR_LVS // Object number -82
DEFINE OBJECT CR_DOOR_01 // Object number -83
DEFINE OBJECT CR_DOOR_03 // Object number -84
DEFINE OBJECT SHUTTER_VEGAS // Object number -85
DEFINE OBJECT CR1_DOOR // Object number -86
DEFINE OBJECT A51_BLASTDOORR // Object number -87
DEFINE OBJECT A51_BLASTDOORL // Object number -88
DEFINE OBJECT A51_LABDOOR // Object number -89
DEFINE OBJECT A51_JETDOOR // Object number -90
DEFINE OBJECT PORTAKABIN // Object number -91
DEFINE OBJECT FREIGHT_SFW_DOOR // Object number -92
DEFINE OBJECT AB_CASDORLOK // Object number -93
DEFINE OBJECT IMY_SHASH_WALL // Object number -94
DEFINE OBJECT TWRCRANE_M_04 // Object number -95
DEFINE OBJECT TWRCRANE_M_01 // Object number -96
DEFINE OBJECT A51_VENTCOVERB // Object number -97
DEFINE OBJECT CARRIER_DOOR_SFSE // Object number -98
DEFINE OBJECT CARRIER_LIFT2_SFSE // Object number -99
DEFINE OBJECT CARRIER_LIFT1_SFSE // Object number -100
DEFINE OBJECT GWFORUM1_LAE // Object number -101
DEFINE OBJECT GANGSHOPS4_LAE2 // Object number -102
DEFINE OBJECT K_POOLQ // Object number -103
DEFINE OBJECT K_POOLBALLCUE // Object number -104
DEFINE OBJECT K_POOLBALLSPT01 // Object number -105
DEFINE OBJECT K_POOLBALLSPT02 // Object number -106
DEFINE OBJECT K_POOLBALLSPT03 // Object number -107
DEFINE OBJECT K_POOLBALLSPT04 // Object number -108
DEFINE OBJECT K_POOLBALLSPT05 // Object number -109
DEFINE OBJECT K_POOLBALLSPT06 // Object number -110
DEFINE OBJECT K_POOLBALLSPT07 // Object number -111
DEFINE OBJECT K_POOLBALL8 // Object number -112
DEFINE OBJECT K_POOLBALLSTP01 // Object number -113
DEFINE OBJECT K_POOLBALLSTP02 // Object number -114
DEFINE OBJECT K_POOLBALLSTP03 // Object number -115
DEFINE OBJECT K_POOLBALLSTP04 // Object number -116
DEFINE OBJECT K_POOLBALLSTP05 // Object number -117
DEFINE OBJECT K_POOLBALLSTP06 // Object number -118
DEFINE OBJECT K_POOLBALLSTP07 // Object number -119
DEFINE OBJECT K_POOLQ2 // Object number -120
DEFINE OBJECT DYN_WINE_BIG // Object number -121
DEFINE OBJECT KB_BEER // Object number -122
DEFINE OBJECT CASKET_LAW // Object number -123
DEFINE OBJECT BD_WINDOW // Object number -124
DEFINE OBJECT CR_AMMOBOX // Object number -125
DEFINE OBJECT BD_WINDOW_SHATTER // Object number -126
DEFINE OBJECT SEC_KEYPAD // Object number -127
DEFINE OBJECT KMB_RAMP // Object number -128
DEFINE OBJECT IMCMPTRKDRL_LAS // Object number -129
DEFINE OBJECT IMCMPTRKDRR_LAS // Object number -130
DEFINE OBJECT IMCOMPMOVEDR1_LAS // Object number -131
DEFINE OBJECT BARREL4 // Object number -132
DEFINE OBJECT IMY_BBOX // Object number -133
DEFINE OBJECT IMY_LA_DOOR // Object number -134
DEFINE OBJECT DB_AMMO // Object number -135
DEFINE OBJECT MED_BED_8 // Object number -136
DEFINE OBJECT CR_GUNCRATE // Object number -137
DEFINE OBJECT GUNBOX // Object number -138
DEFINE OBJECT TMP_BIN // Object number -139
DEFINE OBJECT AMMOTRN_OBJ // Object number -140
DEFINE OBJECT KMB_FRONTGATE // Object number -141
DEFINE OBJECT WAREHOUSE_DOOR2B // Object number -142
DEFINE OBJECT WAREHOUSE_DOOR1 // Object number -143
DEFINE OBJECT CJ_CARDBRD_PICKUP // Object number -144
DEFINE OBJECT CM_BOX // Object number -145
DEFINE OBJECT FAKE_MULE_COL // Object number -146
DEFINE OBJECT CARDBOARDBOX2 // Object number -147
DEFINE OBJECT LAE_SMOKECUTSCENE // Object number -148
DEFINE OBJECT IMMMCRAN // Object number -149
DEFINE OBJECT KMB_SKIP // Object number -150
DEFINE OBJECT STORM_DRAIN_COVER // Object number -151
DEFINE OBJECT WHEEL_OR1 // Object number -152
DEFINE OBJECT DYN_WOODPILE2 // Object number -153
DEFINE OBJECT KMB_RHYMESBOOK // Object number -154
DEFINE OBJECT CJ_JUICE_CAN // Object number -155
DEFINE OBJECT KMB_GOFLAG // Object number -156
DEFINE OBJECT IMY_SKYLIGHT // Object number -157
DEFINE OBJECT KMB_TROLLEY // Object number -158
DEFINE OBJECT LXR_MOTEL_DOORSIM // Object number -159
DEFINE OBJECT LXR_MOTELVENT // Object number -160
DEFINE OBJECT DYN_SCAFFOLD_4B // Object number -161
DEFINE OBJECT MUNCH_DONUT // Object number -162
DEFINE OBJECT WD_FENCE_ANIM // Object number -163
DEFINE OBJECT CHOPCOP_ARMR // Object number -164
DEFINE OBJECT CHOPCOP_LEGR // Object number -165
DEFINE OBJECT CHOPCOP_HEAD // Object number -166
DEFINE OBJECT CHOPCOP_TORSO // Object number -167
DEFINE OBJECT CHOPCOP_ARML // Object number -168
DEFINE OBJECT CHOPCOP_LEGL // Object number -169
DEFINE OBJECT DYN_SCAFFOLD_3B // Object number -170
DEFINE OBJECT KMB_ATM1 // Object number -171
DEFINE OBJECT KMB_ATM2 // Object number -172
DEFINE OBJECT KMB_ATM3 // Object number -173
DEFINE OBJECT MTSAFE // Object number -174
DEFINE OBJECT MAN_SAFENEW // Object number -175
DEFINE OBJECT KEV_SAFE // Object number -176
DEFINE OBJECT RIDER1_DOOR // Object number -177
DEFINE OBJECT KMB_MARIJUANA // Object number -178
DEFINE OBJECT SW_HAYBREAK02 // Object number -179
DEFINE OBJECT GRASSPLANT // Object number -180
DEFINE OBJECT PARKBENCH1 // Object number -181
DEFINE OBJECT PORTALOO // Object number -182
DEFINE OBJECT CLOTHESP // Object number -183
DEFINE OBJECT LAMPPOST3 // Object number -184
DEFINE OBJECT CT_STALL1 // Object number -185
DEFINE OBJECT CT_TABLE // Object number -186
DEFINE OBJECT CHINATGARAGEDOOR // Object number -187
DEFINE OBJECT CHINA_TOWN_GATEB // Object number -188
DEFINE OBJECT A51_SPOTBASE // Object number -189
DEFINE OBJECT A51_SPOTHOUSING // Object number -190
DEFINE OBJECT A51_SPOTBULB // Object number -191
DEFINE OBJECT KMB_CONTAINER_RED // Object number -192
DEFINE OBJECT CJ_CHRIS_CRATE // Object number -193
DEFINE OBJECT CJ_CHRIS_CRATE_LD // Object number -194
DEFINE OBJECT CJ_CHRIS_CRATE_RD // Object number -195
DEFINE OBJECT CJ_PADLOCK // Object number -196
DEFINE OBJECT MOBILE1993B // Object number -197
DEFINE OBJECT KMB_PACKET // Object number -198
DEFINE OBJECT NTO_B_S // Object number -199
DEFINE OBJECT CARDBOARDBOX // Object number -200
DEFINE OBJECT DYN_DUMPSTER // Object number -201
DEFINE OBJECT KMB_CONTAINER_BLUE // Object number -202
DEFINE OBJECT KMB_CONTAINER_YEL // Object number -203
DEFINE OBJECT KMB_CONTAINER_OPEN // Object number -204
DEFINE OBJECT TEMP_STINGER2 // Object number -205
DEFINE OBJECT TRAFFICCONE // Object number -206
DEFINE OBJECT GARYS_LUV_RAMP // Object number -207
DEFINE OBJECT AD_ROADMARK1 // Object number -208
DEFINE OBJECT AD_ROADMARK2 // Object number -209
DEFINE OBJECT AD_FINISH // Object number -210
DEFINE OBJECT MINIGUN_BASE // Object number -211
DEFINE OBJECT WONGS_ERECTION // Object number -212
DEFINE OBJECT WONGS_ERECTION2 // Object number -213
DEFINE OBJECT RCBOMB // Object number -214
DEFINE OBJECT BARREL2 // Object number -215
DEFINE OBJECT MINI_MAGNET // Object number -216
DEFINE OBJECT KMB_PLANK // Object number -217
DEFINE OBJECT KMB_HOLDALL // Object number -218
DEFINE OBJECT KMB_PARACHUTE // Object number -219
DEFINE OBJECT AMMO_CAPSULE // Object number -220
DEFINE OBJECT BARREL1 // Object number -221
DEFINE OBJECT KB_BARREL // Object number -222
DEFINE OBJECT CR_CRATESTACK // Object number -223
DEFINE OBJECT D9_RUNWAY // Object number -224
DEFINE OBJECT CARGO_TEST // Object number -225
DEFINE OBJECT CARGO_STUFF // Object number -226
DEFINE OBJECT CARGO_STORE // Object number -227
DEFINE OBJECT KMILITARY_CRATE // Object number -228
DEFINE OBJECT KMILITARY_BASE // Object number -229
DEFINE OBJECT BLOCKPALLET // Object number -230
DEFINE OBJECT TEMP_CRATE1 // Object number -231
DEFINE OBJECT K_SMASHBOXES // Object number -232
DEFINE OBJECT K_CARGO1 // Object number -233
DEFINE OBJECT K_CARGO4 // Object number -234
DEFINE OBJECT BASEJUMP_TARGET // Object number -235
DEFINE OBJECT DES_QUARRYGATE2 // Object number -236
DEFINE OBJECT DES_QUARRYGATE // Object number -237
DEFINE OBJECT CJ_DYN_PLUNGE_1 // Object number -238
DEFINE OBJECT DYNAMITE // Object number -239
DEFINE OBJECT DYNO_BOX_A // Object number -240
DEFINE OBJECT DYNO_BOX_B // Object number -241
DEFINE OBJECT PRIVATESIGN3 // Object number -242
DEFINE OBJECT PRIVATESIGN1 // Object number -243
DEFINE OBJECT CJ_CHIP_MAKER_BITS // Object number -244
DEFINE OBJECT CJ_CHIP_MAKER // Object number -245
DEFINE OBJECT CJ_WHEELCHAIR1 // Object number -246
DEFINE OBJECT AB_CARCASS // Object number -247
DEFINE OBJECT AB_HOOK // Object number -248
DEFINE OBJECT FREEZER_DOOR // Object number -249
DEFINE OBJECT CJ_MEAT_BAG_1 // Object number -250
DEFINE OBJECT CJ_MEAT_1 // Object number -251
DEFINE OBJECT CJ_MEAT_2 // Object number -252
DEFINE OBJECT JET_BAGGAGE_DOOR // Object number -253
DEFINE OBJECT JET_INTERIOR // Object number -254
DEFINE OBJECT SMLPLANE_DOOR // Object number -255
DEFINE OBJECT JET_DOOR // Object number -256
DEFINE OBJECT SMASH_BOX_STAY // Object number -257
DEFINE OBJECT SMASH_BOX_BRK // Object number -258
DEFINE OBJECT SMASHBOXPILE // Object number -259
DEFINE OBJECT ST_ARCH_PLAN // Object number -260
DEFINE OBJECT GEN_DOORINT01 // Object number -261
DEFINE OBJECT KMB_LOCKEDDOOR // Object number -262
DEFINE OBJECT DYN_AIRCON // Object number -263
DEFINE OBJECT GENERATOR_BIG // Object number -264
DEFINE OBJECT AB_VAULTDOOR // Object number -265
DEFINE OBJECT GENERATOR_BIG_D // Object number -266
DEFINE OBJECT CARGO_REAR // Object number -267
DEFINE OBJECT D9_RAMP // Object number -268
DEFINE OBJECT OPMANS01_CUNTE // Object number -269
DEFINE OBJECT MISSILE_07_SFXR // Object number -270
DEFINE OBJECT KMB_KEYPAD // Object number -271
DEFINE OBJECT BBALL_INGAME // Object number -272
DEFINE OBJECT LA_FUCKCAR1 // Object number -273
DEFINE OBJECT LA_FUCKCAR2 // Object number -274
DEFINE OBJECT TARGET_FRAME // Object number -275
DEFINE OBJECT TARGET_LLEG // Object number -276
DEFINE OBJECT TARGET_RLEG // Object number -277
DEFINE OBJECT TARGET_LTORSO // Object number -278
DEFINE OBJECT TARGET_RTORSO // Object number -279
DEFINE OBJECT TARGET_LARM // Object number -280
DEFINE OBJECT TARGET_RARM // Object number -281
DEFINE OBJECT TARGET_HEAD // Object number -282
DEFINE OBJECT DEAD_TIED_COP // Object number -283
DEFINE OBJECT DYN_QUARRYROCK03 // Object number -284
DEFINE OBJECT BLACKBAG2 // Object number -285
DEFINE OBJECT DYN_WOODPILE // Object number -286
DEFINE OBJECT DYN_QUARRYROCK02 // Object number -287
DEFINE OBJECT BOUY // Object number -288
DEFINE OBJECT BB_PICKUP // Object number -289
DEFINE OBJECT CHIP_STACK07 // Object number -290
DEFINE OBJECT CHIP_STACK08 // Object number -291
DEFINE OBJECT CHIP_STACK12 // Object number -292
DEFINE OBJECT CHIP_STACK09 // Object number -293
DEFINE OBJECT CHIP_STACK11 // Object number -294
DEFINE OBJECT WHEEL_WEE // Object number -295
DEFINE OBJECT ROULETTE_MARKER // Object number -296
DEFINE OBJECT KMB_BPRESS // Object number -297
DEFINE OBJECT BEACHTOWEL01 // Object number -298
DEFINE OBJECT BEACHTOWEL03 // Object number -299
DEFINE OBJECT BEACHTOWEL04 // Object number -300
DEFINE OBJECT KMB_DUMBBELL_R // Object number -301
DEFINE OBJECT KMB_DUMBBELL_L // Object number -302
DEFINE OBJECT BBALL_COL // Object number -303
DEFINE OBJECT KMB_ROCK // Object number -304
DEFINE OBJECT CHIP_STACK10 // Object number -305
DEFINE OBJECT CHIP_STACK13 // Object number -306
DEFINE OBJECT CHIP_STACK14 // Object number -307
DEFINE OBJECT WHEEL_SUPPORT // Object number -308
DEFINE OBJECT WHEEL_TABLE // Object number -309
DEFINE OBJECT CLICKER // Object number -310
DEFINE OBJECT CJ_FF_TILL_QUE // Object number -311
DEFINE OBJECT CJ_BURG_CHAIR // Object number -312
DEFINE OBJECT CJ_PIZZA_CHAIR // Object number -313
DEFINE OBJECT CJ_PIZZA_CHAIR2 // Object number -314
DEFINE OBJECT CJ_PIZZA_CHAIR3 // Object number -315
DEFINE OBJECT CJ_BARSTOOL // Object number -316
DEFINE OBJECT CJ_BINCO_DOOR // Object number -317
DEFINE OBJECT CJ_SUBURB_DOOR_2 // Object number -318
DEFINE OBJECT CJ_PRO_DOOR_01 // Object number -319
DEFINE OBJECT CJ_GAP_DOOR_ // Object number -320
DEFINE OBJECT CJ_VICTIM_DOOR // Object number -321
DEFINE OBJECT CJ_DS_DOOR // Object number -322
DEFINE OBJECT PIZZALOW // Object number -323
DEFINE OBJECT PIZZAMED // Object number -324
DEFINE OBJECT PIZZA_HEALTHY // Object number -325
DEFINE OBJECT CLUCKLOW // Object number -326
DEFINE OBJECT CLUCKMED // Object number -327
DEFINE OBJECT CLUCKHIGH // Object number -328
DEFINE OBJECT CLUCK_HEALTHY // Object number -329
DEFINE OBJECT BURGERLOW // Object number -330
DEFINE OBJECT BURGERMED // Object number -331
DEFINE OBJECT BURGER_HEALTHY // Object number -332
DEFINE OBJECT POLICE_BARRIER // Object number -333
DEFINE OBJECT LAESKATETUBE1 // Object number -334
DEFINE OBJECT SFSE_ROADBLOCK5
DEFINE OBJECT SFSE_ROADBLOCK2
DEFINE OBJECT SUB_ROADRIGHT
DEFINE OBJECT SUB_ROADLEFT
DEFINE OBJECT ESCL_SINGLELA
DEFINE OBJECT FER_CARS3_SFE
DEFINE OBJECT VICJUMP_SFE
DEFINE OBJECT OTTOS_RAMP
DEFINE OBJECT ODRAMPBIT
DEFINE OBJECT IMCOMPSTRS02
DEFINE OBJECT LHROOFST14
DEFINE OBJECT A51_SPOTTOWER
DEFINE OBJECT DK_CARGOSHP03D
DEFINE OBJECT W7BARK
DEFINE OBJECT NWDKBRIDD_LAS2
DEFINE OBJECT SW_JETTY
DEFINE OBJECT LOOPBIG
DEFINE OBJECT LOOPWEE
DEFINE OBJECT KICKRAMP06
DEFINE OBJECT SF_JUMP
DEFINE OBJECT CONCPIPE_SFXRF
DEFINE OBJECT ELECSTIONV_SFS
DEFINE OBJECT DES_GUNBLDG01
DEFINE OBJECT CRGOSTNTRMP
DEFINE OBJECT SW_CONT05
DEFINE OBJECT LAS2DKWAR04
DEFINE OBJECT SFNVILLA001_CM
DEFINE OBJECT VGSSREDBRIX02
DEFINE OBJECT DES_INDRUIN02
DEFINE OBJECT DES_PUEBLO3
DEFINE OBJECT DES_PUEBLO4
DEFINE OBJECT DES_PUEBLO06
DEFINE OBJECT DES_PUEBLO1
DEFINE OBJECT BIGHANGAR1_SFX
DEFINE OBJECT GAZ4_LAW
DEFINE OBJECT CHATEAU01_LAWN
DEFINE OBJECT COMPBIGHO2_LAE
DEFINE OBJECT COMPMEDHOS4_LAE
DEFINE OBJECT LOGCABINN01
DEFINE OBJECT OFFICEDESK1
DEFINE OBJECT KB_SWIVELCHAIR2
DEFINE OBJECT DYN_TABLE_03
DEFINE OBJECT MRK_SEATING1
DEFINE OBJECT MRK_BED1
DEFINE OBJECT VEG_TREEA3
DEFINE OBJECT VEG_PALWEE01
DEFINE OBJECT VEG_PALMBIG14
DEFINE OBJECT SJMCACTI03
DEFINE OBJECT PINETREE01
DEFINE OBJECT FIRTREE2
DEFINE OBJECT SM_VEG_TREE5
DEFINE OBJECT AW_STREETTREE1
DEFINE OBJECT SUBMARR_SFE

DEFINE MISSIONS 5
DEFINE MISSION 0 AT @INITIAL
DEFINE MISSION 1 AT @DYOM_MISSION
DEFINE MISSION 2 AT @INTTOOL_MISSION
DEFINE MISSION 3 AT @JTOMTOOL_MISSION
DEFINE MISSION 4 AT @JTOCTOOL_MISSION
DEFINE EXTERNAL_SCRIPTS 0 // Use -1 in order not to compile AAA script
//DEFINE SCRIPT {NAME}  AT {LABEL} @
DEFINE UNKNOWN_EMPTY_SEGMENT 0
DEFINE UNKNOWN_THREADS_MEMORY 0                                                                                                                      

{$VERSION 3.0.0000}
var
 $PLAYER_CHAR: Player
end // var 
03A4: name_thread 'MAIN' 
01F0: set_max_wanted_level_to 0   
0111: toggle_wasted_busted_check 0
08F8: display_stat_update_box 0  
00C0: set_current_time_hours_to 8 minutes_to 0 
04E4: unknown_refresh_game_renderer_at 2488.56 -1666.84 
03CB: set_rendering_origin_at 2488.56 -1666.84 13.38 
0053: $PLAYER_CHAR = create_player #NULL at 2488.56 -1666.84 12.38 
01F5: $PLAYER_ACTOR = create_player_actor $PLAYER_CHAR 
07AF: $PLAYER_GROUP = player $PLAYER_CHAR group 
0373: set_camera_directly_behind_player 
01B6: set_weather 0 
0001: wait 0 ms 
087B: set_player $PLAYER_CHAR clothes_texture "PLAYER_FACE" model "HEAD" body_part 1 
087B: set_player $PLAYER_CHAR clothes_texture "JEANSDENIM" model "JEANS" body_part 2 
087B: set_player $PLAYER_CHAR clothes_texture "SNEAKERBINCBLK" model "SNEAKER" body_part 3 
087B: set_player $PLAYER_CHAR clothes_texture "VEST" model "VEST" body_part 0 
070D: rebuild_player $PLAYER_CHAR 
01B4: toggle_player $PLAYER_CHAR can_move 1 
0109: player $PLAYER_CHAR money += 10000 
                                         
04BB: select_interior 0 

0629: change_integer_stat 181 to 4 
0180: set_on_mission_flag_to $ONMISSION 
0004: $DEFAULT_WAIT_TIME = 250
$INITIAL_STARTUP = 1
$INITDONE = 0
$DYOM_AUTORUN = 0
$DYOM_IN_STORY = 0
$DYOM_IN_INTRO = 0
03E6: remove_text_box 

06C8: enable_riot 0
03BA: clear_cars_from_cube_cornerA -3000.0 -3000.0 -100.0 cornerB 3000.0 3000.0 2000.0
042B: clear_peds_from_cube_cornerA -3000.0 -3000.0 -100.0 cornerB 3000.0 3000.0 2000.0 
01EB: set_traffic_density_multiplier_to 0.0 
03DE: set_pedestrians_density_multiplier_to 0.0 

gosub @TEXT_init
gosub @DESIGNMODE_ON

create_thread @ACTOR_LOAD_THREAD
create_thread @ANIMATION_THREAD

0417: start_mission 0  // Initial 
repeat
  wait 10
until $INITDONE == 1

if NOT $DYOM_IN_STORY == 1
then
    gosub @SHOW_DESIGN_ITEMS
end
gosub @GENERATE_AUDIOCODE

// start threads
create_thread @INFO_THREAD 
create_thread @SPHERE_THREAD 
create_thread @MAINMENU_THREAD     // <=== Here is where it all happens
create_thread @DYOMINTRO_THREAD 
create_thread @HUNGER_THREAD 
                                                
// The sole purpose of the mainloop, is to test wether the parachute thread should be activated/deacticated
// All further DYOM functionality is handled in the MAINMENU thread
:MAIN_LOOP
while true
    repeat
      repeat
        wait 50
      until Player.Defined($PLAYER_CHAR)
    until Actor.HasWeapon($PLAYER_ACTOR, 46)
    00D7: create_thread @PLCHUTE
    repeat 
      repeat
        wait 50
      until Player.Defined($PLAYER_CHAR)
    until not Actor.HasWeapon($PLAYER_ACTOR, 46)
    0459: end_thread_named 'PLCHUTE' 
end


var
$TEMPVAR_FLOAT_1:Float
$TEMPVAR_FLOAT_2:Float
$TEMPVAR_FLOAT_3:Float
$TEMPVAR_FLOAT_4:Float
$TEMPVAR_FLOAT_5:Float
$TEMPVAR_FLOAT_6:Float
$TEMPVAR_FLOAT_7:Float
$TEMP_INTERIOR:Integer
$TEMPVAR_ANGLE:Float
$DYOM_IN_STORY:Integer
$DYOM_MISSION_RESULT:Integer
$DYOM_AUTORUN:Integer
$DYOM_mission_car :integer
$DYOM_selected_slot :integer
$OBJ_I:integer    //temp 
$OBJ_M:integer    //temp
$OBJ_P:integer    //temp
end



//============================================================================
//============================================================================
//
//                  D Y O M   D A T A S T R U C T U R E S
//
//============================================================================
//============================================================================
const
DYOM_objective_max   = 100 
DYOM_actor_max       = 100  
DYOM_car_max         = 50
DYOM_pickup_max      = 50
DYOM_object_max      = 100
DYOM_point_max       = 400
DYOM_trigger_max     = 25

// $DYOM_objective_type values
DYOM_objtype_car      = 1
DYOM_objtype_marker   = 2
DYOM_objtype_pickup   = 3
DYOM_objtype_checkp   = 4
DYOM_objtype_actor    = 5
DYOM_objtype_cutscene = 6
DYOM_objtype_teleport = 7
DYOM_objtype_countdown= 8
DYOM_objtype_telecar  = 9
DYOM_objtype_timeout  = 10
DYOM_objtype_weather  = 11
DYOM_objtype_settime  = 12
DYOM_objtype_peds     = 13
DYOM_objtype_wanted   = 14
DYOM_objtype_timelimit= 15
DYOM_objtype_timeron  = 16
DYOM_objtype_noweapon = 17
DYOM_objtype_phone    = 18
DYOM_objtype_object   = 19
DYOM_objtype_addmoney = 20
DYOM_objtype_submoney = 21
DYOM_objtype_animation= 22


// Gangtypes
DYOM_gang_enemy      = 24
DYOM_gang_friend     = 25
DYOM_gang_enemy2     = 26
DYOM_gang_neutral    = 4

// Actor behaviour (Old system voor Actor properties)
DYOM_behaviour_normal    = 1
DYOM_behaviour_hold      = 2
DYOM_behaviour_aware     = 3
DYOM_behaviour_holdaware = 4
DYOM_behaviour_follow    = 5

// Actor Property 
DYOM_actorpropbit_hold     = 1
DYOM_actorpropbit_aware    = 2
DYOM_actorpropbit_follow   = 3
DYOM_actorpropbit_headshot = 4
DYOM_actorpropbit_allenemies = 5
DYOM_actorpropbit_bar      = 6
DYOM_actorpropbit_enemy2   =7

// Car Property field: bitnumbers
DYOM_carpropbit_bulletproof = 1
DYOM_carpropbit_explproof   = 2
DYOM_carpropbit_popproof    = 3
DYOM_carpropbit_damproof    = 4
DYOM_carpropbit_locked      = 5
DYOM_carpropbit_hunt        = 6
DYOM_carpropbit_ride        = 7
DYOM_carpropbit_mustdestroy = 8
DYOM_carpropbit_driveby     = 9
DYOM_carpropbit_bar         = 10

DYOM_pickuppropbit_pickall  = 1
DYOM_pickuppropbit_counter  = 2


// Cutscene behaviour (coded in property field)
DYOM_cutscene_static        = 0
DYOM_cutscene_linear        = 1
DYOM_cutscene_smooth        = 2
DYOM_cutscene_actor         = 3
DYOM_cutscene_actor_pov     = 4
DYOM_cutscene_actor_3rd     = 5
DYOM_cutscene_player        = 6
DYOM_cutscene_player_pov    = 7
DYOM_cutscene_player_3rd    = 8

// bitnummers
DYOM_cutscene_prop_slowmo   = 8
DYOM_cutscene_prop_shake    = 9
DYOM_cutscene_skip_fade     = 10
DYOM_cutscene_skip_wide     = 11


// DYOM Property field: bitnumbers
DYOM_propbit_riot           = 1
DYOM_propbit_timed          = 2
end

var
// The id that will be used for subsequent spawnwiths.
// The objective/player before it, should be Blue
$DYOM_selected_obj  : integer
$DYOM_current_objective : Integer
$select_weather: Integer
end


var
$DYOM_file_version      : integer
$DYOM_objective_count   : integer 
$DYOM_actor_count       : integer  
$DYOM_car_count         : integer
$DYOM_pickup_count      : integer
$DYOM_object_count      : integer
$DYOM_trigger_count     : integer

//Settings
//-----------------
$DYOM_timelimit         : integer     // in minutes,  0-> no limit
$DYOM_timeofday         : integer     // hour: 0-23
$DYOM_weather           : integer     // 0 - 22
$DYOM_minwantedlevel    : integer     // 0 - 6
$DYOM_maxwantedlevel    : integer     // 0 - 6 
$DYOM_properties        : integer     // vlaggen
   
//Player   
//-----------------
$DYOM_player_location_x : Float   
$DYOM_player_location_y : Float   
$DYOM_player_location_z : Float   
$DYOM_player_location_a : Float   
$DYOM_player_interior   : Integer   
$DYOM_player_model      : Integer 
$DYOM_player_weapon     : Integer 
$DYOM_player_ammo       : Integer 
$DYOM_player_health     : Integer 
$DYOM_player_handle     : Integer 
   
//Objective:
//-----------------
// One extra, to be used for temp storage when moving objectives
$DYOM_objective_location_x : array 101 of Float   
$DYOM_objective_location_y : array 101 of Float   
$DYOM_objective_location_z : array 101 of Float   
$DYOM_objective_location_a : array 101 of Float   
$DYOM_objective_interior   : array 101 of Integer   
$DYOM_objective_type       : array 101 of Integer //  (actor, car, markers, pickups, checkp)
$DYOM_objective_model      : array 101 of Integer //  (car->model, actor->model, pickups->model, checkp->type)
$DYOM_objective_data       : array 101 of Integer //  (actor->weapon, marker->size, car->color)
$DYOM_objective_ammo       : array 101 of Integer //  (marker: radarbliphandle)
$DYOM_objective_markercolor: array 101 of Integer //  (geen, of kleur van radarblip)  
$DYOM_objective_properties : array 101 of Integer 
$DYOM_objective_health     : array 101 of Integer 
$DYOM_objective_accuracy   : array 101 of Integer 
$DYOM_objective_timelimit  : array 101 of Integer //  neg = add amount, pos = new timelimit, 0 = none, -1 = stop.
$DYOM_objective_handle     : array 101 of Integer
$DYOM_objective_animation  : array 101 of Integer
$DYOM_objective_distance   : array 101 of Float

// Actor:
//-----------------
$DYOM_actor_model      : array 100 of Integer  
$DYOM_actor_gang       : array 100 of Integer     
$DYOM_actor_location_x : array 100 of Float   
$DYOM_actor_location_y : array 100 of Float   
$DYOM_actor_location_z : array 100 of Float   
$DYOM_actor_location_a : array 100 of Float 
$DYOM_actor_interior   : array 100 of Integer 
$DYOM_actor_weapon     : array 100 of Integer
$DYOM_actor_ammo       : array 100 of Integer
$DYOM_actor_properties : array 100 of Integer  
$DYOM_actor_health     : array 100 of Integer
$DYOM_actor_accuracy   : array 100 of Integer
$DYOM_actor_spawnwith  : array 100 of Integer  // objective number 
$DYOM_actor_hidewith   : array 100 of Integer  // objective number 
$DYOM_actor_mustlive   : array 100 of Integer  // dead = mission failed
$DYOM_actor_handle     : array 100 of Integer 
$DYOM_actor_animation  : array 100 of Integer 
$DYOM_actor_distance   : array 100 of Float

$DYOM_temp_markers   : array 100 of Integer      // NOT stored in the savefile..
//Car:
//-----------------
$DYOM_car_model        : array 50 of Integer   
$DYOM_car_color1       : array 50 of Integer   
$DYOM_car_color2       : array 50 of Integer   
$DYOM_car_location_x   : array 50 of Float   
$DYOM_car_location_y   : array 50 of Float   
$DYOM_car_location_z   : array 50 of Float   
$DYOM_car_location_a   : array 50 of Float 
$DYOM_car_interior     : array 50 of Integer 
$DYOM_car_health       : array 50 of Integer 
$DYOM_car_properties   : array 50 of Integer 
$DYOM_car_spawnwith    : array 50 of Integer    // objective number 
$DYOM_car_hidewith     : array 50 of Integer    // objective number 
$DYOM_car_mustlive     : array 50 of Integer    // dead = mission failed
$DYOM_car_handle       : array 50 of Integer

//Pickups:
//-----------------
$DYOM_pickup_model       : array 50 of Integer   
$DYOM_pickup_ammo        : array 50 of Integer // 0 -> pickup without ammo  
$DYOM_pickup_mode        : array 50 of Integer   
$DYOM_pickup_location_x  : array 50 of Float   
$DYOM_pickup_location_y  : array 50 of Float   
$DYOM_pickup_location_z  : array 50 of Float   
$DYOM_pickup_spawnwith   : array 50 of Integer   // objective number 
$DYOM_pickup_hidewith    : array 50 of Integer   // objective number 
$DYOM_pickup_handle      : array 50 of Integer

// Objects:
//-----------------
$DYOM_object_model       : array 100 of Integer  
$DYOM_object_location_x  : array 100 of Float   
$DYOM_object_location_y  : array 100 of Float   
$DYOM_object_location_z  : array 100 of Float   
$DYOM_object_location_rx : array 100 of Float 
$DYOM_object_location_ry : array 100 of Float 
$DYOM_object_location_rz : array 100 of Float 
$DYOM_object_interior    : array 100 of Integer 
$DYOM_object_spawnwith   : array 100 of Integer  // objective number 
$DYOM_object_hidewith    : array 100 of Integer  // objective number 
$DYOM_object_handle      : array 100 of Integer 
$DYOM_object_h_effect    : array 100 of Integer 

//$DYOM_object_interior    : array 100 of Integer 
//          laatste 3 digits   OBJ_I => interior
//          digit 4-6          OBJ_P => link      (0-399)
//          digit 7            OBJ_M => movetype  (0)nomove  (1)prox_move   (2)cont_move
//
//$OBJ_I = $DYOM_object_interior 
//$OBJ_M = $OBJ_I
//$OBJ_M /= 1000
//$OBJ_M *= 1000
//$OBJ_I -= $OBJ_M
//$OBJ_M /= 1000
//$OBJ_P = $OBJ_M
//$OBJ_M /= 1000
//$OBJ_M *= 1000
//$OBJ_P -= $OBJ_M  
//$OBJ_M /= 1000

// Points  (Split up because arrays can only be declared with sizes upto 255)
//-----------------
$DYOM_point_link         : array 200 of Integer  // 0:free, -1:lastone, -2:lastone of loop >0: index of next point.
$DYOM_point_link1        : array 200 of Integer  
$DYOM_point_x            : array 200 of float
$DYOM_point_x1           : array 200 of float
$DYOM_point_y            : array 200 of float
$DYOM_point_y1           : array 200 of float
$DYOM_point_z            : array 200 of float
$DYOM_point_z1           : array 200 of float

// Triggers (for storyline)
//-----------------
$DYOM_trigger_icon       : array 25 of Integer  
$DYOM_trigger_location_x : array 25 of Float   
$DYOM_trigger_location_y : array 25 of Float   
$DYOM_trigger_location_z : array 25 of Float   
$DYOM_trigger_after      : array 25 of Integer 
$DYOM_trigger_mhandle    : array 25 of Integer 
$DYOM_trigger_reward     : array 25 of Integer 

end

// Address all these arrays here, so that they will be
// layout properly in de mem-map.
$myindex = 0
$DYOM_POINT_LINK[$myindex] = 1
$DYOM_POINT_LINK1[$myindex] = 2
$DYOM_POINT_X[$myindex] = 1.0
$DYOM_POINT_X1[$myindex] = 99.0
$DYOM_POINT_Y[$myindex] = 2.0
$DYOM_POINT_Y1[$myindex] = 99.0
$DYOM_POINT_Z[$myindex] = 3.0
$DYOM_POINT_Z1[$myindex] = 99.0



//-------------------------
// Weapon mapping
//-------------------------
var
  $DYOM_Weapon_model : ARRAY 49 of Integer
end


//============================================================================
//============================================================================
//
//                               T E X T S
//
//============================================================================
//============================================================================
// Current texts: 
//  - Mission Name                     max 50 
//  - Mission Author                   max 50 
//  - Intro1-3                         max 100
//  - Objective0-99                    max 100
//  - file mission buffer              max 50

var
  $TEXTZERO:Integer    //  Base address from which all text offsets are calculated
  $TEXTCUR:Integer     //  Pointer to the current textbuffer, which is used for all text-routines
  $TEXTTARGET:Integer  //  Pointer to the target textbuffer, for copy
  $TEXTMAX:Integer     //  max input size for currentbuffer
  
  $TEXTNAME:Integer        // Missionname
  $TEXTCREDIT:Integer       // Start of filenamebuffer
  $TEXTAUTHOR:Integer      // MissionAuthor 
  $TEXTINTRO:Integer       // Start of Intro texts
  $TEXTOBJECTIVES:Integer  // Start of Objective texts
  $TEXTTRIGGERS:Integer    // Start of Triggers texts
  $TEXTFILE:Integer        // Start of filenamebuffer
  $TEXTDYOM:Integer        // Start of "DYOM"
  $TEXTNUMIMPUT:Integer    // input buffer
  $TEXTAUDIOCODE:Integer   // AudioCode display
  // GXT tags offsets
  $TEXTTAG:Integer
end

:dyombuffer
hex
44 59 4F 4D 00 00 00 00 00 00
end

:textnamebuffer
hex
44 59 4F 4D 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00
end

:textcreditbuffer
hex
"Missiondesign" 20 "by" 20 "~N~~y~" 
end

:textauthorbuffer
hex
44 59 4F 4D 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00
end

:textaudiocode
hex
"SD/ABCDE/xx.mp3" 00
end


:DYOMTXT
0900: 'DYOMTXT'   

:TEXT_init
//-----------------------------
// TEXTBUFFERS init
//-----------------------------
// This section calculates the address of text behind the :text label, based on the current IP at the zero label
0A9F: 0@ = current_thread_pointer 
0@ += 20 // Current IP 
:zero
0A8D: $TEXTZERO = read_memory 0@ size 4 virtual_protect 0 
$TEXTZERO -= @zero
$TEXTZERO -= 9    

$TEXTNAME = $TEXTZERO
$TEXTNAME += @textnamebuffer

$TEXTAUTHOR = $TEXTZERO
$TEXTAUTHOR += @textauthorbuffer

$TEXTCREDIT = $TEXTZERO
$TEXTCREDIT += @textcreditbuffer

$TEXTDYOM = $TEXTZERO
$TEXTDYOM += @dyombuffer

0AC8: $TEXTINTRO = allocate_memory_size        300  // 3 x 100 bytes
0AC8: $TEXTOBJECTIVES = allocate_memory_size 10000  // 100 x 100 bytes
0AC8: $TEXTTRIGGERS = allocate_memory_size     400  // 25 x 16 bytes
0AC8: $TEXTFILE = allocate_memory_size          50  
0AC8: $TEXTNUMIMPUT = allocate_memory_size      20  

0084: 2@ = $TEXTOBJECTIVES
for 1@ = 0 to 99
  0AD3: 2@ = format " "
  2@ += 100
end

$TEXTAUDIOCODE = $TEXTZERO
$TEXTAUDIOCODE += @textaudiocode

$TEXTTAG = $TEXTZERO
$TEXTTAG += @DYOMTXT
$TEXTTAG += 3 

return

:TEXT_show
if 0AA9:   is_game_version_original 
then 
  0AA5: call 5802976 4 pop 4 0 0 0 $TEXTCUR
else
  0AA5: call 5804976 4 pop 4 0 0 0 $TEXTCUR 
end
return

:TEXT_show_perm
if 0AA9:   is_game_version_original 
then 
0AA8: call_function_method 0x6A0050 struct 0xC1B340 num_params 1 pop 0 $TEXTTAG 29@ // GetGxtString
0AA5: call 0x718600 num_params 2 pop 2 29@ $TEXTCUR // cpystr
else
0AA8: call_function_method 0x6A0870 struct 0xC1DB00 num_params 1 pop 0 $TEXTTAG 29@ // GetGxtString
0AA5: call 0x718E90 num_params 2 pop 2 29@ $TEXTCUR // cpystr
end
0512: show_permanent_text_box 'DYOMTXT'  
return


:TEXT_clear
0A8C: write_memory $TEXTCUR size 1 value 0 virtual_protect 0
return

:TEXT_save
0085: 1@ = $TEXTCUR
repeat
    0A8D: $buffer = read_memory 1@ size 1 virtual_protect 0 
    0A9E: writefile $hFILE size 1 from $buffer
    1@ += 1
until $buffer == 0
return


:TEXT_load
0085: 1@ = $TEXTCUR
repeat
    0A9D: readfile $hFILE size 1 to $buffer
    0A8C: write_memory 1@ size 1 value $buffer virtual_protect 0
    1@ += 1
until $buffer == 0
return

:TEXT_input
var
  $idx : integer
  $count : integer
  $buffer : integer
  $ready : integer
  1@: integer
end  
gosub @TEXT_clear
:TEXT_edit
0085: 1@ = $TEXTCUR
$count = 0
repeat
    // translate ~ -> +
    0A8D: $ready = read_memory 1@ size 1 virtual_protect 0
    if $ready == 126
    then
        0A8C: write_memory 1@ size 1 value 43 virtual_protect 0
    end
    if NOT $ready == 0
    then
      1@ += 1
      $count += 1
    end 
until $ready == 0

if NOT $TEXTCUR == 1@
then
  gosub @TEXT_show_perm
end
0085: 2@ = 1@
$ready = 0
repeat
    wait 10    
    // A-Z, a-z
    for $idx = 65 to 90 
      if and 
        0AB0:  key_pressed $idx
        not $count == $TEXTMAX
      then
        0084: $buffer = $idx
        if 8AB0: not key_pressed 16
        then
          $buffer += 32
        end
        if 0AB0:  key_pressed 17
        then
            $count += 3
            if $count <  $TEXTMAX
            then
            0A8C: write_memory 1@ size 1 value 43 virtual_protect 0
            1@ += 1  
            0A8C: write_memory 1@ size 1 value $buffer virtual_protect 0
            1@ += 1  
            0A8C: write_memory 1@ size 1 value 43 virtual_protect 0
            1@ += 1  
            0A8C: write_memory 1@ size 1 value 0 virtual_protect 0
            else
              $count += -3
            end
        else
            0A8C: write_memory 1@ size 1 value $buffer virtual_protect 0
            1@ += 1  
            0A8C: write_memory 1@ size 1 value 0 virtual_protect 0
            $count += 1
        end
        repeat
          wait 0
        until 8AB0: not key_pressed $idx
      end
    end
    // 0- 9
    {
    Shift 0 = )  41
    Shift 1 = !  33
    Shift 2 = +  43
    Shift 3 = ?  63
    Shift 4 = $  36
    Shift 5 = %  37
    Shift 6 = :  58
    Shift 7 = /  47
    Shift 8 = '  37
    Shift 9 = (  40
    }
    for $idx = 48 to 57 
      if and
        0AB0:  key_pressed $idx
        not $count == $TEXTMAX
      then
        if 8AB0: not key_pressed 16
        then    
            0A8C: write_memory 1@ size 1 value $idx virtual_protect 0
            1@ += 1  
            0A8C: write_memory 1@ size 1 value 0 virtual_protect 0
            $count += 1
        else
            if 0AB0:  key_pressed 48      // Shift - 0      )
            then
                0A8C: write_memory 1@ size 1 value 41 virtual_protect 0
                1@ += 1  
                0A8C: write_memory 1@ size 1 value 0 virtual_protect 0
                $count += 1
            end
            if 0AB0:  key_pressed 49      // Shift - 1      !
            then
                0A8C: write_memory 1@ size 1 value 33 virtual_protect 0
                1@ += 1  
                0A8C: write_memory 1@ size 1 value 0 virtual_protect 0
                $count += 1
            end
            if 0AB0:  key_pressed 50      // Shift - 2      +  = placeholder for ~
            then
                0A8C: write_memory 1@ size 1 value 43 virtual_protect 0
                1@ += 1  
                0A8C: write_memory 1@ size 1 value 0 virtual_protect 0
                $count += 1
            end
            if 0AB0:  key_pressed 51      // Shift - 3      ?
            then
                0A8C: write_memory 1@ size 1 value 63 virtual_protect 0
                1@ += 1  
                0A8C: write_memory 1@ size 1 value 0 virtual_protect 0
                $count += 1
            end
            if 0AB0:  key_pressed 52      // Shift - 4      $
            then
                0A8C: write_memory 1@ size 1 value 36 virtual_protect 0
                1@ += 1  
                0A8C: write_memory 1@ size 1 value 0 virtual_protect 0
                $count += 1
            end
            if 0AB0:  key_pressed 53      // Shift - 5      %
            then
                0A8C: write_memory 1@ size 1 value 37 virtual_protect 0
                1@ += 1  
                0A8C: write_memory 1@ size 1 value 0 virtual_protect 0
                $count += 1
            end
            if 0AB0:  key_pressed 54      // Shift - 6      =
            then
                0A8C: write_memory 1@ size 1 value 58 virtual_protect 0
                1@ += 1  
                0A8C: write_memory 1@ size 1 value 0 virtual_protect 0
                $count += 1
            end
            if 0AB0:  key_pressed 55      // Shift - 7      /
            then
                0A8C: write_memory 1@ size 1 value 47 virtual_protect 0
                1@ += 1  
                0A8C: write_memory 1@ size 1 value 0 virtual_protect 0
                $count += 1
            end
            if 0AB0:  key_pressed 56      // Shift - 8      '
            then
                0A8C: write_memory 1@ size 1 value 39 virtual_protect 0
                1@ += 1  
                0A8C: write_memory 1@ size 1 value 0 virtual_protect 0
                $count += 1
            end
            if 0AB0:  key_pressed 57      // Shift - 9      (
            then
                0A8C: write_memory 1@ size 1 value 40 virtual_protect 0
                1@ += 1  
                0A8C: write_memory 1@ size 1 value 0 virtual_protect 0
                $count += 1
            end        
        end    
        repeat
          wait 0
        until 8AB0: not key_pressed $idx
      end
    end
    // Space
    if and
        0AB0:  key_pressed 32
        not $count == $TEXTMAX
    then
        0A8C: write_memory 1@ size 1 value 32 virtual_protect 0
        1@ += 1  
        0A8C: write_memory 1@ size 1 value 95 virtual_protect 0
        1@ += 1  
        0A8C: write_memory 1@ size 1 value 0 virtual_protect 0
        1@ -= 1  
         $count += 1
        repeat
          wait 0
        until 8AB0: not key_pressed 32
    end
    // ,
    if and
        0AB0:  key_pressed 188
        not $count == $TEXTMAX
    then
        0A8C: write_memory 1@ size 1 value 44 virtual_protect 0
        1@ += 1  
        0A8C: write_memory 1@ size 1 value 0 virtual_protect 0
        $count += 1
        repeat
          wait 0
        until 8AB0: not key_pressed 188
    end
    // .
    if and
        0AB0:  key_pressed 190
        not $count == $TEXTMAX
    then
        0A8C: write_memory 1@ size 1 value 46 virtual_protect 0
        1@ += 1  
        0A8C: write_memory 1@ size 1 value 0 virtual_protect 0
        $count += 1
        repeat
          wait 0
        until 8AB0: not key_pressed 190
    end
    // ~
    if and
        0AB0:  key_pressed 192
        0AB0:  key_pressed 16
        not $count == $TEXTMAX
    then
        0A8C: write_memory 1@ size 1 value 126 virtual_protect 0
        1@ += 1  
        0A8C: write_memory 1@ size 1 value 0 virtual_protect 0
        $count += 1
        repeat
          wait 0
        until 8AB0: not key_pressed 192
    end

    // backspace
    if 0AB0:  key_pressed 8
    then
        1@ -= 1  
        0A8C: write_memory 1@ size 1 value 95 virtual_protect 0
        $count -= 1
        repeat
          wait 0
        until 8AB0: not key_pressed 8
    end
    // return
    if 0AB0:  key_pressed 13
    then
        //0A8C: write_memory 1@ size 1 value 0 virtual_protect 0
        $ready = 1
        repeat
          wait 0
        until 8AB0: not key_pressed 13
    end
    
    if 803B:   not  1@ == 2@ // (int) 
    then
      gosub @TEXT_show_perm
      0085: 2@ = 1@
    end     
until $ready == 1
03E6: remove_text_box 

// Translate + -> ~
0085: 1@ = $TEXTCUR
repeat 
    0A8D: 2@ = read_memory 1@ size 1 virtual_protect 0 
    if 2@ == 43
    then
        0A8C: write_memory 1@ size 1 value 126 virtual_protect 0
    end
    1@ += 1
until 2@ == 0
return
                
:TEXT_num_input
var
  $num_input: integer
  $digits: integer
  $dig : integer
  $rem: integer
  $idx : integer
  $count : integer
  $buffer : integer
  $ready : integer
end  
0085: 1@ = $TEXTCUR
0085: 2@ = 1@
$ready = 0
$count = 0
gosub @TEXT_clear
// count digits in input
$digits = 0
$rem = $num_input
while  $rem > 0
   $rem /= 10
   $digits += 1
end
$rem = $num_input
$count = $digits
while $digits > 0
  // determine the most significant digit of the remainder
  $idx = 1
  $dig = $rem
  while $idx < $digits
      $dig /= 10
      $idx += 1
  end
  // output digit
  $dig += 48
  0A8C: write_memory 1@ size 1 value $dig virtual_protect 0
  1@ += 1  
  0A8C: write_memory 1@ size 1 value 0 virtual_protect 0
  $dig += -48
  // determine the value of the digit
  $idx = 1
  while $idx < $digits
      $dig *= 10
      $idx += 1
  end
  // calculate new remainder
  $rem -= $dig  
  $digits += -1
end
if $num_input == 0
then
  0A8C: write_memory 1@ size 1 value 48 virtual_protect 0
  1@ += 1  
  0A8C: write_memory 1@ size 1 value 0 virtual_protect 0  
  $count = 1
end 
// Start input/edit.
repeat
    wait 10    
    // 0- 9
    for $idx = 48 to 57 
      if and
        0AB0:  key_pressed $idx
        not $count == $TEXTMAX
      then
        0A8C: write_memory 1@ size 1 value $idx virtual_protect 0
        1@ += 1  
        $num_input *= 10
        $dig = $idx
        $dig -= 48
        $num_input += $dig
        0A8C: write_memory 1@ size 1 value 0 virtual_protect 0
        $count += 1
        repeat
          wait 0
        until 8AB0: not key_pressed $idx
      end
    end
    // backspace
    if and
         0AB0:  key_pressed 8
         $count > 0
    then
        1@ -= 1  
        0A8C: write_memory 1@ size 1 value 95 virtual_protect 0
        $count -= 1
        $num_input /= 10
        repeat
          wait 0
        until 8AB0: not key_pressed 8
    end
    // return
    if 0AB0:  key_pressed 13
    then
        //0A8C: write_memory 1@ size 1 value 0 virtual_protect 0
        $ready = 1
        repeat
          wait 0
        until 8AB0: not key_pressed 13
    end
    
    if 803B:   not  1@ == 2@ // (int) 
    then
      gosub @TEXT_show_perm
      0085: 2@ = 1@
    end     
until $ready == 1
03E6: remove_text_box 

return


:TEXT_copy
0085: 1@ = $TEXTCUR
0085: 2@ = $TEXTTARGET
repeat
    0A8D: $buffer = read_memory 1@ size 1 virtual_protect 0 
    0A8C: write_memory 2@ size 1 value $buffer virtual_protect 0
    1@ += 1
    2@ += 1
until $buffer == 0
return


//============================================================================
//============================================================================
//
//                               S O U N D
//
//============================================================================
//============================================================================
:MAKE_SOUND_NAME
    var
      $SOUNDFILE : array 3 of Integer
    end
    //$SOUNDFILE[2] = 775502127  // "/99."
    var
    $sound_v :integer
    $sound_h :integer
    $longletter :integer
    end
    // "SD/ABCDE/xx.mp3"
    // "/__."
    $longletter= 771751983
    // "/nn."
    $sound_v = $DYOM_current_objective
    $sound_v +=1
    $sound_v /= 10
    $sound_h = $sound_v
    $sound_v += 48
    $sound_v *= 256
    $longletter += $sound_v
    $sound_h *= 10    
    $sound_v = $DYOM_current_objective
    $sound_v += 1
    $sound_v -= $sound_h
    $sound_v += 48
    $sound_v *= 65536
    $longletter += $sound_v
    $SOUNDFILE[2] = $longletter
    $SOUNDFILE[3] = 3371117   //mp3
  return
var
  v$SOUNDFILE:String
  $hMP3:integer
  $aMP3:integer
end

:SOUND_GO
  0A99: chdir 1
  0662: - PRINTSTRING "SOUNDGO"
  wait 200
  gosub @MAKE_SOUND_NAME
  0662: - PRINTSTRING v$SOUNDFILE
  if 0AAB:  file_exists v$SOUNDFILE
  then
     0662: - PRINTSTRING "PLAYING"
     0AAC: $hMP3 = load_mp3 v$SOUNDFILE
     0AAD: set_mp3 $hMP3 perform_action 1
  end
  if NOT $aMP3 == -1
  then
      $SOUNDFILE[3] = 6385518   //noa
      0662: - PRINTSTRING v$SOUNDFILE
      if 0AAB:  file_exists v$SOUNDFILE
      then
         0662: - PRINTSTRING "MUTE AMB"
         0AAD: set_mp3 $aMP3 perform_action 2
      else
         0AAD: set_mp3 $aMP3 perform_action 3
      end
  
  end
return


:SOUND_STOP
  0A99: chdir 1
  $SOUNDFILE[3] = 3371117   //mp3
  if and 
     0AAB:  file_exists v$SOUNDFILE
     NOT $hMP3 == -1
  then
     0662: - PRINTSTRING "STOPPING"
     0AAD: set_mp3 $hMP3 perform_action 0
     0AAE: release_mp3 $hMP3
     $hMP3 = -1
  end
return

:MAKE_AMB_NAME
    var
    $sound_v :integer
    $sound_h :integer
    end
    // "SD/ABCDE/xx.mp3"
    var
      $SOUNDFILE : array 3 of Integer
    end
    $SOUNDFILE[2] = 778920239  //  "/am."
    $SOUNDFILE[3] = 3371117   //mp3
return

:AMB_GO
  0A99: chdir 1
  gosub @MAKE_AMB_NAME
  0662: - PRINTSTRING v$SOUNDFILE
  $aMP3 = -1
  if 0AAB:  file_exists v$SOUNDFILE
  then
     0662: - PRINTSTRING "PLAYING"
     0AAC: $aMP3 = load_mp3 v$SOUNDFILE
     0AAD: set_mp3 $aMP3 perform_action 1
    0663: - PRINTINT "amp3" $aMP3
  end
return


:AMB_STOP
  0A99: chdir 1
  if NOT $aMP3 == -1
  then
     0662: - PRINTSTRING "STOPPING"
     0AAD: set_mp3 $aMP3 perform_action 0
     0AAE: release_mp3 $aMP3
     $aMP3 = -1
  end
return

:AMB_RESTART
  0A99: chdir 1
  //0663: - PRINTINT "AM active" $aMP3
  if NOT $aMP3 == -1
  then
    0AB9: get_mp3 $aMP3 state_to $sMP3
    if $sMP3 < 0
    then
     0AAD: set_mp3 $aMP3 perform_action 1
    end
  end
return



var
  $longletter:Integer
  $letter:Integer
  $AD1:Integer
end
:GENERATE_AUDIOCODE
v$SOUNDFILE = "SD/ABCDE/xx.mp3"
var
  $SOUNDFILE : array 3 of Integer
end
$longletter = 3097683
0209: $letter = random_int_in_ranges 65 91 
$letter *= 16777216
$longletter += $letter
0A8C: write_memory $TEXTAUDIOCODE size 4 value $longletter virtual_protect 0
$SOUNDFILE[0] = $longletter

$AD1 = $TEXTAUDIOCODE
$AD1 += 4 
0209: $letter = random_int_in_ranges 65 91 
$longletter = $letter
$longletter *=256
0209: $letter = random_int_in_ranges 65 91 
$longletter += $letter
$longletter *=256
0209: $letter = random_int_in_ranges 65 91 
$longletter += $letter
$longletter *=256
0209: $letter = random_int_in_ranges 65 91 
$longletter += $letter
0A8C: write_memory $AD1 size 4 value $longletter virtual_protect 0
$SOUNDFILE[1] = $longletter
0662: - PRINTSTRING v$SOUNDFILE
return



//============================================================================
//============================================================================
//
//                       H E L P E R   T H R E A D S
//
//============================================================================
//============================================================================


//--------------------------------
// ACTOR LOADING thread
//--------------------------------
var
  $actor_model_loaded : Integer
  $actor_model_req : Integer
end

:ACTOR_LOAD_THREAD
03A4: name_thread 'ACTLOAD' 
repeat
    repeat
        wait 10
    until not $actor_model_req == -1
    gosub @generic_actor_load
until false
END_THREAD


//-----------------------------------------------------------------------------------------------------
// this routine loads the indicated $actor_model_req, which might be a special actor ( > 999)
// The resulting model is returned in $actor_model_loaded. (for special actor, this wil be #SPECIAL01)
//-----------------------------------------------------------------------------------------------------
:generic_actor_load
    if $actor_model_req == 289
    then
      if $ONMISSION == 0
      then
        $actor_model_req = 264
      else
        // 0-288   + 33
        0209: $actor_model_req = random_int_in_ranges 0 299
        if $actor_model_req > 0
        then
          $actor_model_req += 6
        end
        if $actor_model_req > 7
        then
          $actor_model_req += 1
        end
        if $actor_model_req > 41
        then
          $actor_model_req += 1
        end
        if $actor_model_req > 64
        then
          $actor_model_req += 1
        end
        if $actor_model_req > 73
        then
          $actor_model_req += 1
        end
        if $actor_model_req > 85
        then
          $actor_model_req += 1
        end
        if $actor_model_req > 207
        then
           $actor_model_req += 1
        end
        if $actor_model_req > 118
        then
         $actor_model_req += 1
        end
        if $actor_model_req > 148
        then
         $actor_model_req += 1
        end
        if $actor_model_req > 264
        then
        $actor_model_req += 9
         end
        if $actor_model_req > 288
        then
          $actor_model_req += 711
        end
        0663: - PRINTINT "RACTOR" $actor_model_req
      end
    end
if $actor_model_req > 999
then

    if $actor_model_req == 1000
    then
    023C: load_special_actor 'ANDRE' as 1
    end
    if $actor_model_req == 1001
    then
    023C: load_special_actor 'BBTHIN' as 1
    end
    if $actor_model_req == 1002
    then
    023C: load_special_actor  'BB'  as 1
    end
    if $actor_model_req == 1003
    then
    023C: load_special_actor 'CAT' as 1
    end
    if $actor_model_req == 1004
    then
    023C: load_special_actor 'CESAR' as 1
    end
    if $actor_model_req == 1005
    then
    023C: load_special_actor 'CLAUDE' as 1
    end
    if $actor_model_req == 1006
    then
    023C: load_special_actor 'DWAYNE' as 1
    end
    if $actor_model_req == 1007
    then
    023C: load_special_actor 'EMMET' as 1
    end
    if $actor_model_req == 1008
    then
    023C: load_special_actor 'FORELLI' as 1
    end
    if $actor_model_req == 1009
    then
    023C: load_special_actor 'JANITOR' as 1
    end
    if $actor_model_req == 1010
    then
    023C: load_special_actor 'JETHRO' as 1
    end
    if $actor_model_req == 1011
    then
    023C: load_special_actor 'JIZZY' as 1
    end
    if $actor_model_req == 1012
    then
    023C: load_special_actor 'HERN' as 1
    end
    if $actor_model_req == 1013
    then
    023C: load_special_actor 'KENDL' as 1
    end
    if $actor_model_req == 1014
    then
    023C: load_special_actor 'MACCER' as 1
    end
    if $actor_model_req == 1015
    then
    023C: load_special_actor 'MADDOGG' as 1
    end
    if $actor_model_req == 1016
    then
    023C: load_special_actor 'OGLOC' as 1
    end
    if $actor_model_req == 1017
    then
    023C: load_special_actor 'PAUL'  as 1
    end
    if $actor_model_req == 1018
    then
    023C: load_special_actor 'PULASKI' as 1
    end
    if $actor_model_req == 1019
    then
    023C: load_special_actor 'ROSE' as 1
    end
    if $actor_model_req == 1020
    then
    023C: load_special_actor 'RYDER2' as 1
    end
    if $actor_model_req == 1021
    then
    023C: load_special_actor 'RYDER3' as 1
    end
    if $actor_model_req == 1022
    then
    023C: load_special_actor 'SINDACO' as 1
    end
    if $actor_model_req == 1023
    then
    023C: load_special_actor 'SMOKE' as 1
    end
    if $actor_model_req == 1024
    then
    023C: load_special_actor 'SMOKEV' as 1
    end
    if $actor_model_req == 1025
    then
    023C: load_special_actor 'SUZIE' as 1
    end
    if $actor_model_req == 1026
    then
    023C: load_special_actor 'SWEET' as 1
    end
    if $actor_model_req == 1027
    then
    023C: load_special_actor 'TBONE' as 1
    end
    if $actor_model_req == 1028
    then
    023C: load_special_actor 'TENPEN' as 1
    end
    if $actor_model_req == 1029
    then
    023C: load_special_actor 'TORINO' as 1
    end
    if $actor_model_req == 1030
    then
    023C: load_special_actor 'TRUTH' as 1
    end
    if $actor_model_req == 1031
    then
    023C: load_special_actor 'WUZIMU' as 1
    end
    if $actor_model_req == 1032
    then
    023C: load_special_actor 'ZERO' as 1
    end
       
    repeat
        wait 0
    until 023D:   special_actor 1 loaded  
    $actor_model_req = -1
    $actor_model_loaded = #SPECIAL01
else

    model.Load($actor_model_req)
    038B: load_requested_models 
    repeat
        wait 0 ms
    until model.Available($actor_model_req)  
    $actor_model_loaded = $actor_model_req
    $actor_model_req = -1
end

return

//-----------------------------------------------------------------------------------------------------
// this routine unloads the indicated $actor_model_loaded, which might be a special actor 
//-----------------------------------------------------------------------------------------------------
:generic_actor_unload
if $actor_model_loaded == #SPECIAL01
then
    0296: unload_special_actor 1 
else
    0249: release_model $actor_model_loaded
end
return


//==========================================================
// Animation thread
//==========================================================
// To use:
// - Wait until $anim_req == -1
// - Set $anim_actor to the actor that should perform the animation.
// - Set $anim_req to the requested animation_id.
var
  $anim_req :integer
  $anim_actor:actor
  $anim_gang:actor
  $anim_distance:float
  $anim_loop:integer
  $anim_lock:integer
  $anim_max:integer
  v$animfile:string
  v$animname:string
  $tmpi:integer
  $found_car:integer
  $found_model:integer
  $min_dist:float
  $dist:float
end  
:ANIMATION_THREAD
03A4: name_thread 'ANIMATE' 
$anim_req = -1
$anim_max = 129
repeat
  repeat
    wait 10
  until not $anim_req == -1
  //01E5: show_text_1number_highpriority GXT 'NUMBER' number $anim_req time 5000 flag 1
  if $anim_req > -1
  then
    $animload = 1
    $anim_loop = 1
    if $anim_req < 10
    then
        if $anim_req == 0
        then
          $animload = 0
          v$animname = "IDLE_ARMED"
        end
        if $anim_req == 1
        then
          $animload = 0
          v$animname = "IDLE_CHAT"
        end
        if $anim_req == 2
        then
          $animload = 0
          v$animname = "FUCKU"
        end
        if $anim_req == 3  
        then
          v$animfile = "BD_FIRE"
          v$animname = "BD_PANIC_LOOP"
        end
        if $anim_req == 4
        then
          $animload = 0
          v$animname = "WEAPON_CROUCH"
        end
        if $anim_req == 5
        then
          $animload = 0
          v$animname = "SEAT_IDLE"
        end
        if $anim_req == 6
        then
          $animload = 0
          v$animname = "ATM"
        end
        if $anim_req == 7
        then
          v$animfile = "PARK"
          v$animname = "TAI_CHI_LOOP"
        end
        if $anim_req == 8
        then
          v$animfile = "MISC"
          v$animname = "HIKER_POSE"
        end
        if $anim_req == 9
        then
          v$animfile = "MISC"
          v$animname = "SCRATCHBALLS_01"
        end
        $anim_req = 9999
    end
    if $anim_req < 20
    then
        if $anim_req == 10
        then
          v$animfile = "RIOT"
          v$animname = "RIOT_FUKU"
        end
        if $anim_req == 11
        then
          v$animfile = "ON_LOOKERS"
          v$animname = "WAVE_LOOP"
        end
        if $anim_req == 12  
        then
          v$animfile = "BD_FIRE"
          v$animname = "WASH_UP"
        end
        if $anim_req == 13
        then
          v$animfile = "STRIP"
          v$animname = "PUN_LOOP"
        end
        if $anim_req == 14
        then
          v$animfile = "DANCING"
          v$animname = "DAN_LOOP_A"
        end
        if $anim_req == 15
        then
          v$animfile = "CASINO"
          v$animname = "CARDS_WIN"
        end
        if $anim_req == 16 
        then 
            v$animfile = "POLICE" 
            v$animname = "COPTRAF_COME" 
        end
        if $anim_req == 17
        then
          v$animfile = "RIOT"
          v$animname = "RIOT_CHALLENGE"
        end
        if $anim_req == 18
        then
          v$animfile = "RIOT"
          v$animname = "RIOT_CHANT"
        end
        if $anim_req == 19
        then
          v$animfile = "RIOT"
          v$animname = "RIOT_PUNCHES"
        end
        $anim_req = 9999
    end
    if $anim_req < 30
    then
        if $anim_req == 20
        then
          v$animfile = "RIOT"
          v$animname = "RIOT_SHOUT"
        end
        
        if $anim_req == 21
        then
          v$animfile = "SNM"
          v$animname = "SPANKINGP"
        end
        	
        if $anim_req == 22
        then
          v$animfile = "SHOP"
          v$animname = "ROB_LOOP_THREAT"
        end
        	
        if $anim_req == 23  
        then
          v$animfile = "SWEET"
          v$animname = "SWEET_ASS_SLAP"
        end
        	
        if $anim_req == 24
        then
          v$animfile = "SHOP"
          v$animname = "SHP_ROB_HANDSUP"
        end
    	
        if $anim_req == 25
        then
          v$animfile = "ON_LOOKERS"
          v$animname = "LKAROUND_LOOP"
        end
    	
        if $anim_req == 26
        then
          v$animfile = "ON_LOOKERS"
          v$animname = "LKUP_LOOP"
        end
    	
        if $anim_req == 27
        then
          v$animfile = "ON_LOOKERS"
          v$animname = "LKUP_POINT"
        end
    	
        if $anim_req == 28
        then
          v$animfile = "ON_LOOKERS"
          v$animname = "POINT_LOOP"
        end
    	
        if $anim_req == 29
        then
          v$animfile = "ON_LOOKERS"
          v$animname = "POINTUP_LOOP"
        end
        $anim_req = 9999
    end
    if $anim_req < 40
    then
    	
        if $anim_req == 30
        then
          v$animfile = "ON_LOOKERS"
          v$animname = "POINTUP_SHOUT"
        end
    	
        if $anim_req == 31
        then
          v$animfile = "ON_LOOKERS"
          v$animname = "SHOUT_01"
        end
    	
        if $anim_req == 32
        then
          v$animfile = "ON_LOOKERS"
          v$animname = "SHOUT_02"
        end
    	
        if $anim_req == 33
        then
          v$animfile = "ON_LOOKERS"
          v$animname = "SHOUT_LOOP"
        end
    	
        if $anim_req == 34
        then
          v$animfile = "MISC"
          v$animname = "BNG_WNDW"
        end
    	 
        if $anim_req == 35 
        then
          v$animfile = "VENDING"
          v$animname = "VEND_DRINK_P"
        end
    	
        if $anim_req == 36
        then
          v$animfile = "GYMNASIUM"
          v$animname = "GYMSHADOWBOX"
        end
    	    
        if $anim_req == 37
        then
          v$animfile = "GHANDS"
          v$animname = "GSIGN1"
        end
    	
        if $anim_req == 38
        then
          v$animfile = "GHANDS"
          v$animname = "GSIGN3"
        end
    	
        if $anim_req == 39
        then
          v$animfile = "GANGS"
          v$animname = "HNDSHKFA"
        end
        $anim_req = 9999
    end
    if $anim_req < 50
    then
	
        if $anim_req == 40
        then
          v$animfile = "GANGS"
          v$animname = "HNDSHKFA_SWT"
        end
    	
        if $anim_req == 41
        then
          v$animfile = "DANCING"
          v$animname = "DAN_LOOP_A"
        end
    	
        if $anim_req == 42
        then
          v$animfile = "DANCING"
          v$animname = "DNCE_M_A"
        end
    	
        if $anim_req == 43
        then
          v$animfile = "DANCING"
          v$animname = "DNCE_M_B"
        end
    	
        if $anim_req == 44
        then
          v$animfile = "DANCING"
          v$animname = "DNCE_M_C"
        end
    	
        if $anim_req == 45
        then
          v$animfile = "DANCING"
          v$animname = "DNCE_M_D"
        end
    	
        if $anim_req == 46
        then
          v$animfile = "DANCING"
          v$animname = "DNCE_M_E"
        end
    	
        if $anim_req == 47
        then
          v$animfile = "BEACH"
          v$animname = "PARKSIT_M_LOOP"
        end
    	
        if $anim_req == 48
        then
          v$animfile = "BEACH"
          v$animname = "PARKSIT_W_LOOP"
        end
    	
        if $anim_req == 49
        then
          v$animfile = "BEACH"
          v$animname = "SITNWAIT_LOOP_W"
        end
        $anim_req = 9999
    end
    if $anim_req < 61
    then
	
        if $anim_req == 50
        then
          v$animfile = "BASEBALL"
          v$animname = "BAT_4"
        end
        if $anim_req == 51  
        then
          $anim_loop = 0
          v$animfile = "MISC"
          v$animname = "PLUNGER_01"
        end
	
        if $anim_req == 52
        then
          v$animfile = "FIGHT_B"
          v$animname = "FIGHTB_G"
        end
	
        if $anim_req == 53   
        then
          $animload= 0
          v$animname = "FIGHTA_G"
        end
	
        if $anim_req == 54  
        then
          $animload= 0
          v$animname = "FIGHTIDLE"
        end
	
        if $anim_req == 55
        then
          v$animfile = "MISC"
          v$animname = "BITCHSLAP"
        end
	
        if $anim_req == 56
        then
          v$animfile = "FIGHT_C"
          v$animname = "FIGHTC_IDLE"
        end
	
        if $anim_req == 57   
        then
          v$animfile = "PAULNMAC"
          v$animname = "PNM_ARGUE1_A"
        end
	
        if $anim_req == 58     
        then
          v$animfile = "PAULNMAC"
          v$animname = "PNM_ARGUE2_B"
        end
	
        if $anim_req == 59
        then
          v$animfile = "FIGHT_D"
          v$animname = "FIGHTD_G"
        end
        if $anim_req == 60
        then
          v$animfile = "FIGHT_D"
          v$animname = "FIGHTD_M"
        end
       $anim_req = 9999
    end
    if $anim_req < 69
    then
        v$animfile = "GANGS"
        if $anim_req == 61
        then
          v$animname = "PRTIAL_GNGTLKA"
        end
        if $anim_req == 62
        then
          v$animname = "PRTIAL_GNGTLKB"
        end
        if $anim_req == 63
        then
          v$animname = "PRTIAL_GNGTLKC"
        end
        if $anim_req == 64
        then
          v$animname = "PRTIAL_GNGTLKD"
        end
        if $anim_req == 65
        then
          v$animname = "PRTIAL_GNGTLKE"
        end
        if $anim_req == 66
        then
          v$animname = "PRTIAL_GNGTLKF"
        end
        if $anim_req == 67
        then
          v$animname = "PRTIAL_GNGTLKG"
        end
        if $anim_req == 68
        then
          v$animname = "PRTIAL_GNGTLKH"
        end
       
       $anim_req = 9999
    end
    if $anim_req < 80
    then
        if $anim_req == 69
        then
          v$animfile = "HEIST9"
          v$animname = "USE_SWIPECARD"
        end
        if $anim_req == 70
        then
          v$animfile = "STRIP"
          v$animname = "STR_LOOP_A"
        end
        if $anim_req == 71
        then
          v$animfile = "STRIP"
          v$animname = "STR_LOOP_B"
        end
        if $anim_req == 72
        then
          v$animfile = "STRIP"
          v$animname = "STR_LOOP_C"
        end
        if $anim_req == 73
        then
          v$animfile = "STRIP"
          v$animname = "STRIP_A"
        end
        if $anim_req == 74
        then
          v$animfile = "STRIP"
          v$animname = "STRIP_E"
        end
        if $anim_req == 75
        then
          v$animfile = "RYDER"
          v$animname = "RYD_BECKON_01"
        end
        if $anim_req == 76
        then
          v$animfile = "RYDER"
          v$animname = "RYD_BECKON_02"
        end
        if $anim_req == 77
        then
          v$animfile = "RYDER"
          v$animname = "RYD_BECKON_03"
        end
        if $anim_req == 78
        then
          v$animfile = "CRACK"
          v$animname = "CRCKDETH2"
        end
        if $anim_req == 79
        then
          v$animfile = "WUZI"
          v$animname = "CS_DEAD_GUY"
        end
       
       $anim_req = 9999
    end  
    if $anim_req < 87
    then
        v$animfile = "SWAT"
        if $anim_req == 80
        then
          v$animname = "GNSTWALL_INJURD"
        end
        if $anim_req == 81
        then
          v$animname = "SWT_WLLPK_R"
        end
        if $anim_req == 82
        then
          v$animname = "SWT_WLLPK_L"
        end
        if $anim_req == 83
        then
          $anim_loop = 0
          v$animname = "SWT_BREACH_01"
        end
        if $anim_req == 84
        then
          $anim_loop = 0
          v$animname = "SWT_BREACH_02"
        end
        if $anim_req == 85
        then
          $anim_loop = 0
          v$animname = "SWT_BREACH_03"
        end
        if $anim_req == 86
        then
          $anim_loop = 0
          v$animname = "SWT_GO"
        end
       $anim_req = 9999
    end  
    if $anim_req < 91
    then
        v$animfile = "COP_AMBIENT"
        if $anim_req == 87
        then
          v$animname = "COPLOOK_LOOP"
        end
        if $anim_req == 88
        then
          v$animname = "COPLOOK_NOD"
        end
        if $anim_req == 89
        then
          v$animname = "COPLOOK_SHAKE"
        end
        if $anim_req == 90
        then
          v$animname = "COPLOOK_THINK"
        end
       $anim_req = 9999
    end  
    if $anim_req < 95
    then
        v$animfile = "LOWRIDER"
        if $anim_req == 91
        then
          v$animname = "RAP_A_LOOP"
        end
        if $anim_req == 92
        then
          v$animname = "RAP_B_LOOP"
        end
        if $anim_req == 93
        then
          v$animname = "RAP_C_LOOP"
        end
        if $anim_req == 94
        then
          v$animname = "M_SMKSTND_LOOP"
        end
       $anim_req = 9999
    end  
    if $anim_req < 100
    then
        v$animfile = "PLAYIDLES"
        if $anim_req == 95
        then
          v$animname = "SHIFT"
        end
        if $anim_req == 96
        then
          v$animname = "SHLDR"
        end
        if $anim_req == 97
        then
          v$animname = "STRETCH"
        end
        if $anim_req == 98
        then
          v$animname = "STRLEG"
        end
        if $anim_req == 99
        then
          v$animname = "TIME"
        end
       $anim_req = 9999
    end  
    if $anim_req < 110
    then
        if $anim_req == 100
        then
          v$animfile = "CHAINSAW"
          v$animname = "CSAW_G"
        end
        if $anim_req == 101
        then
          v$animfile = "CRACK"
          v$animname = "CRCKIDLE2"
        end
        if $anim_req == 102
        then
          v$animfile = "INT_HOUSE"
          v$animname = "BED_LOOP_R"
        end
        if $anim_req == 103  
        then
          v$animfile = "GANGS"
          v$animname = "INVITE_YES"
        end
        if $anim_req == 104
        then
          v$animfile = "GANGS"
          v$animname = "INVITE_NO"
        end
        if $anim_req == 105
        then
          v$animfile = "GRAVEYARD"
          v$animname = "MRNF_LOOP"
        end
        if $anim_req == 106
        then
          v$animfile = "MISC"
          v$animname = "PLYRLEAN_LOOP"
        end
        if $anim_req == 107
        then
          v$animfile = "POLICE"
          v$animname = "COPTRAF_AWAY"
        end
        if $anim_req == 108
        then
          v$animfile = "POLICE"
          v$animname = "COPTRAF_LEFT"
        end
        if $anim_req == 109
        then
          v$animfile = "POLICE"
          v$animname = "COPTRAF_STOP"
        end
        $anim_req = 9999
    end
    if $anim_req < 120
    then
        if $anim_req == 110
        then
          v$animfile = "POLICE"
          v$animname = "DOOR_KICK"
        end
        if $anim_req == 111
        then
          v$animfile = "ATTRACTORS"
          v$animname = "STEPSIT_LOOP"
        end
        if $anim_req == 112
        then
          v$animfile = "MISC"
          v$animname = "SEAT_TALK_02"
        end
        if $anim_req == 113  
        then
          v$animfile = "OTB"
          v$animname = "BETSLP_LOOP"
        end
        if $anim_req == 114
        then
          v$animfile = "OTB"
          v$animname = "WTCHRACE_LOOP"
        end
        if $anim_req == 115
        then
          v$animfile = "DEALER"
          v$animname = "SHOP_PAY"
        end
        if $anim_req == 116
        then
          v$animfile = "BOMBER"
          v$animname = "BOM_PLANT_LOOP"
        end
        if $anim_req == 117
        then
          v$animfile = "MISC"
          v$animname = "PLYR_SHKHEAD"
        end
        if $anim_req == 118
        then
          v$animfile = "SHOP"
          v$animname = "SHP_GUN_AIM"
        end
        if $anim_req == 119
        then
          $animload = 0
          v$animname = "GUN_STAND"
        end
        $anim_req = 9999
    end
    if $anim_req < 130
    then
        if $anim_req == 120
        then
          $animload = 0
          $anim_loop = 0
          v$animname = "EV_DIVE"
        end
        if $anim_req == 121
        then
          $animload = 0
          $anim_loop = 0
          v$animname = "KO_SKID_FRONT"
        end
        if $anim_req == 122
        then
          $animload = 0
          v$animname = "FACANGER"
        end
        if $anim_req == 123
        then
          $animload = 0
          v$animname = "FACGUM"
        end
        if $anim_req == 124
        then
          $animload = 0
          v$animname = "FACSURP"
        end
        if $anim_req == 125
        then
          $animload = 0
          v$animname = "FACSURPM"
        end
        if $anim_req == 126
        then
          $animload = 0
          v$animname = "FACTALK"
        end
        if $anim_req == 127
        then
          $animload = 0
          v$animname = "FACURIOS"
        end
        if $anim_req == 128
        then
          v$animfile = "INT_OFFICE"
          v$animname = "OFF_SIT_CRASH"
        end
        if $anim_req == 129
        then
          v$animfile = "INT_OFFICE"
          v$animname = "OFF_SIT_READ"
        end
        $anim_req = 9999
    end
    if $ONMISSION == 0
    then
      $anim_loop = 1
    end 
    
    $anim_lock = 1
    $anim_lock -= $anim_loop 

    if $animload == 0
    then
        0605: actor $anim_actor perform_animation_sequence v$animname IFP_file "PED" 4.0 loop $anim_loop $anim_lock $anim_lock 0 time -1 // versionA        
    else
        04ED: load_animation v$animfile 
        repeat
            wait 0
        until 04EE:   animation v$animfile loaded 
        0605: actor $anim_actor perform_animation_sequence v$animname IFP_file v$animfile 4.0 loop $anim_loop $anim_lock $anim_lock 0 time -1 // versionA        
        04EF: release_animation v$animfile
    end 
    0662: printstring v$animname
  else  // if $anim_req > -1
    if or
      $anim_req == -2 
      $anim_req == -3 
      $anim_req == -9 
      $anim_req == -10 
    then
        // WALK / RUN / SPRINT / CROUCH
        //--------------
        var
          $idx : Integer
          $idx2 : Integer
        end  
        24@ = 4  // flags
        if $anim_req == -3
        then
          24@ = 6  // run     
        end
        if $anim_req == -9
        then
          24@ = 7  // sprint     
        end
        if $anim_req == -10
        then
          04EB: AS_actor $anim_actor crouch 1
        end
        0615: define_AS_pack_begin 15@ 
        05D6: clear_scmpath
        $cntr = 0 
        0084: $idx = $anim_distance
        REPEAT
            if $cntr == 8
            then
                05D8: AS_assign_scmpath to_actor -1 flags 24@ 0 
                05D6: clear_scmpath 
                $cntr = 0                   
            end
            05D7: add_point_to_scmpath $DYOM_POINT_X[$idx] $DYOM_POINT_Y[$idx] $DYOM_POINT_Z[$idx] 
            $idx2 = $idx
            $idx = $DYOM_POINT_LINK[$idx2]
            $cntr += 1            
        UNTIL $idx <= 0
        
        05D8: AS_assign_scmpath to_actor -1 flags 24@ 0 
        
        // Make it looping
        if $idx == -2
        then
          0643: set_AS_pack 15@ loop 1 
        end
        0616: define_AS_pack_end 15@ 
        0618: assign_actor $anim_actor to_AS_pack 15@
        061B: remove_references_to_AS_pack 15@     
    end
    
    if or
      $anim_req == -99 
      $anim_req == -100 
    then
        // oldstyle walking/running  (with distance current angle)
        if $anim_req == -99
        then
          $mode = 4
        else
          $mode = 6
        end  
        
        008C: $time = float $anim_distance to_integer 
        0008: $time += 2 
        0010: $time *= 1000 
    
        04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $anim_actor with_offset 0.0 0.0 0.0 
        04C4: store_coords_to $TEMPVAR_FLOAT_4 $TEMPVAR_FLOAT_5 $TEMPVAR_FLOAT_6 from_actor $anim_actor with_offset 0.0 $anim_distance 0.0 
        0615: define_AS_pack_begin 15@ 
        05D3: AS_actor -1 goto_point $TEMPVAR_FLOAT_4 $TEMPVAR_FLOAT_5 $TEMPVAR_FLOAT_6 mode $mode $time ms // versionA 
        05D3: AS_actor -1 goto_point $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 mode $mode $time ms // versionA 
        0643: set_AS_pack 15@ loop 1 
        0616: define_AS_pack_end 15@ 
        0618: assign_actor $anim_actor to_AS_pack 15@
        061B: remove_references_to_AS_pack 15@ 
    end
    if $anim_req == -7 
    then
        060A: create_decision_maker_type 0 store_to 23@ 
        060B: set_actor $anim_actor decision_maker_to 23@
        Actor.Health($anim_actor) = 20
        08AF: set_actor $anim_actor max_health_to 100 
        077A: set_actor $anim_actor acquaintance 4 to_actors_pedtype 0 // see ped.dat 
        Actor.WeaponAccuracy($anim_actor) = 5
        0762: AS_actor $anim_actor dies 
    end
    if $anim_req == -8 
    then
        05BC: AS_actor $anim_actor jump 1 
    end
    if $anim_req == -11 
    then
        0084: $idx = $anim_distance
        $cntr = 0
        REPEAT
            $idx2 = $idx
            $idx = $DYOM_POINT_LINK[$idx2]
            $cntr += 1            
        UNTIL $idx <= 0
        //0663: - PRINTSTRING "HIDE n:" $cntr
        $cntr += 1
        // choose a random number x: 1..n
        0209: 24@ = random_int_in_ranges 1 $cntr 
        //0663: - PRINTSTRING "HIDE x:" 24@
        
        // select point x 
        0084: $idx = $anim_distance
        WHILE 24@ >1
            $idx2 = $idx
            $idx = $DYOM_POINT_LINK[$idx2]
            24@ += -1            
        END        
        // position actor at x, facing initial location
        04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $anim_actor with_offset 0.0 0.0 0.0 
        $TEMPVAR_FLOAT_1 -= $DYOM_POINT_X[$idx]
        $TEMPVAR_FLOAT_2 -= $DYOM_POINT_Y[$idx]
        0604: get_Z_angle_for_point $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 store_to $TEMPVAR_ANGLE 
        actor.PutAt($anim_actor,$DYOM_POINT_X[$idx],$DYOM_POINT_Y[$idx],$DYOM_POINT_Z[$idx])
        actor.Angle($anim_actor) = $TEMPVAR_ANGLE
    end
    if $anim_req == -12 
    then
        04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $anim_actor with_offset 0.0 10.0 0.0 
        0667: AS_actor $anim_actor aim_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 1000000 ms
    end
    if or
      $anim_req == -4 
      $anim_req == -5 
      $anim_req == -6 
    then
        // CAR related ANIMATIONS
        //========================
        
        // First we find the nearest car
        //------------------------------
        00A0: store_actor $anim_actor position_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 
        $min_dist = 999.0
        $found_car = 0
        $tmpi = 0
        WHILE  $DYOM_car_count > $tmpi
            wait 0
            
            IF and 
               NOT $DYOM_car_spawnwith[$tmpi] > $DYOM_current_objective
               $DYOM_car_hidewith[$tmpi] > $DYOM_current_objective
            THEN
               050A: $dist = distance_between_XYZ $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 and_XYZ $DYOM_car_location_x[$tmpi] $DYOM_car_location_y[$tmpi] $DYOM_car_location_z[$tmpi]
               if $dist < $min_dist
               then
                  $min_dist = $dist
                  $found_car = $DYOM_car_handle[$tmpi]
                  $found_model = $DYOM_car_model[$tmpi]
               end
            END 
            $tmpi += 1
        END
        
        IF or
          $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_car 
          $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_telecar
        THEN
           050A: $dist = distance_between_XYZ $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 and_XYZ $DYOM_objective_location_x[$DYOM_current_objective] $DYOM_objective_location_y[$DYOM_current_objective] $DYOM_objective_location_z[$DYOM_current_objective]
           if $dist < $min_dist
           then
              $min_dist = $dist
              $found_car =  $DYOM_objective_handle[$DYOM_current_objective]
              $found_model =  $DYOM_objective_model[$DYOM_current_objective]
           end
        END
        
        if NOT $DYOM_mission_car == -1
        THEN
          00AA: store_car $DYOM_mission_car position_to $TEMPVAR_FLOAT_4 $TEMPVAR_FLOAT_5 $TEMPVAR_FLOAT_6 
           050A: $dist = distance_between_XYZ $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 and_XYZ $TEMPVAR_FLOAT_4 $TEMPVAR_FLOAT_5 $TEMPVAR_FLOAT_6
           if $dist < $min_dist
           then
              $min_dist = $dist
              $found_car =  $DYOM_mission_car
              $found_model = car.Model($DYOM_mission_car)
              //$found_model =  $DYOM_objective_model[$DYOM_current_objective]
           end
        END


        if $found_car <> 0
        then
            // Clear normal enemy/friend behaviour
            060A: create_decision_maker_type 0 store_to 23@ 
            060B: set_actor $anim_actor decision_maker_to 23@
            24@ = 0   // Do loop ?
            $pilot = 0
            if $anim_req == -4  // Enter vehicle
            then
              // Enter Car
              //----------------------------
              if $anim_distance <= 0
              then
                // Enter Car as Driver
                //----------------------------
                0615: define_AS_pack_begin 15@ 
                05B9: AS_actor -1 stay_idle 1000 ms
                05CB: AS_actor -1 enter_car $found_car as_driver 10000 ms 
              else
                // Enter Car as Passenger
                //----------------------------
                $anim_distance -= 1
                0615: define_AS_pack_begin 15@ 
                05B9: AS_actor -1 stay_idle 1000 ms
                05CA: AS_actor -1 enter_car $found_car passenger_seat $anim_distance 10000 ms 
              end  
            else
              if $anim_distance <= 0
              then
                // Leave/Sit As Driver
                //--------------------
                072A: put_actor $anim_actor into_car $found_car driverseat 
                0615: define_AS_pack_begin 15@ 
              else
                 // As Passenger
                 //--------------------
                 $anim_distance -= 1
                 072B: put_actor $anim_actor into_car $found_car passengerseat $anim_distance 
                 0615: define_AS_pack_begin 15@ 
              end   
            end   // if $anim_req == -4
           
            if $anim_distance < 0
            then
                if or 
                  0820:   model $found_model heli 
                  081F:   model $found_model plane 
                then
                    $pilot = 1

                    // Driver behaviour ( 0 => no driving )
                    // -1,-2,-3 route, without points, no action
                    if $anim_distance == -4    //Attack
                    then
                      if $anim_req == -4
                      then
                           05CB: AS_actor $anim_actor enter_car $found_car as_driver 2900 ms 
                           wait 3000 ms
                      end
                      if  0820:   model $found_model heli 
                      then
                        0825: set_helicopter $found_car instant_rotor_start 
                        0724: heli $found_car follow_and_attack_player $PLAYER_CHAR radius 50.0     //PPD
                      else
                        0710: plane $found_car follow_actor $PLAYER_ACTOR follow_car -1 radius 70.0   //PPD
                      end
                    end
                    if $anim_distance == -5    //Follow behind
                    then
                      if $anim_req == -4
                      then
                           05CB: AS_actor $anim_actor enter_car $found_car as_driver 2900 ms 
                           wait 3000 ms
                      end
                      if  0820:   model $found_model heli 
                      then
                        0825: set_helicopter $found_car instant_rotor_start 
                        0726: heli $found_car follow_actor $PLAYER_ACTOR follow_car -1 radius 20.0   //PPD
                      else
                        0710: plane $found_car follow_actor $PLAYER_ACTOR follow_car -1 radius 70.0   //PPD
                      end
                    end
                    var
                      $idx : Integer
                      $idx2 : Integer
                      $cntr : Integer
                      $type: Integer
                      $speed: Float
                    end  
                    if $anim_distance < -500    //Drive to
                    then
                      if and 
                         $anim_distance < -500
                         -1500 < $anim_distance
                      then 
                        car.SetMaxSpeed($found_car,20.0)
                        0084: $idx = $anim_distance
                        $idx += 1000                    
                      end
                    
                      if and 
                         $anim_distance < -1500
                         -2500 < $anim_distance
                      then 
                        car.SetMaxSpeed($found_car,100.0)
                        0084: $idx = $anim_distance
                        $idx += 2000                    
                      end
    
                      if and 
                         $anim_distance < -2500
                         -3500 < $anim_distance
                      then 
                        0084: $idx = $anim_distance
                        $idx += 3000                    
                      end
                      if 0820:   model $found_model heli 
                      then
                          0825: set_helicopter $found_car instant_rotor_start 
                          004F: create thread @HELI_PILOT $anim_actor $found_car $idx $anim_req
                      else
                          004F: create thread @PLANE_PILOT $anim_actor $found_car $idx $anim_req
                      end

                    end
                else
                    // Driver behaviour ( 0 => no driving )
                    // -1,-2,-3 route, without points, no action
                    if $anim_distance == -4    //Attack
                    then
                      06E1: AS_actor -1 using_car $found_car target_car -1 with_order 2 max_speed 60.0 traffic_flag 3 
                    end
                    if $anim_distance == -5    //Follow behind
                    then
                      06E1: AS_actor -1 using_car $found_car target_car -1 with_order 43 max_speed 60.0 traffic_flag 2
                    end
                    var
                      $idx : Integer
                      $idx2 : Integer
                      $cntr : Integer
                      $type: Integer
                      $speed: Float
                    end  
                    if $anim_distance < -500    //Drive to
                    then
                      if and 
                         $anim_distance < -500
                         -1500 < $anim_distance
                      then 
                        $type = 0   
                        $speed = 20.0 
                        $d = 5.0
                        0084: $idx = $anim_distance
                        $idx += 1000                    
                      end
                    
                      if and 
                         $anim_distance < -1500
                         -2500 < $anim_distance
                      then 
                        $type = 2   
                        $speed = 30.0 
                        $d = 7.0
                        0084: $idx = $anim_distance
                        $idx += 2000                    
                      end
    
                      if and 
                         $anim_distance < -2500
                         -3500 < $anim_distance
                      then 
                        $type = 2   
                        $speed = 40.0 
                        $d = 10.0
                        0084: $idx = $anim_distance
                        $idx += 3000                    
                      end
                      0587: toggle_car $found_car validate_position 1 
                      
                      $pilot = 1
                      004F: create thread @CAR_DRIVER $anim_actor $found_car $idx $anim_req $speed $type $d

                    end
                end    
            else
                // Passenger Behaviour
                //--------------------
                if or
                    $anim_gang == DYOM_gang_enemy
                    $anim_gang == DYOM_gang_enemy2
                then

                  0713: actor -1 driveby_actor $PLAYER_ACTOR car -1 point 0.0 0.0 0.0 radius 5000.0 8 1 firing_rate 40     //PPD
                end 
                if $anim_gang == DYOM_gang_friend
                then
                  0713: actor -1 driveby_actor -1 car -1 point 0.0 0.0 0.0 radius 5000.0 8 1 firing_rate 40 
                end 
            end  // if $anim_distance <= 0

            if $anim_req == -5  // Leave vehicle
            then
              if $anim_distance <= 0
              then
                // The Driver will get out (after possibly driving here)
                05B9: AS_actor -1 stay_idle 1000 ms
                05CD: AS_actor -1 exit_car $found_car 
              else
                // Passengers that need to leave with a driver that drives here, have a problem.
                // The driver doesn't have to be known yet, so the destination is hard to determine.
                // For now, just let them sit in the car.
                // 05CF: AS_actor -1 exit_car $DYOM_car_handle[$found_car] when_at ??? ??? ???
              end  
            end          
            // Finalize and assign SA pack
            //----------------------------
            0643: set_AS_pack 15@ loop 24@ 
            0616: define_AS_pack_end 15@ 
            if $pilot == 0
            then
              0618: assign_actor $anim_actor to_AS_pack 15@
            end  

            061B: remove_references_to_AS_pack 15@ 
        end  // $found_car <> 0
    end  // if "CAR_ANIMATION"
  end  // if $anim_req > -1
  $anim_req = -1
until false
END_THREAD

:ROUTINE_enterspace_release
  repeat
    wait 20
  until 80E1:   NOT player 0 pressed_key 16
  repeat
    wait 20
  until 8AB0:   NOT   key_pressed 0x0D 
return


//--------------------------------
// Variables for interior tool and teleport to objective
//--------------------------------
var
   $interior_selected:integer
   $previous_interior:integer
   $interior_id:integer
end
var
  $obj_idx :integer
  $obj_prev :integer
  $obj_cancel :integer
  $obj_int:integer
  $za:float
  $ground_z_marker:float
end

//--------------------------------
// Generic menu handling routine
//--------------------------------
var
  $menu:Integer
  $menu_choice:Integer
  $menu_canceled:Integer
end
:GEN_MENU
$menu_canceled = 0
0512: permanent_text_box 'MENU'  // Use ~k~~GO_FORWARD~ and ~k~~GO_BACK~ to select.~N~~k~~PED_SPRINT~ Select~N~~k~~VEHICLE_ENTER_EXIT~ Exit
gosub @ROUTINE_enterspace_release                                                
repeat
    wait  0 ms
    if  00E1:   player 0 pressed_key 15 
    then                                                                                                                    
        08DA: remove_panel $menu
        03E6: remove text box
        repeat
            wait 20
        until 80E1:   NOT player 0 pressed_key 15
        $menu_canceled = 1
        return
    end
    if 0AB0:  key_pressed 0x0D
    then
      break  // Accept enter as alternative for 'space' to make a choice in the menu's.
    end  
until 00E1:   player 0 pressed_key 16         
gosub @ROUTINE_enterspace_release                                                

08D7: $menu_choice = panel $menu active_row
08DA: remove_panel $menu 
03E6: remove text box
      
return

//------------------------------------
// Generic action confirmation routine
//------------------------------------
var
  $confirm_canceled:Integer
end
:GEN_CONFIRM_ACTION
gosub @ROUTINE_enterspace_release                                                
$confirm_canceled = 0
repeat
    wait  0 ms
    if 00E1:   player 0 pressed_key 15 
    then       
        repeat
          wait 20
        until 80E1:   NOT player 0 pressed_key 15  
        03E6: remove text box
        0373: set_camera_directly_behind_player 
        02EB: restore_camera_with_jumpcut
        $confirm_canceled = 1
        return
    end
    if 0AB0:  key_pressed 0x0D
    then
      break  // Accept enter as alternative for 'space' to end the loop
    end  
until 00E1:   player 0 pressed_key 16                
gosub @ROUTINE_enterspace_release                                                
03E6: remove text box

0373: set_camera_directly_behind_player 
02EB: restore_camera_with_jumpcut

return

:DESIGNMODE_ON
while not player.Defined($PLAYER_CHAR)
  wait 20
end
04D8: set_actor $PLAYER_ACTOR drowns_in_water 0 
02AB: set_actor $PLAYER_ACTOR immunities BP 1 FP 1 EP 1 CP 1 MP 1 
055D: make_player $PLAYER_CHAR fireproof 1
03BA: clear_cars_from_cube_cornerA -3000.0 -3000.0 -100.0 cornerB 3000.0 3000.0 2000.0
042B: clear_peds_from_cube_cornerA -3000.0 -3000.0 -100.0 cornerB 3000.0 3000.0 2000.0 
01EB: set_traffic_density_multiplier_to 0.0 
03DE: set_pedestrians_density_multiplier_to 0.0 
return

:DESIGNMODE_OFF
while not player.Defined($PLAYER_CHAR)
  wait 20
end
04D8: set_actor $PLAYER_ACTOR drowns_in_water 1 
02AB: set_actor $PLAYER_ACTOR immunities BP 0 FP 0 EP 0 CP 0 MP 0 
055D: make_player $PLAYER_CHAR fireproof 0
return

//============================================================================
//============================================================================
//
//                             M A I N   M E N U
//
//============================================================================
//============================================================================
:MAINMENU_THREAD
thread 'DYOMMENU' 

:MENUSNIFFER
$IN_MENU = 0
wait 20 ms

if and
0256:   player $PLAYER_CHAR defined 
$ONMISSION == 0 
$DYOM_IN_STORY == 0          
jf @MENUSNIFFER

if and
 0AB0:  key_pressed 17  // ctrl
 0AB0:  key_pressed 80  // P
then
  gosub @actor_add_duplicate 
end

if  
00E1:   player 0 pressed_key 11
jf @MENUSNIFFER   

:MAINMENU
$IN_MENU = 1
Player.CanMove($PLAYER_CHAR) = False

08D4: $menu = create_panel_with_title 'MAIN MEN' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
08DB: set_panel $menu column 0 header 'MAIN MEN' data 'MMENU' 'SMENU' 'SETTING' 'PLAYER' 'OBJECTI' 'ACTORS' 'CARS' 'PICKUPS' 'OBJECTS' 'TOOLS' 'DUMMY' 'DUMMY'  
gosub @GEN_MENU
if $menu_canceled == 1
then
  goto @MAINMENULOOP
end

if $menu_choice == 0
then
    //===============================
    // MISSION MENU
    //===============================
    08D4: $menu = create_panel_with_title 'MISSIE' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'MMENU' data 'PLAY' 'SAVEMIS' 'LOAD' 'PUBL' 'NEW' 'AUDIO' 'OTEXP' 'OTIMP' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
      goto @MAINMENU
    end
    
    if $menu_choice == 0
    then
       //---------------
       // Start Mission
       //---------------
       if and
         $ONMISSION == 0 
         Player.Controllable($PLAYER_CHAR)
       then
          $ONMISSION = 1
          fade 0 300
          if 0AA9:   is_game_version_original 
          then 
            0AA8: call_function_method 0x6A0050 struct 0xC1B340 num_params 1 pop 0 $TEXTTAG 0@ // GetGxtString
            0AA5: call 0x718600 num_params 2 pop 2 0@ $TEXTNAME // cpystr
          else
            0AA8: call_function_method 0x6A0870 struct 0xC1DB00 num_params 1 pop 0 $TEXTTAG 0@ // GetGxtString
            0AA5: call 0x718E90 num_params 2 pop 2 0@ $TEXTNAME // cpystr
          end
          00BA: show_text_styled GXT 'DYOMTXT' time 1000 style 2 
          
          wait 300
          
          gosub @CLEAR_DESIGN_ITEMS
          while not player.Defined($PLAYER_CHAR) 
            wait 100
          end
          gosub @DESIGNMODE_OFF

          Player.CanMove($PLAYER_CHAR) = True
          
          start_mission 1 
          repeat
            wait 200
          until $ONMISSION == 0
          014F: stop_timer $mission_timer
          while not player.Defined($PLAYER_CHAR) 
            wait 100
          end
          Player.CanMove($PLAYER_CHAR) = False
          wait 4000
          fade 0 2000
          wait 2000
          gosub @CLEAR_DESIGN_ITEMS
          wait 100
          gosub @SHOW_DESIGN_ITEMS
          wait 1000
          while not player.Defined($PLAYER_CHAR) 
            wait 100
          end
          gosub @DESIGNMODE_ON
          09C7: set_player $PLAYER_CHAR modelID_to #NULL
          0373: set_camera_directly_behind_player 
          02EB: restore_camera_with_jumpcut
          048F: actor $PLAYER_ACTOR remove_weapons 
          06C8: enable_riot 0
          
          fade 1 500
          Player.CanMove($PLAYER_CHAR) = True

       end
       goto @MAINMENULOOP
    end
    
    if $menu_choice == 1
    then
        //---------------
        // Save Mission
        //---------------
        gosub @SAVE_FILE
        goto @MAINMENULOOP
    end
    
    if $menu_choice == 2
    then
        //---------------
        // Load Mission
        //---------------
         gosub @LOAD_FILE
         if and 
            $LOAD_RESULT == 0
            NOT $DYOM_selected_slot == 0
         then
           // File could not be load
           00BC: show_text_highpriority GXT 'FILERRL' time 3000 flag 1
         end  
         
         // check $DYOM_selected_slot == 0, 
         // in that case, load was canceled and nothing should be done.
         if NOT $DYOM_selected_slot == 0
         then
             if $readonly == 0
             then
                  fade 0 0
                  wait 500
                  gosub @SHOW_DESIGN_ITEMS
                
                
                  0373: set_camera_directly_behind_player 
                  wait 0 ms
                  fade 1 500
                
                  00BC: show_text_highpriority GXT 'MISLOAD' time 3000 flag 1
    
             else
                  wait 1000
                  $ONMISSION = 1
                  fade 0 500
                  if 0AA9:   is_game_version_original 
                  then 
                    0AA8: call_function_method 0x6A0050 struct 0xC1B340 num_params 1 pop 0 $TEXTTAG 0@ // GetGxtString
                    0AA5: call 0x718600 num_params 2 pop 2 0@ $TEXTNAME // cpystr
                  else
                    0AA8: call_function_method 0x6A0870 struct 0xC1DB00 num_params 1 pop 0 $TEXTTAG 0@ // GetGxtString
                    0AA5: call 0x718E90 num_params 2 pop 2 0@ $TEXTNAME // cpystr
                  end
                  00BA: show_text_styled GXT 'DYOMTXT' time 1000 style 2 
                  
                  while not player.Defined($PLAYER_CHAR) 
                    wait 100
                  end
                  Player.CanMove($PLAYER_CHAR) = True
                  gosub @DESIGNMODE_OFF
                  
                  start_mission 1 
                  repeat
                    wait 200
                  until $ONMISSION == 0
                  014F: stop_timer $mission_timer
                  while not player.Defined($PLAYER_CHAR) 
                    wait 100
                  end
                  Player.CanMove($PLAYER_CHAR) = False
                  wait 4000
                  fade 0 2000
                  wait 2000
                  gosub @CLEAR_DESIGN_ITEMS
                  $INITDONE = 0
                  0417: start_mission 0  // Initial 
                  repeat
                    wait 10
                  until $INITDONE == 1
                  //wait 2000
                  gosub @SHOW_DESIGN_ITEMS
                  wait 1000
                  while not player.Defined($PLAYER_CHAR) 
                    wait 100
                  end
                  gosub @DESIGNMODE_ON
                  09C7: set_player $PLAYER_CHAR modelID_to #NULL
                  0373: set_camera_directly_behind_player 
                  02EB: restore_camera_with_jumpcut
                  048F: actor $PLAYER_ACTOR remove_weapons 
                  06C8: enable_riot 0
                  //03BA: clear_cars_from_cube_cornerA -3000.0 -3000.0 -100.0 cornerB 3000.0 3000.0 2000.0
                  //042B: clear_peds_from_cube_cornerA -3000.0 -3000.0 -100.0 cornerB 3000.0 3000.0 2000.0 
                  //01EB: set_traffic_density_multiplier_to 0.0 
                  //03DE: set_pedestrians_density_multiplier_to 0.0 

                  fade 1 500
                  Player.CanMove($PLAYER_CHAR) = True
               
             end
         end
        goto @MAINMENULOOP
    end
    
    if $menu_choice == 3
    then
        //---------------
        // Publish  Mission
        //---------------
         gosub @PUBLISH_FILE
         03E5: show_text_box 'PUBLHLP'  
        goto @MAINMENULOOP
    end
    
    if $menu_choice == 4
    then
        //---------------
        // Clean  Mission
        //---------------
        gosub @CLEAR_DESIGN_ITEMS
        $INITDONE = 0
        0417: start_mission 0  // Initial 
        repeat
          wait 10
        until $INITDONE == 1
        
        gosub @GENERATE_AUDIOCODE
        // Mission Name
        0512: show_permanent_text_box 'NAMEHLP' 
        
        $TEXTCUR = $TEXTNAME
        $TEXTMAX = 49
        gosub @TEXT_input
        
        // Mission Author
        0512: show_permanent_text_box 'MAUTHLP' 
        $TEXTCUR = $TEXTAUTHOR
        $TEXTMAX = 49
        gosub @TEXT_input
        
        gosub @SHOW_DESIGN_ITEMS
        goto @MAINMENULOOP
    end
    
    if $menu_choice == 5
    then
        //---------------
        // Show Mission audio code
        //---------------
        $TEXTCUR = $TEXTAUDIOCODE
         gosub @TEXT_show
        goto @MAINMENULOOP
    end     
    
    if $menu_choice == 6
    then
        //---------------
        // Export Mission Texts
        //---------------
        0A99: chdir 1
        if 0A9A: $hFILE = openfile "DYOMtemp.txt" mode "wt+"  // IF and SET
        then
            $idx = 0
            while $idx < $DYOM_objective_count
                $idx2 = $idx
                $idx2 *= 100
                $idx2 += $TEXTOBJECTIVES 
                0AD8: write_string_to_file $hFile from $idx2 //IF and SET
                0AD9: write_formatted_text "%c" in_file $hFile 0xA
                $idx += 1
            end
            0AD9: write_formatted_text "---------= DYOM Objective texts =-------%c" in_file $hFile 0xA 
            0AD9: write_formatted_text "The first %d lines of this file should contain the objective texts to be imported.%c" in_file $hFile $DYOM_objective_count 0xA
            0AD9: write_formatted_text "One line per objective, Maximum 99 characters per line.%c" in_file $hFile 0xA
            0AD9: write_formatted_text "Warning:%c" in_file $hFile 0xA
            0AD9: write_formatted_text " * Save your mission before importing texts.%c" in_file $hFile 0xA
            0AD9: write_formatted_text " * Lines that are too long will mess up your mission.%c" in_file $hFile 0xA
            0AD9: write_formatted_text " * Trailing spaces on a line will make your text invisible ingame.%c" in_file $hFile 0xA
            0AD9: write_formatted_text " * Not all characters are supported by the ingame font.%c" in_file $hFile 0xA
            0A9B: closefile $hFILE
            0ACD: show_text_highpriority "Objective texts exported to DYOMtemp.txt" time 2000

        end
        goto @MAINMENULOOP
    end
    if $menu_choice == 7
    then
        //---------------
        // Import Mission Texts
        //---------------
        0A99: chdir 1
        if 0A9A: $hFILE = openfile "DYOMtemp.txt" mode "r"  // IF and SET
        then
            $idx = 0
            while $idx < $DYOM_objective_count
                $idx2 = $idx
                $idx2  *= 100
                $idx2 += $TEXTOBJECTIVES
                0AD7: read_string_from_file $hFile to $idx2 size 99 // IF and SET
                0ACD: show_text_highpriority $idx2 time 100
                wait 100
                $idx += 1
            end
            0A9B: closefile $hFILE
            0ACD: show_text_highpriority "Objective texts imported from DYOMtemp.txt" time 2000
        else
            0ACD: show_text_highpriority "Failed to import objective texts from DYOMtemp.txt" time 2000
        end
        goto @MAINMENULOOP
    end
    

    goto @MAINMENULOOP
end
//=====
// end of mission menu
//=====


if $menu_choice == 1
then
    :STORYLINE_MENU
    //===============================
    // STORYLINE MENU
    //===============================
    08D4: $menu = create_panel_with_title 'SLINE' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    if $DYOM_AUTORUN == 0
    then
        08DB: set_panel $menu column 0 header 'SMENU' data 'STEST' 'SCLEAR' 'MMENU' 'SAUTO' 'MTADD' 'MTEDIT' 'MTDEL' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 
    else
        08DB: set_panel $menu column 0 header 'SMENU' data 'STEST' 'SCLEAR' 'MMENU' 'SNOAUTO' 'MTADD' 'MTEDIT' 'MTDEL' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 
    end
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
      goto @MAINMENU
    end
    
    if $menu_choice == 0
    then
        // Test Storyline
        
        create_thread @STORYLINE_THREAD 

        goto @MAINMENULOOP
    end
    if $menu_choice == 1
    then
        // Clear Storyline
        gosub @CLEAR_DESIGN_ITEMS
        $DYOM_trigger_count = 1
        gosub @SHOW_DESIGN_ITEMS
        gosub @SAVE_STORYLINE
        
        // clear INTRO, OUTRO and autostart file
        v$filename = "DSL/_intro.dat"
        gosub @CLEAR_NAMED_FILE
        v$filename = "DSL/_outro.dat"
        gosub @CLEAR_NAMED_FILE
        v$filename = "DSL/_autorun"
        gosub @CLEAR_NAMED_FILE
        goto @MAINMENULOOP
    end
    
    if $menu_choice == 2
    then
        //===============================
        // MISSION MENU
        //===============================
        08D4: $menu = create_panel_with_title 'SLINE' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'MMENU' data 'SSAVE' 'SINTRO' 'SOUTRO' 'SLOAD' 'LINTRO' 'LOUTRO' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 
        gosub @GEN_MENU
        if $menu_canceled == 1
        then
          goto @MAINMENU
        end
        
        if $menu_choice == 0
        then
            // Save Mission for Storyline
            // Input requested filename
            0512: show_permanent_text_box 'FILETXT' 
            $TEXTCUR = $TEXTFILE
            $TEXTMAX = 10
            gosub @TEXT_input
            
            // Calculate address of this string,
            // and copy the input string at offset 4 into it
            1@v = "DSL/            "        
            0A9F: 0@ = current_thread_pointer
            0@ += 0x3C
            0@ += 8 // variable 1@s => 1 * 4  ( +4 for "DSL/" )
            if 0AA9:   is_game_version_original 
            then 
                0AA5: call 0x718600 num_params 2 pop 2 0@ $TEXTFILE // cpystr
            else
                0AA5: call 0x718E90 num_params 2 pop 2 0@ $TEXTFILE // cpystr
            end
            
            // Now save the current mission under this name 
            v$filename = 1@v
            gosub @SAVE_NAMED_FILE
            goto @MAINMENULOOP
        end
        if $menu_choice == 1
        then
            // Store as Intro
            v$filename = "DSL/_intro.dat"
            gosub @SAVE_NAMED_FILE
            goto @MAINMENULOOP
        end
        if $menu_choice == 2
        then
            // Store as Outro
            v$filename = "DSL/_outro.dat"
            gosub @SAVE_NAMED_FILE
            goto @MAINMENULOOP
        end
        if $menu_choice == 3
        then
            // Load mission from DSL
            // Input requested filename
            0512: show_permanent_text_box 'FILETXT' 
            $TEXTCUR = $TEXTFILE
            $TEXTMAX = 10
            gosub @TEXT_input
            
            // Calculate address of this string,
            // and copy the input string at offset 4 into it
            1@v = "DSL/            "        
            0A9F: 0@ = current_thread_pointer
            0@ += 0x3C
            0@ += 8 // variable 1@s => 1 * 4  ( +4 for "DSL/" )
            if 0AA9:   is_game_version_original 
            then 
                0AA5: call 0x718600 num_params 2 pop 2 0@ $TEXTFILE // cpystr
            else
                0AA5: call 0x718E90 num_params 2 pop 2 0@ $TEXTFILE // cpystr
            end
            
            // Now load this file 
            v$filename = 1@v
            $loadnoreadonly = 1
            gosub @LOAD_NAMED_FILE
            if $LOAD_RESULT == 0
            then
                // File could not be load
                00BC: show_text_highpriority GXT 'FILERRL' time 3000 flag 1
            end  
             
            fade 0 0
            wait 500
            gosub @SHOW_DESIGN_ITEMS
            
            
            0373: set_camera_directly_behind_player 
            wait 0 ms
            fade 1 500
            
            00BC: show_text_highpriority GXT 'MISLOAD' time 3000 flag 1
            
            goto @MAINMENULOOP
        end
        if $menu_choice == 4
        then
            // Load Intro
            v$filename = "DSL/_intro.dat"
            $loadnoreadonly = 1
            gosub @LOAD_NAMED_FILE
            if $LOAD_RESULT == 0
            then
                // File could not be load
                00BC: show_text_highpriority GXT 'FILERRL' time 3000 flag 1
            end  
             
            fade 0 0
            wait 500
            gosub @SHOW_DESIGN_ITEMS
            
            
            0373: set_camera_directly_behind_player 
            wait 0 ms
            fade 1 500
            
            00BC: show_text_highpriority GXT 'MISLOAD' time 3000 flag 1
            
            goto @MAINMENULOOP
        end
        if $menu_choice == 5
        then
            // Load Outro
            v$filename = "DSL/_outro.dat"
            $loadnoreadonly = 1
            gosub @LOAD_NAMED_FILE
            if $LOAD_RESULT == 0
            then
                // File could not be load
                00BC: show_text_highpriority GXT 'FILERRL' time 3000 flag 1
            end  
             
            fade 0 0
            wait 500
            gosub @SHOW_DESIGN_ITEMS
            
            
            0373: set_camera_directly_behind_player 
            wait 0 ms
            fade 1 500
            
            00BC: show_text_highpriority GXT 'MISLOAD' time 3000 flag 1
            
            goto @MAINMENULOOP
        end
        goto @MAINMENULOOP
    end    
    if $menu_choice == 3
    then
        v$filename = "DSL/_autorun"
        if $DYOM_AUTORUN == 0
        then
            // Make autorun
            gosub @SET_NAMED_FILE
            $DYOM_AUTORUN = 1
        else
            // Clear autorun
            gosub @CLEAR_NAMED_FILE
            $DYOM_AUTORUN = 0
        end
        goto @MAINMENULOOP
    end
    if $menu_choice == 4
    then
        // Add Missiontrigger
        gosub @ADDTRIGGER
        gosub @SAVE_STORYLINE
        goto @MAINMENULOOP
    end
    if $menu_choice == 5
    then
        // Edit Missiontrigger
        gosub @EDITTRIGGER
        gosub @SAVE_STORYLINE
        goto @MAINMENULOOP
    end
    if $menu_choice == 6
    then
        // Remove Missiontrigger
        gosub @DELETE_TRIGGER
        gosub @SAVE_STORYLINE
        goto @MAINMENULOOP
    end
    goto @MAINMENULOOP
end
//=====
// end of storyline menu
//=====


if $menu_choice == 2
then
    :SETTING_MENU
    //===============================
    // SETTINGS MENU
    //===============================
    08D4: $menu = create_panel_with_title 'SETTING' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'SETTING' data 'MNAME' 'MINTRO' 'TIMELIM' 'TIMED' 'DAYTIME' 'WEATHER' 'MINWANT' 'MAXWANT' 'RIOT' 'DUMMY' 'DUMMY' 'DUMMY'  
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
      goto @MAINMENU
    end
    
    if $menu_choice == 0
    then
        // Mission Name
        0512: show_permanent_text_box 'NAMEHLP' 
        $TEXTCUR = $TEXTNAME
        $TEXTMAX = 49
        gosub @TEXT_input
        goto @MAINMENULOOP
    end

    if $menu_choice == 1
    then
        0512: show_permanent_text_box 'MINTHLP' 
        $TEXTCUR = $TEXTINTRO
        $TEXTMAX = 99
        gosub @TEXT_input
        0512: show_permanent_text_box 'MINTHLP' 
        $TEXTCUR += 100
        gosub @TEXT_input
        0512: show_permanent_text_box 'MINTHLP' 
        $TEXTCUR += 100
        gosub @TEXT_input
        goto @MAINMENULOOP
    end
    
    if $menu_choice == 2
    then
        GOSUB @SELECT_TIMELIMIT
        goto @MAINMENULOOP
    end

    if $menu_choice == 3
    then
        //===============================
        // Timed missie
        //===============================
        08D4: $menu = create_panel_with_title 'SETTING' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'TIMED' data 'ON' 'OFF' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
        gosub @GEN_MENU
        if $menu_canceled == 1
        then
          goto @SETTING_MENU
        end

        if $menu_choice == 0
        then
          08BA: set $DYOM_properties bit DYOM_propbit_timed
        end   
        
        if $menu_choice == 1
        then
          08C0: clear $DYOM_properties bit DYOM_propbit_timed 
        end
        goto @MAINMENULOOP
    end
    
    if $menu_choice == 4
    then
        GOSUB @SELECT_DAYTIME
        goto @MAINMENULOOP
    end
    
    if $menu_choice == 5
    then
        $select_weather = $DYOM_weather
        GOSUB @SELECT_WEATHER
        $DYOM_weather = $select_weather
        goto @MAINMENULOOP
    end
    
    if $menu_choice == 6
    then
        //===============================
        // minimum wanted level
        //===============================
        08D4: $menu = create_panel_with_title 'SETTING' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'MINWANT' data 'WANT0' 'WANT1' 'WANT2' 'WANT3' 'WANT4' 'WANT5' 'WANT6' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
        gosub @GEN_MENU
        if $menu_canceled == 1
        then
          goto @SETTING_MENU
        end
        $DYOM_minwantedlevel = $menu_choice
        goto @MAINMENULOOP
    end
    
    if $menu_choice == 7
    then
        //===============================
        // maximum wanted level
        //===============================
        08D4: $menu = create_panel_with_title 'SETTING' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'MAXWANT' data 'WANT0' 'WANT1' 'WANT2' 'WANT3' 'WANT4' 'WANT5' 'WANT6' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
        gosub @GEN_MENU
        if $menu_canceled == 1
        then
          goto @SETTING_MENU
        end
        $DYOM_maxwantedlevel = $menu_choice
        goto @MAINMENULOOP
    end

    if $menu_choice == 8
    then
        //===============================
        // riots
        //===============================
        08D4: $menu = create_panel_with_title 'SETTING' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'RIOT' data 'ON' 'OFF' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
        gosub @GEN_MENU
        if $menu_canceled == 1
        then
          goto @SETTING_MENU
        end
            
        if $menu_choice == 0
        then
          08BA: set $DYOM_properties bit DYOM_propbit_riot
        else  
          08C0: clear $DYOM_properties bit DYOM_propbit_riot  
        end   
        goto @MAINMENULOOP
    end

    goto @MAINMENULOOP
end
//====
// end of setting menu
//====

if $menu_choice == 3
then
    //===============================
    // PLAYER MENU
    //===============================
    gosub @DEFINE_PLAYER
    goto @MAINMENULOOP
end

if $menu_choice == 4
then
    //===============================
    // OBJECTIVE MENU
    //===============================
    08D4: $menu = create_panel_with_title 'OBJECTI' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'OBJECTI' data 'ADDOBJ' 'EDOBJ' 'DEOBJ' 'SELOBJ' 'MOVE' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
      goto @MAINMENU
    end
    
    if $menu_choice == 0
    then
        //Add Objective
        if DYOM_objective_max > $DYOM_objective_count
        then
        
            //===============================
            // ADD OBJECTIVE MENU
            //===============================
            :ADD_OBJECTIVE_MENU
            08D4: $menu = create_panel_with_title 'OBJECTI' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
            08DB: set_panel $menu column 0 header 'ADDOBJ' data 'ADDCAR' 'ADDACT' 'ADDPIC' 'ADDCHE' 'ADDOB' 'ADDSPEC' 'ADDSPC1' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
            gosub @GEN_MENU
            if $menu_canceled == 1
            then
              goto @MAINMENU
            end
            
            if $menu_choice == 0
            then
                //Add Car
                gosub @ADD_OBJECTIVE_CAR
                goto @MAINMENULOOP
            end
            
            if $menu_choice == 1
            then
                 //Add Actor
                  gosub @ADD_OBJECTIVE_ACTOR
                goto @MAINMENULOOP
            end
        
            if $menu_choice == 2
            then
                 //Add Pickup
                  gosub @ADD_OBJECTIVE_PICKUP
                  goto @MAINMENULOOP
            end
            
            if $menu_choice == 3
            then
                 //Add Checkpoint
                  gosub @ADD_OBJECTIVE_MARKER
                 goto @MAINMENULOOP
            end

            if $menu_choice == 4
            then
                 //Add Object
                  gosub @ADD_OBJECTIVE_OBJECT
                 goto @MAINMENULOOP
            end
            
            if $menu_choice == 5
            then
                08D4: $menu = create_panel_with_title 'OBJECTI' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
                08DB: set_panel $menu column 0 header 'SPECIAL' data 'ADDTELE' 'ANNIM' 'ADDTCAR' 'ADDWANT' 'NOWEAP' 'ADDPH' 'ADDAM' 'ADDSM' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
                gosub @GEN_MENU
                if $menu_canceled == 1
                then
                  goto @ADD_OBJECTIVE_MENU
                end
            
                if $menu_choice == 0
                then
                     //Add Teleport
                      gosub @ADD_OBJECTIVE_TELEPORT
                      goto @MAINMENULOOP
                end
            
                if $menu_choice == 1
                then
                     //Add Teleport
                      gosub @ADD_OBJECTIVE_ANIMATION
                      goto @MAINMENULOOP
                end
            
               if $menu_choice == 2
                then
                     //Add Teleport to Car
                      gosub @ADD_OBJECTIVE_TELECAR
                      goto @MAINMENULOOP
                end
          
                if $menu_choice == 3
                then
                     //Wanted level 
                      gosub @ADD_OBJECTIVE_WANTED
                      goto @MAINMENULOOP
                end
                
                if $menu_choice == 4
                then
                     //Remove weapons 
                      gosub @ADD_OBJECTIVE_NOWEAPON
                      goto @MAINMENULOOP
                end
                
                if $menu_choice == 5
                then
                     //Talk on Phone
                      gosub @ADD_OBJECTIVE_PHONE
                      goto @MAINMENULOOP
                end

                if $menu_choice == 6
                then
                     //add Money
                      gosub @ADD_OBJECTIVE_ADDMONEY
                      goto @MAINMENULOOP
                end

                if $menu_choice == 7
                then
                     //Subtract Money
                      gosub @ADD_OBJECTIVE_SUBMONEY
                      goto @MAINMENULOOP
                end
                goto @MAINMENULOOP
            end
            
            if $menu_choice == 6
            then
                08D4: $menu = create_panel_with_title 'OBJECTI' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
                08DB: set_panel $menu column 0 header 'SPECIAL' data 'ADDCUT' 'ADDDOWN' 'ADDTIME' 'ADDWEAT' 'ADDSTIM' 'ADDPED' 'ADDTIMR' 'ADDTIMO' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 
                gosub @GEN_MENU
                if $menu_canceled == 1
                then
                  goto @ADD_OBJECTIVE_MENU
                end
            
                if $menu_choice == 0
                then
                  //Add Cutscene
                     gosub @ADD_OBJECTIVE_CUTSCENE
                     goto @MAINMENULOOP
                end
            
                if $menu_choice == 1
                then
                     //Add Countdown
                      gosub @ADD_OBJECTIVE_COUNTDOWN
                      goto @MAINMENULOOP
                end
         
                if $menu_choice == 2
                then
                     //Add Timeout
                      gosub @ADD_OBJECTIVE_TIMEOUT
                      goto @MAINMENULOOP
                end
                
                if $menu_choice == 3
                then
                     //Weather
                      gosub @ADD_OBJECTIVE_WEATHER
                      goto @MAINMENULOOP
                end
                
                if $menu_choice == 4
                then
                     //Set Time
                      gosub @ADD_OBJECTIVE_SETTIME
                      goto @MAINMENULOOP
                end
                
                if $menu_choice == 5
                then
                     //Ped/cars Behaviour
                      gosub @ADD_OBJECTIVE_PEDS
                      goto @MAINMENULOOP
                end
                
                if $menu_choice == 6
                then
                     //TimeLimit objective
                      gosub @ADD_OBJECTIVE_TIMELIMIT
                      goto @MAINMENULOOP
                end
                
                if $menu_choice == 7
                then
                     //Start Timer :)
                      gosub @ADD_OBJECTIVE_TIMERON
                      goto @MAINMENULOOP
                end
                
            end
        end
        goto @MAINMENULOOP
    end
       
    if $menu_choice == 1
    then
         //Edit objective
        if $DYOM_objective_count > 0
        then
          gosub @EDIT_OBJECTIVE
        end
        goto @MAINMENULOOP
    end
    
    if $menu_choice == 2
    then
        //Destroy Objective
        gosub @DELETE_OBJECTIVE
        goto @MAINMENULOOP
    end

    if $menu_choice == 3
    then
        //SELECT Objective
        gosub @SELECT_OBJECTIVE
        goto @MAINMENULOOP
    end
    if $menu_choice == 4
    then
        //SELECT Objective
        gosub @MOVE_OBJECTIVE
        goto @MAINMENULOOP
    end
    goto @MAINMENULOOP
end

if $menu_choice == 5
then
    //===============================
    // ACTORS MENU
    //===============================
    08D4: $menu = create_panel_with_title 'ACTORS' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'ACTORS' data 'ADDACT' 'SACT' 'HACT' 'EDACT' 'DEACT' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
      goto @MAINMENU
    end
    
    if $menu_choice == 0
    then
        //Add Actor
        if DYOM_actor_max > $DYOM_actor_count
        then
          gosub @ADDACTOR
        end
        goto @MAINMENULOOP
    end
    
    if $DYOM_actor_count > 0
    then
        if $menu_choice == 1
        then
            //Spawn Actor
            gosub @SPAWNACTOR
            goto @MAINMENULOOP
        end
        if $menu_choice == 2
        then
            //Hide Actor
            gosub @HIDEACTOR
            goto @MAINMENULOOP
        end
       if $menu_choice == 3
        then
            //Edit Actor
            gosub @EDITACTOR
            goto @MAINMENULOOP
        end
        if $menu_choice == 4
        then
            //Destroy Actor
            gosub @DELETE_ACTOR
            goto @MAINMENULOOP
        end   
    end
    goto @MAINMENULOOP
end

if $menu_choice == 6
then
    //===============================
    // CARS MENU
    //===============================
    08D4: $menu = create_panel_with_title 'CARS' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'CARS' data 'ADDCAR' 'SCAR' 'HCAR' 'EDCAR' 'DECAR' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
      goto @MAINMENU
    end

    if $menu_choice == 0
    then
        //Add Car
        if DYOM_car_max > $DYOM_car_count
        then
          gosub @ADDCAR
        end
        goto @MAINMENULOOP
    end
    
    if $DYOM_car_count > 0
    then
        if $menu_choice == 1
        then
            // Spawn car
            gosub @SPAWNCAR
            goto @MAINMENULOOP
        end
        if $menu_choice == 2
        then
            //Hide car
            gosub @HIDECAR
            goto @MAINMENULOOP
        end
        if $menu_choice == 3
        then
            //Edit car
            gosub @EDITCAR
            goto @MAINMENULOOP
        end
        if $menu_choice == 4
        then
            //Destroy car
            gosub @DELETE_CAR
            goto @MAINMENULOOP
        end
    end
    goto @MAINMENULOOP
end

if $menu_choice == 7
then
    //===============================
    // PICKUPS MENU
    //===============================
    08D4: $menu = create_panel_with_title 'PICKUPS' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'PICKUPS' data 'ADDPIC' 'SPU' 'HPU' 'EDPU' 'DEPIC' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
      goto @MAINMENU
    end
    
    if $menu_choice == 0
    then
        //Add Pickup
        if DYOM_pickup_max > $DYOM_pickup_count
        then
          gosub @ADDPICKUP
        end
        goto @MAINMENULOOP
    end
    
    if $DYOM_pickup_count > 0
    then
        if $menu_choice == 1
        then
            //SPAWN Pickup
            gosub @SPAWNPICKUP
            goto @MAINMENULOOP
        end
        if $menu_choice == 2
        then
            //Hide Pickup
            gosub @HIDEPICKUP
            goto @MAINMENULOOP
        end
        if $menu_choice == 3
        then
            //Edit Pickup
            gosub @EDITPICKUP
            goto @MAINMENULOOP
        end
        if $menu_choice == 4
        then
            //Destroy Pickup
            gosub @DELETE_PICKUP
            goto @MAINMENULOOP
        end
    end
    goto @MAINMENULOOP
end


if $menu_choice == 8
then
    //===============================
    // OBJECTS MENU
    //===============================
    08D4: $menu = create_panel_with_title 'OBJECTZ' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'OBJECTS' data 'ADDOB' 'SOB' 'HOB' 'EDOB' 'DEOB' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
      goto @MAINMENU
    end
    
    if $menu_choice == 0
    then
        //Add Object
        if DYOM_object_max > $DYOM_object_count
        then
          gosub @ADDOBJECT
        end
        goto @MAINMENULOOP
    end
    
    if $DYOM_object_count > 0
    then
        if $menu_choice == 1
        then
            //Spawn Object
            gosub @SPAWNOBJECT
            goto @MAINMENULOOP
        end
        if $menu_choice == 2
        then
            //Hide Object
            gosub @HIDEOBJECT
            goto @MAINMENULOOP
        end
        if $menu_choice == 3
        then
            //Edit Object
            gosub @EDITOBJECT
            goto @MAINMENULOOP
        end
        if $menu_choice == 4
        then
            //Destroy Object
            gosub @DELETE_OBJECT
            goto @MAINMENULOOP
        end
    end
    goto @MAINMENULOOP
end

if $menu_choice == 9
then
    //===============================
    // TOOLS MENU
    //===============================
    08D4: $menu = create_panel_with_title 'TOOLS' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'TOOLS' data 'TELEPRT' 'TELEOBJ' 'JETPACK' 'TESTCAR' 'INTER' 'PRTPLAY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
      goto @MAINMENU
    end
    
    if $menu_choice == 0
    then
        $ONMISSION = 1
        start_mission 3 
        repeat
          wait 200
        until $ONMISSION == 0
        while not player.Defined($PLAYER_CHAR) 
           wait 100
        end
        wait 2000
        gosub @DESIGNMODE_ON
        goto @MAINMENULOOP
    end
    
    if $menu_choice == 1
    then
        $ONMISSION = 1
        start_mission 4 
        repeat
          wait 200
        until $ONMISSION == 0
        while not player.Defined($PLAYER_CHAR) 
           wait 100
        end
        wait 2000
        gosub @DESIGNMODE_ON
        goto @MAINMENULOOP
    end
    
    if $menu_choice == 2
    then
      07A7: put_jetpack_on_actor $PLAYER_ACTOR 
    end
    
    if $menu_choice == 3
    then
        04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 3.0 -1.0
        077E: get_active_interior_to $TEMP_INTERIOR
        0172: $TEMPVAR_ANGLE = actor $PLAYER_ACTOR Z_angle  
        0009: $TEMPVAR_ANGLE += 270.0 

        // position camera over shoulder
        04C4: store_coords_to $camx  $camy  $camz from_actor $PLAYER_ACTOR with_offset 2.0 -10.0 2.0
        015F: set_camera_position $camx  $camy  $camz rotation 0.0 0.0 0.0 
        0160: set_camera_point_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 mode 2 
        
        gosub @CARMODEL_SELECTION
        
        0373: set_camera_directly_behind_player 
        02EB: restore_camera_with_jumpcut
        
        if $car_cancel == 0
        then
            repeat
                wait 20
            until 8AB0: NOT key_pressed 0x0D
        
            03E6: remove text box
            0512: permanent_text_box 'TCARHLP'  // Use ~k~~GO_FORWARD~ and ~k~~GO_BACK~ to select.~N~~k~~PED_SPRINT~ Select~N~~k~~VEHICLE_ENTER_EXIT~ Exit
            Player.CanMove($PLAYER_CHAR) = True
            072A: put_actor $PLAYER_ACTOR into_car $car driverseat 
            repeat 
              wait 200 ms
              0A30: repair_car $car
              if NOT player.Defined($PLAYER_CHAR)
              then
                  break
              end    
            until 80DB: NOT  actor $PLAYER_ACTOR in_car $car 
            00A6: destroy_car $car  
        end     
        03E6: remove text box
        goto @MAINMENULOOP
    end
    
    if $menu_choice == 4
    then
        //gosub @interior_jump
        $ONMISSION = 1
        start_mission 2 
        repeat
          wait 200
        until $ONMISSION == 0
        while not player.Defined($PLAYER_CHAR) 
           wait 100
        end
        wait 2000
        gosub @DESIGNMODE_ON
        goto @MAINMENULOOP
    end 
     
    if $menu_choice == 5
    then
       //---------------
       // Start Mission
       //---------------
       if and
         $ONMISSION == 0 
         Player.Controllable($PLAYER_CHAR)
       then
          $PARTIAL_PLAY = 1
          $ONMISSION = 1
          fade 0 300
          0ACB: show_styled_text $TEXTNAME time 1000 style 2          
          wait 300
          gosub @CLEAR_DESIGN_ITEMS
          while not player.Defined($PLAYER_CHAR) 
            wait 100
          end
          gosub @DESIGNMODE_OFF
          Player.CanMove($PLAYER_CHAR) = True
          start_mission 1 
          repeat
            wait 200
          until $ONMISSION == 0
          014F: stop_timer $mission_timer
          while not player.Defined($PLAYER_CHAR) 
            wait 100
          end
          Player.CanMove($PLAYER_CHAR) = False
          wait 4000
          fade 0 2000
          wait 2000
          gosub @CLEAR_DESIGN_ITEMS
          wait 100
          gosub @SHOW_DESIGN_ITEMS
          wait 1000
          while not player.Defined($PLAYER_CHAR) 
            wait 100
          end
          gosub @DESIGNMODE_ON
          09C7: set_player $PLAYER_CHAR modelID_to #NULL
          0373: set_camera_directly_behind_player 
          02EB: restore_camera_with_jumpcut
          048F: actor $PLAYER_ACTOR remove_weapons 
          06C8: enable_riot 0

          fade 1 500
          Player.CanMove($PLAYER_CHAR) = True
          $PARTIAL_PLAY = 0
       end
      
       goto @MAINMENULOOP
    end  
    goto @MAINMENULOOP
end


:MAINMENULOOP
Player.CanMove($PLAYER_CHAR) = True
// restart all fires
VAR
  $DYOM_idx:integer
END
$DYOM_idx = 0
WHILE  $DYOM_object_count > $DYOM_idx
    if
      $DYOM_object_model[$DYOM_idx] == -16
    then
      02CF: $DYOM_object_handle[$DYOM_idx] = create_fire_at $DYOM_object_location_x[$DYOM_idx] $DYOM_object_location_y[$DYOM_idx] $DYOM_object_location_z[$DYOM_idx] propagation 0 size 1 
    end
    $DYOM_idx += 1
END
wait 500 ms
jump @MENUSNIFFER 

//============================================================================
//============================================================================
//
//                        F I L E   H A N D L I N G
//
//============================================================================
//============================================================================

//================================
// SUBROUTINES : SELECT_FILE
//================================
var
  $DYOM_slot_ptr : Integer
  v$filename : String
  v$filelabel : String
end 

:SELECT_FILE
FOR $DYOM_slot_ptr = 1 TO 8
    $TEXTCUR = $TEXTFILE
    0AD3: v$filename = format "DYOM%d.dat" $DYOM_slot_ptr
    0AD3: v$filelabel = format "FILE%d" $DYOM_slot_ptr
    if 0A9A: $hFILE = openfile v$filename mode 0x6272  // IF and SET
    then
      0A9D: readfile $hFILE size 4 to 1@
      0095: make 1@ absolute_integer 
      if 1@ > 2
      then
          gosub @TEXT_load
      else
          0AD3: $TEXTCUR = format "Slot %d" $DYOM_slot_ptr
      end  
      0ADF: add_dynamic_GXT_entry v$filelabel text $TEXTCUR
      0A9B: closefile $hFILE
    else
      0ADF: add_dynamic_GXT_entry v$filelabel text "This slot is empty"
    end
END

Player.CanMove($PLAYER_CHAR) = False
0581: enable_radar 0 
08D4: $menu = create_panel_with_title 'SLMENU' position 29.0 170.0 width 240.0 columns 1 interactive 1 background 1 alignment 0  
08DB: set_panel $menu column 0 header 'SLMENU' data "FILE1" "FILE2" "FILE3" "FILE4" "FILE5" "FILE6" "FILE7" "FILE8"  'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
gosub @GEN_MENU
if $menu_canceled == 1
then
  goto @SF_CANCEL
end

$DYOM_selected_slot = $menu_choice
$DYOM_selected_slot += 1  
0AD3: v$filename = format "DYOM%d.dat" $DYOM_selected_slot
0662: - PRINTSTRING v$filename

0581: enable_radar 1                                                                                                       
return 

:SF_CANCEL
$DYOM_selected_slot = 0    
0581: enable_radar 1                                                                                                       
return
   
//================================
// SUBROUTINES: SAVE FILE
//================================
:SAVE_FILE
0A99: chdir 1
gosub @SELECT_FILE
if  $DYOM_selected_slot == 0
then
  return
end

:SAVE_NAMED_FILE
$DYOM_file_version = 6
jump @STORE_FILE

:PUBLISH_FILE
v$filename="DYOM0.dat"

$DYOM_file_version = -6

:STORE_FILE
0A99: chdir 1
if 0A9A: $hFILE = openfile v$filename mode 0x6277  // IF and SET
then   
  0A9E: writefile $hFILE size 4 from $DYOM_file_version
  $TEXTCUR = $TEXTNAME
  gosub @TEXT_save
  $TEXTCUR = $TEXTAUTHOR
  gosub @TEXT_save
  $TEXTCUR = $TEXTINTRO
  gosub @TEXT_save
  $TEXTCUR += 100
  gosub @TEXT_save
  $TEXTCUR += 100
  gosub @TEXT_save
  $TEXTCUR = $TEXTAUDIOCODE
  gosub @TEXT_save
  0A9E: writefile $hFILE size 4 from $DYOM_objective_count
  0A9E: writefile $hFILE size 4 from $DYOM_actor_count
  0A9E: writefile $hFILE size 4 from $DYOM_car_count
  0A9E: writefile $hFILE size 4 from $DYOM_pickup_count
  0A9E: writefile $hFILE size 4 from $DYOM_object_count
  
//Settings   
//-----------------
  0A9E: writefile $hFILE size 4 from $DYOM_timelimit  
  0A9E: writefile $hFILE size 4 from $DYOM_timeofday  
  0A9E: writefile $hFILE size 4 from $DYOM_weather     
  0A9E: writefile $hFILE size 4 from $DYOM_minwantedlevel  
  0A9E: writefile $hFILE size 4 from $DYOM_maxwantedlevel  
  0A9E: writefile $hFILE size 4 from $DYOM_properties  
   
//Player   
//-----------------
  0A9E: writefile $hFILE size 4 from $DYOM_player_location_x
  0A9E: writefile $hFILE size 4 from $DYOM_player_location_y
  0A9E: writefile $hFILE size 4 from $DYOM_player_location_z
  0A9E: writefile $hFILE size 4 from $DYOM_player_location_a
  0A9E: writefile $hFILE size 4 from $DYOM_player_interior
  0A9E: writefile $hFILE size 4 from $DYOM_player_model
  0A9E: writefile $hFILE size 4 from $DYOM_player_weapon
  0A9E: writefile $hFILE size 4 from $DYOM_player_ammo
  0A9E: writefile $hFILE size 4 from $DYOM_player_health
   
//Objective:
//-----------------
  0A9E: writefile $hFILE size 400 from $DYOM_objective_location_x[0]
  0A9E: writefile $hFILE size 400 from $DYOM_objective_location_y[0]
  0A9E: writefile $hFILE size 400 from $DYOM_objective_location_z[0]
  0A9E: writefile $hFILE size 400 from $DYOM_objective_location_a[0]
  0A9E: writefile $hFILE size 400 from $DYOM_objective_interior[0]
  0A9E: writefile $hFILE size 400 from $DYOM_objective_type[0]
  0A9E: writefile $hFILE size 400 from $DYOM_objective_model[0]
  0A9E: writefile $hFILE size 400 from $DYOM_objective_data[0]
  0A9E: writefile $hFILE size 400 from $DYOM_objective_ammo[0]
  0A9E: writefile $hFILE size 400 from $DYOM_objective_markercolor[0]
  0A9E: writefile $hFILE size 400 from $DYOM_objective_properties[0]
  0A9E: writefile $hFILE size 400 from $DYOM_objective_health[0]
  0A9E: writefile $hFILE size 400 from $DYOM_objective_accuracy[0]
  0A9E: writefile $hFILE size 400 from $DYOM_objective_timelimit[0]
  0A9E: writefile $hFILE size 400 from $DYOM_objective_animation[0]
  0A9E: writefile $hFILE size 400 from $DYOM_objective_distance[0]
  $TEXTCUR = $TEXTOBJECTIVES
  for $idx = 0 to 99
      gosub @TEXT_save
      $TEXTCUR += 100
  end

   
//Actor:
//-----------------
  0A9E: writefile $hFILE size 400 from $DYOM_actor_model[0]
  0A9E: writefile $hFILE size 400 from $DYOM_actor_gang[0]
  0A9E: writefile $hFILE size 400 from $DYOM_actor_location_x[0]
  0A9E: writefile $hFILE size 400 from $DYOM_actor_location_y[0]
  0A9E: writefile $hFILE size 400 from $DYOM_actor_location_z[0]
  0A9E: writefile $hFILE size 400 from $DYOM_actor_location_a[0]
  0A9E: writefile $hFILE size 400 from $DYOM_actor_interior[0]
  0A9E: writefile $hFILE size 400 from $DYOM_actor_weapon[0]
  0A9E: writefile $hFILE size 400 from $DYOM_actor_ammo[0]
  0A9E: writefile $hFILE size 400 from $DYOM_actor_properties[0]
  0A9E: writefile $hFILE size 400 from $DYOM_actor_health[0]
  0A9E: writefile $hFILE size 400 from $DYOM_actor_accuracy[0]
  0A9E: writefile $hFILE size 400 from $DYOM_actor_spawnwith[0]
  0A9E: writefile $hFILE size 400 from $DYOM_actor_hidewith[0]
  0A9E: writefile $hFILE size 400 from $DYOM_actor_mustlive[0]
  0A9E: writefile $hFILE size 400 from $DYOM_actor_animation[0]
  0A9E: writefile $hFILE size 400 from $DYOM_actor_distance[0]
   
//Car:
//-----------------
  0A9E: writefile $hFILE size 200 from $DYOM_car_model[0]
  0A9E: writefile $hFILE size 200 from $DYOM_car_color1[0]
  0A9E: writefile $hFILE size 200 from $DYOM_car_color2[0]
  0A9E: writefile $hFILE size 200 from $DYOM_car_location_x[0]
  0A9E: writefile $hFILE size 200 from $DYOM_car_location_y[0]
  0A9E: writefile $hFILE size 200 from $DYOM_car_location_z[0]
  0A9E: writefile $hFILE size 200 from $DYOM_car_location_a[0]
  0A9E: writefile $hFILE size 200 from $DYOM_car_interior[0]
  0A9E: writefile $hFILE size 200 from $DYOM_car_health[0]
  0A9E: writefile $hFILE size 200 from $DYOM_car_properties[0]
  0A9E: writefile $hFILE size 200 from $DYOM_car_spawnwith[0]
  0A9E: writefile $hFILE size 200 from $DYOM_car_hidewith[0]
  0A9E: writefile $hFILE size 200 from $DYOM_car_mustlive[0]

//Pickups:
//-----------------
  0A9E: writefile $hFILE size 200 from $DYOM_pickup_model[0] 
  0A9E: writefile $hFILE size 200 from $DYOM_pickup_ammo[0]
  0A9E: writefile $hFILE size 200 from $DYOM_pickup_mode[0]
  0A9E: writefile $hFILE size 200 from $DYOM_pickup_location_x[0]
  0A9E: writefile $hFILE size 200 from $DYOM_pickup_location_y[0]
  0A9E: writefile $hFILE size 200 from $DYOM_pickup_location_z[0]
  0A9E: writefile $hFILE size 200 from $DYOM_pickup_spawnwith[0]
  0A9E: writefile $hFILE size 200 from $DYOM_pickup_hidewith[0]
  
//Objects:
//-----------------
  0A9E: writefile $hFILE size 400 from $DYOM_object_model[0]
  0A9E: writefile $hFILE size 400 from $DYOM_object_location_x[0]
  0A9E: writefile $hFILE size 400 from $DYOM_object_location_y[0]
  0A9E: writefile $hFILE size 400 from $DYOM_object_location_z[0]
  0A9E: writefile $hFILE size 400 from $DYOM_object_location_rx[0]
  0A9E: writefile $hFILE size 400 from $DYOM_object_location_ry[0]
  0A9E: writefile $hFILE size 400 from $DYOM_object_location_rz[0]
  0A9E: writefile $hFILE size 400 from $DYOM_object_interior[0]
  0A9E: writefile $hFILE size 400 from $DYOM_object_spawnwith[0]
  0A9E: writefile $hFILE size 400 from $DYOM_object_hidewith[0]

//Points:
//-----------------
  0A9E: writefile $hFILE size 1600 from $DYOM_point_link[0]
  0A9E: writefile $hFILE size 1600 from $DYOM_point_x[0]
  0A9E: writefile $hFILE size 1600 from $DYOM_point_y[0]
  0A9E: writefile $hFILE size 1600 from $DYOM_point_z[0]
  

  0A9B: closefile $hFILE
  00BC: show_text_highpriority GXT 'MISSAVE' time 3000 flag 1
else
  // File could not be written
  00BC: show_text_highpriority GXT 'FILERRS' time 3000 flag 1
end
return

:CLEAR_NAMED_FILE
0A99: chdir 1
$LOAD_RESULT = 0
if 0A9A: $hFILE = openfile v$filename mode 0x6277  // IF and SET
then   
  0A9E: writefile $hFILE size 4 from $LOAD_RESULT
  0A9B: closefile $hFILE
else
  // File could not be written
  00BC: show_text_highpriority GXT 'FILERRS' time 3000 flag 1
end
return

:SET_NAMED_FILE
0A99: chdir 1
$LOAD_RESULT = 1
if 0A9A: $hFILE = openfile v$filename mode 0x6277  // IF and SET
then   
  0A9E: writefile $hFILE size 4 from $LOAD_RESULT
  0A9B: closefile $hFILE
else
  // File could not be written
  00BC: show_text_highpriority GXT 'FILERRS' time 3000 flag 1
end
return

:GET_NAMED_FILE
0A99: chdir 1
$LOAD_RESULT = 0
if 0A9A: $hFILE = openfile v$filename mode 0x6272  // IF and SET
then   
  0A9D: readfile $hFILE size 4 to $LOAD_RESULT
  0A9B: closefile $hFILE
end
return


//================================
// SUBROUTINES: LOAD FILE
//================================
:LOAD_FILE
0A99: chdir 1
gosub @SELECT_FILE
if  $DYOM_selected_slot == 0
then
  return
end
fade 0 500
wait 500 ms

:LOAD_NAMED_FILE
0A99: chdir 1

:READ_FILE
$LOAD_RESULT = 0
if 0A9A: $hFILE = openfile v$filename mode 0x6272  // IF and SET
then

  gosub @CLEAR_DESIGN_ITEMS
  0A9D: readfile $hFILE size 4 to $DYOM_file_version
  
  IF $DYOM_file_version < 0
  then
     1@ = 0
    0064: 1@ -= $DYOM_file_version
    008A: $DYOM_file_version = 1@
    $readonly = 1
    if $loadnoreadonly == 1
    then
        0A9B: closefile $hFILE
        
        04E4: unknown_refresh_game_renderer_at $DYOM_player_location_x $DYOM_player_location_y
        03CB: set_rendering_origin_at $DYOM_player_location_x $DYOM_player_location_y $DYOM_player_location_z 
        $DYOM_selected_obj = $DYOM_objective_count
        fade 1 500
        $loadnoreadonly = 0
        return
    end
  else
    $readonly = 0
  end
  if $DYOM_file_version == 1
  then  
  $LOAD_RESULT = 1
  //=================================
  // Version 1 fileformat
  //=================================
      $TEXTCUR = $TEXTNAME
      gosub @TEXT_clear
      $TEXTCUR = $TEXTAUTHOR
      gosub @TEXT_clear
      $TEXTCUR = $TEXTINTRO
      gosub @TEXT_clear
      $TEXTCUR += 100
      gosub @TEXT_clear
      $TEXTCUR += 100
      gosub @TEXT_clear
      gosub @GENERATE_AUDIOCODE
      0A9D: readfile $hFILE size 4 to $DYOM_objective_count
      0A9D: readfile $hFILE size 4 to $DYOM_actor_count
      0A9D: readfile $hFILE size 4 to $DYOM_car_count
      0A9D: readfile $hFILE size 4 to $DYOM_pickup_count
      $DYOM_object_count = 0       
    //Settings   
    //-----------------
      0A9D: readfile $hFILE size 4 to $DYOM_timelimit  
      0A9D: readfile $hFILE size 4 to $DYOM_timeofday  
      0A9D: readfile $hFILE size 4 to $DYOM_weather     
      0A9D: readfile $hFILE size 4 to $DYOM_minwantedlevel  
      0A9D: readfile $hFILE size 4 to $DYOM_maxwantedlevel
      $DYOM_properties = 0
      
    //Player   
    //-----------------
      0A9D: readfile $hFILE size 4 to $DYOM_player_location_x
      0A9D: readfile $hFILE size 4 to $DYOM_player_location_y
      0A9D: readfile $hFILE size 4 to $DYOM_player_location_z
      0A9D: readfile $hFILE size 4 to $DYOM_player_location_a
      0A9D: readfile $hFILE size 4 to $DYOM_player_interior
      0A9D: readfile $hFILE size 4 to $DYOM_player_model
      0A9D: readfile $hFILE size 4 to $DYOM_player_weapon
      0A9D: readfile $hFILE size 4 to $DYOM_player_ammo
      $DYOM_player_health = 1000
       
    //Objective:
    //-----------------
      0A9D: readfile $hFILE size 80 to $DYOM_objective_location_x[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_location_y[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_location_z[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_location_a[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_interior[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_type[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_model[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_data[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_ammo[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_markercolor[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_properties[0]
      for $idx = 0 to 19
        $DYOM_objective_health[$idx] = 1000
        $DYOM_objective_accuracy[$idx] = 500
        $DYOM_objective_timelimit[$idx] = 0
        $DYOM_objective_animation[$idx] = -1
        $DYOM_objective_distance[$idx] = 0.0
      end
      $TEXTCUR = $TEXTOBJECTIVES
      for $idx = 0 to 19
          gosub @TEXT_clear
          $TEXTCUR += 100
      end

    //Actor:
    //-----------------
      0A9D: readfile $hFILE size 400 to $DYOM_actor_model[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_gang[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_location_x[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_location_y[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_location_z[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_location_a[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_interior[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_weapon[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_ammo[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_properties[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_health[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_accuracy[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_spawnwith[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_mustlive[0]
      
      for $idx = 0 to 99
        $DYOM_actor_animation[$idx] = -1
        $DYOM_actor_distance[$idx] = 0.0
        $DYOM_actor_hidewith[$idx] = 1000
        var
          $tmp_prop : integer
        end  
        $tmp_prop = 0
        if or
          $DYOM_actor_properties[$idx] == DYOM_behaviour_hold
          $DYOM_actor_properties[$idx] == DYOM_behaviour_holdaware
        then
          08BA: set $tmp_prop bit DYOM_actorpropbit_hold
        end   
        if or
          $DYOM_actor_properties[$idx] == DYOM_behaviour_aware
          $DYOM_actor_properties[$idx] == DYOM_behaviour_holdaware
        then
          08BA: set $tmp_prop bit DYOM_actorpropbit_aware
        end   
        if $DYOM_actor_properties[$idx] == DYOM_behaviour_follow
        then
          08BA: set $tmp_prop bit DYOM_actorpropbit_follow
        end   
        $DYOM_actor_properties[$idx] = $tmp_prop        
      end
       
    //Car:
    //-----------------
      0A9D: readfile $hFILE size 80 to $DYOM_car_model[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_color1[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_color2[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_location_x[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_location_y[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_location_z[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_location_a[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_interior[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_health[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_properties[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_spawnwith[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_mustlive[0]
      for $idx = 0 to 19
        $DYOM_car_hidewith[$idx] = 1000
      end
    
    //Pickups:
    //-----------------
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_model[0] 
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_ammo[0]
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_mode[0]
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_location_x[0]
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_location_y[0]
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_location_z[0]
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_spawnwith[0]
      for $idx = 0 to 19
        $DYOM_pickup_hidewith[$idx] = 1000
      end
      
    //Points  
      for $idx = 0 to 399
        $DYOM_point_link[$idx] = 0
      end
  
  end
  if $DYOM_file_version == 2
  then  
  $LOAD_RESULT = 1
  //=================================
  // Version 2 fileformat
  //=================================
      $TEXTCUR = $TEXTNAME
      gosub @TEXT_clear
      $TEXTCUR = $TEXTAUTHOR
      gosub @TEXT_clear
      $TEXTCUR = $TEXTINTRO
      gosub @TEXT_clear
      $TEXTCUR += 100
      gosub @TEXT_clear
      $TEXTCUR += 100
      gosub @TEXT_clear
      gosub @GENERATE_AUDIOCODE
      0A9D: readfile $hFILE size 4 to $DYOM_objective_count
      0A9D: readfile $hFILE size 4 to $DYOM_actor_count
      0A9D: readfile $hFILE size 4 to $DYOM_car_count
      0A9D: readfile $hFILE size 4 to $DYOM_pickup_count
      $DYOM_object_count = 0       
       
    //Settings   
    //-----------------
      0A9D: readfile $hFILE size 4 to $DYOM_timelimit  
      0A9D: readfile $hFILE size 4 to $DYOM_timeofday  
      0A9D: readfile $hFILE size 4 to $DYOM_weather     
      0A9D: readfile $hFILE size 4 to $DYOM_minwantedlevel  
      0A9D: readfile $hFILE size 4 to $DYOM_maxwantedlevel
      $DYOM_properties = 0
      
    //Player   
    //-----------------
      0A9D: readfile $hFILE size 4 to $DYOM_player_location_x
      0A9D: readfile $hFILE size 4 to $DYOM_player_location_y
      0A9D: readfile $hFILE size 4 to $DYOM_player_location_z
      0A9D: readfile $hFILE size 4 to $DYOM_player_location_a
      0A9D: readfile $hFILE size 4 to $DYOM_player_interior
      0A9D: readfile $hFILE size 4 to $DYOM_player_model
      0A9D: readfile $hFILE size 4 to $DYOM_player_weapon
      0A9D: readfile $hFILE size 4 to $DYOM_player_ammo
      $DYOM_player_health = 1000
       
    //Objective:
    //-----------------
      0A9D: readfile $hFILE size 80 to $DYOM_objective_location_x[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_location_y[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_location_z[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_location_a[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_interior[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_type[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_model[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_data[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_ammo[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_markercolor[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_properties[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_health[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_accuracy[0]
      for $idx = 0 to 19
        $DYOM_objective_timelimit[$idx] = 0
        $DYOM_objective_animation[$idx] = -1
        $DYOM_objective_distance[$idx] = 0.0
      end
      $TEXTCUR = $TEXTOBJECTIVES
      for $idx = 0 to 19
          gosub @TEXT_clear
          $TEXTCUR += 100
      end
       
    //Actor:
    //-----------------
      0A9D: readfile $hFILE size 400 to $DYOM_actor_model[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_gang[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_location_x[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_location_y[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_location_z[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_location_a[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_interior[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_weapon[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_ammo[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_properties[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_health[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_accuracy[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_spawnwith[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_mustlive[0]
      for $idx = 0 to 99
        $DYOM_actor_animation[$idx] = -1
        $DYOM_actor_distance[$idx] = 0.0
        $DYOM_actor_hidewith[$idx] = 1000
        $tmp_prop = 0
        if or
          $DYOM_actor_properties[$idx] == DYOM_behaviour_hold
          $DYOM_actor_properties[$idx] == DYOM_behaviour_holdaware
        then
          08BA: set $tmp_prop bit DYOM_actorpropbit_hold
        end   
        if or
          $DYOM_actor_properties[$idx] == DYOM_behaviour_aware
          $DYOM_actor_properties[$idx] == DYOM_behaviour_holdaware
        then
          08BA: set $tmp_prop bit DYOM_actorpropbit_aware
        end   
        if $DYOM_actor_properties[$idx] == DYOM_behaviour_follow
        then
          08BA: set $tmp_prop bit DYOM_actorpropbit_follow
        end   
        $DYOM_actor_properties[$idx] = $tmp_prop        
      end
       
    //Car:
    //-----------------
      0A9D: readfile $hFILE size 80 to $DYOM_car_model[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_color1[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_color2[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_location_x[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_location_y[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_location_z[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_location_a[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_interior[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_health[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_properties[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_spawnwith[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_mustlive[0]
      for $idx = 0 to 19
        $DYOM_car_hidewith[$idx] = 1000
      end
    
    //Pickups:
    //-----------------
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_model[0] 
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_ammo[0]
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_mode[0]
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_location_x[0]
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_location_y[0]
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_location_z[0]
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_spawnwith[0]
      for $idx = 0 to 19
        $DYOM_pickup_hidewith[$idx] = 1000
      end
      
    //Points  
      for $idx = 0 to 399
        $DYOM_point_link[$idx] = 0
      end

  end
  if $DYOM_file_version == 3
  then  
  $LOAD_RESULT = 1
  //=================================
  // Version 3 fileformat
  //=================================
      $TEXTCUR = $TEXTNAME
      gosub @TEXT_load
      $TEXTCUR = $TEXTAUTHOR
      gosub @TEXT_load
      $TEXTCUR = $TEXTINTRO
      gosub @TEXT_load
      $TEXTCUR += 100
      gosub @TEXT_load
      $TEXTCUR += 100
      gosub @TEXT_load
      gosub @GENERATE_AUDIOCODE
      0A9D: readfile $hFILE size 4 to $DYOM_objective_count
      0A9D: readfile $hFILE size 4 to $DYOM_actor_count
      0A9D: readfile $hFILE size 4 to $DYOM_car_count
      0A9D: readfile $hFILE size 4 to $DYOM_pickup_count
      $DYOM_object_count = 0       
       
    //Settings   
    //-----------------
      0A9D: readfile $hFILE size 4 to $DYOM_timelimit  
      0A9D: readfile $hFILE size 4 to $DYOM_timeofday  
      0A9D: readfile $hFILE size 4 to $DYOM_weather     
      0A9D: readfile $hFILE size 4 to $DYOM_minwantedlevel  
      0A9D: readfile $hFILE size 4 to $DYOM_maxwantedlevel
      0A9D: readfile $hFILE size 4 to $DYOM_properties
      
    //Player   
    //-----------------
      0A9D: readfile $hFILE size 4 to $DYOM_player_location_x
      0A9D: readfile $hFILE size 4 to $DYOM_player_location_y
      0A9D: readfile $hFILE size 4 to $DYOM_player_location_z
      0A9D: readfile $hFILE size 4 to $DYOM_player_location_a
      0A9D: readfile $hFILE size 4 to $DYOM_player_interior
      0A9D: readfile $hFILE size 4 to $DYOM_player_model
      0A9D: readfile $hFILE size 4 to $DYOM_player_weapon
      0A9D: readfile $hFILE size 4 to $DYOM_player_ammo
      $DYOM_player_health = 1000
       
    //Objective:
    //-----------------
      0A9D: readfile $hFILE size 80 to $DYOM_objective_location_x[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_location_y[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_location_z[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_location_a[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_interior[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_type[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_model[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_data[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_ammo[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_markercolor[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_properties[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_health[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_accuracy[0]
      0A9D: readfile $hFILE size 80 to $DYOM_objective_timelimit[0]
      for $idx = 0 to 19
        $DYOM_objective_animation[$idx] = -1
        $DYOM_objective_distance[$idx] = 0.0
      end
      $TEXTCUR = $TEXTOBJECTIVES
      for $idx = 0 to 19
          gosub @TEXT_load
          $TEXTCUR += 100
      end
       
    //Actor:
    //-----------------
      0A9D: readfile $hFILE size 400 to $DYOM_actor_model[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_gang[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_location_x[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_location_y[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_location_z[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_location_a[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_interior[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_weapon[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_ammo[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_properties[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_health[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_accuracy[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_spawnwith[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_mustlive[0]
      for $idx = 0 to 99
        $DYOM_actor_animation[$idx] = -1
        $DYOM_actor_distance[$idx] = 0.0
        $DYOM_actor_hidewith[$idx] = 1000

        $tmp_prop = 0
        if or
          $DYOM_actor_properties[$idx] == DYOM_behaviour_hold
          $DYOM_actor_properties[$idx] == DYOM_behaviour_holdaware
        then
          08BA: set $tmp_prop bit DYOM_actorpropbit_hold
        end   
        if or
          $DYOM_actor_properties[$idx] == DYOM_behaviour_aware
          $DYOM_actor_properties[$idx] == DYOM_behaviour_holdaware
        then
          08BA: set $tmp_prop bit DYOM_actorpropbit_aware
        end   
        if $DYOM_actor_properties[$idx] == DYOM_behaviour_follow
        then
          08BA: set $tmp_prop bit DYOM_actorpropbit_follow
        end   
        $DYOM_actor_properties[$idx] = $tmp_prop        
      end
       
    //Car:
    //-----------------
      0A9D: readfile $hFILE size 80 to $DYOM_car_model[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_color1[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_color2[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_location_x[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_location_y[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_location_z[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_location_a[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_interior[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_health[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_properties[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_spawnwith[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_mustlive[0]
      for $idx = 0 to 19
        $DYOM_car_hidewith[$idx] = 1000
      end
    
    //Pickups:
    //-----------------
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_model[0] 
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_ammo[0]
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_mode[0]
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_location_x[0]
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_location_y[0]
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_location_z[0]
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_spawnwith[0]
      for $idx = 0 to 19
        $DYOM_pickup_hidewith[$idx] = 1000
      end
      
    //Points  
      for $idx = 0 to 399
        $DYOM_point_link[$idx] = 0
      end
  end
  if $DYOM_file_version == 4
  then  
  $LOAD_RESULT = 1
  //=================================
  // Version 4 fileformat
  //=================================
      $TEXTCUR = $TEXTNAME
      gosub @TEXT_load
      $TEXTCUR = $TEXTAUTHOR
      gosub @TEXT_load
      $TEXTCUR = $TEXTINTRO
      gosub @TEXT_load
      $TEXTCUR += 100
      gosub @TEXT_load
      $TEXTCUR += 100
      gosub @TEXT_load
      gosub @GENERATE_AUDIOCODE
      0A9D: readfile $hFILE size 4 to $DYOM_objective_count
      0A9D: readfile $hFILE size 4 to $DYOM_actor_count
      0A9D: readfile $hFILE size 4 to $DYOM_car_count
      0A9D: readfile $hFILE size 4 to $DYOM_pickup_count
      0A9D: readfile $hFILE size 4 to $DYOM_object_count
       
    //Settings   
    //-----------------
      0A9D: readfile $hFILE size 4 to $DYOM_timelimit  
      0A9D: readfile $hFILE size 4 to $DYOM_timeofday  
      0A9D: readfile $hFILE size 4 to $DYOM_weather     
      0A9D: readfile $hFILE size 4 to $DYOM_minwantedlevel  
      0A9D: readfile $hFILE size 4 to $DYOM_maxwantedlevel
      0A9D: readfile $hFILE size 4 to $DYOM_properties
      
    //Player   
    //-----------------
      0A9D: readfile $hFILE size 4 to $DYOM_player_location_x
      0A9D: readfile $hFILE size 4 to $DYOM_player_location_y
      0A9D: readfile $hFILE size 4 to $DYOM_player_location_z
      0A9D: readfile $hFILE size 4 to $DYOM_player_location_a
      0A9D: readfile $hFILE size 4 to $DYOM_player_interior
      0A9D: readfile $hFILE size 4 to $DYOM_player_model
      0A9D: readfile $hFILE size 4 to $DYOM_player_weapon
      0A9D: readfile $hFILE size 4 to $DYOM_player_ammo
      0A9D: readfile $hFILE size 4 to $DYOM_player_health
       
    //Objective:
    //-----------------
      0A9D: readfile $hFILE size 200 to $DYOM_objective_location_x[0]
      0A9D: readfile $hFILE size 200 to $DYOM_objective_location_y[0]
      0A9D: readfile $hFILE size 200 to $DYOM_objective_location_z[0]
      0A9D: readfile $hFILE size 200 to $DYOM_objective_location_a[0]
      0A9D: readfile $hFILE size 200 to $DYOM_objective_interior[0]
      0A9D: readfile $hFILE size 200 to $DYOM_objective_type[0]
      0A9D: readfile $hFILE size 200 to $DYOM_objective_model[0]
      0A9D: readfile $hFILE size 200 to $DYOM_objective_data[0]
      0A9D: readfile $hFILE size 200 to $DYOM_objective_ammo[0]
      0A9D: readfile $hFILE size 200 to $DYOM_objective_markercolor[0]
      0A9D: readfile $hFILE size 200 to $DYOM_objective_properties[0]
      0A9D: readfile $hFILE size 200 to $DYOM_objective_health[0]
      0A9D: readfile $hFILE size 200 to $DYOM_objective_accuracy[0]
      0A9D: readfile $hFILE size 200 to $DYOM_objective_timelimit[0]
      0A9D: readfile $hFILE size 200 to $DYOM_objective_animation[0]
      0A9D: readfile $hFILE size 200 to $DYOM_objective_distance[0]
      $TEXTCUR = $TEXTOBJECTIVES
      for $idx = 0 to 49
          gosub @TEXT_load
          $TEXTCUR += 100
      end
       
    //Actor:
    //-----------------
      0A9D: readfile $hFILE size 400 to $DYOM_actor_model[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_gang[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_location_x[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_location_y[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_location_z[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_location_a[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_interior[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_weapon[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_ammo[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_properties[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_health[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_accuracy[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_spawnwith[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_hidewith[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_mustlive[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_animation[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_distance[0]
      for $idx = 0 to 99
        if $DYOM_actor_hidewith[$idx] == -1
        then
          $DYOM_actor_hidewith[$idx] = 1000
        end   
        
        // Convert old walk and run definitions
        if $DYOM_actor_animation[$idx] == -2
        then
           $DYOM_actor_animation[$idx] = -99
        end
        if $DYOM_actor_animation[$idx] == -3
        then
           $DYOM_actor_animation[$idx] = -100
        end
      end
       
    //Car:
    //-----------------
      0A9D: readfile $hFILE size 80 to $DYOM_car_model[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_color1[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_color2[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_location_x[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_location_y[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_location_z[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_location_a[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_interior[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_health[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_properties[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_spawnwith[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_hidewith[0]
      0A9D: readfile $hFILE size 80 to $DYOM_car_mustlive[0]
      for $idx = 0 to 19
        if $DYOM_car_hidewith[$idx] == -1
        then
          $DYOM_car_hidewith[$idx] = 1000
        end   
      end
    
    //Pickups:
    //-----------------
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_model[0]         
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_ammo[0]
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_mode[0]
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_location_x[0]
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_location_y[0]
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_location_z[0]
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_spawnwith[0]
      0A9D: readfile $hFILE size 80 to $DYOM_pickup_hidewith[0]
      for $idx = 0 to 19
        if $DYOM_pickup_hidewith[$idx] == -1
        then
          $DYOM_pickup_hidewith[$idx] = 1000
        end   
      end
      
    //Object:
    //-----------------
      0A9D: readfile $hFILE size 400 to $DYOM_object_model[0]
      0A9D: readfile $hFILE size 400 to $DYOM_object_location_x[0]
      0A9D: readfile $hFILE size 400 to $DYOM_object_location_y[0]
      0A9D: readfile $hFILE size 400 to $DYOM_object_location_z[0]
      0A9D: readfile $hFILE size 400 to $DYOM_object_location_rx[0]
      0A9D: readfile $hFILE size 400 to $DYOM_object_location_ry[0]
      0A9D: readfile $hFILE size 400 to $DYOM_object_location_rz[0]
      0A9D: readfile $hFILE size 400 to $DYOM_object_interior[0]
      0A9D: readfile $hFILE size 400 to $DYOM_object_spawnwith[0]
      0A9D: readfile $hFILE size 400 to $DYOM_object_hidewith[0]
      
    //Points  
      for $idx = 0 to 399
        $DYOM_point_link[$idx] = 0
      end    
  end
  if $DYOM_file_version == 5
  then  
  $LOAD_RESULT = 1
  //=================================
  // Version 5 fileformat
  //=================================
      $TEXTCUR = $TEXTNAME
      gosub @TEXT_load
      $TEXTCUR = $TEXTAUTHOR
      gosub @TEXT_load
      $TEXTCUR = $TEXTINTRO
      gosub @TEXT_load
      $TEXTCUR += 100
      gosub @TEXT_load
      $TEXTCUR += 100
      gosub @TEXT_load
      gosub @GENERATE_AUDIOCODE
      0A9D: readfile $hFILE size 4 to $DYOM_objective_count
      0A9D: readfile $hFILE size 4 to $DYOM_actor_count
      0A9D: readfile $hFILE size 4 to $DYOM_car_count
      0A9D: readfile $hFILE size 4 to $DYOM_pickup_count
      0A9D: readfile $hFILE size 4 to $DYOM_object_count
       
    //Settings   
    //-----------------
      0A9D: readfile $hFILE size 4 to $DYOM_timelimit  
      0A9D: readfile $hFILE size 4 to $DYOM_timeofday  
      0A9D: readfile $hFILE size 4 to $DYOM_weather     
      0A9D: readfile $hFILE size 4 to $DYOM_minwantedlevel  
      0A9D: readfile $hFILE size 4 to $DYOM_maxwantedlevel
      0A9D: readfile $hFILE size 4 to $DYOM_properties
      
    //Player   
    //-----------------
      0A9D: readfile $hFILE size 4 to $DYOM_player_location_x
      0A9D: readfile $hFILE size 4 to $DYOM_player_location_y
      0A9D: readfile $hFILE size 4 to $DYOM_player_location_z
      0A9D: readfile $hFILE size 4 to $DYOM_player_location_a
      0A9D: readfile $hFILE size 4 to $DYOM_player_interior
      0A9D: readfile $hFILE size 4 to $DYOM_player_model
      0A9D: readfile $hFILE size 4 to $DYOM_player_weapon
      0A9D: readfile $hFILE size 4 to $DYOM_player_ammo
      0A9D: readfile $hFILE size 4 to $DYOM_player_health
       
    //Objective
    //-----------------
      0A9D: readfile $hFILE size 400 to $DYOM_objective_location_x[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_location_y[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_location_z[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_location_a[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_interior[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_type[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_model[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_data[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_ammo[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_markercolor[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_properties[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_health[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_accuracy[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_timelimit[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_animation[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_distance[0]
      $TEXTCUR = $TEXTOBJECTIVES
      for $idx = 0 to 99
          gosub @TEXT_load
          $TEXTCUR += 100
      end
       
    //Actors
    //-----------------
      0A9D: readfile $hFILE size 400 to $DYOM_actor_model[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_gang[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_location_x[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_location_y[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_location_z[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_location_a[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_interior[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_weapon[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_ammo[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_properties[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_health[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_accuracy[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_spawnwith[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_hidewith[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_mustlive[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_animation[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_distance[0]
      for $idx = 0 to 99
        if $DYOM_actor_hidewith[$idx] == -1
        then
          $DYOM_actor_hidewith[$idx] = 1000
        end   
      end
       
    //Cars
    //-----------------
      0A9D: readfile $hFILE size 200 to $DYOM_car_model[0]
      0A9D: readfile $hFILE size 200 to $DYOM_car_color1[0]
      0A9D: readfile $hFILE size 200 to $DYOM_car_color2[0]
      0A9D: readfile $hFILE size 200 to $DYOM_car_location_x[0]
      0A9D: readfile $hFILE size 200 to $DYOM_car_location_y[0]
      0A9D: readfile $hFILE size 200 to $DYOM_car_location_z[0]
      0A9D: readfile $hFILE size 200 to $DYOM_car_location_a[0]
      0A9D: readfile $hFILE size 200 to $DYOM_car_interior[0]
      0A9D: readfile $hFILE size 200 to $DYOM_car_health[0]
      0A9D: readfile $hFILE size 200 to $DYOM_car_properties[0]
      0A9D: readfile $hFILE size 200 to $DYOM_car_spawnwith[0]
      0A9D: readfile $hFILE size 200 to $DYOM_car_hidewith[0]
      0A9D: readfile $hFILE size 200 to $DYOM_car_mustlive[0]
      for $idx = 0 to 49
        if $DYOM_car_hidewith[$idx] == -1
        then
          $DYOM_car_hidewith[$idx] = 1000
        end   
      end
    
    //Pickups
    //-----------------
      0A9D: readfile $hFILE size 200 to $DYOM_pickup_model[0] 
      0A9D: readfile $hFILE size 200 to $DYOM_pickup_ammo[0]
      0A9D: readfile $hFILE size 200 to $DYOM_pickup_mode[0]
      0A9D: readfile $hFILE size 200 to $DYOM_pickup_location_x[0]
      0A9D: readfile $hFILE size 200 to $DYOM_pickup_location_y[0]
      0A9D: readfile $hFILE size 200 to $DYOM_pickup_location_z[0]
      0A9D: readfile $hFILE size 200 to $DYOM_pickup_spawnwith[0]
      0A9D: readfile $hFILE size 200 to $DYOM_pickup_hidewith[0]
      for $idx = 0 to 49
        if $DYOM_pickup_hidewith[$idx] == -1
        then
          $DYOM_pickup_hidewith[$idx] = 1000
        end   
      end
      
    //Objects
    //-----------------
      0A9D: readfile $hFILE size 400 to $DYOM_object_model[0]
      0A9D: readfile $hFILE size 400 to $DYOM_object_location_x[0]
      0A9D: readfile $hFILE size 400 to $DYOM_object_location_y[0]
      0A9D: readfile $hFILE size 400 to $DYOM_object_location_z[0]
      0A9D: readfile $hFILE size 400 to $DYOM_object_location_rx[0]
      0A9D: readfile $hFILE size 400 to $DYOM_object_location_ry[0]
      0A9D: readfile $hFILE size 400 to $DYOM_object_location_rz[0]
      0A9D: readfile $hFILE size 400 to $DYOM_object_interior[0]
      0A9D: readfile $hFILE size 400 to $DYOM_object_spawnwith[0]
      0A9D: readfile $hFILE size 400 to $DYOM_object_hidewith[0]
      
    //Points
    //-----------------
      0A9D: readfile $hFILE size 1600 to $DYOM_point_link[0]
      0A9D: readfile $hFILE size 1600 to $DYOM_point_x[0]
      0A9D: readfile $hFILE size 1600 to $DYOM_point_y[0]
      0A9D: readfile $hFILE size 1600 to $DYOM_point_z[0]
  end
  if $DYOM_file_version == 6
  then  
  $LOAD_RESULT = 1
  //=================================
  // Version 6 fileformat
  //=================================
      $TEXTCUR = $TEXTNAME
      gosub @TEXT_load
      $TEXTCUR = $TEXTAUTHOR
      gosub @TEXT_load
      $TEXTCUR = $TEXTINTRO
      gosub @TEXT_load
      $TEXTCUR += 100
      gosub @TEXT_load
      $TEXTCUR += 100
      gosub @TEXT_load
      $TEXTCUR = $TEXTAUDIOCODE
      gosub @TEXT_load
      0A8D: $SOUNDFILE[0] = read_memory $TEXTCUR size 4 virtual_protect 0
      $TEXTCUR += 4
      0A8D: $SOUNDFILE[1] = read_memory $TEXTCUR size 4 virtual_protect 0
      $TEXTCUR += 4
      0A8D: $SOUNDFILE[2] = read_memory $TEXTCUR size 4 virtual_protect 0
      0662: - PRINTSTRING v$SOUNDFILE

      0A9D: readfile $hFILE size 4 to $DYOM_objective_count
      0A9D: readfile $hFILE size 4 to $DYOM_actor_count
      0A9D: readfile $hFILE size 4 to $DYOM_car_count
      0A9D: readfile $hFILE size 4 to $DYOM_pickup_count
      0A9D: readfile $hFILE size 4 to $DYOM_object_count
       
    //Settings   
    //-----------------
      0A9D: readfile $hFILE size 4 to $DYOM_timelimit  
      0A9D: readfile $hFILE size 4 to $DYOM_timeofday  
      0A9D: readfile $hFILE size 4 to $DYOM_weather     
      0A9D: readfile $hFILE size 4 to $DYOM_minwantedlevel  
      0A9D: readfile $hFILE size 4 to $DYOM_maxwantedlevel
      0A9D: readfile $hFILE size 4 to $DYOM_properties
      
    //Player   
    //-----------------
      0A9D: readfile $hFILE size 4 to $DYOM_player_location_x
      0A9D: readfile $hFILE size 4 to $DYOM_player_location_y
      0A9D: readfile $hFILE size 4 to $DYOM_player_location_z
      0A9D: readfile $hFILE size 4 to $DYOM_player_location_a
      0A9D: readfile $hFILE size 4 to $DYOM_player_interior
      0A9D: readfile $hFILE size 4 to $DYOM_player_model
      0A9D: readfile $hFILE size 4 to $DYOM_player_weapon
      0A9D: readfile $hFILE size 4 to $DYOM_player_ammo
      0A9D: readfile $hFILE size 4 to $DYOM_player_health
       
    //Objective
    //-----------------
      0A9D: readfile $hFILE size 400 to $DYOM_objective_location_x[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_location_y[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_location_z[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_location_a[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_interior[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_type[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_model[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_data[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_ammo[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_markercolor[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_properties[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_health[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_accuracy[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_timelimit[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_animation[0]
      0A9D: readfile $hFILE size 400 to $DYOM_objective_distance[0]
      $TEXTCUR = $TEXTOBJECTIVES
      for $idx = 0 to 99
          gosub @TEXT_load
          $TEXTCUR += 100
      end
       
    //Actors
    //-----------------
      0A9D: readfile $hFILE size 400 to $DYOM_actor_model[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_gang[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_location_x[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_location_y[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_location_z[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_location_a[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_interior[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_weapon[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_ammo[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_properties[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_health[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_accuracy[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_spawnwith[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_hidewith[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_mustlive[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_animation[0]
      0A9D: readfile $hFILE size 400 to $DYOM_actor_distance[0]
      for $idx = 0 to 99
        if $DYOM_actor_hidewith[$idx] == -1
        then
          $DYOM_actor_hidewith[$idx] = 1000
        end   
      end
       
    //Cars
    //-----------------
      0A9D: readfile $hFILE size 200 to $DYOM_car_model[0]
      0A9D: readfile $hFILE size 200 to $DYOM_car_color1[0]
      0A9D: readfile $hFILE size 200 to $DYOM_car_color2[0]
      0A9D: readfile $hFILE size 200 to $DYOM_car_location_x[0]
      0A9D: readfile $hFILE size 200 to $DYOM_car_location_y[0]
      0A9D: readfile $hFILE size 200 to $DYOM_car_location_z[0]
      0A9D: readfile $hFILE size 200 to $DYOM_car_location_a[0]
      0A9D: readfile $hFILE size 200 to $DYOM_car_interior[0]
      0A9D: readfile $hFILE size 200 to $DYOM_car_health[0]
      0A9D: readfile $hFILE size 200 to $DYOM_car_properties[0]
      0A9D: readfile $hFILE size 200 to $DYOM_car_spawnwith[0]
      0A9D: readfile $hFILE size 200 to $DYOM_car_hidewith[0]
      0A9D: readfile $hFILE size 200 to $DYOM_car_mustlive[0]
      for $idx = 0 to 49
        if $DYOM_car_hidewith[$idx] == -1
        then
          $DYOM_car_hidewith[$idx] = 1000
        end   
      end
    
    //Pickups
    //-----------------
      0A9D: readfile $hFILE size 200 to $DYOM_pickup_model[0] 
      0A9D: readfile $hFILE size 200 to $DYOM_pickup_ammo[0]
      0A9D: readfile $hFILE size 200 to $DYOM_pickup_mode[0]
      0A9D: readfile $hFILE size 200 to $DYOM_pickup_location_x[0]
      0A9D: readfile $hFILE size 200 to $DYOM_pickup_location_y[0]
      0A9D: readfile $hFILE size 200 to $DYOM_pickup_location_z[0]
      0A9D: readfile $hFILE size 200 to $DYOM_pickup_spawnwith[0]
      0A9D: readfile $hFILE size 200 to $DYOM_pickup_hidewith[0]
      for $idx = 0 to 49
        if $DYOM_pickup_hidewith[$idx] == -1
        then
          $DYOM_pickup_hidewith[$idx] = 1000
        end   
      end
      
    //Objects
    //-----------------
      0A9D: readfile $hFILE size 400 to $DYOM_object_model[0]
      0A9D: readfile $hFILE size 400 to $DYOM_object_location_x[0]
      0A9D: readfile $hFILE size 400 to $DYOM_object_location_y[0]
      0A9D: readfile $hFILE size 400 to $DYOM_object_location_z[0]
      0A9D: readfile $hFILE size 400 to $DYOM_object_location_rx[0]
      0A9D: readfile $hFILE size 400 to $DYOM_object_location_ry[0]
      0A9D: readfile $hFILE size 400 to $DYOM_object_location_rz[0]
      0A9D: readfile $hFILE size 400 to $DYOM_object_interior[0]
      0A9D: readfile $hFILE size 400 to $DYOM_object_spawnwith[0]
      0A9D: readfile $hFILE size 400 to $DYOM_object_hidewith[0]
      
    //Points
    //-----------------
      0A9D: readfile $hFILE size 1600 to $DYOM_point_link[0]
      0A9D: readfile $hFILE size 1600 to $DYOM_point_x[0]
      0A9D: readfile $hFILE size 1600 to $DYOM_point_y[0]
      0A9D: readfile $hFILE size 1600 to $DYOM_point_z[0]
  end

  0A9B: closefile $hFILE
  $empty_point = 399
  04E4: unknown_refresh_game_renderer_at $DYOM_player_location_x $DYOM_player_location_y
  03CB: set_rendering_origin_at $DYOM_player_location_x $DYOM_player_location_y $DYOM_player_location_z 
  $DYOM_selected_obj = $DYOM_objective_count
  fade 1 500
end
$loadnoreadonly = 0
return

//================================
// SUBROUTINES: SAVE STORYLINE
//================================

:SAVE_STORYLINE
0A99: chdir 1
$DYOM_file_version = 6

if 0A9A: $hFILE = openfile "DSL/_story.dat" mode 0x6277  // IF and SET
then   
  0A9E: writefile $hFILE size 4 from $DYOM_file_version
  
  // Triggers
  0A9E: writefile $hFILE size 4 from $DYOM_trigger_count
  0A9E: writefile $hFILE size 100 from $DYOM_trigger_icon[0]
  0A9E: writefile $hFILE size 100 from $DYOM_trigger_location_x[0]
  0A9E: writefile $hFILE size 100 from $DYOM_trigger_location_y[0]
  0A9E: writefile $hFILE size 100 from $DYOM_trigger_location_z[0]
  //0A9E: writefile $hFILE size 100 from $DYOM_trigger_interior[0]
  0A9E: writefile $hFILE size 100 from $DYOM_trigger_after[0]
  0A9E: writefile $hFILE size 100 from $DYOM_trigger_reward[0]
  
  
  $TEXTCUR = $TEXTTRIGGERS
  for $idx = 0 to 24
      gosub @TEXT_save
      $TEXTCUR += 16
  end

  0A9B: closefile $hFILE
else
  // File could not be written
  00BC: show_text_highpriority GXT 'FILERRS' time 3000 flag 1
end
return


//================================
// SUBROUTINES: LOAD STORYLINE
//================================
:LOAD_STORYLINE
0A99: chdir 1
if 0A9A: $hFILE = openfile "DSL/_story.dat" mode 0x6272  // IF and SET
then
  0A9D: readfile $hFILE size 4 to $DYOM_file_version
  
  IF $DYOM_file_version < 0
  then
    1@ = 0
    0064: 1@ -= $DYOM_file_version
    008A: $DYOM_file_version = 1@
    $readonly = 1
  else
    $readonly = 0
  end
  
  if $DYOM_file_version == 5
  then  
    //=================================
    // Version 5 fileformat
    //=================================

    //Triggers
    //-----------------
    0A9D: readfile $hFILE size 4 to $DYOM_trigger_count
    0A9D: readfile $hFILE size 200 to $DYOM_trigger_icon[0]
    0A9D: readfile $hFILE size 200 to $DYOM_trigger_location_x[0]
    0A9D: readfile $hFILE size 200 to $DYOM_trigger_location_y[0]
    0A9D: readfile $hFILE size 200 to $DYOM_trigger_location_z[0]
    0A9D: readfile $hFILE size 200 to $DYOM_trigger_after[0] // get rid of the old $DYOM_trigger_interior values
    0A9D: readfile $hFILE size 200 to $DYOM_trigger_after[0]
    for $idx = 0 to 24
      $DYOM_trigger_reward[$idx] = 0
    end
    $TEXTCUR = $TEXTTRIGGERS
    for $idx = 0 to 24
      gosub @TEXT_load
      $TEXTCUR += 16
    end
  end
  
  if $DYOM_file_version == 6
  then  
    //=================================
    // Version 6 fileformat
    //=================================

    //Triggers
    //-----------------
    0A9D: readfile $hFILE size 4 to $DYOM_trigger_count
    0A9D: readfile $hFILE size 100 to $DYOM_trigger_icon[0]
    0A9D: readfile $hFILE size 100 to $DYOM_trigger_location_x[0]
    0A9D: readfile $hFILE size 100 to $DYOM_trigger_location_y[0]
    0A9D: readfile $hFILE size 100 to $DYOM_trigger_location_z[0]
    //0A9D: readfile $hFILE size 100 to $DYOM_trigger_interior[0]
    0A9D: readfile $hFILE size 100 to $DYOM_trigger_after[0]
    0A9D: readfile $hFILE size 100 to $DYOM_trigger_reward[0]
    $TEXTCUR = $TEXTTRIGGERS
    for $idx = 0 to 24
      gosub @TEXT_load
      $TEXTCUR += 16
    end
  end

  0A9B: closefile $hFILE 
end
return
//================================
// SUBROUTINES: SAVE STORYLINE PROGRESS
//================================

:SAVE_PROGRESS
0A99: chdir 1
$DYOM_file_version = 5

if 0A9A: $hFILE = openfile "DSL/_progress" mode 0x6277  // IF and SET
then   
  0A9E: writefile $hFILE size 4 from $DYOM_file_version
  0A9E: writefile $hFILE size 100 from $DYOM_trigger_mhandle[0]
  0A9B: closefile $hFILE
else
  // File could not be written
  00BC: show_text_highpriority GXT 'FILERRS' time 3000 flag 1
end
return


//================================
// SUBROUTINES: LOAD STORYLINE PROGRESS
//================================
:LOAD_PROGRESS
0A99: chdir 1
if 0A9A: $hFILE = openfile "DSL/_progress" mode 0x6272  // IF and SET
then
  0A9D: readfile $hFILE size 4 to $DYOM_file_version
  
  if $DYOM_file_version == 5
  then  
    //=================================
    // Version 5 fileformat
    //=================================

    //Triggers
    //-----------------
    for $fileidx = 1 to 49
        if NOT $DYOM_trigger_mhandle[$fileidx] == 0
        then
            marker.disable($DYOM_trigger_mhandle[$fileidx]) 
        end
    end
    0A9D: readfile $hFILE size 100 to $DYOM_trigger_mhandle[0]
    $missions_available = 0
    $fileidx = 1
    while $fileidx < $DYOM_trigger_count
        if NOT $DYOM_trigger_mhandle[$fileidx] == 0
        then
            $missions_available += 1
            marker.CreateIconAndSphere($DYOM_trigger_mhandle[$fileidx],$DYOM_trigger_icon[$fileidx],$DYOM_trigger_location_x[$fileidx],$DYOM_trigger_location_y[$fileidx],$DYOM_trigger_location_z[$fileidx])        
        end
        $fileidx += 1
    end
  end

  0A9B: closefile $hFILE 
end
return

//----------------------------------
// Find Nearest Actor
//----------------------------------
var
  $found:Integer
  $dist:Float
  $mindist:Float
end
:FIND_NEAR_ACTOR
$found = -1
$mindist = 9999.0
$idx = 0
04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 0.5 0.0

while $DYOM_actor_count > $idx
    050A: $dist = distance_between_XYZ $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 and_XYZ $DYOM_actor_location_x[$idx] $DYOM_actor_location_y[$idx] $DYOM_actor_location_z[$idx]
    if $mindist > $dist
    then
        $mindist = $dist
        $found = $idx
    end      
    $idx += 1
end
return

//----------------------------------
// Find Nearest Car
//----------------------------------
var
  $found:Integer
  $dist:Float
  $mindist:Float
end
:FIND_NEAR_CAR
$found = -1
$mindist = 9999.0
$idx = 0
04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 0.5 0.0

while $DYOM_car_count > $idx
    050A: $dist = distance_between_XYZ $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 and_XYZ $DYOM_car_location_x[$idx] $DYOM_car_location_y[$idx] $DYOM_car_location_z[$idx]
    if $mindist > $dist
    then
        $mindist = $dist
        $found = $idx
    end      
    $idx += 1
end
return

//----------------------------------
// Find Nearest Pickup
//----------------------------------
var
  $found:Integer
  $dist:Float
  $mindist:Float
end
:FIND_NEAR_PICKUP
$found = -1
$mindist = 9999.0
$idx = 0
04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 0.5 0.0

while $DYOM_pickup_count > $idx
    050A: $dist = distance_between_XYZ $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 and_XYZ $DYOM_pickup_location_x[$idx] $DYOM_pickup_location_y[$idx] $DYOM_pickup_location_z[$idx]
    if $mindist > $dist
    then
        $mindist = $dist
        $found = $idx
    end      
    $idx += 1
end
return

//----------------------------------
// Find Nearest Object
//----------------------------------
var
  $found:Integer
  $dist:Float
  $mindist:Float
end
:FIND_NEAR_OBJECT
$found = -1
$mindist = 9999.0
$idx = 0
04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 0.5 0.0

while $DYOM_object_count > $idx
    050A: $dist = distance_between_XYZ $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 and_XYZ $DYOM_object_location_x[$idx] $DYOM_object_location_y[$idx] $DYOM_object_location_z[$idx]
    if $mindist > $dist
    then
        $mindist = $dist
        $found = $idx
    end      
    $idx += 1
end
return

//----------------------------------
// Find Nearest Trigger
//----------------------------------
var
  $found:Integer
  $dist:Float
  $mindist:Float
end
:FIND_NEAR_TRIGGER
$found = -1
$mindist = 9999.0
$idx = 0
04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 0.5 0.0

while $DYOM_trigger_count > $idx
    050A: $dist = distance_between_XYZ $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 and_XYZ $DYOM_trigger_location_x[$idx] $DYOM_trigger_location_y[$idx] $DYOM_trigger_location_z[$idx]
    if $mindist > $dist
    then
        $mindist = $dist
        $found = $idx
    end      
    $idx += 1
end
return


//----------------------------------
// Find Nearest Objective
//----------------------------------
var
  $found:Integer
  $dist:Float
  $mindist:Float
end
:FIND_NEAR_OBJECTIVE
$found = -1
$mindist = 9999.0
$idx = 0
04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 0.5 0.0

while $DYOM_objective_count > $idx
    050A: $dist = distance_between_XYZ $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 and_XYZ $DYOM_objective_location_x[$idx] $DYOM_objective_location_y[$idx] $DYOM_objective_location_z[$idx]
    if $mindist > $dist
    then
        $mindist = $dist
        $found = $idx
    end      
    $idx += 1
end
return

//----------------------------------
// Find Nearest SELECT
//----------------------------------
var
  $found:Integer
  $dist:Float
  $mindist:Float
end
:FIND_NEAR_SELECT
$found = -1
$idx = 0
04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 0.5 0.0

050A: $mindist = distance_between_XYZ $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 and_XYZ $DYOM_player_location_x $DYOM_player_location_y $DYOM_player_location_z

while $DYOM_objective_count > $idx
    050A: $dist = distance_between_XYZ $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 and_XYZ $DYOM_objective_location_x[$idx] $DYOM_objective_location_y[$idx] $DYOM_objective_location_z[$idx]
    if $mindist > $dist
    then
        $mindist = $dist
        $found = $idx
    end      
    $idx += 1
end

$found += 1
return


//----------------------------------
//FIND_FREE_POINT
//----------------------------------
var
  $empty_point: Integer // will contain the index of free slot or -1 if full
end 
:FIND_FREE_POINT
//$empty_point = 399
while $empty_point >= 0
  wait 0 ms
  if $DYOM_point_link[$empty_point] == 0
  then
    break
  end 
  $empty_point -= 1
end

return

//----------------------------------
//DUPLICATE_POINT_CHAIN
//----------------------------------
var
  $point: Integer // index of first point of chain to be duplicated
  $next: Integer
  $last: Integer
end
:DUPLICATE_POINT_CHAIN

// Also handle points that are offset, due to their use in an actor animation.
while $point < 0
  $point += 1000
end  

$next = $point
$point = -1
$last  = -1
while $next > 0
  wait 0
  gosub @FIND_FREE_POINT
  
  // if no more points are avail, clear copy and return -1
  if $empty_point < 0
  then
     gosub @FREE_POINT_CHAIN
     $point = -1
     break
  end
  
  // Store first new idx for return, the remainder as link
  if $point == -1
  then
     $point = $empty_point
     $last = $empty_point
  else
     $DYOM_point_link[$last] = $empty_point
     $last = $empty_point
  end
  0663: NOP "DUPPNTF" $next 
  0663: NOP "DUPPNTT" $empty_point 
  $DYOM_point_x[$empty_point] = $DYOM_point_x[$next]
  $DYOM_point_y[$empty_point] = $DYOM_point_y[$next]
  $DYOM_point_z[$empty_point] = $DYOM_point_z[$next]
  $DYOM_point_link[$empty_point] = $DYOM_point_link[$next]
  $next = $DYOM_point_link[$next]
end
return  

//----------------------------------
//FREE_POINT_CHAIN
//----------------------------------
var
  $point: Integer // index of first point of chain to be deleted
  $next: Integer
end
:FREE_POINT_CHAIN

// Also handle points that are offset, due to their use in an actor animation.
while $point < 0
  $point += 1000
end  

$next = $point
while $DYOM_point_link[$point] > 0
  $next = $DYOM_point_link[$point]
  $DYOM_point_link[$point] = 0
  if $point > $empty_point
  then
    $empty_point = $point
  end
  $point = $next
end
$DYOM_point_link[$point] = 0
return  


//============================================================================
//============================================================================
//
//                   S E L E C T    R O U T I N E S 
//
//============================================================================
//============================================================================


//================================
// SUBROUTINE: SELECT_ACTOR_MODEL
//================================
// 289 -> random actor
var
  $actor_model : Integer   // result of SELECT_ACTOR_MODEL
  $actor_cancel :Integer
end 
:SELECT_ACTOR_MODEL

//$actor_model_req -> $actor_model_loaded
$actor_model_loaded = -1
$actor_model_req = $actor_model
repeat
  wait 20
until not $actor_model_loaded == -1

09C7: set_player $PLAYER_CHAR modelID_to $actor_model_loaded

0512: permanent_text_box 'AMODEL'
                                             
gosub @ROUTINE_enterspace_release                                                
repeat
    wait 50 ms
                                                                                                                
    0084: $previous_id = $actor_model// (int) 
    
    if 00E1:   player 0 pressed_key 15
    then
      03E6: remove_text_box 
      $actor_cancel = 1
      return
    end
    
    
    if or
       00E1:   player 0 pressed_key 11
       00E1:   player 0 pressed_key 8     // G 
    then
        0008: $actor_model += 1 
        if  00E1:   player 0 pressed_key 8     // G 
        then
           0008: $actor_model += 9 
        end
        
        if and
            0018:   $actor_model > 0
            001A:   7 > $actor_model
        then
            $actor_model = 7
        end
        
        if or
            0038:   $actor_model == 8 
            0038:   $actor_model == 42 
            0038:   $actor_model == 65 
            0038:   $actor_model == 74 
            0038:   $actor_model == 86 
            0038:   $actor_model == 208
            0038:   $actor_model == 119
            0038:   $actor_model == 149
        then
            0008: $actor_model += 1
        end 
        
        if and
            0018:   $actor_model > 264
            001A:   274 > $actor_model
        then
            $actor_model = 274
        end
        
        if and
            0018:   $actor_model > 289
            001A:   1000 > $actor_model
        then
            $actor_model = 1000
        end

        if  0018:   $actor_model > 1032
        then
            $actor_model = 0
        end
                
    end
    
    if or
       00E1:   player 0 pressed_key 10
       00E1:   player 0 pressed_key 9     // H 
    then
        0008: $actor_model += -1 
        if  00E1:   player 0 pressed_key 9     // H 
        then
           0008: $actor_model += -9 
        end
        if or
            0038:   $actor_model == 8 
            0038:   $actor_model == 42 
            0038:   $actor_model == 65 
            0038:   $actor_model == 74 
            0038:   $actor_model == 86 
            0038:   $actor_model == 208
            0038:   $actor_model == 119
            0038:   $actor_model == 149
        then
            0008: $actor_model += -1
        end 
        
        if 001A:   0 > $actor_model
        then
            $actor_model = 1032
        end
        
        if and
            0018:   $actor_model > 264
            001A:   274 > $actor_model
        then
            $actor_model = 264
        end


        if and
            0018:   $actor_model > 0
            001A:   7 > $actor_model
        then
            $actor_model = 0
        end
        
        if and
            0018:   $actor_model > 289
            001A:   1000 > $actor_model
        then
            $actor_model = 289
        end
        
    end

    
    if 803A:   not  $previous_id == $actor_model // (int) 
    then    
       //$actor_model_req -> $actor_model_loaded
        $actor_model_loaded = -1
        $actor_model_req = $actor_model
        repeat
          wait 20
        until not $actor_model_loaded == -1
                                                
       09C7: set_player $PLAYER_CHAR modelID_to $actor_model_loaded 

       if $actor_model == 289
       then
         00BC: show_text_highpriority GXT 'RANDOM' time 1000 flag 1
       else
         01E5: show_text_1number_highpriority GXT 'NUMBER' number $actor_model time 1000 flag 1   
       end
       
       gosub @generic_actor_unload                                                         
    end    
    if 0AB0:  key_pressed 0x0D
    then
      break  // Accept enter as alternative for 'space' to end the loop
    end  
until 00E1:   player 0 pressed_key 16
$actor_cancel = 0
03E6: remove_text_box 

return

//================================
// SUBROUTINE: SELECT_WEAPON_MODEL
//================================
var
  $weapon_model : Integer   // result of SELECT_WEAPON_MODEL
  $weapon_ammo  : Integer   // result of SELECT_WEAPON_MODEL
  $weapon_cancel :Integer  
end 
:SELECT_WEAPON_MODEL
01B2: give_actor $PLAYER_ACTOR weapon $weapon_model ammo $weapon_ammo // Load the weapon model before using this 

0512: permanent_text_box 'WMODEL'
                                       
gosub @ROUTINE_enterspace_release                                                
repeat
    wait 50 ms
                                                                                                                
    0084: $previousw_id = $weapon_model // (int) 

    if 00E1:   player 0 pressed_key 15
    then
      03E6: remove_text_box 
      $weapon_cancel = 1
      return
    end
    
    if 00E1:   player 0 pressed_key 11
    then
        repeat
         wait 20
        until 80E1:   NOT player 0 pressed_key 11
        0008: $weapon_model += 1 
        
        if and
            0018:   $weapon_model > 18
            001A:   22 > $weapon_model
        then
            $weapon_model = 22
        end
        
        if and
            0018:   $weapon_model > 45
            001A:   48 > $weapon_model
        then
            $weapon_model = 48
        end
        
        if 0018: $weapon_model > 48
        then
            $weapon_model = 0
        end    
    end
    
    if  00E1:   player 0 pressed_key 10
    then
        repeat
            wait 20
        until 80E1:   NOT player 0 pressed_key 10
        0008: $weapon_model += -1 
        
        if and
            0018:   $weapon_model > 18
            001A:   22 > $weapon_model
        then
            $weapon_model = 18
        end
        
        if and
            0018:   $weapon_model > 45
            001A:   48 > $weapon_model
        then
            $weapon_model = 45
        end
        
        if 001A: 0 > $weapon_model 
        then
            $weapon_model = 48
        end    

    end

    if  803A:   not  $previousw_id == $weapon_model // (int) 
    then  
        if $weapon_model == 0
        then   
          0555: remove_weapon $previousw_id from_actor $PLAYER_ACTOR 
        else
          if $weapon_model == 48
          then
            0555: remove_weapon $previousw_id from_actor $PLAYER_ACTOR 
            00BC: show_text_highpriority GXT 'RANDOM' time 1000 flag 1  // Leave Car          
          else
            model.Load($DYOM_Weapon_model[$weapon_model])
            038B: load_requested_models 
    
            repeat
                wait 0 ms
            until model.Available($DYOM_Weapon_model[$weapon_model])
            01B2: give_actor $PLAYER_ACTOR weapon $weapon_model ammo $weapon_ammo 
            0249: release_model $DYOM_Weapon_model[$weapon_model]
          end 
        end
    end    
    if 0AB0:  key_pressed 0x0D
    then
      break  // Accept enter as alternative for 'space' to end the loop
    end  
until 00E1:   player 0 pressed_key 16
$weapon_cancel = 0
03E6: remove_text_box 
if and 
    $weapon_model > 15 
    $weapon_model < 44
then
    00BB: show_text_lowpriority GXT 'AMHELP' time 10000 flag 1 
    $TEXTCUR = $TEXTNUMIMPUT
    $TEXTMAX = 5
    $num_input = $weapon_ammo
    gosub @TEXT_num_input
    if $num_input > 9999
    then
      $num_input = 9999
    end
    $weapon_ammo = $num_input
else
    $weapon_ammo = 9999
end
00BE: text_clear_all 
return

//================================
// SUBROUTINE: SELECT_ANIMATION
//================================
var
  $anim_id : Integer   
  $anim_dist : Float
  $temp_dist : Float
  $anim_cancel :Integer 
  $last_point :Integer  
  $point_count :Integer  
  $anim_edit :Integer 
  $has_list :Integer
end 
:SELECT_ANIMATION
0512: permanent_text_box 'ANIMSEL'  
$anim_cancel = 0                           
gosub @ROUTINE_enterspace_release                                                
while not $anim_req == -1
    wait 10
end

$has_list = 1
if or
   $anim_id > -2
   NOT $anim_edit == 1
then
    $has_list = 0
end 

$previousw_id = -999
repeat
    wait 100 ms    
                                                                                                                
    if 00E1:   player 0 pressed_key 15
    then
      03E6: remove_text_box 
      0687: clear_actor $PLAYER_ACTOR task 
      $anim_cancel = 1
      return
    end

    if or
       00E1:   player 0 pressed_key 11
       00E1:   player 0 pressed_key 8     // G 
    then
        0008: $anim_id += 1 
        if  00E1:   player 0 pressed_key 8     // G 
        then
           0008: $anim_id += 9 
        end
        if 001C:   $anim_id > $anim_max // (int) 
        then
            $anim_id = -12
        end       
    end
    
    if or
       00E1:   player 0 pressed_key 10
       00E1:   player 0 pressed_key 9     // H 
    then
        0008: $anim_id += -1 
        if  00E1:   player 0 pressed_key 9     // H 
        then
           0008: $anim_id += -9 
        end
               
        if 001A: -12 > $anim_id 
        then
            0084: $anim_id = $anim_max
        end    

    end

    if  803A:   not  $previousw_id == $anim_id // (int) 
    then  
      while not $anim_req == -1
        wait 10
      end
        if $anim_id == -1
        then
            00BC: show_text_highpriority GXT 'NOANIM' time 3000 flag 1  // No Animation
            05B9: AS_actor $PLAYER_ACTOR stay_idle -1 ms 
        else
            if $anim_id == -2
            then
                00BC: show_text_highpriority GXT 'WALKANI' time 3000 flag 1  // Walk
                05B9: AS_actor $PLAYER_ACTOR stay_idle -1 ms 
            else
                if $anim_id == -3
                then
                    00BC: show_text_highpriority GXT 'RUN' time 3000 flag 1  // Run
                    05B9: AS_actor $PLAYER_ACTOR stay_idle -1 ms 
                else
                    if $anim_id == -4
                    then
                        00BC: show_text_highpriority GXT 'CARIN' time 3000 flag 1  // Enter Car
                        05B9: AS_actor $PLAYER_ACTOR stay_idle -1 ms 
                    else
                        if $anim_id == -5
                        then
                            00BC: show_text_highpriority GXT 'CAROUT' time 3000 flag 1  // Leave Car
                            05B9: AS_actor $PLAYER_ACTOR stay_idle -1 ms 
                        else
                            if $anim_id == -6
                            then
                                00BC: show_text_highpriority GXT 'CARSIT' time 3000 flag 1  // Sit in Car
                                05B9: AS_actor $PLAYER_ACTOR stay_idle -1 ms 
                            else
                                if $anim_id == -7
                                then
                                    00BC: show_text_highpriority GXT 'ACTDIE' time 3000 flag 1  // Die
                                    05B9: AS_actor $PLAYER_ACTOR stay_idle -1 ms 
                                else
                                    if $anim_id == -8
                                    then
                                        00BC: show_text_highpriority GXT 'TST1' time 3000 flag 1  // Jump
                                        05B9: AS_actor $PLAYER_ACTOR stay_idle -1 ms 
                                    else
                                        if $anim_id == -9
                                        then
                                            00BC: show_text_highpriority GXT 'SPRINT' time 3000 flag 1  // SPRINT
                                            05B9: AS_actor $PLAYER_ACTOR stay_idle -1 ms 
                                        else
                                            if $anim_id == -10
                                            then
                                                00BC: show_text_highpriority GXT 'CROUCH' time 3000 flag 1  // HIDE
                                                05B9: AS_actor $PLAYER_ACTOR stay_idle -1 ms 
                                            else
                                                if $anim_id == -11
                                                then
                                                    00BC: show_text_highpriority GXT 'HIDE' time 3000 flag 1  // HIDE
                                                    05B9: AS_actor $PLAYER_ACTOR stay_idle -1 ms 
                                                else
                                                    if $anim_id == -12
                                                    then
                                                        00BC: show_text_highpriority GXT 'AIM' time 3000 flag 1  // aim
                                                        05B9: AS_actor $PLAYER_ACTOR stay_idle -1 ms 
                                                    else
                                                        01E5: show_text_1number_highpriority GXT 'NUMBER' number $anim_id time 3000 flag 1
                                                        0084: $anim_actor = $PLAYER_ACTOR
                                                        0084: $anim_req = $anim_id
                                                        01E5: show_text_1number_highpriority GXT 'NUMBER' number $anim_id time 3000 flag 1
                                                        0084: $anim_actor = $PLAYER_ACTOR
                                                        0084: $anim_req = $anim_id
                                                    end
                                                end
                                            end
                                        end
                                    end
                                end
                            end
                        end       
                    end
                end
            end
        end 
    end    
    
    if 0AB0:  key_pressed 0x0D
    then
      break  // Accept enter as alternative for 'space' to end the loop
    end  
    0084: $previousw_id = $anim_id // (int) 
until 00E1:   player 0 pressed_key 16
$anim_cancel = 0
03E6: remove_text_box 

var
  $target : integer
  $anim_route : integer
end

if or 
  $anim_id == -2      // Walk
  $anim_id == -3      // Run
  $anim_id == -9      // SPRINT
  $anim_id == -10      // CROUCH
  $anim_id == -11      // HIDE
then
    $anim_route = 0
    if $has_list == 1
    then
      gosub @KEEP_ROUTE_MENU
      if $anim_cancel == 1
      then
        return
      end
      if $anim_route == 1
      then
         // keep current route
         return
      end
    end
    
    
    
    $has_list = 0

    // Store player position/rotation
    04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 0.0 -1.0 
    $TEMPVAR_FLOAT_4 = Actor.Angle($PLAYER_ACTOR)
    
    if $anim_id == -11
    then
        0512: permanent_text_box 'CHIDE'
    else    
        0512: permanent_text_box 'CROUTE'
    end
    Player.CanMove($PLAYER_CHAR) = True
    // WALK/RUN 
    // record waypoints into a point chain  in the points table
    // The first point is stored in in $anim_dist
    $point_count = 0    
    if $anim_route == 2   //Extend route
    then
       // put player at last point of existing route
       // and enable user to create additional routepoints
       $point_count = 0    
       0084: $last_point = $anim_dist             
       0663: printint "link" $last_point
       while $last_point >= 0
          0663: printint "count" $point_count
          $TEMPVAR_FLOAT_5 = $DYOM_POINT_X[$last_point]  
          $TEMPVAR_FLOAT_6 = $DYOM_POINT_Y[$last_point] 
          $TEMPVAR_FLOAT_7 = $DYOM_POINT_Z[$last_point] 
          $last_point = $DYOM_POINT_LINK[$last_point]
          0663: printint "link" $last_point
          $point_count += 1
       end
       00A1: put_actor $PLAYER_ACTOR at $TEMPVAR_FLOAT_5 $TEMPVAR_FLOAT_6 $TEMPVAR_FLOAT_7
    end
    $last_point = -1
    repeat
      wait 10
      if and
         00E1:   player 0 pressed_key 10  // N
         $point_count < 64
      then
        //----------------------------------
        // Add current location to pointchain
        //-----------------------------------
        04C4: store_coords_to $TEMPVAR_FLOAT_5 $TEMPVAR_FLOAT_6 $TEMPVAR_FLOAT_7 from_actor $PLAYER_ACTOR with_offset 0.0 0.0 -1.0 
        gosub @FIND_FREE_POINT
        $point_count += 1

        if $empty_point == -1
        then
          03E6: remove_text_box 
          $anim_cancel = 1
          // Display error text
          00BC: show_text_highpriority GXT 'POINTF' time 3000 flag 1  
          // Remove the added points if any
          if NOT $last_point == -1
          then
            0084: $point = $anim_dist
            gosub @FREE_POINT_CHAIN
          end
          return          
        end
        02FD: show_text_2number_lowpriority GXT 'PNTCNT' number $point_count $empty_point time 1000 flag 1 
        $DYOM_POINT_X[$empty_point] = $TEMPVAR_FLOAT_5 
        $DYOM_POINT_Y[$empty_point] = $TEMPVAR_FLOAT_6
        $DYOM_POINT_Z[$empty_point] = $TEMPVAR_FLOAT_7
        $DYOM_POINT_LINK[$empty_point] = -1
        if $last_point == -1
        then
          0084: $anim_dist = $empty_point             
        else
          // link from previous point
          $DYOM_POINT_LINK[$last_point] = $empty_point
        end
        $last_point = $empty_point
        repeat
          wait 10
        until 80E1: NOT  player 0 pressed_key 10  // N

      end

      if 00E1:   player 0 pressed_key 15
      then
          03E6: remove_text_box 
          $anim_cancel = 1
          // Remove the added points if any
          if NOT $last_point == -1
          then
            0084: $point = $anim_dist
            gosub @FREE_POINT_CHAIN
          end

          return
      end
      
      if $point_count > 0
      then
          // IF pressing L, store route as loop, and break out of loop.
          if 0AB0:  key_pressed 76   // L -> loop
          then
            $DYOM_POINT_LINK[$last_point] = -2
            break   
          end
          // IF pressing Y,  break out of loop.
          if 00E1:   player 0 pressed_key 11  //  Y
          then
            break   
          end
      end
    until false



    // Restore player position/rotation
    if Actor.Driving($PLAYER_ACTOR)
    then
       0362: remove_actor $PLAYER_ACTOR from_car_and_place_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 
    else
       Actor.PutAt($PLAYER_ACTOR,$TEMPVAR_FLOAT_1,$TEMPVAR_FLOAT_2,$TEMPVAR_FLOAT_3)
    end
    Actor.Angle($PLAYER_ACTOR) = $TEMPVAR_FLOAT_4
    03E6: remove text box    
    0373: set_camera_directly_behind_player 
    02EB: restore_camera_with_jumpcut 
end

if or 
  $anim_id == -4
  $anim_id == -5
  $anim_id == -6
then
    // Display menu to choose between driverseat and one of the passenger seats
    // and put the selection in $anim_dist
    Player.CanMove($PLAYER_CHAR) = False

    08D4: $seatmenu = create_panel_with_title 'SELSEAT' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $seatmenu column 0 header 'SELSEAT' data 'SEATD' 'SEAT1' 'SEAT2' 'SEAT3' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
        $anim_cancel = 1
        Player.CanMove($PLAYER_CHAR) = True
        return 
    end    
    
    0084: $temp_dist = $menu_choice
    
    if $temp_dist == 0
    then
      if or
          $anim_id == -4     // enter car
          $anim_id == -6     // sit in car
      then  
        // Driver, select driver behaviour
        // 0: none
        // -1: drive route slow
        // -2: drive route normal
        // -3: drive route aggresive
        // -4: Attack
        // -5: Follow
        08D4: $menu = create_panel_with_title 'SETTING' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'DRIVBEH' data 'DRIVNON' 'DRIVTO1' 'DRIVTO2' 'DRIVTO3' 'DRIVATT' 'DRIVFOB' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
      else
        // Driver, select driver behaviour
        // 0: none
        // -1: drive route slow
        // -2: drive route normal
        // -3: drive route aggresive
        08D4: $menu = create_panel_with_title 'SETTING' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'DRIVBEH' data 'DRIVNON' 'DRIVTO1' 'DRIVTO2' 'DRIVTO3' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
      end  
      gosub @GEN_MENU
      if $menu_canceled == 1
      then
          $anim_cancel = 1
          Player.CanMove($PLAYER_CHAR) = True
          return 
      end      
      0084: $temp_dist = $menu_choice
      0010: $temp_dist *= -1 
      
      if or 
        $temp_dist == -1
        $temp_dist == -2
        $temp_dist == -3
      then
        if $has_list == 1
        then
          gosub @KEEP_ROUTE_MENU
          if $anim_cancel == 1
          then
            Player.CanMove($PLAYER_CHAR) = True
            return
          end
          if $anim_route == 1
          then
             Player.CanMove($PLAYER_CHAR) = True
             return
          end
        end
        $has_list = 0
        // Store player position/rotation
        04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 0.0 -1.0 
        $TEMPVAR_FLOAT_4 = Actor.Angle($PLAYER_ACTOR)
        
        //#QUAD.Load()
        //repeat
        //  wait 0
        //until #QUAD.Available()
        
        //$TEMPCAR = car.Create(#QUAD,$TEMPVAR_FLOAT_1,$TEMPVAR_FLOAT_2,$TEMPVAR_FLOAT_3);
        //car.Angle($TEMPCAR) = $TEMPVAR_FLOAT_4
        //072A: put_actor $PLAYER_ACTOR into_car $TEMPCAR driverseat 
        //#QUAD.Destroy()
        
        // DRIVE TO ..
        // record waypoints into a point chain  in the points table
        // The first point is stored in in $anim_dist
        // $anim_dist = -1000 + index (thus -1000 to -801)
        $point_count = 0    
        if $anim_route == 2   //Extend route
        then
           // put player at last point of existing route
           // and enable user to create additional routepoints
           $point_count = 0    
           0084: $last_point = $anim_dist             
            while $last_point < 0
              $last_point += 1000
            end
           0663: printint "link" $last_point
           while $last_point >= 0
              0663: printint "count" $point_count
              $TEMPVAR_FLOAT_5 = $DYOM_POINT_X[$last_point]  
              $TEMPVAR_FLOAT_6 = $DYOM_POINT_Y[$last_point] 
              $TEMPVAR_FLOAT_7 = $DYOM_POINT_Z[$last_point] 
              $last_point = $DYOM_POINT_LINK[$last_point]
              0663: printint "link" $last_point
              $point_count += 1
           end
           00A1: put_actor $PLAYER_ACTOR at $TEMPVAR_FLOAT_5 $TEMPVAR_FLOAT_6 $TEMPVAR_FLOAT_7
        end
        $anim_dist = $temp_dist
        
        07A7: put_jetpack_on_actor $PLAYER_ACTOR 

        
        0512: permanent_text_box 'CROUTE'
        Player.CanMove($PLAYER_CHAR) = True
        
        $last_point = -1
        repeat
          wait 10
          if 00E1:   player 0 pressed_key 10  // N
          then
            //----------------------------------
            // Add current location to pointchain
            //-----------------------------------
            00A0: store_actor $PLAYER_ACTOR position_to $TEMPVAR_FLOAT_5 $TEMPVAR_FLOAT_6 $TEMPVAR_FLOAT_7  
            gosub @FIND_FREE_POINT
            $point_count += 1
            02FD: show_text_2number_lowpriority GXT 'PNTCNTD' number $point_count $empty_point time 1000 flag 1 

            if $empty_point == -1
            then
                  03E6: remove_text_box 
                  $anim_cancel = 1
                  // Display error text
                  
                  // Remove the added points if any
                  if NOT $last_point == -1
                  then
                    0084: $point = $anim_dist
                    gosub @FREE_POINT_CHAIN
                  end
                  Player.CanMove($PLAYER_CHAR) = True
                  return          
            end
            $DYOM_POINT_X[$empty_point] = $TEMPVAR_FLOAT_5          
            $DYOM_POINT_Y[$empty_point] = $TEMPVAR_FLOAT_6
            $DYOM_POINT_Z[$empty_point] = $TEMPVAR_FLOAT_7 
            $DYOM_POINT_LINK[$empty_point] = -1
            if $last_point == -1
            then
              // first point, store in $anim_dist
              $anim_dist *= 1000
              0058: $anim_dist += $empty_point             
            else
              // link from previous point
              $DYOM_POINT_LINK[$last_point] = $empty_point
            end
            $last_point = $empty_point
            repeat
              wait 10
            until 80E1: NOT  player 0 pressed_key 10  // N
  
          end

          if 00E1:   player 0 pressed_key 15
          then
              03E6: remove_text_box 
              $anim_cancel = 1
              // Remove the added points if any
              if NOT $last_point == -1
              then
            0084: $point = $anim_dist
                gosub @FREE_POINT_CHAIN
              end
              return
          end
          
          if $point_count > 0
          then
              // IF pressing L, store route as loop, and break out of loop.
              if 0AB0:  key_pressed 76   // L -> loop
              then
                $DYOM_POINT_LINK[$last_point] = -2
                break   
              end
              // IF pressing Y,  break out of loop.
              if 00E1:   player 0 pressed_key 11  //  Y
              then
                break   
              end
          end
        until false
        // Restore player position/rotation
        if Actor.Driving($PLAYER_ACTOR)
        then
           0362: remove_actor $PLAYER_ACTOR from_car_and_place_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 
        else
           Actor.PutAt($PLAYER_ACTOR,$TEMPVAR_FLOAT_1,$TEMPVAR_FLOAT_2,$TEMPVAR_FLOAT_3)
        end
        //car.Destroy($TEMPCAR)
        Actor.Angle($PLAYER_ACTOR) = $TEMPVAR_FLOAT_4
        03E6: remove text box    
        0373: set_camera_directly_behind_player 
        02EB: restore_camera_with_jumpcut 
      else
        $anim_dist = $temp_dist  
      end
    else
      $anim_dist = $temp_dist
    end
    Player.CanMove($PLAYER_CHAR) = True
end

return

:KEEP_ROUTE_MENU
Player.CanMove($PLAYER_CHAR) = False

08D4: $menu = create_panel_with_title 'ROUTE' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
08DB: set_panel $menu column 0 header 'ROUTE' data 'NEW_R' 'OLD_R' 'EXT_R' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
gosub @GEN_MENU
if $menu_canceled == 1
then
    $anim_cancel = 1
    Player.CanMove($PLAYER_CHAR) = True
    return 
end

$anim_route = $menu_choice
return


//================================
// SUBROUTINE: SELECT_CAR_MODEL
//================================
var
$car_model : Integer  
$car_color : Integer  
$car_color2 : Integer  
$car :Integer          // The created car
$car_cancel : Integer
end
:SELECT_CAR_MODEL
04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 3.0 -1.0
077E: get_active_interior_to $TEMP_INTERIOR
0172: $TEMPVAR_ANGLE = actor $PLAYER_ACTOR Z_angle  
0009: $TEMPVAR_ANGLE += 270.0 

// during edit, we start here, so that the existing position can be used
:SELECT_CAR_MODEL_EDIT
// position camera over shoulder
04C4: store_coords_to $camx  $camy  $camz from_actor $PLAYER_ACTOR with_offset 2.0 -10.0 2.0
015F: set_camera_position $camx  $camy  $camz rotation 0.0 0.0 0.0 
0160: set_camera_point_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 mode 2 
Player.CanMove($PLAYER_CHAR) = False
gosub @CARMODEL_SELECTION
03E6: remove_text_box 
if $car_cancel == 1
then
  00A6: destroy_car $car
  0373: set_camera_directly_behind_player 
  02EB: restore_camera_with_jumpcut
  return
end
//--------------
// select color
//--------------
0512: permanent_text_box 'CCOLOR'
gosub @ROUTINE_enterspace_release                                                
repeat
    wait 50 ms
    0084: $previousc_id = $car_color

    if 00E1:   player 0 pressed_key 15
    then
      00A6: destroy_car $car
      03E6: remove_text_box 
      $car_cancel = 1
      0373: set_camera_directly_behind_player 
      02EB: restore_camera_with_jumpcut
      return
    end
    
    if 00E1:   player 0 pressed_key 11
    then
        repeat 
           wait 100
        until 80E1:   not player 0 pressed_key 11
        
        0008: $car_color += 1                                                                                                                                    
            
        if 0018:   $car_color > 125
        then
            $car_color = 0
        end
    end
        
    
    if 00E1:   player 0 pressed_key 10
    then
        repeat 
           wait 100
        until 80E1:   not player 0 pressed_key 10
        
        0008: $car_color += -1 
        
        if 001A:   0 > $car_color
        then
            $car_color = 125
        end
    end

    
    if  803A:   not  $previousc_id == $car_color // (int) 
    then  
        0229: set_car $car primary_color_to $car_color secondary_color_to $car_color2 
    end
    if 0AB0:  key_pressed 0x0D
    then
      break  // Accept enter as alternative for 'space' to end the loop
    end  
until 00E1:   player 0 pressed_key 16
03E6: remove_text_box 

0512: permanent_text_box 'CCOLOR2'
gosub @ROUTINE_enterspace_release                                                
repeat
    wait 50 ms
    0084: $previousc_id = $car_color2

    if 00E1:   player 0 pressed_key 15
    then
      00A6: destroy_car $car
      03E6: remove_text_box 
      $car_cancel = 1
      0373: set_camera_directly_behind_player 
      02EB: restore_camera_with_jumpcut
      return
    end
    
    if 00E1:   player 0 pressed_key 11
    then
        repeat 
           wait 100
        until 80E1:   not player 0 pressed_key 11
        
        0008: $car_color2 += 1                                                                                                                                    
            
        if 0018:   $car_color2 > 125
        then
            $car_color2 = 0
        end
    end
        
    
    if 00E1:   player 0 pressed_key 10
    then
        repeat 
           wait 100
        until 80E1:   not player 0 pressed_key 10
        
        0008: $car_color2 += -1 
        
        if 001A:   0 > $car_color2
        then
            $car_color2 = 125
        end
    end

    
    if  803A:   not  $previousc_id == $car_color2 // (int) 
    then  
        0229: set_car $car primary_color_to $car_color secondary_color_to $car_color2 
    end
    if 0AB0:  key_pressed 0x0D
    then
      break  // Accept enter as alternative for 'space' to end the loop
    end  
until 00E1:   player 0 pressed_key 16
03E6: remove_text_box 



0373: set_camera_directly_behind_player 
02EB: restore_camera_with_jumpcut
Player.CanMove($PLAYER_CHAR) = True

0512: permanent_text_box 'CARPOS'
Car.DoorStatus($car) = 1  // some cars are locked by default

repeat
    wait 10
    if 0119:   car $car wrecked 
    then
      03E6: remove_text_box 
      $car_cancel = 1
      0373: set_camera_directly_behind_player 
      02EB: restore_camera_with_jumpcut
      return    
    end
until     00E1:   player 0 pressed_key 11

$car_cancel = 0
      
03E6: remove_text_box 

return

:CARMODEL_SELECTION
$previousc_id = -1
$car = 0
$car_cancel = 0
0512: permanent_text_box 'CMODEL'

gosub @ROUTINE_enterspace_release                                                
repeat
    wait 0 ms

    if 00E1:   player 0 pressed_key 15
    then
      00A6: destroy_car $car
      03E6: remove_text_box 
      $car_cancel = 1
      return
    end
    
    if 00E1:   player 0 pressed_key 11
    then
        repeat 
           wait 0
        until 80E1:   not player 0 pressed_key 11
        
        0008: $car_model += 1                                                                                                                                    
            
        if 0018:   $car_model > 611
        then
            $car_model = 400
        end
    end

    if 00E1:   player 0 pressed_key 8
    then
        repeat 
           wait 0
        until 80E1:   not player 0 pressed_key 8
        
        0008: $car_model += 10                                                                                                                                    
            
        if 0018:   $car_model > 611
        then
            $car_model = 400
        end
    end
        
    
    if 00E1:   player 0 pressed_key 10
    then
        repeat 
           wait 0
        until 80E1:   not player 0 pressed_key 10
        
        0008: $car_model += -1 
                        
        if 001A:   400 > $car_model
        then
            $car_model = 611
        end
    end

    if 00E1:   player 0 pressed_key 9
    then
        repeat 
           wait 0
        until 80E1:   not player 0 pressed_key 9
        
        0008: $car_model += -10 
                        
        if 001A:   400 > $car_model
        then
            $car_model = 611
        end
    end
    
    if 0AB0:  key_pressed 80   // P = next plane
    then
      repeat 
         wait 0
      until 8AB0:  NOT key_pressed 80
      repeat 
        0008: $car_model += -1 
        
        if 001A:   400 > $car_model
        then
            $car_model = 611
        end
      until 081F:   model $car_model plane  
    end

    if 0AB0:  key_pressed 72   // H = next Heli
    then
      repeat 
         wait 0
      until 8AB0:  NOT key_pressed 72
      repeat 
        0008: $car_model += -1 
        
        if 001A:   400 > $car_model
        then
            $car_model = 611
        end
      until 0820:   model $car_model heli 
    end

    if 0AB0:  key_pressed 66   // B = next Boat
    then
      repeat 
         wait 0
      until 8AB0:  NOT key_pressed 66
      repeat 
        0008: $car_model += -1 
        
        if 001A:   400 > $car_model
        then
            $car_model = 611
        end
      until 081E:   model $car_model boat 
    end

    if 0AB0:  key_pressed 83   // s = special
    then
      repeat 
         wait 0
      until 8AB0:  NOT key_pressed 83
      repeat 
        0008: $car_model += -1 
        
        if 001A:   400 > $car_model
        then
            $car_model = 611
        end
        if and
           8820: NOT  model $car_model heli 
           881F: NOT  model $car_model plane  
           881E: NOT  model $car_model boat 
           8A01: NOT  model $car_model minimum_4wheels_vehicle
        then
           break
        end
      until FALSE 
    end

    if 0AB0:  key_pressed 67   // C = next Car
    then
      repeat 
         wait 0
      until 8AB0:  NOT key_pressed 67
      repeat 
        0008: $car_model += -1 
        
        if 001A:   400 > $car_model
        then
            $car_model = 611
        end
        
        if and
           8820: NOT  model $car_model heli 
           881F: NOT  model $car_model plane  
           881E: NOT  model $car_model boat 
           0A01: model $car_model minimum_4wheels_vehicle
        then
           break
        end
      until FALSE 

    end
    
    if  803A:   not  $previousc_id == $car_model // (int) 
    then  
        model.Load($car_model)
        038B: load_requested_models 

        repeat
           wait 0 ms
        until model.Available($car_model)
        01E5: show_text_1number_highpriority GXT 'NUMBER' number $car_model time 3000 flag 1
                                                           
        00A6: destroy_car $car
        00A5: $car = create_car $car_model at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 
        0229: set_car $car primary_color_to $car_color secondary_color_to $car_color2 
        0175: set_car $car Z_angle_to $TEMPVAR_ANGLE 
        0840: link_car $car to_interior $TEMP_INTERIOR 
        0249: release_model $car_model
    end
    0084: $previousc_id = $car_model// (int) 
    if 0AB0:  key_pressed 0x0D
    then
      break  // Accept enter as alternative for 'space' to end the loop
    end  
until 00E1:   player 0 pressed_key 16
return

//================================
// SUBROUTINE: SELECT_PICKUP_MODE
//================================
var
$pickup_mode  : Integer
$pickup_cancel: Integer
end  
:SELECT_PICKUP_MODE
$pickup_mode = 3
$pickup_cancel = 0

:PICKUPMENU2
08D4: $menu = create_panel_with_title 'ADDPIC' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
08DB: set_panel $menu column 0 header 'BEHAVE' data 'ONCE' 'MULTI' 'MULTF' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
gosub @GEN_MENU
if $menu_canceled == 1
then
    $pickup_cancel = 1
    return 
end

if $menu_choice == 0
then
  $pickup_mode = 3
end

if $menu_choice == 1
then
  $pickup_mode = 15
end

if $menu_choice == 2
then
  $pickup_mode = 2
end
return



//================================
// SUBROUTINE: SELECT_PICKUP_MODEL
//================================
var
$pickup_model : Integer
$pickup_ammo  : Integer
$pickup_cancel: Integer
$pickup:Integer
$TX:Float
$TY:Float
end  
:SELECT_PICKUP_MODEL
$pickup_ammo = 0
$pickup_model = -1
$pickup_cancel = 0
// PICKUP MENU: TYPE/MODEL
08D4: $menu = create_panel_with_title 'ADDPIC' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
08DB: set_panel $menu column 0 header 'ADDPIC' data 'WEAPO' 'HEALTH' 'ARMOR' 'BRIBE' 'OPICK' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
gosub @GEN_MENU
if $menu_canceled == 1
then
    $pickup_cancel = 1
    return 
end


if 09D1:  pickup $pickup created 
then
  pickup.Destroy($pickup)
end

if $menu_choice == 0
then
  gosub @PICK_WEAPON_PICKUP
end

if $menu_choice == 1
then
  $pickup_model = #HEALTH
  gosub @PICKUP_LOCATION
end

if $menu_choice == 2
then
  $pickup_model = #BODYARMOUR
  gosub @PICKUP_LOCATION
end

if $menu_choice == 3
then
  $pickup_model = #BRIBE
  gosub @PICKUP_LOCATION
end

if $menu_choice == 4  
then
  gosub @PICK_OTHER_PICKUP 
end


return



//================================
// SUBROUTINE: PICK_WEAPON_PICKUP
//================================
:PICK_WEAPON_PICKUP


$pickup_ammo = $weapon_ammo
032B: $pickup = create_weapon_pickup #brassknuckle group 1 ammo $pickup_ammo at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3
0512: permanent_text_box 'WMODEL'

// position camera over shoulder
04C4: store_coords_to $camx  $camy  $camz from_actor $PLAYER_ACTOR with_offset 2.0 -1.0 0.0
015F: set_camera_position $camx  $camy  $camz rotation 0.0 0.0 0.0 
0160: set_camera_point_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 mode 2
                                       

gosub @ROUTINE_enterspace_release                                                
repeat
    wait 50 ms
                                                                                                                
    0084: $previousw_id = $weapon_model // (int) 

    if 00E1:   player 0 pressed_key 15
    then
      0249: release_model $DYOM_Weapon_model[$weapon_model] 
      0215: destroy_pickup $pickup
      03E6: remove_text_box 
      $pickup_cancel = 1
      0373: set_camera_directly_behind_player 
      02EB: restore_camera_with_jumpcut
      return
    end

    if or 
      00E1:   player 0 pressed_key 0 
      00E1:   player 0 pressed_key 1 
    then
      gosub @MOVE_AROUND_CAM
      0160: set_camera_point_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 mode 2 
      pickup.Destroy($pickup)
      032B: $pickup = create_weapon_pickup $DYOM_Weapon_model[$weapon_model] group 1 ammo $pickup_ammo at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3
    end
       
    
    if 00E1:   player 0 pressed_key 11
    then
        repeat
         wait 20
        until 80E1:   NOT player 0 pressed_key 11
        0008: $weapon_model += 1 
        
        if and
            0018:   $weapon_model > 18
            001A:   22 > $weapon_model
        then
            $weapon_model = 22
        end
        
        if 0018: $weapon_model > 47
        then
            $weapon_model = 1
        end    
    end
    
    if  00E1:   player 0 pressed_key 10
    then
        repeat
            wait 20
        until 80E1:   NOT player 0 pressed_key 10
        0008: $weapon_model += -1 
        
        if and
            0018:   $weapon_model > 18
            001A:   22 > $weapon_model
        then
            $weapon_model = 18
        end
        
        if 001A: 1 > $weapon_model 
        then
            $weapon_model = 47
        end    

    end

    if  803A:   not  $previousw_id == $weapon_model // (int) 
    then  
        0249: release_model $DYOM_Weapon_model[$previousw_id] 
        model.Load($DYOM_Weapon_model[$weapon_model])
        038B: load_requested_models 

        repeat
            wait 0 ms
        until model.Available($DYOM_Weapon_model[$weapon_model])
        0215: destroy_pickup $pickup
        032B: $pickup = create_weapon_pickup $DYOM_Weapon_model[$weapon_model] group 1 ammo $pickup_ammo at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3
    end    
    if 0AB0:  key_pressed 0x0D
    then
      break  // Accept enter as alternative for 'space' to end the loop
    end  
until 00E1:   player 0 pressed_key 16
0249: release_model $DYOM_Weapon_model[$weapon_model] 
$pickup_model = $DYOM_Weapon_model[$weapon_model]
03E6: remove_text_box 
if and 
    $weapon_model > 15 
    $weapon_model < 44
then
    00BB: show_text_lowpriority GXT 'AMHELP' time 10000 flag 1 
    $TEXTCUR = $TEXTNUMIMPUT
    $TEXTMAX = 5
    $num_input = $pickup_ammo
    gosub @TEXT_num_input
    if $num_input > 9999
    then
      $num_input = 9999
    end
    $pickup_ammo = $num_input
else
    $pickup_ammo = 9999
end
00BE: text_clear_all 
0373: set_camera_directly_behind_player 
02EB: restore_camera_with_jumpcut
return

//================================
// SUBROUTINE: PICK_OTHER_PICKUP
//================================
var
  $pickup_id :Integer
end
:PICK_OTHER_PICKUP
//04C4: store_coords_to $DYOM_pickup_location_x[$DYOM_pickup_count]  $DYOM_pickup_location_y[$DYOM_pickup_count]  $DYOM_pickup_location_z[$DYOM_pickup_count] from_actor $PLAYER_ACTOR with_offset 0.0 2.0 0.0
0213: $pickup = create_pickup $pickup_model type 1 at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3
0512: permanent_text_box 'PMODEL'

// position camera over shoulder
04C4: store_coords_to $camx  $camy  $camz from_actor $PLAYER_ACTOR with_offset 1.0 -1.0 1.0
015F: set_camera_position $camx  $camy  $camz rotation 0.0 0.0 0.0 
0160: set_camera_point_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 mode 2 

gosub @ROUTINE_enterspace_release                                                
repeat 
    wait 10
    0084: $previous_pickup_id = $pickup_id

    if 00E1:   player 0 pressed_key 15
    then
      0215: destroy_pickup $pickup
      03E6: remove_text_box 
      $pickup_cancel = 1
      0373: set_camera_directly_behind_player 
      02EB: restore_camera_with_jumpcut
      return
    end
    
    if or 
      00E1:   player 0 pressed_key 0 
      00E1:   player 0 pressed_key 1 
    then
      gosub @MOVE_AROUND_CAM
      0160: set_camera_point_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 mode 2 
      pickup.Destroy($pickup)
      0213: $pickup = create_pickup $pickup_model type 1 at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3    
    end
       

    if 00E1:   player 0 pressed_key 11
    then
        repeat 
           wait 0
        until 80E1:   not player 0 pressed_key 11
        
        0008: $pickup_id += 1
        
        if 
        0018:   $pickup_id > 7
        then
        $pickup_id = 1
        end 

    end
        
    
    if 00E1:   player 0 pressed_key 10
    then
        repeat 
           wait 0
        until 80E1:   not player 0 pressed_key 10
        
        0008: $pickup_id += -1 
        
        if
        001A:   1 > $pickup_id 
        then
        $pickup_id = 7
        end        
    end
   
   if 803A:   not  $pickup_id == $previous_pickup_id 
   then

    if $pickup_id == 1
    then
    $pickup_model = #KEYCARD
    end

    if $pickup_id == 2
    then
    $pickup_model = #CJ_MONEY_BAG
    end

    if $pickup_id == 3
    then
    $pickup_model = #TRAFFICCONE
    end

    if $pickup_id == 4
    then
    $pickup_model = #CLOTHESP
    end

    if $pickup_id == 5
    then
    $pickup_model = #GREEN_GLOOP
    end

    if $pickup_id == 6
    then 
    $pickup_model = #BRIEFCASE
    end 

    if $pickup_id == 7  
    then
    $pickup_model = #KMB_RHYMESBOOK
    end
    pickup.Destroy($pickup)
    0213: $pickup = create_pickup $pickup_model type 1 at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3
  end
  if 0AB0:  key_pressed 0x0D
  then
      break  // Accept enter as alternative for 'space' to end the loop
  end  
until 00E1:   player 0 pressed_key 16
03E6: remove_text_box 
0373: set_camera_directly_behind_player 
02EB: restore_camera_with_jumpcut 
return

//================================
// SUBROUTINE: PICKUP_LOCATION
//================================
var
  $pickup_id :Integer
  $pickup_model:Integer
  $pickup:Integer
end
:PICKUP_LOCATION
0213: $pickup = create_pickup $pickup_model type 1 at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3
0512: permanent_text_box 'PLOK'

// position camera over shoulder
04C4: store_coords_to $camx  $camy  $camz from_actor $PLAYER_ACTOR with_offset 1.0 -1.0 1.0
015F: set_camera_position $camx  $camy  $camz rotation 0.0 0.0 0.0 
0160: set_camera_point_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 mode 2 

gosub @ROUTINE_enterspace_release                                                
repeat 
    wait 10

    if 00E1:   player 0 pressed_key 15
    then
      0215: destroy_pickup $pickup
      03E6: remove_text_box 
      $pickup_cancel = 1
      0373: set_camera_directly_behind_player 
      02EB: restore_camera_with_jumpcut
      return
    end
    
    if or 
      00E1:   player 0 pressed_key 0 
      00E1:   player 0 pressed_key 1 
    then
      gosub @MOVE_AROUND_CAM
      0160: set_camera_point_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 mode 2 
      pickup.Destroy($pickup)
      0213: $pickup = create_pickup $pickup_model type 1 at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3    
    end
    
    if 0AB0:  key_pressed 0x0D
    then
      break  // Accept enter as alternative for 'space' to end the loop
    end  
until 00E1:   player 0 pressed_key 16
03E6: remove_text_box 
0373: set_camera_directly_behind_player 
02EB: restore_camera_with_jumpcut 
return


var
  $TX:Float
  $TY:Float
  $TZ:Float
  1@:Float
  2@:Float  
  3@:Float
  4@:Float  
  $camx:Float
  $camy:Float  
end
:MOVE_CAM_AROUND_OBJECT
  0509: 1@ = distance_between_XY $camx  $camy and_XY $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 
  3@ = $camx 
  3@ -= $TEMPVAR_FLOAT_1
  4@ = $camy 
  4@ -= $TEMPVAR_FLOAT_2
  05A4: get_angle_between_vectors_origin_to 3@ 4@ and_origin_to 0.0  1.0 store_to 2@
  
  if 
     0 > 3@ 
  then
     2@ *= -1.0
     2@ += 360.0
  end

  0494: get_joystick 0 data_to $MOVE_AXIS_X $MOVE_AXIS_Y $SPECIAL_AXIS_X $SPECIAL_AXIS_Y 
  008D: $TX = integer $MOVE_AXIS_X to_float 
  008D: $TY = integer $MOVE_AXIS_Y to_float 

  $TX /= 128.0
  $TY /= 128.0
  
  $TX *= 2.0
  $TY *= 0.1
  
  1@ += $TY
  2@ -= $TX
  
  02F7: $TY = sine 2@ // (float) 
  02F6: $TX = cosine 2@ // (float) 
  $TX *= 1@
  $TY *= 1@
  
  $camx = $TEMPVAR_FLOAT_1 
  $camx += $TX
  $camy = $TEMPVAR_FLOAT_2
  $camy += $TY
return

:MOVE_AROUND_CAM
  0509: 1@ = distance_between_XY $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 and_XY $camx  $camy 
  3@ = $TEMPVAR_FLOAT_1
  3@ -= $camx
  4@ = $TEMPVAR_FLOAT_2
  4@ -= $camy
  05A4: get_angle_between_vectors_origin_to 3@ 4@ and_origin_to 0.0  1.0 store_to 2@
  
  if 
     0 > 3@ 
  then
     2@ *= -1.0
     2@ += 360.0
  end

  0494: get_joystick 0 data_to $MOVE_AXIS_X $MOVE_AXIS_Y $SPECIAL_AXIS_X $SPECIAL_AXIS_Y 
  008D: $TX = integer $MOVE_AXIS_X to_float 
  008D: $TY = integer $MOVE_AXIS_Y to_float 

  $TX /= 128.0
  $TY /= 128.0
  
  $TX *= 2.0
  $TY *= 0.1
  
  1@ -= $TY
  2@ += $TX
  
  02F7: $TY = sine 2@ // (float) 
  02F6: $TX = cosine 2@ // (float) 
  $TX *= 1@
  $TY *= 1@
  
  $TEMPVAR_FLOAT_1 = $camx
  $TEMPVAR_FLOAT_1 += $TX
  $TEMPVAR_FLOAT_2 = $camy
  $TEMPVAR_FLOAT_2 += $TY
return


var
  $trigger_cancel :Integer
  $previous_trigger_icon   :Integer
  $trigger_icon   :Integer
  $trigger_after  :Integer
  $trigger_reward  :Integer
end
:SELECT_TRIGGER_FILE
$trigger_cancel = 0
// Input filename
0512: show_permanent_text_box 'FILETXT' 
$TEXTCUR = $TEXTFILE
$TEXTMAX = 10
gosub @TEXT_edit

// Calculate address of this string,
// and copy the input string at offset 4 into it
1@v = "DSL/            "        
0A9F: 0@ = current_thread_pointer
0@ += 0x3C
0@ += 8 // variable 1@s => 1 * 4  ( +4 for "DSL/" )
if 0AA9:   is_game_version_original 
then 
    0AA5: call 0x718600 num_params 2 pop 2 0@ $TEXTFILE // cpystr
else
    0AA5: call 0x718E90 num_params 2 pop 2 0@ $TEXTFILE // cpystr
end

// Now save the current mission under this name 
v$filename = 1@v

0A99: chdir 1
if 8A9A: NOT $hFILE = openfile v$filename mode 0x6272  // IF and SET
then
  // File could not be opened
  00BC: show_text_highpriority GXT 'FILERRL' time 3000 flag 1
  $trigger_cancel = 1  
end



return

:SELECT_ICON
$trigger_cancel = 0
02A8: $marker = create_marker $trigger_icon at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3
$object = object.init(#TRAFFICCONE,$TEMPVAR_FLOAT_1,$TEMPVAR_FLOAT_2,$TEMPVAR_FLOAT_3)
0512: permanent_text_box 'TMODEL'

// position camera over shoulder
04C4: store_coords_to $camx  $camy  $camz from_actor $PLAYER_ACTOR with_offset 1.0 -1.0 1.0
015F: set_camera_position $camx  $camy  $camz rotation 0.0 0.0 0.0 
0160: set_camera_point_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 mode 2 

gosub @ROUTINE_enterspace_release                                                
repeat 
    wait 10
    0084: $previous_trigger_id = $trigger_id

    if 00E1:   player 0 pressed_key 15
    then
      marker.Disable($marker)
      object.Destroy($object)
      03E6: remove_text_box 
      $trigger_cancel = 1
      0373: set_camera_directly_behind_player 
      02EB: restore_camera_with_jumpcut
      return
    end
    
    if or 
      00E1:   player 0 pressed_key 0 
      00E1:   player 0 pressed_key 1 
    then
      gosub @MOVE_AROUND_CAM
      0160: set_camera_point_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 mode 2 
      marker.Disable($marker)
      object.Destroy($object)
      02A8: $marker = create_marker $trigger_icon at 3000.0 3000.0 100.0
      $object = object.init(#TRAFFICCONE,$TEMPVAR_FLOAT_1,$TEMPVAR_FLOAT_2,$TEMPVAR_FLOAT_3)
    end
       

    if 00E1:   player 0 pressed_key 11
    then
        repeat 
           wait 0
        until 80E1:   not player 0 pressed_key 11
        
        0008: $trigger_icon += 1
        
        if 
        0018:   $trigger_icon > 63
        then
        $trigger_icon = 0
        end 

    end
        
    
    if 00E1:   player 0 pressed_key 10
    then
        repeat 
           wait 0
        until 80E1:   not player 0 pressed_key 10
        
        0008: $trigger_icon += -1 
        
        if
        001A:   0 > $trigger_icon 
        then
        $trigger_icon = 63
        end        
    end
   
   if 803A:   not  $trigger_icon == $previous_trigger_id 
   then
      marker.Disable($marker)
      02A8: $marker = create_marker $trigger_icon at 3000.0 3000.0 100.0
   end
   if 0AB0:  key_pressed 0x0D
   then
      break  // Accept enter as alternative for 'space' to end the loop
   end  
until 00E1:   player 0 pressed_key 16
03E6: remove_text_box 
0373: set_camera_directly_behind_player 
02EB: restore_camera_with_jumpcut 
marker.Disable($marker)
object.Destroy($object)

return

:SELECT_TRIGGER_AFTER
$trigger_cancel = 0
00BB: show_text_lowpriority GXT 'TAHELP' time 10000 flag 1 
$TEXTCUR = $TEXTNUMIMPUT
$TEXTMAX = 2
$num_input = $trigger_after
gosub @TEXT_num_input
$trigger_after = $num_input
00BE: text_clear_all 
return

//                 money                 20 bits   (0 - 1000000 )     bit 0 - 19
//                 weather  (0-22)       5  bit 20-24    
//                 riot                  1 (+1) bit 25 flag, bit 26 value
//                 wanted possible       1 (+1) bit 27 flag, bit 28 value
//                 cars/peds enabled     2 (+1) bit 29 flag, bit 30/31 value     
//                 respect               not coded, always 3 respect for every mission
var
$reward_money:Integer
$reward_weather:Integer
$reward_riot_c:Integer
$reward_riot_v:Integer
$reward_enable_c:Integer
$reward_enable_vv:Integer
$reward_enable_vp:Integer
$reward_wanted_c:Integer
$reward_wanted_v:Integer                                                             
end
:ENCODE_REWARD
$trigger_reward = $reward_money
$trigger_reward *= 0x00001000
$reward_weather *= 0x00000080
$trigger_reward += $reward_weather
if  $reward_riot_c == 1 
then
 08BA: set $trigger_reward bit 0
else
 08C0: clear $trigger_reward bit 0
end
if $reward_riot_v == 1 
then
 08BA: set $trigger_reward bit 1
else
 08C0: clear $trigger_reward bit 1
end
if  $reward_wanted_c == 1 
then
 08BA: set $trigger_reward bit 2
else
 08C0: clear $trigger_reward bit 2
end
if  $reward_wanted_v == 1 
then
 08BA: set $trigger_reward bit 3
else
 08C0: clear $trigger_reward bit 3
end
if  $reward_enable_c == 1 
then
 08BA: set $trigger_reward bit 4
else
 08C0: clear $trigger_reward bit 4
end
if  $reward_enable_vv == 1 
then
 08BA: set $trigger_reward bit 5
else
 08C0: clear $trigger_reward bit 5
end
if  $reward_enable_vp == 1 
then
 08BA: set $trigger_reward bit 6
else
 08C0: clear $trigger_reward bit 6
end
return


:DECODE_REWARD
if  08b4: test $trigger_reward bit 0
then
  $reward_riot_c = 1
else
  $reward_riot_c = 0
end
if  08b4: test $trigger_reward bit 1
then
  $reward_riot_v = 1
else
  $reward_riot_v = 0
end
if  08b4: test $trigger_reward bit 2
then
  $reward_wanted_c = 1
else
  $reward_wanted_c = 0
end
if  08b4: test $trigger_reward bit 3
then
  $reward_wanted_v = 1
else
  $reward_wanted_v = 0
end
if  08b4: test $trigger_reward bit 4
then
  $reward_enable_c = 1
else
  $reward_enable_c = 0
end
if  08b4: test $trigger_reward bit 5
then
  $reward_enable_vv = 1
else
  $reward_enable_vv = 0
end
if  08b4: test $trigger_reward bit 6
then
  $reward_enable_vp = 1
else
  $reward_enable_vp = 0
end
$reward_money = $trigger_reward
$reward_money /= 0x00001000
$reward_money *= 0x00001000
$reward_weather = $trigger_reward
$reward_weather -= $reward_money
$reward_money /= 0x00001000
$reward_weather /= 0x00000080
return


:SELECT_TRIGGER_REWARD
$trigger_cancel = 0
gosub @DECODE_REWARD

:RWMENU
08D4: $menu = create_panel_with_title 'RWTITL' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
08DB: set_panel $menu column 0 header 'RWMENU' 'READY' 'RWMON' 'RWWEAT' 'RWRIOT' 'RWWANT' 'RWPEDS' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
gosub @GEN_MENU
if $menu_canceled == 1
then
  $trigger_cancel  = 1
  return
end

if $menu_choice == 0
then
  // do nothing
end
if $menu_choice == 1
then
    00BB: show_text_lowpriority GXT 'RWMONH' time 10000 flag 1 
    $TEXTCUR = $TEXTNUMIMPUT
    $TEXTMAX = 9
    $num_input = $reward_money
    gosub @TEXT_num_input
    $reward_money = $num_input
    00BE: text_clear_all 

    goto @RWMENU
end
if $menu_choice == 2
then
    08D4: $menu = create_panel_with_title 'RWTITL' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'RWWEAT' 'RWKEEP' 'RWWEAT' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
      goto @RWMENU
    end
    if $menu_choice == 0
    then
       $reward_weather = 0
    end
    if $menu_choice == 1
    then
       $select_weather = $reward_weather
       if $select_weather > 0
       then
          $select_weather += -1
       end
       gosub @SELECT_WEATHER
       $reward_weather = $select_weather
       $reward_weather += 1
    end
    goto @RWMENU
end
if $menu_choice == 3
then
    08D4: $menu = create_panel_with_title 'RWTITL' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'RWRIOT' 'RWKEEP' 'RWON' 'RWOFF' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
      goto @RWMENU
    end
    if $menu_choice == 0
    then
       $reward_riot_c = 0
       $reward_riot_v = 0
    end
    if $menu_choice == 1
    then
       $reward_riot_c = 1
       $reward_riot_v = 1
    end
    if $menu_choice == 2
    then
       $reward_riot_c = 1
       $reward_riot_v = 0
    end    
    goto @RWMENU
end
if $menu_choice == 4
then
    08D4: $menu = create_panel_with_title 'RWTITL' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'RWWANT' 'RWKEEP' 'RWON' 'RWOFF' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
      goto @RWMENU
    end
    if $menu_choice == 0
    then
       $reward_wanted_c = 0
       $reward_wanted_v = 0
    end
    if $menu_choice == 1
    then
       $reward_wanted_c = 1
       $reward_wanted_v = 1
    end
    if $menu_choice == 2
    then
       $reward_wanted_c = 1
       $reward_wanted_v = 0
    end    
    goto @RWMENU
end
if $menu_choice == 5
then
    08D4: $menu = create_panel_with_title 'RWTITL' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'RWPEDS' 'RWKEEP' 'RWP00' 'RWP01' 'RWP10' 'RWP11' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
      goto @RWMENU
    end
    if $menu_choice == 0
    then
       $reward_enable_c = 0
       $reward_enable_vv = 0
       $reward_enable_vp = 0
    end
    if $menu_choice == 1
    then
       $reward_enable_c = 1
       $reward_enable_vv = 0
       $reward_enable_vp = 0
    end
    if $menu_choice == 2
    then
       $reward_enable_c = 1
       $reward_enable_vv = 0
       $reward_enable_vp = 1
    end    
    if $menu_choice == 3
    then
       $reward_enable_c = 1
       $reward_enable_vv = 1
       $reward_enable_vp = 0
    end    
    if $menu_choice == 4
    then
       $reward_enable_c = 1
       $reward_enable_vv = 1
       $reward_enable_vp = 1
    end    
    goto @RWMENU

end

gosub @ENCODE_REWARD
return






:SELECT_CAMERA_POSITION
wait 0 ms

var
  $camera_objective : Integer
  21@    :Integer
  $camera_cancel : Integer
  $camera_actor : Integer
  $CAM_X :Float
  $CAM_Y :Float
  $CAM_Z :Float
  $CAM_Z :Float
  15@    :Float
end
$camera_cancel = 0
$camera_objective = $DYOM_objective_count
02A3: enable_widescreen 1 
04C4: store_coords_to 11@ 12@ 13@ from_actor $PLAYER_ACTOR with_offset 0.0 0.0 -1.0 
015F: set_camera_position $CAM_X  $CAM_Y  $CAM_Z rotation 0.0 0.0 0.0 
0160: set_camera_point_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 mode 2 
15@ = $CAM_Z
15@ += 100.0
Actor.PutAt($PLAYER_ACTOR,$CAM_X,$CAM_Y,15@)
actor.LockInCurrentPosition($PLAYER_ACTOR,true)
077E: get_active_interior_to 20@

if or
    $camera_mode <= DYOM_cutscene_actor
    $camera_mode == DYOM_cutscene_player
then
    0512: permanent_text_box 'CUTHLP'  
     
    gosub @ROUTINE_enterspace_release                                                
    repeat 
        wait 0
    
        
        if or
           00E1:   player 0 pressed_key 8
           00E1:   player 0 pressed_key 9
        then
          21@ = $camera_objective
              0663: - PRINTINT "o" 21@
          if NOT $DYOM_objective_count == 0
          then    
              repeat
                if 00E1:   player 0 pressed_key 8  
                then                
                  21@ += -1
                  if 21@ < 0
                  then
                    21@ = $DYOM_objective_count
                    21@ += -1
                  end
                end
                if 00E1:   player 0 pressed_key 9  
                then                
                  21@ += 1
                  if 003c: $DYOM_objective_count == 21@
                  then
                    21@ = 0
                  end
                end
                  0663: - PRINTINT "ci" 21@
                  0663: - PRINTINT "ct" $DYOM_objective_type[21@]
                  if $DYOM_objective_type[21@] == DYOM_objtype_cutscene
                  then
                     break
                  end
              until 003c: $camera_objective == 21@
          end
          0663: - PRINTINT "x1" 21@
          0663: - PRINTINT "x2" $camera_objective

          if 803c: NOT $camera_objective == 21@
          then
            $camera_objective = 21@
            
            $CAM_X = $DYOM_objective_location_x[21@]  
            $CAM_Y = $DYOM_objective_location_y[21@] 
            0086: $CAM_Z  = $DYOM_objective_location_a[21@]
            0086: $TEMPVAR_FLOAT_1 = $DYOM_objective_model[21@]  
            0086: $TEMPVAR_FLOAT_2 = $DYOM_objective_markercolor[21@]
            0086: $TEMPVAR_FLOAT_3 = $DYOM_objective_ammo[21@]
            15@ = $CAM_Z
            15@ += 100.0
            015F: set_camera_position $CAM_X  $CAM_Y  $CAM_Z rotation 0.0 0.0 0.0 
            0160: set_camera_point_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 mode 2 
            Actor.PutAt($PLAYER_ACTOR,$CAM_X,$CAM_Y,15@)
            actor.LockInCurrentPosition($PLAYER_ACTOR,true)

          end
          repeat
            wait 100
          until 80E1: NOT   player 0 pressed_key 8
          repeat
            wait 100
          until 80E1: NOT   player 0 pressed_key 9
        end
        
        if 00E1:   player 0 pressed_key 15
        then
          03E6: remove_text_box
          
          04E4: unknown_refresh_game_renderer_at 11@ 12@ 
          03CB: set_rendering_origin_at 11@ 12@ 13@ 
          Actor.PutAt($PLAYER_ACTOR,11@,12@,13@)
          actor.LockInCurrentPosition($PLAYER_ACTOR,false)
          02A3: enable_widescreen 0 
          04BB: select_interior 20@
          if 20@ == 0
            then
              //0581: enable_radar 1
            else
              //0581: enable_radar 0
            end
          $camera_cancel = 1
          0373: set_camera_directly_behind_player 
          02EB: restore_camera_with_jumpcut
          return
        end
                                                                                                                        
        if or 
          00E1:   player 0 pressed_key 0 
          00E1:   player 0 pressed_key 1 
        then
            if 00E1: player 0 pressed_key 17
            then
                  3@ = $TEMPVAR_FLOAT_1
                  3@ -= $CAM_X
                  4@ = $TEMPVAR_FLOAT_2
                  4@ -= $CAM_Y
                  05A4: get_angle_between_vectors_origin_to 3@ 4@ and_origin_to 0.0  1.0 store_to 2@
                  
                  if 
                     0 > 3@ 
                  then
                     2@ *= -1.0
                     2@ += 360.0
                  end
                
                  0494: get_joystick 0 data_to $MOVE_AXIS_X $MOVE_AXIS_Y $SPECIAL_AXIS_X $SPECIAL_AXIS_Y 
                  008D: $TX = integer $MOVE_AXIS_X to_float 
                  008D: $TY = integer $MOVE_AXIS_Y to_float 
                
                  $TX /= 128.0
                  $TY /= 128.0
                  
                  $TX *= 0.2
                  $TY *= -0.2
                  
                  if 00E1: player 0 pressed_key 14
                  then
                    $TX *= 10.0
                    $TY *= 10.0                
                  end
    
                  
                  02F7: 4@ = sine 2@ // (float) 
                  02F6: 3@ = cosine 2@ // (float) 
                  3@ *= $TY
                  4@ *= $TY
                  
                  $CAM_X += 3@
                  $TEMPVAR_FLOAT_1 += 3@
                  $CAM_Y += 4@
                  $TEMPVAR_FLOAT_2 += 4@
                  
                  2@ += 90.0
                  
                  02F7: 4@ = sine 2@ // (float) 
                  02F6: 3@ = cosine 2@ // (float) 
                  3@ *= $TX
                  4@ *= $TX
                  
                  $CAM_X += 3@
                  $TEMPVAR_FLOAT_1 += 3@
                  $CAM_Y += 4@
                  $TEMPVAR_FLOAT_2 += 4@
            else
              if 80E1: NOT  player 0 pressed_key 14
              then
              3@ = $TEMPVAR_FLOAT_1
              3@ -= $CAM_X
              4@ = $TEMPVAR_FLOAT_2
              4@ -= $CAM_Y
              05A4: get_angle_between_vectors_origin_to 3@ 4@ and_origin_to 0.0  1.0 store_to 2@
              
              if 
                 0 > 3@ 
              then
                 2@ *= -1.0
                 2@ += 360.0
              end
            
              0494: get_joystick 0 data_to $MOVE_AXIS_X $MOVE_AXIS_Y $SPECIAL_AXIS_X $SPECIAL_AXIS_Y 
              008D: $TX = integer $MOVE_AXIS_X to_float 
              008D: $TZ = integer $MOVE_AXIS_Y to_float 
            
              $TX /= 128.0
              $TZ /= 128.0
              
              $TX *= 2.0
              $TZ *= -0.1
              
              2@ += $TX
              
              02F7: $TY = sine 2@ // (float) 
              02F6: $TX = cosine 2@ // (float) 
              $TX *= 5.0
              $TY *= 5.0
              
              $TEMPVAR_FLOAT_1 = $CAM_X
              $TEMPVAR_FLOAT_1 += $TX
              $TEMPVAR_FLOAT_2 = $CAM_Y
              $TEMPVAR_FLOAT_2 += $TY
              $TEMPVAR_FLOAT_3 += $TZ
              else
                  0494: get_joystick 0 data_to $MOVE_AXIS_X $MOVE_AXIS_Y $SPECIAL_AXIS_X $SPECIAL_AXIS_Y 
                  008D: $TZ = integer $MOVE_AXIS_Y to_float 
                
                  $TZ /= 128.0
                  
                  $TZ *= -0.1
                  $CAM_Z += $TZ
                  15@ += $TZ
                  $TEMPVAR_FLOAT_3 += $TZ
            end  
          end
          015F: set_camera_position $CAM_X  $CAM_Y  $CAM_Z rotation 0.0 0.0 0.0 
          0160: set_camera_point_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 mode 2 
          Actor.PutAt($PLAYER_ACTOR,$CAM_X,$CAM_Y,15@)
          actor.LockInCurrentPosition($PLAYER_ACTOR,true)
          
        end
        
        if 0AB0:  key_pressed 0x0D
        then
          break  // Accept enter as alternative for 'space' to end the loop
        end  
    until 00E1:   player 0 pressed_key 16
    
    03E6: remove_text_box 
end

gosub @ROUTINE_enterspace_release  
if and
   $camera_mode >= DYOM_cutscene_actor
   $camera_mode < DYOM_cutscene_player
   $DYOM_actor_count > 0
then
  0512: permanent_text_box 'CACHLP'  
  $camera_actor = $DYOM_actor_count
  $camera_actor -= 1 
  repeat
    wait 10
  until $anim_req == -1
  $anim_actor = $DYOM_actor_handle[$camera_actor]
  $anim_req = 11
  0160: set_camera_point_at $DYOM_actor_location_x[$camera_actor] $DYOM_actor_location_y[$camera_actor] $DYOM_actor_location_z[$camera_actor] mode 2 
  repeat
    wait 0
    if 00E1:   player 0 pressed_key 15
    then
      03E6: remove_text_box
      
      04E4: unknown_refresh_game_renderer_at 11@ 12@ 
      03CB: set_rendering_origin_at 11@ 12@ 13@ 
      Actor.PutAt($PLAYER_ACTOR,11@,12@,13@)
      actor.LockInCurrentPosition($PLAYER_ACTOR,false)
      02A3: enable_widescreen 0 
      04BB: select_interior 20@
      if 20@ == 0
        then
          //0581: enable_radar 1
        else
          //0581: enable_radar 0
        end
      $camera_cancel = 1
      0373: set_camera_directly_behind_player 
      02EB: restore_camera_with_jumpcut
      return
    end
    
    if 00E1:   player 0 pressed_key 11
    then
        repeat 
           wait 0
        until 80E1:   not player 0 pressed_key 11
        0687: clear_actor $DYOM_actor_handle[$camera_actor] task 
        
        0008: $camera_actor += 1
        
        if $camera_actor >= $DYOM_actor_count
        then
            $camera_actor = 0
        end 
      repeat
        wait 10
      until $anim_req == -1
      $anim_actor = $DYOM_actor_handle[$camera_actor]
      $anim_req = 11
      0160: set_camera_point_at $DYOM_actor_location_x[$camera_actor] $DYOM_actor_location_y[$camera_actor] $DYOM_actor_location_z[$camera_actor] mode 2 
    end
        
    
    if 00E1:   player 0 pressed_key 10
    then
        repeat 
           wait 0
        until 80E1:   not player 0 pressed_key 10
        0687: clear_actor $DYOM_actor_handle[$camera_actor] task 
        
        if $camera_actor <= 0
        then
            $camera_actor = $DYOM_actor_count
        end 
        0008: $camera_actor += -1 
      repeat
        wait 10
      until $anim_req == -1
      $anim_actor = $DYOM_actor_handle[$camera_actor]
      $anim_req = 11
      0160: set_camera_point_at $DYOM_actor_location_x[$camera_actor] $DYOM_actor_location_y[$camera_actor] $DYOM_actor_location_z[$camera_actor] mode 2 
    end
    
      
      if 0AB0:  key_pressed 0x0D
      then
        break  // Accept enter as alternative for 'space' to end the loop
      end  
  until 00E1:   player 0 pressed_key 16
  0687: clear_actor $DYOM_actor_handle[$camera_actor] task 
  03E6: remove_text_box 
end
04E4: unknown_refresh_game_renderer_at 11@ 12@ 
03CB: set_rendering_origin_at 11@ 12@ 13@ 
Actor.PutAt($PLAYER_ACTOR,11@,12@,13@)
actor.LockInCurrentPosition($PLAYER_ACTOR,false)
02A3: enable_widescreen 0 
04BB: select_interior 20@
if 20@ == 0
then
  //0581: enable_radar 1
else
  //0581: enable_radar 0
end

 
0373: set_camera_directly_behind_player 
02EB: restore_camera_with_jumpcut 


return



//================================
// SUBROUTINE: SELECT_CAMERA_MODE
//================================
var
$camera_mode  : Integer
$camera_cancel: Integer
end  
:SELECT_CAMERA_MODE
$camera_cancel = 0

08D4: $menu = create_panel_with_title 'CAMMODE' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
08DB: set_panel $menu column 0 header 'BEHAVE' data 'STAT' 'LIN' 'SMO' 'CSACT' 'CSAP1' 'CSAP3' 'CSPLY' 'CSPP1' 'CSPP3' 'DUMMY' 'DUMMY' 'DUMMY'  
if $DYOM_actor_count == 0
then
    08D9: set_panel $menu row 3 enable 0
    08D9: set_panel $menu row 4 enable 0
    08D9: set_panel $menu row 5 enable 0
end
gosub @GEN_MENU
if $menu_canceled == 1
then
    $camera_cancel = 1
    return 
end
$camera_mode = $menu_choice
return


//================================
// SUBROUTINE: SELECT_MARKER_COLOR
//================================
var
  $marker_color : Integer
  $marker_cancel: Integer
end
:SELECT_MARKER_COLOR
    $marker_cancel = 0
    08D4: $menu = create_panel_with_title 'OBJECTI' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'MARKC' data 'NMARKER' 'RRED' 'GREEN' 'BLUE' 'WHITE' 'LYELLOW' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
        $marker_cancel = 1
        return
    end    
    $marker_color = -1
    
    $marker_color = $menu_choice
    $marker_color -= 1
return
//================================
// SUBROUTINE: SELECT_MARKER_MODEL
//================================
var
  $marker: integer
  $marker_model :Integer
  $marker_size :Float
  $prev_model :Integer
  $marker_cancel :Integer
end
:SELECT_MARKER_MODEL
0512: permanent_text_box 'SMARKER'

// position camera over shoulder
04C4: store_coords_to $camx  $camy  $camz from_actor $PLAYER_ACTOR with_offset 4.0 -4.0 6.0
015F: set_camera_position $camx  $camy  $camz rotation 0.0 0.0 0.0 
0160: set_camera_point_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 mode 2 


$marker_cancel = 0

gosub @ROUTINE_enterspace_release                                                
$redraw = 1
repeat 
    wait 10

    if 00E1:   player 0 pressed_key 15
    then
      03E6: remove_text_box 
      0373: set_camera_directly_behind_player 
      02EB: restore_camera_with_jumpcut 
      $marker_cancel = 1
      if or
         $marker_model == 0
         $marker_model == 5
      then
        03BD: destroy_sphere $marker
      else
          if $marker_model == 6
          then
            0A41: destroy_entrance_marker $marker
          else
            06D6: disable_racing_checkpoint $marker 
          end
      end
      
      return
    end
    
    if or 
      00E1:   player 0 pressed_key 0 
      00E1:   player 0 pressed_key 1 
    then
      if 00E1:   player 0 pressed_key 14
      then
        0494: get_joystick 0 data_to $MOVE_AXIS_X $MOVE_AXIS_Y $SPECIAL_AXIS_X $SPECIAL_AXIS_Y 
          008D: $TX = integer $MOVE_AXIS_X to_float 
          008D: $TY = integer $MOVE_AXIS_Y to_float 
        
          $TX /= 128.0
          $TY /= 128.0
          
          $TX *= 2.0
          $TY *= -0.1
          $TEMPVAR_FLOAT_3 += $TY
          $TEMPVAR_ANGLE += $TX
      else
         if 00E1:   player 0 pressed_key 17
         then
          0494: get_joystick 0 data_to $MOVE_AXIS_X $MOVE_AXIS_Y $SPECIAL_AXIS_X $SPECIAL_AXIS_Y 
          008D: $TY = integer $MOVE_AXIS_Y to_float 
        
          $TY /= 128.0
          
          $TY *= -0.1
          $marker_size += $TY
          else
            gosub @MOVE_AROUND_CAM
          end  
      end
      $redraw = 1      
    end

    if 00E1:   player 0 pressed_key 11
    then
        repeat 
           wait 0
        until 80E1:   not player 0 pressed_key 11
        
        $marker_model += 1
        
        if $marker_model > 5
        then
            $marker_model = 0
        end 
        $redraw = 1      
    end
        
    if 00E1:   player 0 pressed_key 10
    then
        repeat 
           wait 0
        until 80E1:   not player 0 pressed_key 10
        
        $marker_model += -1
        
        if $marker_model < 0 
        then
            $marker_model = 5
        end  
        $redraw = 1      
    end
    
    if $redraw == 1
    then
        0160: set_camera_point_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 mode 2 
        02F6: 1@ = cosine $TEMPVAR_ANGLE // (float) 
        02F7: 2@ = sine $TEMPVAR_ANGLE // (float)
        1@ += $TEMPVAR_FLOAT_1 
        2@ += $TEMPVAR_FLOAT_2 
        
        if or
          $prev_model == 0
          $prev_model == 5
        then
          03BD: destroy_sphere $marker
          wait 50
        else
          if $prev_model == 6
          then
            0A41: destroy_entrance_marker $marker 
          else
            06D6: disable_racing_checkpoint $marker
          end   
        end
        if $marker_model == 0
        then
          03BC: $marker = create_sphere_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 radius $marker_size 
        end
        if $marker_model == 1
        then
          06D5: $marker = create_racing_checkpoint_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 point_to 1@ 2@ $TEMPVAR_FLOAT_3 type 0 radius $marker_size
        end
        if $marker_model == 2
        then
          06D5: $marker = create_racing_checkpoint_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 point_to 1@ 2@ $TEMPVAR_FLOAT_3 type 1 radius $marker_size
        end
        if $marker_model == 3
        then
          06D5: $marker = create_racing_checkpoint_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 point_to 1@ 2@ $TEMPVAR_FLOAT_3 type 2 radius $marker_size
        end
        if $marker_model == 4
        then
          06D5: $marker = create_racing_checkpoint_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 point_to 1@ 2@ $TEMPVAR_FLOAT_3 type 4 radius $marker_size
        end
        if $marker_model == 5
        then
          00BC: show_text_highpriority GXT 'invisi' time 1000 flag 1  // Invisible
          03BC: $marker = create_sphere_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 radius $marker_size 
        end
        if $marker_model == 6
        then
           $marker_size = 1.0
           0A40: $marker = create_entrance_marker_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 color 14 
        end
        $redraw = 0
        $prev_model = $marker_model
       
    end
   
    if 0AB0:  key_pressed 0x0D
    then
      break  // Accept enter as alternative for 'space' to end the loop
    end  
until 00E1:   player 0 pressed_key 16
//03BD: destroy_sphere $marker
03E6: remove_text_box 
0373: set_camera_directly_behind_player 
02EB: restore_camera_with_jumpcut 

return

//===================================
// SUBROUTINE: SELECT_OBJECT_DISTANCE
//===================================
var
  $object_dist :Float
  $object_cancel :Integer
end
:SELECT_OBJECT_DISTANCE
0512: permanent_text_box 'SDIST'

// position camera over shoulder
04C4: store_coords_to $camx  $camy  $camz from_actor $PLAYER_ACTOR with_offset 4.0 -4.0 6.0
015F: set_camera_position $camx  $camy  $camz rotation 0.0 0.0 0.0 
0160: set_camera_point_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 mode 2 


$object_cancel = 0
$object_dist *= 2.0
gosub @ROUTINE_enterspace_release                                                
$redraw = 1
repeat 
    wait 10

    if 00E1:   player 0 pressed_key 15
    then
      03E6: remove_text_box 
      0373: set_camera_directly_behind_player 
      02EB: restore_camera_with_jumpcut 
      $object_cancel = 1
      03BD: destroy_sphere $marker
      return
    end
    
    if 00E1:   player 0 pressed_key 11
    then
        repeat 
           wait 0
        until 80E1:   not player 0 pressed_key 11
        
        $object_dist += 0.5        
        $redraw = 1      
    end
        
    if 00E1:   player 0 pressed_key 10
    then
        repeat 
           wait 0
        until 80E1:   not player 0 pressed_key 10
        if $object_dist > 0.5
        then
           $object_dist -= 0.5
        end
        $redraw = 1      
    end
    
    if $redraw == 1
    then
      03BD: destroy_sphere $marker
      wait 50
      03BC: $marker = create_sphere_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 radius $object_dist 
      $redraw = 0
    end
   
    if 0AB0:  key_pressed 0x0D
    then
      break  // Accept enter as alternative for 'space' to end the loop
    end  
until 00E1:   player 0 pressed_key 16
03BD: destroy_sphere $marker
03E6: remove_text_box 
0373: set_camera_directly_behind_player 
02EB: restore_camera_with_jumpcut 
$object_dist /= 2.0
return


//================================
// SUBROUTINE: SELECT_DAYTIME
//================================
:SELECT_DAYTIME
var 
$temp_timeofday :integer
end

$temp_timeofday = $DYOM_timeofday
0512: permanent_text_box 'TIMETXT'

gosub @ROUTINE_enterspace_release                                                
repeat 
    00C0: set_current_time_hours_to $temp_timeofday minutes_to 0 
    01B6: set_weather $DYOM_weather 
    wait 10

    if 00E1:   player 0 pressed_key 15
    then
      03E6: remove_text_box 
      return
    end
    

    if 00E1:   player 0 pressed_key 11
    then
        repeat 
           wait 0
        until 80E1:   not player 0 pressed_key 11
        
        $temp_timeofday += 1
        
        if 0018: $temp_timeofday > 23
        then
          $temp_timeofday = 0
        end  
    end    
        
    if 00E1:   player 0 pressed_key 10
    then
        repeat 
           wait 0
        until 80E1:   not player 0 pressed_key 10
        
        $temp_timeofday += -1
        
        if 001A: 0 > $temp_timeofday
        then
          $temp_timeofday = 23
        end  
    end   
    if 0AB0:  key_pressed 0x0D
    then
      break  // Accept enter as alternative for 'space' to end the loop
    end  
until 00E1:   player 0 pressed_key 16
03E6: remove_text_box 
$DYOM_timeofday = $temp_timeofday
return

//================================
// SUBROUTINE: SELECT_OBJECTIVE_DAYTIME
//================================
var 
$daytime_choice :integer
$daytime_cancel :integer
end

:SELECT_OBJECTIVE_DAYTIME
$daytime_cancel = 0

0512: permanent_text_box 'TIMETXT'

gosub @ROUTINE_enterspace_release                                                
repeat 
    00C0: set_current_time_hours_to $daytime_choice minutes_to 0 
    01B6: set_weather $DYOM_weather 
    wait 10

    if 00E1:   player 0 pressed_key 15
    then
      03E6: remove_text_box 
      $daytime_cancel = 1
      return
    end
    

    if 00E1:   player 0 pressed_key 11
    then
        repeat 
           wait 0
        until 80E1:   not player 0 pressed_key 11
        
        $daytime_choice += 1
        
        if 0018: $daytime_choice > 23
        then
          $daytime_choice = 0
        end  
    end    
        
    if 00E1:   player 0 pressed_key 10
    then
        repeat 
           wait 0
        until 80E1:   not player 0 pressed_key 10
        
        $daytime_choice += -1
        
        if 001A: 0 > $daytime_choice
        then
          $daytime_choice = 23
        end  
    end   
    if 0AB0:  key_pressed 0x0D
    then
      break  // Accept enter as alternative for 'space' to end the loop
    end  
until 00E1:   player 0 pressed_key 16
03E6: remove_text_box 
return

//================================
// SUBROUTINE: SELECT_WEATHER
//================================
:SELECT_WEATHER
var 
$temp_weather :integer
end
$temp_weather = $select_weather
01B6: set_weather $temp_weather 
0512: permanent_text_box 'WEATTXT'

gosub @ROUTINE_enterspace_release                                                
repeat 
    wait 10

    if 00E1:   player 0 pressed_key 15
    then
      03E6: remove_text_box 
      return
    end
    

    if 00E1:   player 0 pressed_key 11
    then
        repeat 
           wait 0
        until 80E1:   not player 0 pressed_key 11
        
        $temp_weather += 1
        
        if 0018: $temp_weather > 22
        then
          $temp_weather = 0
        end  
        01B6: set_weather $temp_weather 

    end
        
    if 00E1:   player 0 pressed_key 10
    then
        repeat 
           wait 0
        until 80E1:   not player 0 pressed_key 10
        
        $temp_weather += -1
        
        if 001A: 0 > $temp_weather
        then
          $temp_weather = 22
        end  
        01B6: set_weather $temp_weather 

    end
   
    if 0AB0:  key_pressed 0x0D
    then
      break  // Accept enter as alternative for 'space' to end the loop
    end  
until 00E1:   player 0 pressed_key 16
03E6: remove_text_box 
$select_weather = $temp_weather 
return

//================================
// SUBROUTINE: SELECT_OBJECTIVE_WEATHER
//================================
:SELECT_OBJECTIVE_WEATHER
var 
$weather_choice :Integer
$weather_cancel: integer
end

$weather_cancel = 0
01B6: set_weather $weather_choice
0512: permanent_text_box 'WEATTXT'

gosub @ROUTINE_enterspace_release                                                
repeat 
    wait 10

    if 00E1:   player 0 pressed_key 15
    then
      03E6: remove_text_box 
      $weather_cancel = 1
      01B6: set_weather $DYOM_weather 
      return
    end
    

    if 00E1:   player 0 pressed_key 11
    then
        repeat 
           wait 0
        until 80E1:   not player 0 pressed_key 11
        
        $weather_choice += 1
        
        if 0018: $weather_choice > 22
        then
          $weather_choice = 0
        end  
        01B6: set_weather $weather_choice

    end
        
    if 00E1:   player 0 pressed_key 10
    then
        repeat 
           wait 0
        until 80E1:   not player 0 pressed_key 10
        
        $weather_choice += -1
        
        if 001A: 0 > $weather_choice
        then
          $weather_choice = 22
        end  
        01B6: set_weather $weather_choice

    end
   
    if 0AB0:  key_pressed 0x0D
    then
      break  // Accept enter as alternative for 'space' to end the loop
    end  
until 00E1:   player 0 pressed_key 16
03E6: remove_text_box 
01B6: set_weather $DYOM_weather 
return

//================================
// SUBROUTINE: SELECT WANTED LEVEL
//================================

var
$wanted_cancel: integer
$wanted_choice: integer
end

:SELECT_OBJECTIVE_WANTED
$wanted_cancel = 0

08D4: $menu = create_panel_with_title 'OBJECTI' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
08DB: set_panel $menu column 0 header 'ADDWANT' data 'WANT0' 'WANT1' 'WANT2' 'WANT3' 'WANT4' 'WANT5' 'WANT6' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
090E: set_panel $menu active_row $wanted_choice
gosub @GEN_MENU
if $menu_canceled == 1
then
    $wanted_cancel = 1
    return 
end 
$wanted_choice = $menu_choice   
return

//================================
// SUBROUTINE: SELECT MAX WANTED LEVEL
//================================

var
$wantedmax_choice: integer
end

:SELECT_OBJECTIVE_WANTEDMAX
$wanted_cancel = 0

08D4: $menu = create_panel_with_title 'OBJECTI' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
08DB: set_panel $menu column 0 header 'MAXWANT' data 'WANT0' 'WANT1' 'WANT2' 'WANT3' 'WANT4' 'WANT5' 'WANT6' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
090E: set_panel $menu active_row $wantedmax_choice
gosub @GEN_MENU
if $menu_canceled == 1
then
    $wanted_cancel = 1
    return 
end 
$wantedmax_choice = $menu_choice   
return
    
//================================
// SUBROUTINE: SELECT MIN WANTED LEVEL
//================================

var
$wantedmin_choice: integer
end

:SELECT_OBJECTIVE_WANTEDMIN
$wanted_cancel = 0

08D4: $menu = create_panel_with_title 'SETTING' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
08DB: set_panel $menu column 0 header 'MINWANT' data 'WANT0' 'WANT1' 'WANT2' 'WANT3' 'WANT4' 'WANT5' 'WANT6' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
090E: set_panel $menu active_row $wantedmin_choice
gosub @GEN_MENU
if $menu_canceled == 1
then
    $wanted_cancel = 1
    return 
end 
$wantedmin_choice = $menu_choice   
return


//================================
// SUBROUTINE: SELECT PEDS BEHAVIOUR
//================================

var
$peds_cancel: integer
$peds_choice: integer
end

:SELECT_OBJECTIVE_PEDS
$peds_cancel = 0

08D4: $menu = create_panel_with_title 'OBJECTI' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
08DB: set_panel $menu column 0 header 'ADDPEDS' data 'PEDNORM' 'PEDRIOT' 'NOCARS' 'NOPEDS' 'NOBOTH' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
090E: set_panel $menu active_row $peds_choice

gosub @GEN_MENU
if $menu_canceled == 1
then
    $peds_cancel = 1
    return 
end 
$peds_choice = $menu_choice   
return


//================================
// SUBROUTINE: SELECT_SPECIAL_DURATION
//================================
:SELECT_SPECIAL_DURATION
    var 
    $time_value :integer
    $time_cancel :integer
    end
    $time_cancel = 0
    
    03C3: set_timer_to $time_value type 1 GXT 'BB_19' // global_variable  // Time Left
    0396: pause_timer 1 
    
    gosub @ROUTINE_enterspace_release                                                
    repeat 
        wait 10
    
        if 00E1:   player 0 pressed_key 15
        then
          014F: stop_timer $time_value 
          03E6: remove_text_box 
          $time_cancel = 1
          return
        end
        
    
        if 00E1:   player 0 pressed_key 11
        then
            repeat 
               wait 0
            until 80E1:   not player 0 pressed_key 11
            
            $time_value += 1000
            014F: stop_timer $time_value 
            03C3: set_timer_to $time_value type 1 GXT 'BB_19' // global_variable  // Time Left
            0396: pause_timer 1 
    
            
        end
            
        if 00E1:   player 0 pressed_key 10
        then
            repeat 
               wait 0
            until 80E1:   not player 0 pressed_key 10
            
            if 0018: $time_value > 1000
            then
               $time_value += -1000
            else
              $time_value = 0
            end
            014F: stop_timer $time_value 
            03C3: set_timer_to $time_value type 1 GXT 'BB_19' // global_variable  // Time Left
            0396: pause_timer 1 
        end
       
        if 0AB0:  key_pressed 0x0D
        then
          break  // Accept enter as alternative for 'space' to end the loop
        end  
    until 00E1:   player 0 pressed_key 16
    gosub @ROUTINE_enterspace_release                                                
    014F: stop_timer $time_value 
    03E6: remove_text_box 
return


//================================
// SUBROUTINE: SELECT_TIME
//================================
:SELECT_TIME
    var 
    $time_value :integer
    $time_cancel :integer
    end
    $time_cancel = 0
    0512: permanent_text_box 'TLIMTXT'
    
    03C3: set_timer_to $time_value type 1 GXT 'BB_19' // global_variable  // Time Left
    0396: pause_timer 1 
    
    gosub @ROUTINE_enterspace_release                                                
    repeat 
        wait 10
    
        if 00E1:   player 0 pressed_key 15
        then
          014F: stop_timer $time_value 
          03E6: remove_text_box 
          $time_cancel = 1
          return
        end
        
    
        if 00E1:   player 0 pressed_key 11
        then
            repeat 
               wait 0
            until 80E1:   not player 0 pressed_key 11
            
            $time_value += 10000
            014F: stop_timer $time_value 
            03C3: set_timer_to $time_value type 1 GXT 'BB_19' // global_variable  // Time Left
            0396: pause_timer 1 
    
            
        end
            
        if 00E1:   player 0 pressed_key 10
        then
            repeat 
               wait 0
            until 80E1:   not player 0 pressed_key 10
            
            if 0018: $time_value > 10000
            then
               $time_value += -10000
            else
              $time_value = 0
            end
            014F: stop_timer $time_value 
            03C3: set_timer_to $time_value type 1 GXT 'BB_19' // global_variable  // Time Left
            0396: pause_timer 1 
        end
       
        if 0AB0:  key_pressed 0x0D
        then
          break  // Accept enter as alternative for 'space' to end the loop
        end  
    until 00E1:   player 0 pressed_key 16
    014F: stop_timer $time_value 
    03E6: remove_text_box 
return

//================================
// SUBROUTINE: SELECT_TIMELIMIT
//================================
:SELECT_TIMELIMIT
    $time_value = $DYOM_timelimit
    gosub @SELECT_TIME
    if $time_cancel == 0
    then
        $DYOM_timelimit = $time_value
    end
return

//================================
// SUBROUTINE: Select Objective Time Limit
//================================
var
  $timelimit : Integer
  $time_cancel: Integer
end
:SELECT_OBJ_TIME_LIMIT
    //$timelimit = 0
    $time_cancel = 0
    08D4: $menu = create_panel_with_title 'OBJECTI' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'TIMELIM' data 'TLSET' 'TLADD' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
    
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
        $time_cancel = 1
        return
    end
    
    if $menu_choice == 0
    then
        $time_value = 0
        gosub @SELECT_TIME
        if $time_cancel == 0
        then
          if $time_value > 0
          then
            $timelimit = $time_value
          else
            $timelimit = -1   // Stop timelimit
          end  
        end
    end
    
    if $menu_choice == 1
    then
        $time_value = 0
        gosub @SELECT_TIME
        if $time_cancel == 0
        then
          if $time_value > 0
          then
            $timelimit = 0 
            $timelimit -= $time_value
          else
            $timelimit = 0
          end
        end
    end
    
return


//==================================
// SUBROUTINE: SELECT DISPLAY TIMEOUT
//==================================

var
$show_cancel: integer
$show_choice: integer
end

:SELECT_SHOW_TIMEOUT
    $show_cancel = 0
    
    08D4: $menu = create_panel_with_title 'SHWTIME' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'SHWTIME' data  'NO' 'YES' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'
    090E: set_panel $menu active_row $show_choice
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
        $show_cancel = 1
        return 
    end
    $show_choice = $menu_choice

return

//==================================
// SUBROUTINE: get effectstring for object id
//==================================
var
  v$effect:string
end
:EFFECT_GETNAME
if $object_model == -388
then
  v$effect = "blood_heli"
end
if $object_model == -389
then
  v$effect = "camflash"
end
if $object_model == -390
then
  v$effect = "coke_puff"  
end
if $object_model == -391
then
  v$effect = "explosion_crate"  
end
if $object_model == -392
then
  v$effect = "explosion_door"
end
if $object_model == -393
then
  v$effect = "exhale"
end
if $object_model == -394
then
  v$effect = "gunflash" 
end
if $object_model == -395
then
  v$effect = "gunsmoke"
end
if $object_model == -396
then
  v$effect = "puke"
end
if $object_model == -397
then
  v$effect = "riot_smoke" 
end
if $object_model == -398
then
  v$effect = "shootlight"  
end
if $object_model == -399
then
  v$effect = "tank_fire" 
end
if $object_model == -400
then
  v$effect = "tree_hit_fir"
end
if $object_model == -401
then
  v$effect = "tree_hit_palm" 
end
if $object_model == -402
then
  v$effect = "water_hydrant"   
end
if $object_model == -403
then
  v$effect = "water_splash" 
end
if $object_model == -404
then
  v$effect = "water_splash_big"
end
if $object_model == -405
then
  v$effect = "water_splsh_sml"  
end
if $object_model == -406
then
  v$effect = "water_swim"
end
if $object_model == -407
then
  v$effect = "wallbust"
end
if $object_model == -408
then
  v$effect = "boat_prop"
end
if $object_model == -409
then
  v$effect = "carwashspray"
end
if $object_model == -410
then
  v$effect = "cement"  
end
if $object_model == -411
then
  v$effect = "cloudfast"
end
if $object_model == -412
then
  v$effect = "coke_trail" 
end
if $object_model == -413
then
  v$effect = "cigarette_smoke"
end
if $object_model == -414
then
  v$effect = "extinguisher"
end
if $object_model == -415
then
  v$effect = "flame"
end
if $object_model == -416
then
  v$effect = "fire"
end
if $object_model == -417
then
  v$effect = "fire_med"
end
if $object_model == -418
then
  v$effect = "fire_large"
end
if $object_model == -419
then
  v$effect = "flamethrower" 
end
if $object_model == -420
then
  v$effect = "fire_bike" 
end
if $object_model == -421
then
  v$effect = "fire_car" 
end
if $object_model == -422
then
  v$effect = "insects"
end
if $object_model == -423
then
  v$effect = "heli_dust" 
end
if $object_model == -424
then
  v$effect = "jetpack" 
end
if $object_model == -425
then
  v$effect = "jetthrust"
end
if $object_model == -426
then
  v$effect = "nitro"
end
if $object_model == -427
then
  v$effect = "molotov_flame"
end
if $object_model == -428
then
  v$effect = "overheat_car"
end
if $object_model == -429
then
  v$effect = "prt_boatsplash"
end
if $object_model == -430
then
  v$effect = "prt_gunshell"
end
if $object_model == -431
then
  v$effect = "prt_sand"  
end
if $object_model == -432
then
  v$effect = "prt_sand2"
end
if $object_model == -433
then
  v$effect = "prt_smoke_huge" 
end
if $object_model == -434
then
  v$effect = "prt_spark"
end
if $object_model == -435
then
  v$effect = "prt_spark_2"
end
if $object_model == -436
then
  v$effect = "prt_splash" 
end
if $object_model == -437
then
  v$effect = "prt_watersplash" 
end
if $object_model == -438
then
  v$effect = "prt_wheeldirt"  
end
if $object_model == -439
then
  v$effect = "petrolcan"
end
if $object_model == -440
then
  v$effect = "spraycan"
end
if $object_model == -441
then
  v$effect = "smoke30lit"
end
if $object_model == -442
then
  v$effect = "smoke30m"
end
if $object_model == -443
then
  v$effect = "smoke50lit" 
end
if $object_model == -444
then
  v$effect = "smoke_flare"
end
if $object_model == -445
then
  v$effect = "teargas"
end
if $object_model == -446
then
  v$effect = "teargasAD"  
end
if $object_model == -447
then
  v$effect = "vent"
end
if $object_model == -448
then
  v$effect = "vent2" 
end
if $object_model == -449
then
  v$effect = "water_ripples"
end
if $object_model == -450
then
  v$effect = "water_speed"  
end
if $object_model == -451
then
  v$effect = "waterfall_end"
end
if $object_model == -452
then
  v$effect = "water_fnt_tme" 
end
if $object_model == -453
then
  v$effect = "water_fountain"
end
if $object_model == -454
then
  v$effect = "WS_factorysmoke"
end
return

//================================
// SUBROUTINE: show object/effect
//================================
var
  $object_model : Integer
  $object_cancel : Integer
  $TEMPVAR_ANGLE_X:Float
  $TEMPVAR_ANGLE_Y:Float
end
:OBJECT_APPEAR
    if $object_model == -16
    then
        02CF: $object = create_fire_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 propagation 0 size 1 
        00BC: show_text_highpriority GXT 'TXFIRE' time 1000 flag 1  // Fire
        return
    end 
    
    if $object_model == -15
    then
        object.Init($object,-239,$TEMPVAR_FLOAT_1, $TEMPVAR_FLOAT_2, $TEMPVAR_FLOAT_3)
        //object.Angle($object)= $TEMPVAR_ANGLE
        //0453: set_object $object XY_rotation $TEMPVAR_ANGLE_X $TEMPVAR_ANGLE_Y angle $TEMPVAR_ANGLE
        Object.KeepInMemory($object) = True
        Object.ToggleInMovingList($object) = False
        Object.RemoveFromMissionCleanupList($object)
        0AD1: show_formatted_text_highpriority "Explosion Old Style" time 1000
        return
    end

    if $object_model > -388
    then
        //physical objects
        //----------------
        object.Init($object,$object_model,$TEMPVAR_FLOAT_1, $TEMPVAR_FLOAT_2, $TEMPVAR_FLOAT_3)
        //object.Angle($object)= $TEMPVAR_ANGLE
        0453: set_object $object XY_rotation $TEMPVAR_ANGLE_X $TEMPVAR_ANGLE_Y angle $TEMPVAR_ANGLE
        Object.KeepInMemory($object) = True
        Object.ToggleInMovingList($object) = False
        Object.RemoveFromMissionCleanupList($object)
        0@ = -16 
        0064: 0@ -= $object_model        
        01E5: show_text_1number_highpriority GXT 'NUMBER' number 0@ time 1000 flag 1
    else
        if $object_model > -455
        then
            // particle effect
            object.Init($object,-112,$TEMPVAR_FLOAT_1, $TEMPVAR_FLOAT_2, $TEMPVAR_FLOAT_3)
            //0453: set_object $object XY_rotation $TEMPVAR_ANGLE_X $TEMPVAR_ANGLE_Y angle $TEMPVAR_ANGLE
            0382: set_object $object collision_detection 0
            Object.KeepInMemory($object) = True
            Object.ToggleInMovingList($object) = False
            Object.RemoveFromMissionCleanupList($object)
            0976: destroy_particle $objecteffect
            gosub @EFFECT_GETNAME
            064B: $objecteffect = create_particle v$effect at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 type 1
            //066E: create_particle v$effect attached_to_object $object with_offset 0.0 0.0 0.0 rotation 0.0 1.0 0.0 flag 1 store_to $objecteffect
    
            064C: make_particle $objecteffect visible
            0AD1: show_formatted_text_highpriority "effect: %s" time 1000 v$effect
        else
            0@ = -16 
            0064: 0@ -= $object_model        
            0@ -= 439 
            0AD1: show_formatted_text_highpriority "Explosion Style %d" time 1000 0@
            //020C: create_explosion type 0@ at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3
            object.Init($object,-239,$TEMPVAR_FLOAT_1, $TEMPVAR_FLOAT_2, $TEMPVAR_FLOAT_3)
            0453: set_object $object XY_rotation $TEMPVAR_ANGLE_X $TEMPVAR_ANGLE_Y angle $TEMPVAR_ANGLE
            Object.KeepInMemory($object) = True
            Object.ToggleInMovingList($object) = False
            Object.RemoveFromMissionCleanupList($object)
            Object.Indestructibility($object) = True
        end
    end
return      
                    
//================================
// SUBROUTINE: SELECT_OBJECT   / MOVE_OBJECT
//================================
var
  $fix_model:integer
  $route_obj:integer
end
:ROUTE_OBJECT
    $route_obj = 1
    $fix_model = 1
    0512: permanent_text_box 'ROBHLP'  
    goto @SELECT_OBJECT_GEN
:MOVE_OBJECT
    $fix_model = 1
    $route_obj = 0
    0512: permanent_text_box 'MOBHLP'  
    goto @SELECT_OBJECT_GEN
:SELECT_OBJECT
    $fix_model = 0
    $route_obj = 0
    0512: permanent_text_box 'OBHLP'  
:SELECT_OBJECT_GEN
    wait 0 ms
    
    0828: unknown_fires_stuff 2
    $object_cancel = 0
    $last_point = -1
    
    // position camera over shoulder
    04C4: store_coords_to $camx  $camy  $camz from_actor $PLAYER_ACTOR with_offset 1.0 -1.0 1.0
    015F: set_camera_position $camx  $camy  $camz rotation 0.0 0.0 0.0 
    0160: set_camera_point_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 mode 2 
    
    if and
       $OBJOBJ_FLAG == 1
       $object_model > -17
    then
       $object_model = -17
    end
    if and
       $OBJOBJ_FLAG == 1
       $object_model < -387
    then
       $object_model = -17
    end

    gosub @OBJECT_APPEAR
    gosub @ROUTINE_enterspace_release                                                
    repeat 
        wait 10
    
        0084: $previous_object = $object_model  // (int) 
        
        if 00E1:   player 0 pressed_key 15
        then
            03E6: remove_text_box 
            $object_cancel = 1
            if $object_model == -16
            then
                if 0973:   fire $object exists 
                then
                    02D1: remove_fire $object 
                end
            else
              0108: destroy_object $object
              0976: destroy_particle $objecteffect
            end
            0373: set_camera_directly_behind_player 
            02EB: restore_camera_with_jumpcut
            Player.CanMove($PLAYER_CHAR) = True
            return
        end
                                                                                                                    
        
     
        if and
           $fix_model == 0
           00E1:   player 0 pressed_key 11
        then
            repeat
              wait 0
            until 80E1: not   player 0 pressed_key 11 
            0008: $object_model += 1         
            
            if and
               $OBJOBJ_FLAG == 1
               $object_model > -17
            then
               $object_model = -387
            end

            if 0018:   $object_model > -15
            then
                $object_model = -467   //-459
            end
            wait 100
        end
        
        if and
           $fix_model == 0
           00E1:   player 0 pressed_key 8
        then
            repeat
              wait 0
            until 80E1: not   player 0 pressed_key 11 
            0008: $object_model += 10         
          
            if and
               $OBJOBJ_FLAG == 1
               $object_model > -17
            then
               $object_model = -387
            end
            if and
               $OBJOBJ_FLAG == 1
                001A:   -387 > $object_model
            then
               $object_model = -387
            end

            if 0018:   $object_model > -15
            then
                $object_model = -467
            end
            wait 100
        end
        
        if and
           $fix_model == 0
           00E1:   player 0 pressed_key 10
        then
            repeat
              wait 0
            until 80E1: not   player 0 pressed_key 10 
            0008: $object_model += -1 
            
            if and
               $OBJOBJ_FLAG == 1
               001A:   -387 > $object_model
            then
               $object_model = -17
            end

            if 001A:   -467 > $object_model
            then
                $object_model = -15
            end
            wait 100
        end

        if and
           $fix_model == 0
           00E1:   player 0 pressed_key 9
        then
            repeat
              wait 0
            until 80E1: not   player 0 pressed_key 10 
            0008: $object_model += -10 

            if and
               $OBJOBJ_FLAG == 1
               001A:   -387 > $object_model
            then
               $object_model = -17
            end
            if and
               $OBJOBJ_FLAG == 1
               $object_model > -17
            then
               $object_model = -17
            end
            
            if 001A:   -467 > $object_model
            then
                $object_model = -15
            end
            wait 100
        end
        
        if 803A:   not  $previous_object == $object_model // (int) 
        then   
            if $previous_object == -16
            then
                if 0973:   fire $object exists 
                then
                    02D1: remove_fire $object 
                end
            else
              0108: destroy_object $object
              0976: destroy_particle $objecteffect
            end
            //01E5: show_text_1number_highpriority GXT 'NUMBER' number $object_model time 3000 flag 1
            gosub @OBJECT_APPEAR
        end    
        
        if or 
          00E1:   player 0 pressed_key 0 
          00E1:   player 0 pressed_key 1 
        then
          if 00E1:   player 0 pressed_key 14
          then
            0494: get_joystick 0 data_to $MOVE_AXIS_X $MOVE_AXIS_Y $SPECIAL_AXIS_X $SPECIAL_AXIS_Y 
              008D: $TX = integer $MOVE_AXIS_X to_float 
              008D: $TY = integer $MOVE_AXIS_Y to_float 
            
              $TX /= 128.0
              $TY /= 128.0
              
              $TX *= -2.0
              $TY *= -0.1
              $TEMPVAR_FLOAT_3 += $TY
              $TEMPVAR_ANGLE += $TX
          else
             if 00E1:   player 0 pressed_key 17
             then
              0494: get_joystick 0 data_to $MOVE_AXIS_X $MOVE_AXIS_Y $SPECIAL_AXIS_X $SPECIAL_AXIS_Y 
              008D: $TX = integer $MOVE_AXIS_X to_float 
              008D: $TY = integer $MOVE_AXIS_Y to_float 
            
              $TX /= 128.0
              $TY /= 128.0
              
              $TX *= -2.0
              $TY *= -2.0
              $TEMPVAR_ANGLE_Y += $TX
              $TEMPVAR_ANGLE_X += $TY
            else
              if 0AB0:  key_pressed 0x14      //CAPSLOCK
              then
                gosub @MOVE_CAM_AROUND_OBJECT
              else
                gosub @MOVE_AROUND_CAM
              end
            end  
          end
          
            015F: set_camera_position $camx  $camy  $camz rotation 0.0 0.0 0.0 
            0160: set_camera_point_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 mode 2 
            if $object_model == -16
            then
                if 0973:   fire $object exists 
                then
                    02D1: remove_fire $object 
                end
                02CF: $object = create_fire_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 propagation 0 size 1 
            else
                01BC: put_object $object at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3
                0453: set_object $object XY_rotation $TEMPVAR_ANGLE_X $TEMPVAR_ANGLE_Y angle $TEMPVAR_ANGLE
                if AND
                   $object_model < -387 
                   $object_model > -455
                then
                    0976: destroy_particle $objecteffect
                    064B: $objecteffect = create_particle v$effect at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 type 1
                    064C: make_particle $objecteffect visible
                end                
            end   
        end
        
        
        if $route_obj == 1
        then
           if 00E1:   player 0 pressed_key 10
           then
              gosub @FIND_FREE_POINT
              if $empty_point == -1
              then
                 00BC: show_text_highpriority GXT 'POINTF' time 3000 flag 1  
              else
                 $point_count = $last_point
                 if $last_point == -1
                 then
                    $OBJ_P = $empty_point
                 else
                    $DYOM_POINT_LINK[$last_point] = $empty_point 
                 end
                 $last_point = $empty_point
                 $DYOM_POINT_X[$last_point] = $TEMPVAR_FLOAT_1
                 $DYOM_POINT_Y[$last_point] = $TEMPVAR_FLOAT_2
                 $DYOM_POINT_Z[$last_point] = $TEMPVAR_FLOAT_3
                 $DYOM_POINT_LINK[$last_point] = -1
                 gosub @FIND_FREE_POINT
                  if $empty_point == -1
                  then
                      // no more point, rollback first point!!!
                      $last_point = $point_count
                      if NOT $last_point == -1
                      then
                         $DYOM_POINT_LINK[$last_point] = -1                         
                      end
                      
                     00BC: show_text_highpriority GXT 'POINTF' time 3000 flag 1  
                  else
                     $DYOM_POINT_LINK[$last_point] = $empty_point
                     $last_point = $empty_point
                     $DYOM_POINT_X[$last_point] = $TEMPVAR_ANGLE_X
                     $DYOM_POINT_Y[$last_point] = $TEMPVAR_ANGLE_Y
                     $DYOM_POINT_Z[$last_point] = $TEMPVAR_ANGLE
                     $DYOM_POINT_LINK[$last_point] = -1
                     0663: "points stored" $last_point
                     01E5: show_text_1number_highpriority GXT 'OBJCNT' number $last_point time 3000 flag 1
                  end
              end
              repeat 
                wait 10
              until 80E1: NOT  player 0 pressed_key 10 
           end
           
           if 00E1:   player 0 pressed_key 11
           then
              break  // accept Y as alternative to space
           end 
                      
           // IF pressing L, store route as loop, and break out of loop.
           if 0AB0:  key_pressed 76   // L -> loop
           then
              $DYOM_POINT_LINK[$last_point] = -2
              break   
           end
        else   
            if or
               0AB0:  key_pressed 0x0D
               00E1:   player 0 pressed_key 16
            then
               break  // Accept enter and'space' to end the loop
            end  
        end
        
    until false 
    03E6: remove_text_box 
    
    0373: set_camera_directly_behind_player 
    02EB: restore_camera_with_jumpcut 
    Player.CanMove($PLAYER_CHAR) = True
return



//============================================================================
//============================================================================
//
//              D E S I G N I T E M S    M A N A G E M E N T 
//
//============================================================================
//============================================================================

//================================
// SUBROUTINE: CLEAR_DESIGN_ITEMS
//================================
var
 $DYOM_idx : Integer
end

:CLEAR_DESIGN_ITEMS

while not player.Defined($PLAYER_CHAR) 
   wait 100
end
if 0449:   actor $PLAYER_ACTOR in_a_car 
then
  0633: AS_actor $PLAYER_ACTOR exit_car 
  wait 3000  
end

0980: extinguish_all_fires_at $DYOM_player_location_x $DYOM_player_location_y $DYOM_player_location_z radius 200.0 


$DYOM_idx = 0
WHILE  $DYOM_actor_count > $DYOM_idx
    wait 0
    if 056D:   actor $DYOM_actor_handle[$DYOM_idx] defined 
    then
      actor.DestroyInstantly($DYOM_actor_handle[$DYOM_idx])
    end
    $DYOM_idx += 1
END
$DYOM_idx = 0
WHILE  $DYOM_car_count > $DYOM_idx
    wait 0
    if 056E:   car $DYOM_car_handle[$DYOM_idx] defined 
    then
      car.Destroy($DYOM_car_handle[$DYOM_idx])
    end 
    $DYOM_idx += 1
END
$DYOM_idx = 0
WHILE  $DYOM_pickup_count > $DYOM_idx
    wait 0
    if 09D1:   pickup $DYOM_pickup_handle[$DYOM_idx] created 
    then
      pickup.Destroy($DYOM_pickup_handle[$DYOM_idx])
    end
    $DYOM_idx += 1
END
$DYOM_idx = 0
WHILE  $DYOM_object_count > $DYOM_idx
    wait 0
    if NOT $DYOM_object_model[$DYOM_idx] == -16
    then
        if 03CA:   object $DYOM_object_handle[$DYOM_idx] exists 
        then
          object.Destroy($DYOM_object_handle[$DYOM_idx])
            if AND
               $DYOM_object_model[$DYOM_idx] < -387 
               $DYOM_object_model[$DYOM_idx] > -455
            then
                0976: destroy_particle $DYOM_object_location_rz[$DYOM_idx]
            end                
        end
    else
        if 0973:   fire $DYOM_object_handle[$DYOM_idx] exists 
        then
          02D1: remove_fire $DYOM_object_handle[$DYOM_idx]
        end
    end
    
    $DYOM_idx += 1
END

if NOT $DYOM_IN_STORY == 1
then
    $DYOM_idx = 1
    WHILE  $DYOM_trigger_count > $DYOM_idx
        wait 0
        if NOT $DYOM_trigger_mhandle[$DYOM_idx] == 0
        then
            if 03CA:   object $DYOM_trigger_mhandle[$DYOM_idx] exists 
            then
                object.Destroy($DYOM_trigger_mhandle[$DYOM_idx])
                $DYOM_trigger_mhandle[$DYOM_idx] = 0      
            end
        end
        $DYOM_idx += 1
    END
end


:CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
if 056D:   actor $DYOM_player_handle defined 
then
  actor.DestroyInstantly($DYOM_player_handle)
end

$DYOM_idx = 0
WHILE  $DYOM_objective_count > $DYOM_idx
    wait 0
    IF or
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_car 
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_telecar
    THEN
      if 056E:   car $DYOM_objective_handle[$DYOM_idx] defined 
      then
        car.Destroy($DYOM_objective_handle[$DYOM_idx])
      end 
    END
    IF $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_marker 
    THEN
      if or
        $DYOM_objective_model[$DYOM_idx] == 0
        $DYOM_objective_model[$DYOM_idx] == 5
      then
        03BD: destroy_sphere $DYOM_objective_handle[$DYOM_idx]
      else
        if $DYOM_objective_model[$DYOM_idx] == 6
        then
          0A41: destroy_entrance_marker $DYOM_objective_handle[$DYOM_idx]
        else
          06D6: disable_racing_checkpoint $DYOM_objective_handle[$DYOM_idx]
        end
      end
      if 03CA:   object $DYOM_objective_ammo[$DYOM_idx] exists 
      then
        object.Destroy($DYOM_objective_ammo[$DYOM_idx])
      end
      $DYOM_objective_handle[$DYOM_idx] = -1
    END 
    IF $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_pickup 
    THEN
      if 09D1:   pickup $DYOM_objective_handle[$DYOM_idx] created 
      then
        pickup.Destroy($DYOM_objective_handle[$DYOM_idx])
      end    
    END
    IF or
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_actor 
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_teleport
    THEN
      if 056D:   actor $DYOM_objective_handle[$DYOM_idx] defined 
      then
        actor.DestroyInstantly($DYOM_objective_handle[$DYOM_idx])
      end
    END
    IF or
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_cutscene 
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_countdown 
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_timeout 
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_weather 
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_addmoney 
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_submoney 
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_animation 
    THEN
      if 03CA:   object $DYOM_objective_handle[$DYOM_idx] exists 
      then
        object.Destroy($DYOM_objective_handle[$DYOM_idx])
      end
    END 
    IF or
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_settime
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_peds 
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_wanted 
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_timelimit 
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_timeron 
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_noweapon 
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_phone 
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_object 
    THEN
      if 03CA:   object $DYOM_objective_handle[$DYOM_idx] exists 
      then
        object.Destroy($DYOM_objective_handle[$DYOM_idx])
      end
    END 
    $DYOM_idx += 1
END

RETURN

//================================
// SUBROUTINE: SHOW_DESIGN_ITEMS
//================================
var
 $DYOM_idx : Integer
end 
:DUMMY_OBJECT
    if
      $DYOM_object_model[$DYOM_idx] == -16
    then
      02CF: $DYOM_object_handle[$DYOM_idx] = create_fire_at $DYOM_object_location_x[$DYOM_idx] $DYOM_object_location_y[$DYOM_idx] $DYOM_object_location_z[$DYOM_idx] propagation 0 size 1 
      return
    end
    
    if or
       $DYOM_object_model[$DYOM_idx] == -15
       $DYOM_object_model[$DYOM_idx] <= -455
    then
      object.Init($DYOM_object_handle[$DYOM_idx],-239,$DYOM_object_location_x[$DYOM_idx], $DYOM_object_location_y[$DYOM_idx], $DYOM_object_location_z[$DYOM_idx])
      //object.Angle($DYOM_object_handle[$DYOM_idx])= $DYOM_object_location_a[$DYOM_idx]
      //0453: set_object $DYOM_object_handle[$DYOM_idx] XY_rotation $DYOM_object_location_rx[$DYOM_idx] $DYOM_object_location_ry[$DYOM_idx] angle $DYOM_object_location_rz[$DYOM_idx] 

      Object.KeepInMemory($DYOM_object_handle[$DYOM_idx]) = True
      Object.ToggleInMovingList($DYOM_object_handle[$DYOM_idx]) = False
      Object.RemoveFromMissionCleanupList($DYOM_object_handle[$DYOM_idx])
      //0382: set_object $DYOM_object_handle[$DYOM_idx] collision_detection 0 

      $OBJ_I = $DYOM_object_interior[$DYOM_idx] 
      $OBJ_M = $OBJ_I
      $OBJ_M /= 1000
      $OBJ_M *= 1000
      $OBJ_I -= $OBJ_M
      0566: link_object $DYOM_object_handle[$DYOM_idx] to_interior $OBJ_I 
      return
    end
    
    
    if $DYOM_object_model[$DYOM_idx] <= -388
    then
      // particle effect
      object.Init($DYOM_object_handle[$DYOM_idx],-112,$DYOM_object_location_x[$DYOM_idx], $DYOM_object_location_y[$DYOM_idx], $DYOM_object_location_z[$DYOM_idx])
//      object.Angle($DYOM_object_handle[$DYOM_idx])= $DYOM_object_location_a[$DYOM_idx]
      0453: set_object $DYOM_object_handle[$DYOM_idx] XY_rotation $DYOM_object_location_rx[$DYOM_idx] $DYOM_object_location_ry[$DYOM_idx] angle $DYOM_object_location_rz[$DYOM_idx] 
      0382: set_object $DYOM_object_handle[$DYOM_idx] collision_detection 0

      Object.KeepInMemory($DYOM_object_handle[$DYOM_idx]) = True
      Object.ToggleInMovingList($DYOM_object_handle[$DYOM_idx]) = False
      Object.RemoveFromMissionCleanupList($DYOM_object_handle[$DYOM_idx])
        $object_model = $DYOM_object_model[$DYOM_idx] 
        gosub @EFFECT_GETNAME
        0976: destroy_particle $DYOM_object_location_rz[$DYOM_idx]
        064B: $DYOM_object_location_rz[$DYOM_idx] = create_particle v$effect at $DYOM_object_location_x[$DYOM_idx] $DYOM_object_location_y[$DYOM_idx] $DYOM_object_location_z[$DYOM_idx] type 1
        064C: make_particle $DYOM_object_location_rz[$DYOM_idx] visible

        //066E: create_particle v$effect attached_to_object $DYOM_object_handle[$DYOM_idx] with_offset 0.0 0.0 0.0 rotation 0.0 1.0 0.0 flag 1 store_to $DYOM_object_location_rz[$DYOM_idx]
        //064F: remove_references_to_particle $objecteffect
            
      $OBJ_I = $DYOM_object_interior[$DYOM_idx] 
      $OBJ_M = $OBJ_I
      $OBJ_M /= 1000
      $OBJ_M *= 1000
      $OBJ_I -= $OBJ_M
      0566: link_object $DYOM_object_handle[$DYOM_idx] to_interior $OBJ_I 
      return    
    end
    
    object.Init($DYOM_object_handle[$DYOM_idx],$DYOM_object_model[$DYOM_idx],$DYOM_object_location_x[$DYOM_idx], $DYOM_object_location_y[$DYOM_idx], $DYOM_object_location_z[$DYOM_idx])
    //object.Angle($DYOM_object_handle[$DYOM_idx])= $DYOM_object_location_a[$DYOM_idx]
    0453: set_object $DYOM_object_handle[$DYOM_idx] XY_rotation $DYOM_object_location_rx[$DYOM_idx] $DYOM_object_location_ry[$DYOM_idx] angle $DYOM_object_location_rz[$DYOM_idx] 
    
    Object.KeepInMemory($DYOM_object_handle[$DYOM_idx]) = True
    Object.ToggleInMovingList($DYOM_object_handle[$DYOM_idx]) = False
    Object.RemoveFromMissionCleanupList($DYOM_object_handle[$DYOM_idx])
    //0382: set_object $DYOM_object_handle[$DYOM_idx] collision_detection 0 
    
    $OBJ_I = $DYOM_object_interior[$DYOM_idx] 
    $OBJ_M = $OBJ_I
    $OBJ_M /= 1000
    $OBJ_M *= 1000
    $OBJ_I -= $OBJ_M
    0566: link_object $DYOM_object_handle[$DYOM_idx] to_interior $OBJ_I 
return

:DUMMY_CAR
    0980: extinguish_all_fires_at $DYOM_car_location_x[$DYOM_idx] $DYOM_car_location_y[$DYOM_idx] $DYOM_car_location_z[$DYOM_idx] radius 1.0 
    model.Load($DYOM_car_model[$DYOM_idx])
    038B: load_requested_models                                                   
    repeat
      wait 0
    until model.Available($DYOM_car_model[$DYOM_idx])  
       
    00A5: $DYOM_car_handle[$DYOM_idx] = create_car $DYOM_car_model[$DYOM_idx] at $DYOM_car_location_x[$DYOM_idx] $DYOM_car_location_y[$DYOM_idx] $DYOM_car_location_z[$DYOM_idx] 
    0175: set_car $DYOM_car_handle[$DYOM_idx] Z_angle_to $DYOM_car_location_a[$DYOM_idx] 
    0229: set_car $DYOM_car_handle[$DYOM_idx] primary_color_to $DYOM_car_color1[$DYOM_idx] secondary_color_to $DYOM_car_color2[$DYOM_idx] 
    0840: link_car $DYOM_car_handle[$DYOM_idx] to_interior $DYOM_car_interior[$DYOM_idx] 
    0249: release_model $DYOM_car_model[$DYOM_idx]

    car.DoorStatus($DYOM_car_handle[$DYOM_idx]) = 4
    car.LockInCurrentPosition($DYOM_car_handle[$DYOM_idx],TRUE)
    02AC: set_car $DYOM_car_handle[$DYOM_idx] immunities BP 1 FP 1 EP 1 CP 1 MP 1 
    099A: set_car $DYOM_car_handle[$DYOM_idx] collision_detection 0 
return

:DUMMY_ACTOR
    0980: extinguish_all_fires_at $DYOM_actor_location_x[$DYOM_idx] $DYOM_actor_location_y[$DYOM_idx] $DYOM_actor_location_z[$DYOM_idx] radius 1.0 
//$actor_model_req -> $actor_model_loaded
    $actor_model_loaded = -1
    $actor_model_req = $DYOM_actor_model[$DYOM_idx]
    repeat
      wait 20
    until not $actor_model_loaded == -1

    var 
      $this_weapon:Integer
    end  
    
    $this_weapon = $DYOM_actor_weapon[$DYOM_idx]
    if $this_weapon == 48
    then
      $this_weapon = 0
    end
    model.Load($DYOM_Weapon_model[$this_weapon])                                                                                                              
    038B: load_requested_models                                                   
    repeat
      wait 0
    until model.Available($DYOM_Weapon_model[$this_weapon])     
    $DYOM_actor_handle[$DYOM_idx] = Actor.Create(DYOM_gang_neutral, $actor_model_loaded, $DYOM_actor_location_x[$DYOM_idx], $DYOM_actor_location_y[$DYOM_idx], $DYOM_actor_location_z[$DYOM_idx])
    0173: set_actor $DYOM_actor_handle[$DYOM_idx] Z_angle_to $DYOM_actor_location_a[$DYOM_idx]
    01B2: give_actor $DYOM_actor_handle[$DYOM_idx] $this_weapon ammo $DYOM_actor_ammo[$DYOM_idx] 
    0860: link_actor $DYOM_actor_handle[$DYOM_idx] to_interior $DYOM_actor_interior[$DYOM_idx]
    0575: set_actor $DYOM_actor_handle[$DYOM_idx] pinned_position 1 
    02AB: set_actor $DYOM_actor_handle[$DYOM_idx] immunities BP 1 FP 1 EP 1 CP 1 MP 1 
    0619: enable_actor $DYOM_actor_handle[$DYOM_idx] collision_detection 0 

    if or
        $DYOM_actor_gang[$DYOM_idx] == DYOM_gang_enemy
        $DYOM_actor_gang[$DYOM_idx] == DYOM_gang_enemy2
    then
        marker.CreateAboveActor($tempmarker,$DYOM_actor_handle[$DYOM_idx])
        marker.SetColor($tempmarker,0)
    end
    if $DYOM_actor_gang[$DYOM_idx] == DYOM_gang_friend
    then
        marker.CreateAboveActor($tempmarker,$DYOM_actor_handle[$DYOM_idx])
    marker.SetColor($tempmarker,1)
    end

    model.Destroy($DYOM_Weapon_model[$this_weapon]) 
    gosub @generic_actor_unload
return

:DUMMY_PICKUP
    //Designtime, spawn pickups with type 1, so they can't be picked-up
    if $DYOM_pickup_ammo[$DYOM_idx] == 0
    then
        0213: $DYOM_pickup_handle[$DYOM_idx] = create_pickup $DYOM_pickup_model[$DYOM_idx] type 1 at $DYOM_pickup_location_x[$DYOM_idx]  $DYOM_pickup_location_y[$DYOM_idx]  $DYOM_pickup_location_z[$DYOM_idx]
      else
        032B: $DYOM_pickup_handle[$DYOM_idx] = create_weapon_pickup $DYOM_pickup_model[$DYOM_idx] group 1 ammo $DYOM_pickup_ammo[$DYOM_idx] at $DYOM_pickup_location_x[$DYOM_idx]  $DYOM_pickup_location_y[$DYOM_idx]  $DYOM_pickup_location_z[$DYOM_idx] 
    end
return

:DUMMY_TRIGGER
    $DYOM_trigger_mhandle[$DYOM_idx] = object.init(#TRAFFICCONE,$DYOM_trigger_location_x[$DYOM_idx],$DYOM_trigger_location_y[$DYOM_idx],$DYOM_trigger_location_z[$DYOM_idx])
    0382: set_object $DYOM_trigger_mhandle[$DYOM_idx] collision_detection 0 
    0188: 28@ = create_marker_above_object $DYOM_trigger_mhandle[$DYOM_idx] 
return

:DUMMY_PLAYER
    0980: extinguish_all_fires_at $DYOM_player_location_x $DYOM_player_location_y $DYOM_player_location_z radius 1.0 
    //$actor_model_req -> $actor_model_loaded
    $actor_model_loaded = -1
    $actor_model_req = $DYOM_player_model
    repeat
      wait 20
    until not $actor_model_loaded == -1
    
    $this_weapon = $DYOM_player_weapon
    if $this_weapon == 48
    then
      $this_weapon = 0
    end
    model.Load($DYOM_Weapon_model[$this_weapon])                                                                                                              
    038B: load_requested_models                                                   
    repeat
      wait 0
    until model.Available($DYOM_Weapon_model[$this_weapon]) 
    $DYOM_player_handle = Actor.Create(DYOM_gang_neutral, $actor_model_loaded, $DYOM_player_location_x, $DYOM_player_location_y, $DYOM_player_location_z)
    0173: set_actor $DYOM_player_handle Z_angle_to $DYOM_player_location_a
    01B2: give_actor $DYOM_player_handle $this_weapon ammo $DYOM_player_ammo 
    0860: link_actor $DYOM_player_handle to_interior $DYOM_player_interior
    marker.CreateAboveActor($tempmarker,$DYOM_player_handle)
    if $DYOM_selected_obj == 0
    then
      marker.SetColor($tempmarker,4)
    else
      marker.SetColor($tempmarker,3)
    end
    0084: $DYOM_select_marker = $tempmarker
    0575: set_actor $DYOM_player_handle pinned_position 1 
    02AB: set_actor $DYOM_player_handle immunities BP 1 FP 1 EP 1 CP 1 MP 1 
    0619: enable_actor $DYOM_player_handle collision_detection 0 
return

:SHOW_DESIGN_ITEMS
while not player.Defined($PLAYER_CHAR) 
  wait 100
end

//First Spawn all objects, so that cars and actors can stand on them.
$DYOM_idx = 0
WHILE  $DYOM_object_count > $DYOM_idx
    wait 0   
    gosub @DUMMY_OBJECT
    $DYOM_idx += 1
END

// Put Player behind position of playerdummy
if 0449:   actor $PLAYER_ACTOR in_a_car 
then
  0362: remove_actor $PLAYER_ACTOR from_car_and_place_at $DYOM_player_location_x $DYOM_player_location_y $DYOM_player_location_z  
else
  00A1: put_actor $PLAYER_ACTOR at $DYOM_player_location_x $DYOM_player_location_y $DYOM_player_location_z 
end
04C4: store_coords_to $TEMPVAR_FLOAT_4 $TEMPVAR_FLOAT_5 $TEMPVAR_FLOAT_6 from_actor $PLAYER_ACTOR with_offset 0.0 0.0 0.0 
00A1: put_actor $PLAYER_ACTOR at $TEMPVAR_FLOAT_4 $TEMPVAR_FLOAT_5 $TEMPVAR_FLOAT_6 
0173: set_actor $PLAYER_ACTOR Z_angle_to $DYOM_player_location_a 
wait 0 ms
while not player.Defined($PLAYER_CHAR) 
  wait 100
end
select_interior $DYOM_player_interior
0860: link_actor $PLAYER_ACTOR to_interior $DYOM_player_interior
if $DYOM_player_interior == 0
then
  //0581: enable_radar 1
else
  //0581: enable_radar 0
end


$DYOM_idx = 0
WHILE  $DYOM_car_count > $DYOM_idx
    wait 0
    gosub @DUMMY_CAR 
    $DYOM_idx += 1
END

$DYOM_idx = 0
WHILE  $DYOM_actor_count > $DYOM_idx
    wait 0
    gosub @DUMMY_ACTOR 
    $DYOM_idx += 1
END

$DYOM_idx = 0
WHILE  $DYOM_pickup_count > $DYOM_idx
    wait 0
    gosub @DUMMY_PICKUP
    $DYOM_idx += 1
END

$DYOM_idx = 1
WHILE  $DYOM_trigger_count > $DYOM_idx
    wait 0
    gosub @DUMMY_TRIGGER 
    $DYOM_idx += 1
END

:SHOW_DESIGN_ITEMS_OBJECTIVESONLY
// Spawn Dummy Player
gosub @DUMMY_PLAYER

$DYOM_idx = 0
WHILE  $DYOM_objective_count > $DYOM_idx


    wait 0
    IF or
       $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_car 
       $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_telecar 
    THEN
        0980: extinguish_all_fires_at $DYOM_objective_location_x[$DYOM_idx] $DYOM_objective_location_y[$DYOM_idx] $DYOM_objective_location_z[$DYOM_idx] radius 1.0 
        model.Load($DYOM_objective_model[$DYOM_idx])
        038B: load_requested_models                                                   
        repeat
          wait 0
        until model.Available($DYOM_objective_model[$DYOM_idx])  
           
        00A5: $DYOM_objective_handle[$DYOM_idx] = create_car $DYOM_objective_model[$DYOM_idx] at $DYOM_objective_location_x[$DYOM_idx] $DYOM_objective_location_y[$DYOM_idx] $DYOM_objective_location_z[$DYOM_idx] 
        0175: set_car $DYOM_objective_handle[$DYOM_idx] Z_angle_to $DYOM_objective_location_a[$DYOM_idx] 
        0229: set_car $DYOM_objective_handle[$DYOM_idx] primary_color_to $DYOM_objective_data[$DYOM_idx] secondary_color_to $DYOM_objective_accuracy[$DYOM_idx] 
        0840: link_car $DYOM_objective_handle[$DYOM_idx] to_interior $DYOM_objective_interior[$DYOM_idx] 
        0249: release_model $DYOM_objective_model[$DYOM_idx]
        marker.CreateAboveCar($tempmarker,$DYOM_objective_handle[$DYOM_idx])
        
        car.DoorStatus($DYOM_objective_handle[$DYOM_idx]) = 4
        car.LockInCurrentPosition($DYOM_objective_handle[$DYOM_idx],TRUE)
        02AC: set_car $DYOM_objective_handle[$DYOM_idx] immunities BP 1 FP 1 EP 1 CP 1 MP 1 
        099A: set_car $DYOM_objective_handle[$DYOM_idx] collision_detection 0 

    END
    
    IF $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_marker 
    THEN
      // Display of the actual markers is handled by the spheres_thread, that will display the selected and the 3 nearest markers
      //
      $DYOM_objective_ammo[$DYOM_idx] = object.Init(#CIGAR_GLOW,$DYOM_objective_location_x[$DYOM_idx], $DYOM_objective_location_y[$DYOM_idx], $DYOM_objective_location_z[$DYOM_idx])
      Object.KeepInMemory($DYOM_objective_ammo[$DYOM_idx]) = True
      Object.ToggleInMovingList($DYOM_objective_ammo[$DYOM_idx]) = False
      Object.RemoveFromMissionCleanupList($DYOM_objective_ammo[$DYOM_idx])

      0566: link_object $DYOM_objective_ammo[$DYOM_idx] to_interior $DYOM_objective_interior[$DYOM_idx] 
     
      0188: $tempmarker = create_marker_above_object $DYOM_objective_ammo[$DYOM_idx] 
    END 
    
    
    IF $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_pickup 
    THEN
        if $DYOM_objective_ammo[$DYOM_idx] == 0
        then
            0213: $DYOM_objective_handle[$DYOM_idx] = create_pickup $DYOM_objective_model[$DYOM_idx] type 1 at $DYOM_objective_location_x[$DYOM_idx]  $DYOM_objective_location_y[$DYOM_idx]  $DYOM_objective_location_z[$DYOM_idx]
          else
            032B: $DYOM_objective_handle[$DYOM_idx] = create_weapon_pickup $DYOM_objective_model[$DYOM_idx] group 1 ammo $DYOM_objective_ammo[$DYOM_idx] at $DYOM_objective_location_x[$DYOM_idx]  $DYOM_objective_location_y[$DYOM_idx]  $DYOM_objective_location_z[$DYOM_idx] 
        end
        03DC: $tempmarker = create_marker_above_pickup $DYOM_objective_handle[$DYOM_idx]
        
    END
    IF or
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_actor 
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_teleport 
    THEN
        0980: extinguish_all_fires_at $DYOM_objective_location_x[$DYOM_idx] $DYOM_objective_location_y[$DYOM_idx] $DYOM_objective_location_z[$DYOM_idx] radius 1.0 

        //$actor_model_req -> $actor_model_loaded
        $actor_model_loaded = -1
        $actor_model_req = $DYOM_objective_model[$DYOM_idx]
        repeat
          wait 20
        until not $actor_model_loaded == -1


        $this_weapon = $DYOM_objective_data[$DYOM_idx]
        if $this_weapon == 48
        then
          $this_weapon = 0
        end
        model.Load($DYOM_Weapon_model[$this_weapon])                                                                                                              
        038B: load_requested_models                                                   
        repeat
          wait 0
        until model.Available($DYOM_Weapon_model[$this_weapon])     
        $DYOM_objective_handle[$DYOM_idx] = Actor.Create(DYOM_gang_neutral, $actor_model_loaded, $DYOM_objective_location_x[$DYOM_idx], $DYOM_objective_location_y[$DYOM_idx], $DYOM_objective_location_z[$DYOM_idx])
        0173: set_actor $DYOM_objective_handle[$DYOM_idx] Z_angle_to $DYOM_objective_location_a[$DYOM_idx]
        01B2: give_actor $DYOM_objective_handle[$DYOM_idx] $this_weapon ammo $DYOM_objective_ammo[$DYOM_idx] 
        0860: link_actor $DYOM_objective_handle[$DYOM_idx] to_interior $DYOM_objective_interior[$DYOM_idx]
        0575: set_actor $DYOM_objective_handle[$DYOM_idx] pinned_position 1 
        02AB: set_actor $DYOM_objective_handle[$DYOM_idx] immunities BP 1 FP 1 EP 1 CP 1 MP 1 
        0619: enable_actor $DYOM_objective_handle[$DYOM_idx] collision_detection 0 
        marker.CreateAboveActor($tempmarker,$DYOM_objective_handle[$DYOM_idx])
        
        model.Destroy($DYOM_Weapon_model[$this_weapon]) 
        gosub @generic_actor_unload
    END
    IF $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_cutscene 
    THEN
        $DYOM_objective_handle[$DYOM_idx] = object.init(#CAMERAPICKUP,$DYOM_objective_location_x[$DYOM_idx],$DYOM_objective_location_y[$DYOM_idx],$DYOM_objective_location_z[$DYOM_idx])
        0382: set_object $DYOM_objective_handle[$DYOM_idx] collision_detection 0 
        0188: $tempmarker = create_marker_above_object $DYOM_objective_handle[$DYOM_idx] 
        0566: link_object $DYOM_objective_handle[$DYOM_idx] to_interior $DYOM_objective_interior[$DYOM_idx]
    END    
    IF or 
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_countdown 
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_timeout 
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_weather
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_settime 
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_addmoney 
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_submoney 
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_animation 
    THEN
        $DYOM_objective_handle[$DYOM_idx] = object.init(#INFO,$DYOM_objective_location_x[$DYOM_idx],$DYOM_objective_location_y[$DYOM_idx],$DYOM_objective_location_z[$DYOM_idx])
        0382: set_object $DYOM_objective_handle[$DYOM_idx] collision_detection 0 
        0188: $tempmarker = create_marker_above_object $DYOM_objective_handle[$DYOM_idx] 
        0566: link_object $DYOM_objective_handle[$DYOM_idx] to_interior $DYOM_objective_interior[$DYOM_idx]
    END
    IF or 
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_peds
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_wanted
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_timelimit
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_timeron
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_noweapon
      $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_phone
    THEN
        $DYOM_objective_handle[$DYOM_idx] = object.init(#INFO,$DYOM_objective_location_x[$DYOM_idx],$DYOM_objective_location_y[$DYOM_idx],$DYOM_objective_location_z[$DYOM_idx])
        0382: set_object $DYOM_objective_handle[$DYOM_idx] collision_detection 0 
        0188: $tempmarker = create_marker_above_object $DYOM_objective_handle[$DYOM_idx] 
        0566: link_object $DYOM_objective_handle[$DYOM_idx] to_interior $DYOM_objective_interior[$DYOM_idx]
    END
    IF $DYOM_objective_type[$DYOM_idx] == DYOM_objtype_object
    THEN
        $DYOM_objective_handle[$DYOM_idx] = object.init($DYOM_objective_model[$DYOM_idx],$DYOM_objective_location_x[$DYOM_idx],$DYOM_objective_location_y[$DYOM_idx],$DYOM_objective_location_z[$DYOM_idx])
        0453: set_object $DYOM_objective_handle[$DYOM_idx] XY_rotation $DYOM_objective_ammo[$DYOM_idx] $DYOM_objective_accuracy[$DYOM_idx] angle $DYOM_objective_location_a[$DYOM_idx] 
        0188: $tempmarker = create_marker_above_object $DYOM_objective_handle[$DYOM_idx] 
        0566: link_object $DYOM_objective_handle[$DYOM_idx] to_interior $DYOM_objective_interior[$DYOM_idx]
    END

    $DYOM_idx += 1
    // after the increment... 
    if $DYOM_selected_obj == $DYOM_idx
    then
      marker.SetColor($tempmarker,4)
      //07E0: set_marker $tempmarker type_to 1  // BLUE
    else
      marker.SetColor($tempmarker,3)
    end
END   
 
//07E0: set_marker $DYOM_select_marker type_to 1  // BLUE
RETURN



//============================================================================
//============================================================================
//
//              D E S I G N I T E M S    C R E A T I O N 
//
//============================================================================
//============================================================================

//---------------------------------
// DEFINE PLAYER menu
//---------------------------------
var
 $health :integer
end
:PLAYER_MENU
    $player_cancel = 0
    Player.CanMove($PLAYER_CHAR) = False
    08D4: $menu = create_panel_with_title 'PLAYER' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'PROP' data 'READY' 'HEALTH' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
    
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
        $player_cancel = 1
        return                                              
    end
    
    if $menu_choice == 1
    then
        //---------------------------------
        // ADD ACTOR HEALTH menu
        //---------------------------------
        08D4: $menu = create_panel_with_title 'PROP' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'HEALTH' data '25' '50' '100' '150' '200' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
        
        gosub @GEN_MENU
        if $menu_canceled == 1
        then
          goto @PLAYER_MENU
        end
        
        if $menu_choice == 0
        then
            $health = 25
        end
        
        if $menu_choice == 1
        then
            $health = 50
        end
        
        if $menu_choice == 2
        then
            $health = 100
        end
        
        if $menu_choice == 3
        then
            $health = 150
        end
        
        if $menu_choice == 4
        then
            $health = 200
        end 
        jump @PLAYER_MENU
    end
    
    
    
    if $menu_choice == 0
    then
        //ready
        08DA: remove_panel $menu
        03E6: remove text box
        // And proceed 
    end
return




{
Dit zou als alternatief kunnen voor define player
Er moet dan nog wel een "move player here" menu optie bij, omdat je als speler anders heel ver moet lopen, en geen teleport enzo hebt.
Dus ook een player menu met 2 opties: edit player en "move player here"


//===============================
// Edit Player
//===============================
:EDIT_PLAYER
Player.CanMove($PLAYER_CHAR) = True
048F: actor $PLAYER_ACTOR remove_weapons 

// Remove Player_dummy, if already exist
if 056D:   actor $DYOM_player_handle defined 
then
  actor.DestroyInstantly($DYOM_player_handle)
end

$actor_model = $DYOM_player_model
$weapon_model = $DYOM_player_weapon
00A1: put_actor $PLAYER_ACTOR at $DYOM_player_location_x $DYOM_player_location_y $DYOM_player_location_z 
0173: set_actor $PLAYER_ACTOR Z_angle_to $DYOM_player_location_a
048F: actor $PLAYER_ACTOR remove_weapons 
$health      = $DYOM_player_health




$health = 100
gosub @SELECT_ACTOR_MODEL
if $actor_cancel == 1
then
    $actor_model = $DYOM_player_model
    00A1: put_actor $PLAYER_ACTOR at $DYOM_player_location_x $DYOM_player_location_y $DYOM_player_location_z 
    0173: set_actor $PLAYER_ACTOR Z_angle_to $DYOM_player_location_a
else
    gosub @SELECT_WEAPON_MODEL
    if $weapon_cancel == 1
    then
       $actor_model = $DYOM_player_model
       00A1: put_actor $PLAYER_ACTOR at $DYOM_player_location_x $DYOM_player_location_y $DYOM_player_location_z 
       0173: set_actor $PLAYER_ACTOR Z_angle_to $DYOM_player_location_a
       $weapon_model = $DYOM_player_weapon
    else
        gosub @PLAYER_MENU
        if $player_cancel == 1
        then
           $actor_model = $DYOM_player_model
           00A1: put_actor $PLAYER_ACTOR at $DYOM_player_location_x $DYOM_player_location_y $DYOM_player_location_z 
           0173: set_actor $PLAYER_ACTOR Z_angle_to $DYOM_player_location_a
           $weapon_model = $DYOM_player_weapon
           $health      = $DYOM_player_health
        end
    end    
end
Player.CanMove($PLAYER_CHAR) = False
fade 0 300
wait 300



04C4: store_coords_to $DYOM_player_location_x $DYOM_player_location_y $DYOM_player_location_z from_actor $PLAYER_ACTOR with_offset 0.0 0.0 -1.0 
//00A0: store_actor $PLAYER_ACTOR position_to $DYOM_player_location_x $DYOM_player_location_y $DYOM_player_location_z 
0172: $DYOM_player_location_a = actor $PLAYER_ACTOR Z_angle 
077E: get_active_interior_to $DYOM_player_interior

$DYOM_player_model = $actor_model
$DYOM_player_weapon = $weapon_model
$DYOM_player_ammo = 9999
$DYOM_player_health = $health

// restore player
04C4: store_coords_to $TEMPVAR_FLOAT_4 $TEMPVAR_FLOAT_5 $TEMPVAR_FLOAT_6 from_actor $PLAYER_ACTOR with_offset 0.0 -0.5 0.0 
00A1: put_actor $PLAYER_ACTOR at $TEMPVAR_FLOAT_4 $TEMPVAR_FLOAT_5 $TEMPVAR_FLOAT_6 
09C7: set_player $PLAYER_CHAR modelID_to #NULL
048F: actor $PLAYER_ACTOR remove_weapons 

// Spawn actor 
$DYOM_player_handle = Actor.Create(DYOM_gang_neutral, $actor_model_loaded, $DYOM_player_location_x, $DYOM_player_location_y, $DYOM_player_location_z)
0173: set_actor $DYOM_player_handle Z_angle_to $DYOM_player_location_a
01B2: give_actor $DYOM_player_handle $DYOM_player_weapon ammo $DYOM_player_ammo 
0860: link_actor $DYOM_player_handle to_interior $DYOM_player_interior

0575: set_actor $DYOM_player_handle pinned_position 1 
02AB: set_actor $DYOM_player_handle immunities BP 1 FP 1 EP 1 CP 1 MP 1 
gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
Player.CanMove($PLAYER_CHAR) = True
fade 1 500
00BB: show_text_lowpriority GXT 'DPLAYER' time 1000 flag 1 

return
}
//===============================
// Define Player
//===============================
:DEFINE_PLAYER
    Player.CanMove($PLAYER_CHAR) = True
    048F: actor $PLAYER_ACTOR remove_weapons  
    
    $health = 100
    gosub @SELECT_ACTOR_MODEL
    if $actor_cancel == 0
    then
        gosub @SELECT_WEAPON_MODEL 
        if $weapon_cancel == 0
        then
            gosub @PLAYER_MENU
        end
    end
    
    if or
       $actor_cancel == 1
       $weapon_cancel == 1
    then
      09C7: set_player $PLAYER_CHAR modelID_to #NULL 
      048F: actor $PLAYER_ACTOR remove_weapons 
      return
    end

    Player.CanMove($PLAYER_CHAR) = False
    fade 0 300
    wait 300    
    
    04C4: store_coords_to $DYOM_player_location_x $DYOM_player_location_y $DYOM_player_location_z from_actor $PLAYER_ACTOR with_offset 0.0 0.0 -1.0 
    0172: $DYOM_player_location_a = actor $PLAYER_ACTOR Z_angle 
    077E: get_active_interior_to $DYOM_player_interior
    
    $DYOM_player_model = $actor_model
    $DYOM_player_weapon = $weapon_model
    $DYOM_player_ammo = $weapon_ammo
    $DYOM_player_health = $health
    
    // restore player
    09C7: set_player $PLAYER_CHAR modelID_to #NULL
    048F: actor $PLAYER_ACTOR remove_weapons 
    
    // old player dummy remove and new actor will be spawned by recreating all objectives again 
    gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
    gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
    Player.CanMove($PLAYER_CHAR) = True
    fade 1 500
    00BB: show_text_lowpriority GXT 'DPLAYER' time 1000 flag 1 
return




var
  $markercolor : Integer
  $health : Integer
  $accuracy : Integer
  $gang : Integer
  $properties :Integer
  $mustlive :Integer
end
//---------------------------------
// ADD ACTOR menu
//---------------------------------
:ACTOR_MENU
    $actor_cancel = 0
    Player.CanMove($PLAYER_CHAR) = False
    08D4: $menu = create_panel_with_title 'ACTORS' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'PROP' data 'READY' 'HEALTH' 'GANGG' 'ACC' 'HEADS' 'MUSTL' 'BAR' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
    
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
        $actor_cancel = 1
        return                                              
    end
    
    if $menu_choice == 1
    then
        //---------------------------------
        // ADD ACTOR HEALTH menu
        //---------------------------------
        08D4: $menu = create_panel_with_title 'PROP' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'HEALTH' data '100' '250' '500' '1000' '2500' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
        
        gosub @GEN_MENU
        if $menu_canceled == 1
        then
          goto @ACTOR_MENU
        end
        
        if $menu_choice == 0
        then
            $health = 100
        end
        
        if $menu_choice == 1
        then
            $health = 250
        end
        
        if $menu_choice == 2
        then
            $health = 500
        end
        
        if $menu_choice == 3
        then
            $health = 1000
        end
        
        if $menu_choice == 4
        then
            $health = 2500
        end 
        jump @ACTOR_MENU
    end
    
    if $menu_choice == 2
    then
        //---------------------------------
        // ADD ACTOR GANG menu
        //---------------------------------
        08D4: $menu = create_panel_with_title 'PROP' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'GANGG' data 'NEUTRAL' 'FRIEND' 'ENEMY1' 'ENEMY2' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
        
        gosub @GEN_MENU
        if $menu_canceled == 1
        then
          goto @ACTOR_MENU
        end
        
        if $menu_choice == 0
        then
            $gang = DYOM_gang_neutral
            08C0: clear $properties bit DYOM_actorpropbit_aware 
            08C0: clear $properties  bit DYOM_actorpropbit_hold
            08C0: clear $properties  bit DYOM_actorpropbit_follow
        end
        
        if or
           $menu_choice == 2
           $menu_choice == 3
        then            
            if $menu_choice == 2
            then
                $gang = DYOM_gang_enemy
            else
                $gang = DYOM_gang_enemy2
            end
            //---------------------------------
            // ADD ACTOR enemy behaviour menu
            //---------------------------------
            08D4: $menu = create_panel_with_title 'ENEMY' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
            08DB: set_panel $menu column 0 header 'BEHAV' data 'NORMAL' 'HOLD' 'BEHA' 'BEHAH' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 
            
            gosub @GEN_MENU
            if $menu_canceled == 1
            then
              goto @ACTOR_MENU
            end
            
            if $menu_choice == 0
            then
                08C0: clear $properties bit DYOM_actorpropbit_aware 
                08C0: clear $properties  bit DYOM_actorpropbit_hold
                08C0: clear $properties  bit DYOM_actorpropbit_follow
            end
            
            if $menu_choice == 1
            then
                08C0: clear $properties bit DYOM_actorpropbit_aware 
                08BA: set $properties bit DYOM_actorpropbit_hold 
                08C0: clear $properties  bit DYOM_actorpropbit_follow
            end
            
            if $menu_choice == 2
            then
                08BA: set $properties bit DYOM_actorpropbit_aware 
                08C0: clear $properties bit DYOM_actorpropbit_hold
                08C0: clear $properties  bit DYOM_actorpropbit_follow
            end
            
            if $menu_choice == 3
            then
                08BA: set $properties bit DYOM_actorpropbit_aware 
                08BA: set $properties bit DYOM_actorpropbit_hold 
                08C0: clear $properties  bit DYOM_actorpropbit_follow
            end
            $menu_choice = 2 // restore toplevel choice   
        end
        
        if $menu_choice == 1
        then
            //---------------------------------
            // ADD ACTOR friend behaviour menu
            //---------------------------------
            08D4: $menu = create_panel_with_title 'FRIEND' position 29.0 170.0 width 220.0 columns 1 interactive 1 background 1 alignment 0  
            08DB: set_panel $menu column 0 header 'BEHAV' data 'NORMAL' 'HOLD' 'FOLLOW' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 
            
            gosub @GEN_MENU
            if $menu_canceled == 1
            then
              goto @ACTOR_MENU
            end
            
            if $menu_choice == 0    // NORMAL
            then
                08C0: clear $properties bit DYOM_actorpropbit_aware
                08C0: clear $properties bit DYOM_actorpropbit_hold
                08C0: clear $properties bit DYOM_actorpropbit_follow
            end
            
            if $menu_choice == 1    // HOLD
            then
                08C0: clear $properties bit DYOM_actorpropbit_aware
                08BA: set $properties bit DYOM_actorpropbit_hold 
                08C0: clear $properties bit DYOM_actorpropbit_follow
            end
            
            if $menu_choice == 2    // FOLLOW
            then
                08C0: clear $properties bit DYOM_actorpropbit_aware
                08C0: clear $properties bit DYOM_actorpropbit_hold 
                08BA: set $properties bit DYOM_actorpropbit_follow
            end
            
            $gang = DYOM_gang_friend
            $menu_choice = 1 // restore toplevel choice   
        end
        jump @ACTOR_MENU
    end
    
    
    if $menu_choice == 3
    then
        //---------------------------------
        // ADD ACTOR ACCURACY menu
        //---------------------------------
        08D4: $menu = create_panel_with_title 'PROP' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'ACC' data '10' '25' '50' '75' '100' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
        
        gosub @GEN_MENU
        if $menu_canceled == 1
        then
          goto @ACTOR_MENU
        end
        
        if $menu_choice == 0
        then
            $accuracy = 10
        end
        
        if $menu_choice == 1
        then
            $accuracy = 25
        end
        
        if $menu_choice == 2
        then
            $accuracy = 50
        end
        
        if $menu_choice == 3
        then
            $accuracy = 75
        end
        
        if $menu_choice == 4
        then
            $accuracy = 100
        end 
        jump @ACTOR_MENU
    end
    
    
    if $menu_choice == 4
    then
        //---------------------------------
        // ADD ACTOR HEADSHOT menu
        //---------------------------------
        08D4: $menu = create_panel_with_title 'PROP' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'HEADS' data 'ON' 'OFF' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
        gosub @GEN_MENU
        if $menu_canceled == 1
        then
          goto @ACTOR_MENU
        end
        if $menu_choice == 0
        then
          08C0: clear $properties bit DYOM_actorpropbit_headshot
        end   
        
        if $menu_choice == 1
        then
          08BA: set $properties bit DYOM_actorpropbit_headshot 
        end
        jump @ACTOR_MENU               
    end
    
    if $menu_choice == 5
    then
        //---------------------------------
        // ADD ACTOR MUSTLIVE menu
        //---------------------------------
        08D4: $menu = create_panel_with_title 'PROP' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'MUSTL' data 'ON' 'OFF' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
        gosub @GEN_MENU
        if $menu_canceled == 1
        then
          goto @ACTOR_MENU
        end
    
        $mustlive = 1
        $mustlive -= $menu_choice
        jump @ACTOR_MENU               
    end
    if $menu_choice == 6
    then
        //---------------------------------
        // ADD ACTOR BAR menu
        //---------------------------------
        08D4: $menu = create_panel_with_title 'PROP' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'BAR' data 'ON' 'OFF' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
        gosub @GEN_MENU
        if $menu_canceled == 1
        then
          goto @ACTOR_MENU
        end
    
        if $menu_choice == 0
        then
          08BA: set $properties bit DYOM_actorpropbit_bar 
        end
        if $menu_choice == 1
        then
          08C0: clear $properties bit DYOM_actorpropbit_bar
        end   
        
        jump @ACTOR_MENU               
    end
    
    if $menu_choice == 0
    then
        //ready
        08DA: remove_panel $menu
        03E6: remove text box
        // And proceed 
    end

return

:ACTOR_SET_LOCATION
    04C4: store_coords_to $DYOM_actor_location_x[$DYOM_idx] $DYOM_actor_location_y[$DYOM_idx] $DYOM_actor_location_z[$DYOM_idx] from_actor $PLAYER_ACTOR with_offset 0.0 0.0 -1.0 
    0172: $DYOM_actor_location_a[$DYOM_idx] = actor $PLAYER_ACTOR Z_angle 
    077E: get_active_interior_to $DYOM_actor_interior[$DYOM_idx]
return

:ACTOR_CLEAR_ROUTE
    if or 
          $DYOM_actor_animation[$DYOM_idx] == -4
          $DYOM_actor_animation[$DYOM_idx] == -5
          $DYOM_actor_animation[$DYOM_idx] == -6
    then
      if $DYOM_actor_distance[$DYOM_idx] < -500
      then
        0084: $point = $DYOM_actor_distance[$DYOM_idx]
        gosub @FREE_POINT_CHAIN
      end
    end
    if or 
          $DYOM_actor_animation[$DYOM_idx] == -2
          $DYOM_actor_animation[$DYOM_idx] == -3
          $DYOM_actor_animation[$DYOM_idx] == -9
          $DYOM_actor_animation[$DYOM_idx] == -10
          $DYOM_actor_animation[$DYOM_idx] == -11
    then
      0084: $point = $DYOM_actor_distance[$DYOM_idx]
      gosub @FREE_POINT_CHAIN
    end
return

:actor_add_duplicate 
    var
      $from : Integer
    end
    if and
      $DYOM_actor_count > 0
      DYOM_actor_max > $DYOM_actor_count
    then
        
        $from = $DYOM_actor_count
        $from -= 1
        $DYOM_actor_model[$DYOM_actor_count]      = $DYOM_actor_model[$from] 
        $DYOM_actor_gang[$DYOM_actor_count]       = $DYOM_actor_gang[$from] 
        $DYOM_actor_weapon[$DYOM_actor_count]     = $DYOM_actor_weapon[$from]
        $DYOM_actor_ammo[$DYOM_actor_count]       = $DYOM_actor_ammo[$from]
        $DYOM_actor_properties[$DYOM_actor_count] = $DYOM_actor_properties[$from]
        $DYOM_actor_health[$DYOM_actor_count]     = $DYOM_actor_health[$from] 
        $DYOM_actor_accuracy[$DYOM_actor_count]   = $DYOM_actor_accuracy[$from] 
        $DYOM_actor_spawnwith[$DYOM_actor_count]  = $DYOM_actor_spawnwith[$from]
        $DYOM_actor_hidewith[$DYOM_actor_count]   = $DYOM_actor_hidewith[$from]
        $DYOM_actor_mustlive[$DYOM_actor_count]   = $DYOM_actor_mustlive[$from]
        $DYOM_actor_animation[$DYOM_actor_count]  = $DYOM_actor_animation[$from]
        $DYOM_actor_distance[$DYOM_actor_count]   = $DYOM_actor_distance[$from]
        
        // DEEP COPY ROUTE
        //------------------------------------------
        // create copy of route
        
        0663: NOP "old_dist" $DYOM_actor_distance[$DYOM_actor_count]
        0084: $from = $DYOM_actor_distance[$DYOM_actor_count]
        while $from < 0
           $from += 1000
        end  
        if $from < DYOM_point_max
        then 
            0663: NOP "old_idx" $from
            $point = $from
            gosub @DUPLICATE_POINT_CHAIN        
            0663: NOP "new_idx" $point
            if $point >= 0
            then
              $point -= $from
              0663: NOP "diff_idx" $point
              0058: $DYOM_actor_distance[$DYOM_actor_count] += $point
            end
            0663: NOP "new_dist" $DYOM_actor_distance[$DYOM_actor_count]
        else
          0662: NOP "No points to copy"
        end
        //------------------------------------------

        fade 0 300
        wait 300
    
        $DYOM_idx = $DYOM_actor_count
        gosub @ACTOR_SET_LOCATION
        gosub @DUMMY_ACTOR 
    
        $DYOM_actor_count += 1
        Player.CanMove($PLAYER_CHAR) = True
        fade 1 500
        01E4: show_text_1number_lowpriority GXT 'NEWACT' number $DYOM_actor_count time 1000 flag 1 
    end
return


//===============================
// ADD ACTOR
//===============================
:ADDACTOR
    Player.CanMove($PLAYER_CHAR) = True
    048F: actor $PLAYER_ACTOR remove_weapons 
    
    $health = 100           
    $accuracy = 50      
    $markercolor = -1   
    $gang = DYOM_gang_enemy
    $properties = 0
    $mustlive = 0
    
    gosub @SELECT_ACTOR_MODEL
    if $actor_cancel == 0
    then
        gosub @SELECT_WEAPON_MODEL 
        if $weapon_cancel == 0
        then
            $anim_edit = 0
            gosub @SELECT_ANIMATION
            if $anim_cancel == 0
            then
                gosub @ACTOR_MENU
            end
        end
    end
    
    if or
       $actor_cancel == 1
       $weapon_cancel == 1
       $anim_cancel == 1
    then
      09C7: set_player $PLAYER_CHAR modelID_to #NULL 
      048F: actor $PLAYER_ACTOR remove_weapons 
      Player.CanMove($PLAYER_CHAR) = True
      return
    end
    
    
    fade 0 300
    wait 300
    
    $DYOM_idx = $DYOM_actor_count
    gosub @ACTOR_SET_LOCATION
    
    // restore player
    09C7: set_player $PLAYER_CHAR modelID_to #NULL
    048F: actor $PLAYER_ACTOR remove_weapons 
    
    //0663: "actor ammo" $weapon_ammo 
    
    $DYOM_actor_model[$DYOM_idx]           = $actor_model
    $DYOM_actor_animation[$DYOM_idx]       = $anim_id
    $DYOM_actor_distance[$DYOM_idx]        = $anim_dist
    $DYOM_actor_gang[$DYOM_idx]            = $gang
    $DYOM_actor_weapon[$DYOM_idx]          = $weapon_model
    $DYOM_actor_ammo[$DYOM_idx]            = $weapon_ammo
    $DYOM_actor_properties[$DYOM_idx]      = $properties
    $DYOM_actor_health[$DYOM_idx]          = $health
    $DYOM_actor_accuracy[$DYOM_idx]        = $accuracy
    $DYOM_actor_mustlive[$DYOM_idx]        = $mustlive
    $DYOM_actor_spawnwith[$DYOM_idx]       = $DYOM_selected_obj
    $DYOM_actor_hidewith[$DYOM_idx]        = 1000
    gosub @DUMMY_ACTOR 
    
    $DYOM_actor_count += 1
    
    
    Player.CanMove($PLAYER_CHAR) = True
    fade 1 500
    01E4: show_text_1number_lowpriority GXT 'NEWACT' number $DYOM_actor_count time 1000 flag 1 
     
return

//===============================
// SPAWN ACTOR
//===============================
:SPAWNACTOR
    Player.CanMove($PLAYER_CHAR) = True
    gosub @FIND_NEAR_ACTOR
    if $found == -1
    then
      return
    end
    
    067E: put_camera_on_actor $DYOM_actor_handle[$found] with_offset 0.0 2.0 2.0 point_to_actor $DYOM_actor_handle[$found] 0.0 mode 2 
    
    0512: permanent_text_box 'SACTHLP'  
    
    gosub @GEN_CONFIRM_ACTION
    if $confirm_canceled == 0
    then
      $DYOM_actor_spawnwith[$found] = $DYOM_selected_obj          
    end
return

//===============================
// HIDE ACTOR
//===============================
:HIDEACTOR
    Player.CanMove($PLAYER_CHAR) = True
    gosub @FIND_NEAR_ACTOR
    if $found == -1
    then
      return
    end
    
    067E: put_camera_on_actor $DYOM_actor_handle[$found] with_offset 0.0 2.0 2.0 point_to_actor $DYOM_actor_handle[$found] 0.0 mode 2 
    
    0512: permanent_text_box 'HACTHLP'  
    
    gosub @GEN_CONFIRM_ACTION
    if $confirm_canceled == 0
    then
      $DYOM_actor_hidewith[$found] = $DYOM_selected_obj               
    end
return

//===============================
// EDIT ACTOR
//===============================
:EDITACTOR
    Player.CanMove($PLAYER_CHAR) = True
    gosub @FIND_NEAR_ACTOR
    if $found == -1
    then
      return
    end
    $DYOM_idx = $found
    actor.DestroyInstantly($DYOM_actor_handle[$DYOM_idx])
    00A1: put_actor $PLAYER_ACTOR at $DYOM_actor_location_x[$DYOM_idx] $DYOM_actor_location_y[$DYOM_idx] $DYOM_actor_location_z[$DYOM_idx] 
    0173: set_actor $PLAYER_ACTOR Z_angle_to $DYOM_actor_location_a[$DYOM_idx]
    048F: actor $PLAYER_ACTOR remove_weapons 
    
    $actor_model  = $DYOM_actor_model[$DYOM_idx]
    $weapon_model = $DYOM_actor_weapon[$DYOM_idx]
    $weapon_ammo  = $DYOM_actor_ammo[$DYOM_idx]
    $health       = $DYOM_actor_health[$DYOM_idx]
    $accuracy     = $DYOM_actor_accuracy[$DYOM_idx] 
    $gang         = $DYOM_actor_gang[$DYOM_idx]
    $properties   = $DYOM_actor_properties[$DYOM_idx]
    $mustlive     = $DYOM_actor_mustlive[$DYOM_idx]
    $anim_id      = $DYOM_actor_animation[$DYOM_idx]
    $anim_dist    = $DYOM_actor_distance[$DYOM_idx]
    gosub @SELECT_ACTOR_MODEL
    if $actor_cancel == 0
    then
        gosub @SELECT_WEAPON_MODEL 
        if $weapon_cancel == 0
        then
            $anim_edit = 1
            gosub @SELECT_ANIMATION 
            if $anim_cancel == 0
            then
                gosub @ACTOR_MENU
                if $actor_cancel == 0
                then
                    //0663: "actor ammo" $weapon_ammo 
                    $DYOM_actor_model[$DYOM_idx]           = $actor_model
                    $DYOM_actor_weapon[$DYOM_idx]          = $weapon_model
                    $DYOM_actor_ammo[$DYOM_idx]            = $weapon_ammo
                    $DYOM_actor_animation[$DYOM_idx]       = $anim_id
                    if $anim_route == 2   //Extend route
                    then
                       0084: $last_point = $DYOM_actor_distance[$DYOM_idx]             
                       while $last_point < 0
                          $last_point += 1000
                       end
                       repeat
                          0663: printint "link" $last_point
                          if $DYOM_POINT_LINK[$last_point] < 0
                          then
                            while $anim_dist < 0
                              $anim_dist += 1000
                            end
                            0084: $DYOM_POINT_LINK[$last_point] = $anim_dist
                            0663: printint "attach" $anim_dist
                            break
                          end
                          $last_point = $DYOM_POINT_LINK[$last_point]
                        until false
                     else
                       if NOT $has_list == 1
                       then
                          gosub @ACTOR_CLEAR_ROUTE
                       end
                       $DYOM_actor_distance[$DYOM_idx]      = $anim_dist
                     end
    
                     $DYOM_actor_gang[$DYOM_idx]            = $gang
                     $DYOM_actor_properties[$DYOM_idx]      = $properties
                     $DYOM_actor_health[$DYOM_idx]          = $health
                     $DYOM_actor_accuracy[$DYOM_idx]        = $accuracy
                     $DYOM_actor_mustlive[$DYOM_idx]        = $mustlive
                     gosub @ACTOR_SET_LOCATION
                end
            end
        end
    end
    Player.CanMove($PLAYER_CHAR) = False
    
    fade 0 300
    wait 300
    
    
    // restore player
    00A1: put_actor $PLAYER_ACTOR at $DYOM_actor_location_x[$DYOM_idx] $DYOM_actor_location_y[$DYOM_idx] $DYOM_actor_location_z[$DYOM_idx] 
    0173: set_actor $PLAYER_ACTOR Z_angle_to $DYOM_actor_location_a[$DYOM_idx]
    09C7: set_player $PLAYER_CHAR modelID_to #NULL
    048F: actor $PLAYER_ACTOR remove_weapons 
    
    gosub @DUMMY_ACTOR 
    
    
    Player.CanMove($PLAYER_CHAR) = True
    fade 1 500
    //01E4: show_text_1number_lowpriority GXT 'NEWACT' number $found time 1000 flag 1 

return


:DELETE_ACTOR
    Player.CanMove($PLAYER_CHAR) = True
    gosub @FIND_NEAR_ACTOR
    if $found == -1
    then
      return
    end
    
    067E: put_camera_on_actor $DYOM_actor_handle[$found] with_offset 0.0 2.0 2.0 point_to_actor $DYOM_actor_handle[$found] 0.0 mode 2 
    
    0512: permanent_text_box 'DACTHLP'  
    
    gosub @GEN_CONFIRM_ACTION
    if $confirm_canceled == 1
    then
      return
    end
    actor.DestroyInstantly($DYOM_actor_handle[$found])
    
    // Remove routepoints if available
    $DYOM_idx = $found
    gosub @ACTOR_CLEAR_ROUTE
    
    // Shift remaining actors 1 position to the front
    var
      $this:integer
      $next:integer
      $last:integer
    end
    $last = $DYOM_actor_count
    $last -= 2
    for $this = $found to $last
      $next = $this
      $next += 1
      //  Copy actor $next to $this
        $DYOM_actor_model[$this]=        $DYOM_actor_model[$next]     
        $DYOM_actor_gang[$this]=         $DYOM_actor_gang[$next]        
        $DYOM_actor_location_x[$this]=   $DYOM_actor_location_x[$next]  
        $DYOM_actor_location_y[$this]=   $DYOM_actor_location_y[$next]  
        $DYOM_actor_location_z[$this]=   $DYOM_actor_location_z[$next]  
        $DYOM_actor_location_a[$this]=   $DYOM_actor_location_a[$next]  
        $DYOM_actor_interior[$this]=     $DYOM_actor_interior[$next]    
        $DYOM_actor_weapon[$this]=       $DYOM_actor_weapon[$next]      
        $DYOM_actor_ammo[$this]=         $DYOM_actor_ammo[$next]        
        $DYOM_actor_properties[$this]=   $DYOM_actor_properties[$next]   
        $DYOM_actor_health[$this]=       $DYOM_actor_health[$next]      
        $DYOM_actor_accuracy[$this]=     $DYOM_actor_accuracy[$next]    
        $DYOM_actor_spawnwith[$this]=    $DYOM_actor_spawnwith[$next]  
        $DYOM_actor_hidewith[$this]=     $DYOM_actor_hidewith[$next]  
        $DYOM_actor_mustlive[$this]=     $DYOM_actor_mustlive[$next]    
        $DYOM_actor_animation[$this]=    $DYOM_actor_animation[$next]    
        $DYOM_actor_distance[$this]=     $DYOM_actor_distance[$next]    
        $DYOM_actor_handle[$this]=       $DYOM_actor_handle[$next]      
    end 
   
    if $DYOM_objective_count > 0
    then
        $last = $DYOM_objective_count
        $last -= 1
        for $this = 0 to $last
          if and
              $DYOM_objective_type[$this] == DYOM_objtype_cutscene
              $DYOM_objective_properties[$this] >= DYOM_cutscene_actor
              $DYOM_objective_animation[$this] > $found
          then
              $DYOM_objective_animation[$this] += -1
          end
        end
    end
   
    $DYOM_actor_count -= 1  
return   


//---------------
// CAR MENU
//---------------
var
   $car_health: Integer
   $car_seat: Integer
   $car_properties: Integer
   $car_mustlive: Integer
end
:CARMENU
Player.CanMove($PLAYER_CHAR) = False
    08D4: $menu = create_panel_with_title 'CARS' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'PROP' data 'READY' 'HEALTH' 'MUSTL' 'BPROOF' 'EPROOF' 'DPROOF' 'TINV' 'LOCK' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
    
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
        $car_cancel = 1 
        return                                              
    end
    
    if $menu_choice == 1
    then
        //---------------------------------
        // ADD CAR HEALTH menu
        //---------------------------------
        08D4: $menu = create_panel_with_title 'PROP' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'HEALTH' data '100' '250' '500' '1000' '2500' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
        
        gosub @GEN_MENU
        if $menu_canceled == 1
        then
          goto @CARMENU
        end
        
        if $menu_choice == 0
        then
            $car_health = 100
        end
        
        if $menu_choice == 1
        then
            $car_health = 250
        end
        
        if $menu_choice == 2
        then
            $car_health = 500
        end
        
        if $menu_choice == 3
        then
            $car_health = 1000
        end
        
        if $menu_choice == 4
        then
            $car_health = 2500
        end 
        $menu_choice = 1 // restore toplevel choice
    end
    
    if $menu_choice == 2
    then
        //---------------------------------
        // ADD CAR MUSTLIVE
        //---------------------------------
        08D4: $menu = create_panel_with_title 'PROP' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'MUSTL' data 'YES' 'NO' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
        
        gosub @GEN_MENU
        if $menu_canceled == 1
        then
          goto @CARMENU
        end
        
        $car_mustlive = 1
        $car_mustlive -= $menu_choice
    
        $menu_choice = 2 // restore toplevel choice
    end
    
    if $menu_choice == 3
    then
        //---------------------------------
        // CAR BULLETPROOF
        //---------------------------------
        08D4: $menu = create_panel_with_title 'PROP' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'BPROOF' data 'YES' 'NO' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'
      
        gosub @GEN_MENU
        if $menu_canceled == 1
        then
          goto @CARMENU
        end
        
        if $menu_choice == 0
        then
            08BA: set $car_properties bit DYOM_carpropbit_bulletproof 
        else
            08C0: clear $car_properties bit DYOM_carpropbit_bulletproof  
        end
        $menu_choice = 3 // restore toplevel choice
    end
    
    if $menu_choice == 4
    then
        //---------------------------------
        // CAR EXPLOSIONPROOF
        //---------------------------------
        08D4: $menu = create_panel_with_title 'PROP' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'EPROOF' data 'YES' 'NO' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'
      
        gosub @GEN_MENU
        if $menu_canceled == 1
        then
          goto @CARMENU
        end
        
        if $menu_choice == 0
        then
            08BA: set $car_properties bit DYOM_carpropbit_explproof 
        else
             08C0: clear $car_properties bit DYOM_carpropbit_explproof  
        end
        $menu_choice = 4 // restore toplevel choice
    end
    
    if $menu_choice == 5
    then
        //---------------------------------
        // CAR DAMAGEPROOF
        //---------------------------------
        08D4: $menu = create_panel_with_title 'PROP' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'DPROOF' data 'YES' 'NO' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'
      
        gosub @GEN_MENU
        if $menu_canceled == 1
        then
          goto @CARMENU
        end
        
        if $menu_choice == 0
        then
            08BA: set $car_properties bit DYOM_carpropbit_damproof 
        else
             08C0: clear $car_properties bit DYOM_carpropbit_damproof  
        end
        $menu_choice = 5 // restore toplevel choice
    end
    
    if $menu_choice == 6
    then
        //---------------------------------
        // CAR TIRES
        //---------------------------------
        08D4: $menu = create_panel_with_title 'PROP' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'TINV' data 'YES' 'NO' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'
      
        gosub @GEN_MENU
        if $menu_canceled == 1
        then
          goto @CARMENU
        end
        
        if $menu_choice == 0
        then
            08BA: set $car_properties bit DYOM_carpropbit_popproof 
        else
            08C0: clear $car_properties bit DYOM_carpropbit_popproof  
        end
        $menu_choice = 6 // restore toplevel choice
    end
    
    if $menu_choice == 7
    then
        //---------------------------------
        // CAR LOCKED
        //---------------------------------
        08D4: $menu = create_panel_with_title 'PROP' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'LOCK' data 'YES' 'NO' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'
      
        gosub @GEN_MENU
        if $menu_canceled == 1
        then
          goto @CARMENU
        end
        
        if $menu_choice == 0
        then
            08BA: set $car_properties bit DYOM_carpropbit_locked 
        else
            08C0: clear $car_properties bit DYOM_carpropbit_locked  
        end
        $menu_choice = 7 // restore toplevel choice
    end
        
    if $menu_choice == 0
    then
        08DA: remove_panel $menu
        03E6: remove text box 
        return    
    end  
    jump @CARMENU
// CARMENU_END    


:CAR_SET_LOCATION
    0407: store_coords_to $DYOM_car_location_x[$DYOM_idx] $DYOM_car_location_y[$DYOM_idx] $DYOM_car_location_z[$DYOM_idx] from_car $car with_offset 0.0 0.0 -1.0 
    0174: $DYOM_car_location_a[$DYOM_idx]  = car $car Z_angle 
    077E: get_active_interior_to $DYOM_car_interior[$DYOM_idx]
return

//===============================
// ADD CAR
//===============================
:ADDCAR
    $car_health = 1000
    $car_properties = 0
    $car_mustlive = 0
    $DYOM_idx = $DYOM_car_count
    
    gosub @SELECT_CAR_MODEL
    if $car_cancel == 0
    then
        if 00DB:   actor $PLAYER_ACTOR in_car $car 
        then
          00AA: store_car $car position_to 21@ 22@ 23@ 
          02CE: 24@ = ground_z_at 21@ 22@ 23@ 
          0063: 23@ -= 24@ 
          if 23@ < 5.0
          then
            05CD: AS_actor $PLAYER_ACTOR exit_car $car 
            repeat
               wait 0
            until 80DB: NOT  actor $PLAYER_ACTOR in_car $car  
          else
            0362: remove_actor $PLAYER_ACTOR from_car_and_place_at 21@ 22@ 24@
          end
          
        end
        gosub @CARMENU
    end
    
    if $car_cancel == 1
    then
      00A6: destroy_car $car
      return
    end
    
    gosub @CAR_SET_LOCATION

    $DYOM_car_model[$DYOM_idx]             = $car_model     
    $DYOM_car_health[$DYOM_idx]            = $car_health
    $DYOM_car_properties[$DYOM_idx]        = $car_properties
    $DYOM_car_color1[$DYOM_idx]            = $car_color
    $DYOM_car_color2[$DYOM_idx]            = $car_color2
    $DYOM_car_mustlive[$DYOM_idx]          = $car_mustlive
    
    $DYOM_car_spawnwith[$DYOM_idx]         = $DYOM_selected_obj
    $DYOM_car_hidewith[$DYOM_idx]          = 1000
    
    00A6: destroy_car $car
    gosub @DUMMY_CAR
    $DYOM_car_count += 1
    
    01E4: show_text_1number_lowpriority GXT 'NEWCAR' number $DYOM_car_count time 1000 flag 1 
return

//===============================
// SPAWN CAR
//===============================
:SPAWNCAR
    Player.CanMove($PLAYER_CHAR) = True
    gosub @FIND_NEAR_CAR
    if $found == -1
    then
      return
    end
    
    067A: put_camera_on_car $DYOM_car_handle[$found] with_offset 0.0 5.0 4.0 point_to_car $DYOM_car_handle[$found] tilt 0.0 2 
    
    0512: permanent_text_box 'SCARHLP'  
    
    gosub @GEN_CONFIRM_ACTION
    if $confirm_canceled == 0
    then
      $DYOM_car_spawnwith[$found] = $DYOM_selected_obj
    end
    
return

//===============================
// HIDE CAR
//===============================
:HIDECAR
    Player.CanMove($PLAYER_CHAR) = True
    gosub @FIND_NEAR_CAR
    if $found == -1
    then
      return
    end
    
    067A: put_camera_on_car $DYOM_car_handle[$found] with_offset 0.0 5.0 4.0 point_to_car $DYOM_car_handle[$found] tilt 0.0 2 
    
    0512: permanent_text_box 'HCARHLP'  
    
    gosub @GEN_CONFIRM_ACTION
    if $confirm_canceled == 0
    then
      $DYOM_car_hidewith[$found] = $DYOM_selected_obj
    end
    
return


//===============================
// EDIT CAR
//===============================
:EDITCAR
    gosub @FIND_NEAR_CAR
    if $found == -1
    then
      return
    end
    
    $DYOM_idx = $found
    $TEMPVAR_FLOAT_1 = $DYOM_car_location_x[$DYOM_idx]
    $TEMPVAR_FLOAT_2 = $DYOM_car_location_y[$DYOM_idx]
    $TEMPVAR_FLOAT_3 = $DYOM_car_location_z[$DYOM_idx] 
    $TEMP_INTERIOR   = $DYOM_car_interior[$DYOM_idx] 
    $TEMPVAR_ANGLE   = $DYOM_car_location_a[$DYOM_idx]
    
    $car_health      = $DYOM_car_health[$DYOM_idx]
    $car_properties  = $DYOM_car_properties[$DYOM_idx] 
    $car_mustlive    = $DYOM_car_mustlive[$DYOM_idx]
    $car_model       = $DYOM_car_model[$DYOM_idx] 
    $car_color       = $DYOM_car_color1[$DYOM_idx]
    $car_color2      = $DYOM_car_color2[$DYOM_idx] 
    
    06BA: AS_actor $PLAYER_ACTOR turn_to_and_look_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3
    wait 1000
    0373: set_camera_directly_behind_player 
    02EB: restore_camera_with_jumpcut
    
    car.Destroy($DYOM_car_handle[$DYOM_idx])
    
    gosub @SELECT_CAR_MODEL_EDIT
    if $car_cancel == 0
    then
        if 00DB:   actor $PLAYER_ACTOR in_car $car 
        then
          00AA: store_car $car position_to 21@ 22@ 23@ 
          02CE: 24@ = ground_z_at 21@ 22@ 23@  
          0063: 23@ -= 24@ 
          if 23@ < 5.0
          then
            05CD: AS_actor $PLAYER_ACTOR exit_car $car 
            repeat
               wait 0
            until 80DB: NOT  actor $PLAYER_ACTOR in_car $car  
          else
            0362: remove_actor $PLAYER_ACTOR from_car_and_place_at 21@ 22@ 24@
          end
        end
        gosub @CARMENU 
        if $car_cancel == 0
        then
            gosub @CAR_SET_LOCATION
            $DYOM_car_health[$DYOM_idx]            = $car_health
            $DYOM_car_properties[$DYOM_idx]        = $car_properties
            $DYOM_car_mustlive[$DYOM_idx]          = $car_mustlive
            $DYOM_car_model[$DYOM_idx]             = $car_model  
            $DYOM_car_color1[$DYOM_idx]            = $car_color
            $DYOM_car_color2[$DYOM_idx]            = $car_color2           
        end
    end
    Player.CanMove($PLAYER_CHAR) = False
    
    car.Destroy($car)
    gosub @DUMMY_CAR
return



:DELETE_CAR
    Player.CanMove($PLAYER_CHAR) = True
    gosub @FIND_NEAR_CAR
    if $found == -1
    then
      return
    end
    
    067A: put_camera_on_car $DYOM_car_handle[$found] with_offset 0.0 5.0 4.0 point_to_car $DYOM_car_handle[$found] tilt 0.0 2 
    
    0512: permanent_text_box 'DCARHLP'  
    
    gosub @GEN_CONFIRM_ACTION
    if $confirm_canceled == 1
    then
      return
    end
    
    car.Destroy($DYOM_car_handle[$found])
    var
      $this:integer
      $next:integer
      $last:integer
    end
    $last = $DYOM_car_count
    $last -= 2
    for $this = $found to $last
        $next = $this
        $next += 1
        //  Copy car $next to $this
        $DYOM_car_model[$this]=           $DYOM_car_model[$next]     
        $DYOM_car_color1[$this]=          $DYOM_car_color1[$next]     
        $DYOM_car_color2[$this]=          $DYOM_car_color2[$next]     
        $DYOM_car_location_x[$this]=      $DYOM_car_location_x[$next] 
        $DYOM_car_location_y[$this]=      $DYOM_car_location_y[$next] 
        $DYOM_car_location_z[$this]=      $DYOM_car_location_z[$next] 
        $DYOM_car_location_a[$this]=      $DYOM_car_location_a[$next] 
        $DYOM_car_interior[$this]=        $DYOM_car_interior[$next]   
        $DYOM_car_health[$this]=          $DYOM_car_health[$next]     
        $DYOM_car_properties[$this]=      $DYOM_car_properties[$next] 
        $DYOM_car_spawnwith[$this]=       $DYOM_car_spawnwith[$next] 
        $DYOM_car_hidewith[$this]=        $DYOM_car_hidewith[$next] 
        $DYOM_car_mustlive[$this]=        $DYOM_car_mustlive[$next]   
        $DYOM_car_handle[$this]=          $DYOM_car_handle[$next]              
    end  
    $DYOM_car_count -= 1        
return
    

//===============================
// PICKUP HELPERS
//===============================
:PICKUP_CAM
    $TEMPVAR_FLOAT_3 = $DYOM_pickup_location_z[$DYOM_idx]
    $TEMPVAR_FLOAT_3 += 2.0
    015F: set_camera_position $DYOM_pickup_location_x[$DYOM_idx] $DYOM_pickup_location_y[$DYOM_idx] $TEMPVAR_FLOAT_3 rotation 0.0 0.0 0.0 
    0160: set_camera_point_at $DYOM_pickup_location_x[$DYOM_idx] $DYOM_pickup_location_y[$DYOM_idx] $DYOM_pickup_location_z[$DYOM_idx] mode 2 
return

:PICKUP_COPY_OUT
    $TEMPVAR_FLOAT_1 = $DYOM_pickup_location_x[$DYOM_idx]
    $TEMPVAR_FLOAT_2 = $DYOM_pickup_location_y[$DYOM_idx]
    $TEMPVAR_FLOAT_3 = $DYOM_pickup_location_z[$DYOM_idx] 
    $pickup_model = $DYOM_pickup_model[$DYOM_idx]
    $pickup_ammo = $DYOM_pickup_ammo[$DYOM_idx]
    $pickup_mode = $DYOM_pickup_mode[$DYOM_idx]
return

:PICKUP_COPY_IN
    $DYOM_pickup_location_x[$DYOM_idx] = $TEMPVAR_FLOAT_1
    $DYOM_pickup_location_y[$DYOM_idx] = $TEMPVAR_FLOAT_2 
    $DYOM_pickup_location_z[$DYOM_idx] = $TEMPVAR_FLOAT_3
    $DYOM_pickup_model[$DYOM_idx] = $pickup_model
    $DYOM_pickup_ammo[$DYOM_idx] = $pickup_ammo
    $DYOM_pickup_mode[$DYOM_idx] = $pickup_mode
return


//===============================
// ADD PICKUP
//===============================
:ADDPICKUP
    Player.CanMove($PLAYER_CHAR) = False
    04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 1.5 0.0
    
    gosub @SELECT_PICKUP_MODEL
    if $pickup_cancel == 0
    then
        gosub @SELECT_PICKUP_MODE
    end  
    
    if $pickup_cancel == 1
    then
      Player.CanMove($PLAYER_CHAR) = True
      return
    end
    
    $DYOM_idx = $DYOM_pickup_count
    gosub @PICKUP_COPY_IN 
    
    pickup.Destroy($pickup)
    gosub @DUMMY_PICKUP
    $DYOM_pickup_spawnwith[$DYOM_idx] = $DYOM_selected_obj
    $DYOM_pickup_hidewith[$DYOM_idx] = 1000
    
    $DYOM_pickup_count += 1 
    01E4: show_text_1number_lowpriority GXT 'NEWPU' number $DYOM_pickup_count time 1000 flag 1 
    Player.CanMove($PLAYER_CHAR) = True
return


//===============================
// SPAWN PICKUP
//===============================
:SPAWNPICKUP
    Player.CanMove($PLAYER_CHAR) = True
    gosub @FIND_NEAR_PICKUP
    if $found == -1
    then
      return
    end
    $DYOM_idx = $found
    gosub @PICKUP_CAM
    0512: permanent_text_box 'SPUHLP'  
    
    gosub @GEN_CONFIRM_ACTION
    if $confirm_canceled == 0
    then
       $DYOM_pickup_spawnwith[$found] = $DYOM_selected_obj               
    end
return

//===============================
// HIDE PICKUP
//===============================
:HIDEPICKUP
    Player.CanMove($PLAYER_CHAR) = True
    gosub @FIND_NEAR_PICKUP
    if $found == -1
    then
      return
    end
    $DYOM_idx = $found
    gosub @PICKUP_CAM
    0512: permanent_text_box 'HPUHLP'  
    
    gosub @GEN_CONFIRM_ACTION
    if $confirm_canceled == 0
    then
       $DYOM_pickup_hidewith[$found] = $DYOM_selected_obj               
    end
return

//===============================
// EDIT PICKUP
//===============================
:EDITPICKUP
    Player.CanMove($PLAYER_CHAR) = False
    gosub @FIND_NEAR_PICKUP
    if $found == -1
    then
      return
    end
    
    $pickup = $DYOM_pickup_handle[$found]
    $DYOM_idx = $found
    gosub @PICKUP_COPY_OUT
    
    06BA: AS_actor $PLAYER_ACTOR turn_to_and_look_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3
    wait 1000
    0373: set_camera_directly_behind_player 
    02EB: restore_camera_with_jumpcut
    
    gosub @SELECT_PICKUP_MODEL
    if $pickup_cancel == 0
    then
        gosub @SELECT_PICKUP_MODE
    end
    
    if $pickup_cancel == 0
    then
        gosub @PICKUP_COPY_IN 
    end
    
    pickup.Destroy($pickup)  
    gosub @DUMMY_PICKUP
    
    Player.CanMove($PLAYER_CHAR) = True
return

//===============================
// DELETE PICKUP
//===============================
:DELETE_PICKUP
    Player.CanMove($PLAYER_CHAR) = True
    gosub @FIND_NEAR_PICKUP
    if $found == -1
    then
      return
    end
    $DYOM_idx = $found
    gosub @PICKUP_CAM
    0512: permanent_text_box 'DPUHLP'  
    
    gosub @GEN_CONFIRM_ACTION
    if $confirm_canceled == 1
    then
      return
    end
    
    pickup.Destroy($DYOM_pickup_handle[$found])
    var
      $this:integer
      $next:integer
      $last:integer
    end
    $last = $DYOM_pickup_count
    $last -= 2
    for $this = $found to $last
        $next = $this
        $next += 1
        //  Copy pickup $next to $this
        $DYOM_pickup_model[$this]=                $DYOM_pickup_model[$next]       
        $DYOM_pickup_ammo[$this]=                 $DYOM_pickup_ammo[$next]        
        $DYOM_pickup_mode[$this]=                 $DYOM_pickup_mode[$next]        
        $DYOM_pickup_location_x[$this]=           $DYOM_pickup_location_x[$next]  
        $DYOM_pickup_location_y[$this]=           $DYOM_pickup_location_y[$next]  
        $DYOM_pickup_location_z[$this]=           $DYOM_pickup_location_z[$next]  
        $DYOM_pickup_spawnwith[$this]=            $DYOM_pickup_spawnwith[$next]  
        $DYOM_pickup_hidewith[$this]=             $DYOM_pickup_hidewith[$next]  
        $DYOM_pickup_handle[$this]=               $DYOM_pickup_handle[$next]                    
    end  
    $DYOM_pickup_count -= 1    
return
    

//---------------
// OBJECT MENU
//---------------
var
   $object_cancel:int 
end
:OBJECTMENU
    Player.CanMove($PLAYER_CHAR) = False
    if $OBJ_P < 0
    then
        08D4: $menu = create_panel_with_title 'OBJECTS' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'PROP' data 'READY' 'MOVEP' 'OPATH' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
        
        gosub @GEN_MENU
        if $menu_canceled == 1
        then
            $object_cancel = 1 
            goto @OBJ_EXIT
        end
        $OBJ_M = $menu_choice
    end
    
    if $OBJ_M == 1
    then
        gosub @SELECT_OBJECT_DISTANCE
        if $object_cancel == 1
        then
          goto @OBJ_EXIT
        end
        
        if not $object_model == -16
        then
            0108: destroy_object $object
            if AND
               $object_model < -387 
               $object_model > -455
            then
                0976: destroy_particle $objecteffect
            end                

        else
            if 0973:   fire $object exists 
            then
                02D1: remove_fire $object 
            end
        end

        if $OBJ_P >= 0
        then
            $found = $OBJ_P
            $TEMPVAR_FLOAT_1 = $DYOM_POINT_X[$found]
            $TEMPVAR_FLOAT_2 = $DYOM_POINT_Y[$found]
            $TEMPVAR_FLOAT_3 = $DYOM_POINT_Z[$found]
            $found           = $DYOM_POINT_LINK[$found]
            $TEMPVAR_ANGLE_X = $DYOM_POINT_X[$found]
            $TEMPVAR_ANGLE_Y = $DYOM_POINT_Y[$found]
            $TEMPVAR_ANGLE   = $DYOM_POINT_Z[$found]
        end
        gosub @MOVE_OBJECT
        if $object_cancel == 1
        then
          goto @OBJ_EXIT
        end
        
        0512: permanent_text_box 'OBJTIM'
        gosub @SELECT_SPECIAL_DURATION
        if $time_cancel == 1
        then
          $object_cancel = 1
          goto @OBJ_EXIT
        end
    end
    

    if $OBJ_M > 1
    then
        08D4: $menu = create_panel_with_title 'OBJECTS' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'PROP' data 'MOVES' 'MOVEN' 'MOVEF' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
        gosub @GEN_MENU
        if $menu_canceled == 1
        then
            $object_cancel = 1 
            goto @OBJ_EXIT
        end
        $OBJ_M = $menu_choice
        $OBJ_M += 2

        if not $object_model == -16
        then
            0108: destroy_object $object
            if AND
               $object_model < -387 
               $object_model > -455
            then
                0976: destroy_particle $objecteffect
            end                

        else
            if 0973:   fire $object exists 
            then
                02D1: remove_fire $object 
            end
        end
        $OBJ_P = -1
        gosub @ROUTE_OBJECT
        if $object_cancel == 1
        then
          0084: $point = $found
          gosub @FREE_POINT_CHAIN                

          goto @OBJ_EXIT
        end
    end
    :OBJ_EXIT
    if not $object_model == -16
    then
        0108: destroy_object $object
        if AND
           $object_model < -387 
           $object_model > -455
        then
            0976: destroy_particle $objecteffect
        end                

    else
        if 0973:   fire $object exists 
        then
            02D1: remove_fire $object 
        end
    end
    return    
// OBJECTMENU_END  
  
//===============================
// OBJECT HELPERS
//===============================
:OBJECT_CAM
    $TEMPVAR_FLOAT_1 = $DYOM_object_location_x[$DYOM_idx]
    $TEMPVAR_FLOAT_2 = $DYOM_object_location_y[$DYOM_idx]
    $TEMPVAR_FLOAT_3 = $DYOM_object_location_z[$DYOM_idx]
    $TEMPVAR_FLOAT_1 += 8.0
    $TEMPVAR_FLOAT_3 += 4.0
    
    015F: set_camera_position $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 rotation 0.0 0.0 0.0 
    0160: set_camera_point_at $DYOM_object_location_x[$DYOM_idx] $DYOM_object_location_y[$DYOM_idx] $DYOM_object_location_z[$DYOM_idx] mode 2 
return

:OBJECT_DESTROY
    if not $DYOM_object_model[$DYOM_idx] == -16
    then
        object.Destroy($DYOM_object_handle[$DYOM_idx])
        if AND
           $DYOM_object_model[$DYOM_idx] < -387 
           $DYOM_object_model[$DYOM_idx] > -455
        then
            0976: destroy_particle $DYOM_object_location_rz[$DYOM_idx]
        end                
    else
        if 0973:   fire $DYOM_object_handle[$DYOM_idx] exists 
        then
            02D1: remove_fire $DYOM_object_handle[$DYOM_idx] 
        end
    end

return

var
  $TF10:float
  $TF11:float
  $TF12:float
  $TF13:float
  $TF14:float
  $TF15:float
end
//===============================
// ADD OBJECT
//===============================
:ADDOBJECT
    04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 7.0 0.0
    $TEMPVAR_ANGLE = actor.Angle($PLAYER_ACTOR)
    $TEMPVAR_ANGLE += 90.0
    $TEMPVAR_ANGLE_X = 0.0
    $TEMPVAR_ANGLE_Y = 0.0
    $OBJ_M = 0 
    gosub @SELECT_OBJECT
    if $object_cancel == 1
    then
      return
    end  
    $TF10 = $TEMPVAR_FLOAT_1
    $TF11 = $TEMPVAR_FLOAT_2
    $TF12 = $TEMPVAR_FLOAT_3
    $TF13 = $TEMPVAR_ANGLE_X
    $TF14 = $TEMPVAR_ANGLE_Y
    $TF15 = $TEMPVAR_ANGLE
    
    $time_value = 2000
    $object_dist = 5.0
    $OBJ_P = -1
    if and
        $object_model < -16
        $object_model > -388
    then
      gosub @OBJECTMENU
    else
        if not $object_model == -16
        then
            if 03CA:   object $object exists 
            then 
                object.Destroy($object)
                if AND
                   $object_model < -387 
                   $object_model > -455
                then
                    0976: destroy_particle $objecteffect
                end                
            end
        else
            if 0973:   fire $object exists 
            then
                02D1: remove_fire $object 
            end
        end
    end    
    if $object_cancel == 1
    then
      return
    end          
    
    $DYOM_idx = $DYOM_object_count    
    077E: get_active_interior_to $DYOM_object_interior[$DYOM_idx]
    
    if $OBJ_M == 1
    then
        $DYOM_object_interior[$DYOM_idx] += 1000000  // Set proxmove
        gosub @FIND_FREE_POINT
        $DYOM_POINT_X[$empty_point] = $TEMPVAR_FLOAT_1          
        $DYOM_POINT_Y[$empty_point] = $TEMPVAR_FLOAT_2
        $DYOM_POINT_Z[$empty_point] = $TEMPVAR_FLOAT_3 
        $DYOM_POINT_LINK[$empty_point] = -1
        $OBJ_P = $empty_point
        gosub @FIND_FREE_POINT
        $DYOM_POINT_LINK[$OBJ_P] = $empty_point
        $DYOM_POINT_X[$empty_point] = $TEMPVAR_ANGLE_X          
        $DYOM_POINT_Y[$empty_point] = $TEMPVAR_ANGLE_Y
        $DYOM_POINT_Z[$empty_point] = $TEMPVAR_ANGLE
        $DYOM_POINT_LINK[$empty_point] = -1
        $OBJ_M = $empty_point
        gosub @FIND_FREE_POINT
        $DYOM_POINT_LINK[$OBJ_M] = $empty_point
        008D: $DYOM_POINT_X[$empty_point] = integer $time_value to_float 
        $DYOM_POINT_X[$empty_point] /= 1000.0
        $DYOM_POINT_Y[$empty_point] = $object_dist
        $DYOM_POINT_Z[$empty_point] = 0.0
        $DYOM_POINT_LINK[$empty_point] = -1
        $OBJ_P *= 1000
        $DYOM_object_interior[$DYOM_idx] += $OBJ_P
        0663: "comb" $DYOM_object_interior[$DYOM_idx]
    else
        if $OBJ_M > 1
        then
            $OBJ_M *= 1000000
            $DYOM_object_interior[$DYOM_idx] += $OBJ_M  // Set permmove
            $OBJ_P *= 1000
            $DYOM_object_interior[$DYOM_idx] += $OBJ_P
            0663: "comb" $DYOM_object_interior[$DYOM_idx]                     
        end
    end
    $DYOM_object_model[$DYOM_idx] = $object_model
    $DYOM_object_location_x[$DYOM_idx] = $TF10
    $DYOM_object_location_y[$DYOM_idx] = $TF11 
    $DYOM_object_location_z[$DYOM_idx] = $TF12
    $DYOM_object_location_rx[$DYOM_idx] = $TF13
    $DYOM_object_location_ry[$DYOM_idx] = $TF14
    $DYOM_object_location_rz[$DYOM_idx] = $TF15
    
    gosub @DUMMY_OBJECT
    $DYOM_object_spawnwith[$DYOM_idx] = $DYOM_selected_obj
    $DYOM_object_hidewith[$DYOM_idx] = 1000
    $DYOM_object_count += 1
     
    01E4: show_text_1number_lowpriority GXT 'NEWOB' number $DYOM_object_count time 1000 flag 1 
return

//===============================
// SPAWN OBJECT
//===============================
:SPAWNOBJECT
    gosub @FIND_NEAR_OBJECT
    if $found == -1
    then
      return
    end
    $DYOM_idx = $found
    gosub @OBJECT_CAM
    0512: permanent_text_box 'SOBHLP'  
    
    gosub @GEN_CONFIRM_ACTION
    if $confirm_canceled == 0
    then
      $DYOM_object_spawnwith[$DYOM_idx] = $DYOM_selected_obj
    end    
return

//===============================
// HIDE OBJECT
//===============================
:HIDEOBJECT
    gosub @FIND_NEAR_OBJECT
    if $found == -1
    then
      return
    end
    $DYOM_idx = $found
    gosub @OBJECT_CAM
    0512: permanent_text_box 'HOBHLP'  
    
    gosub @GEN_CONFIRM_ACTION
    if $confirm_canceled == 0
    then
      $DYOM_object_hidewith[$DYOM_idx] = $DYOM_selected_obj
    end
return

//===============================
// EDIT OBJECT
//===============================
:EDITOBJECT
    Player.CanMove($PLAYER_CHAR) = False
    gosub @FIND_NEAR_OBJECT
    if $found == -1
    then
      return
    end
    $DYOM_idx = $found
    0663: "INDEX" $DYOM_idx                     
    gosub @OBJECT_DESTROY

    $TEMPVAR_FLOAT_1 = $DYOM_object_location_x[$DYOM_idx]
    $TEMPVAR_FLOAT_2 = $DYOM_object_location_y[$DYOM_idx]
    $TEMPVAR_FLOAT_3 = $DYOM_object_location_z[$DYOM_idx]
    $TEMPVAR_ANGLE_X = $DYOM_object_location_rx[$DYOM_idx]
    $TEMPVAR_ANGLE_Y = $DYOM_object_location_ry[$DYOM_idx]
    $TEMPVAR_ANGLE   = $DYOM_object_location_rz[$DYOM_idx]
    $object_model    = $DYOM_object_model[$DYOM_idx]
    
    gosub @SELECT_OBJECT
    if $object_cancel == 0
    then
        $OBJ_I = $DYOM_object_interior[$DYOM_idx] 
        $OBJ_M = $OBJ_I
        $OBJ_M /= 1000
        $OBJ_M *= 1000
        $OBJ_I -= $OBJ_M
        $OBJ_M /= 1000
        $OBJ_P = $OBJ_M
        $OBJ_M /= 1000
        $OBJ_M *= 1000
        $OBJ_P -= $OBJ_M  
        $OBJ_M /= 1000
        0663: - PRINTINT "MOBJECT i=" $OBJ_I
        0663: - PRINTINT "MOBJECT m=" $OBJ_M
        0663: - PRINTINT "MOBJECT p=" $OBJ_P      
        $TF10 = $TEMPVAR_FLOAT_1
        $TF11 = $TEMPVAR_FLOAT_2
        $TF12 = $TEMPVAR_FLOAT_3
        $TF13 = $TEMPVAR_ANGLE_X
        $TF14 = $TEMPVAR_ANGLE_Y
        $TF15 = $TEMPVAR_ANGLE
        
        $found = $OBJ_P
        $found = $DYOM_POINT_LINK[$found]
        $found = $DYOM_POINT_LINK[$found]
        008C: $time_value = float $DYOM_POINT_X[$found] to_integer 
        $time_value *= 1000.0
        $object_dist     = $DYOM_POINT_Y[$found]
        $found = $OBJ_P  // Store for later use
        if and
            $object_model < -16
            $object_model > -388
        then
          gosub @OBJECTMENU
        else
            if not $object_model == -16
            then
                if 03CA:   object $object exists 
                then 
                    object.Destroy($object)
                    if AND
                       $object_model < -387 
                       $object_model > -455
                    then
                        0976: destroy_particle $objecteffect
                    end                
                end
            else
                if 0973:   fire $object exists 
                then
                    02D1: remove_fire $object 
                end
            end
            $OBJ_M = 0
            $OBJ_P = 0
        end    
        if $object_cancel == 0
        then
            //0663: - PRINTINT "MOBJECT i=" $OBJ_I
            //0663: - PRINTINT "MOBJECT m=" $OBJ_M
            //0663: - PRINTINT "MOBJECT p=" $OBJ_P  
            $DYOM_object_interior[$DYOM_idx] = $OBJ_I  // Set proxmove
            if $OBJ_M == 1
            then    
                $OBJ_M *= 1000000
                $DYOM_object_interior[$DYOM_idx] += $OBJ_M  // Set proxmove
                $OBJ_P *= 1000
                $DYOM_object_interior[$DYOM_idx] += $OBJ_P
                $OBJ_P /= 1000
                $DYOM_POINT_X[$OBJ_P] = $TEMPVAR_FLOAT_1          
                $DYOM_POINT_Y[$OBJ_P] = $TEMPVAR_FLOAT_2
                $DYOM_POINT_Z[$OBJ_P] = $TEMPVAR_FLOAT_3 
                $OBJ_P = $DYOM_POINT_LINK[$OBJ_P]
                $DYOM_POINT_X[$OBJ_P] = $TEMPVAR_ANGLE_X          
                $DYOM_POINT_Y[$OBJ_P] = $TEMPVAR_ANGLE_Y
                $DYOM_POINT_Z[$OBJ_P] = $TEMPVAR_ANGLE
                $OBJ_P = $DYOM_POINT_LINK[$OBJ_P]
                008D: $DYOM_POINT_X[$OBJ_P] = integer $time_value to_float 
                $DYOM_POINT_X[$OBJ_P] /= 1000.0
                $DYOM_POINT_Y[$OBJ_P] = $object_dist
                0663: "comb" $DYOM_object_interior[$DYOM_idx]
            else
                if $OBJ_M > 1
                then    
                    // free old points
                    0084: $point = $found
                    gosub @FREE_POINT_CHAIN                
                    $OBJ_M *= 1000000
                    $DYOM_object_interior[$DYOM_idx] += $OBJ_M  // Set permmove
                    $OBJ_P *= 1000
                    $DYOM_object_interior[$DYOM_idx] += $OBJ_P
                    0663: "comb" $DYOM_object_interior[$DYOM_idx]
                end
            end
            
            $DYOM_object_model[$DYOM_idx] = $object_model
            $DYOM_object_location_x[$DYOM_idx] = $TF10
            $DYOM_object_location_y[$DYOM_idx] = $TF11 
            $DYOM_object_location_z[$DYOM_idx] = $TF12
            $DYOM_object_location_rx[$DYOM_idx] = $TF13
            $DYOM_object_location_ry[$DYOM_idx] = $TF14
            $DYOM_object_location_rz[$DYOM_idx] = $TF15
        end  
    end
    0663: "INDEX" $DYOM_idx                         
    gosub @DUMMY_OBJECT 
return


//===============================
// DELETE OBJECT
//===============================
:DELETE_OBJECT
    Player.CanMove($PLAYER_CHAR) = false
    gosub @FIND_NEAR_OBJECT
    if $found == -1
    then
      return
    end
    $DYOM_idx = $found
    gosub @OBJECT_CAM
    0512: permanent_text_box 'DOBHLP'  
    gosub @GEN_CONFIRM_ACTION
    if $confirm_canceled == 1
    then
      return
    end

    $OBJ_I = $DYOM_object_interior[$DYOM_idx] 
    $OBJ_M = $OBJ_I
    $OBJ_M /= 1000
    $OBJ_M *= 1000
    $OBJ_I -= $OBJ_M
    $OBJ_M /= 1000
    $OBJ_P = $OBJ_M
    $OBJ_M /= 1000
    $OBJ_M *= 1000
    $OBJ_P -= $OBJ_M  
    $OBJ_M /= 1000
    //0663: - PRINTINT "MOBJECT i=" $OBJ_I
    //0663: - PRINTINT "MOBJECT m=" $OBJ_M
    //0663: - PRINTINT "MOBJECT p=" $OBJ_P   
    if $OBJ_M > 0
    then   
        $point = $OBJ_P
        gosub @FREE_POINT_CHAIN
    end

    gosub @OBJECT_DESTROY
    var
      $this:integer
      $next:integer
      $last:integer
    end
    $last = $DYOM_object_count
    $last -= 2
    for $this = $found to $last
        $next = $this
        $next += 1
        //  Copy pickup $next to $this
        $DYOM_object_model[$this]=                $DYOM_object_model[$next]       
        $DYOM_object_location_x[$this]=           $DYOM_object_location_x[$next]  
        $DYOM_object_location_y[$this]=           $DYOM_object_location_y[$next]  
        $DYOM_object_location_z[$this]=           $DYOM_object_location_z[$next]  
        $DYOM_object_location_rx[$this]=          $DYOM_object_location_rx[$next]  
        $DYOM_object_location_ry[$this]=          $DYOM_object_location_ry[$next]  
        $DYOM_object_location_rz[$this]=          $DYOM_object_location_rz[$next]  
        $DYOM_object_spawnwith[$this]=            $DYOM_object_spawnwith[$next]  
        $DYOM_object_hidewith[$this]=             $DYOM_object_hidewith[$next]  
        $DYOM_object_interior[$this]=             $DYOM_object_interior[$next]  
        $DYOM_object_handle[$this]=               $DYOM_object_handle[$next]                    
    end  
    $DYOM_object_count -= 1       
return


//===============================
// ADD MISSIONTRIGGER
//===============================
:ADDTRIGGER
077E: get_active_interior_to 5@ 
if NOT 5@ == 0
then
  00BC: show_text_highpriority GXT 'MTINT' time 3000 flag 1 
  wait 2000 
  return
end
Player.CanMove($PLAYER_CHAR) = False
04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 1.5 -0.6

$TEXTCUR = $TEXTFILE
gosub @TEXT_CLEAR
gosub @SELECT_TRIGGER_FILE
if $trigger_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  return
end  
gosub @SELECT_ICON
if $trigger_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  return
end  
$trigger_reward = 0
gosub @SELECT_TRIGGER_REWARD
if $trigger_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  return
end  
// copy filename to buffer
$TEXTCUR = $TEXTFILE
$TEXTTARGET = $DYOM_trigger_count
$TEXTTARGET *= 16
$TEXTTARGET += $TEXTTRIGGERS
gosub @TEXT_copy

$trigger_after = $DYOM_trigger_count
$trigger_after -= 1
gosub @SELECT_TRIGGER_AFTER

$DYOM_trigger_location_x[$DYOM_trigger_count] = $TEMPVAR_FLOAT_1
$DYOM_trigger_location_y[$DYOM_trigger_count] = $TEMPVAR_FLOAT_2 
$DYOM_trigger_location_z[$DYOM_trigger_count] = $TEMPVAR_FLOAT_3

$DYOM_trigger_mhandle[$DYOM_trigger_count] = object.init(#TRAFFICCONE,$DYOM_trigger_location_x[$DYOM_trigger_count],$DYOM_trigger_location_y[$DYOM_trigger_count],$DYOM_trigger_location_z[$DYOM_trigger_count])
0382: set_object $DYOM_trigger_mhandle[$DYOM_trigger_count] collision_detection 0 
0188: 28@ = create_marker_above_object $DYOM_trigger_mhandle[$DYOM_trigger_count] 


$DYOM_trigger_icon[$DYOM_trigger_count] = $trigger_icon
$DYOM_trigger_after[$DYOM_trigger_count] = $trigger_after
$DYOM_trigger_reward[$DYOM_trigger_count] = $trigger_reward
01E4: show_text_1number_lowpriority GXT 'MTNEW' number $DYOM_trigger_count time 1000 flag 1 
$DYOM_trigger_count += 1
 
Player.CanMove($PLAYER_CHAR) = True
return



//===============================
// EDIT MISSIONTRIGGER
//===============================
:EDITTRIGGER
Player.CanMove($PLAYER_CHAR) = False
gosub @FIND_NEAR_TRIGGER
if $found == -1
then
  return
end

object.Destroy($DYOM_trigger_mhandle[$found])
//marker.Disable($DYOM_trigger_mhandle[$found])

$TEMPVAR_FLOAT_1 = $DYOM_trigger_location_x[$found]
$TEMPVAR_FLOAT_2 = $DYOM_trigger_location_y[$found]
$TEMPVAR_FLOAT_3 = $DYOM_trigger_location_z[$found] 
$trigger_icon = $DYOM_trigger_icon[$found]
$trigger_after = $DYOM_trigger_after[$found]
$trigger_reward = $DYOM_trigger_reward[$found]
// copy filename to buffer
$TEXTTARGET = $TEXTFILE
$TEXTCUR = $found
$TEXTCUR *= 16
$TEXTCUR += $TEXTTRIGGERS
gosub @TEXT_copy

06BA: AS_actor $PLAYER_ACTOR turn_to_and_look_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3
0373: set_camera_directly_behind_player 
02EB: restore_camera_with_jumpcut

gosub @SELECT_TRIGGER_FILE
if $trigger_cancel == 0
then
    gosub @SELECT_ICON
    if $trigger_cancel == 0
    then
        gosub @SELECT_TRIGGER_REWARD
        if $trigger_cancel == 0
        then
        
            // copy filename to buffer
            $TEXTCUR = $TEXTFILE
            $TEXTTARGET = $found
            $TEXTTARGET *= 16
            $TEXTTARGET += $TEXTTRIGGERS
            gosub @TEXT_copy
            
            // input after
            gosub @SELECT_TRIGGER_AFTER
            
            $DYOM_trigger_location_x[$found] = $TEMPVAR_FLOAT_1
            $DYOM_trigger_location_y[$found] = $TEMPVAR_FLOAT_2 
            $DYOM_trigger_location_z[$found] = $TEMPVAR_FLOAT_3
            $DYOM_trigger_icon[$found]       = $trigger_icon
            $DYOM_trigger_after[$found]      = $trigger_after
            $DYOM_trigger_reward[$found]     = $trigger_reward
        end 
    end
end

$DYOM_trigger_mhandle[$found] = object.init(#TRAFFICCONE,$DYOM_trigger_location_x[$found],$DYOM_trigger_location_y[$found],$DYOM_trigger_location_z[$found])
0382: set_object $DYOM_trigger_mhandle[$found] collision_detection 0 
0188: 28@ = create_marker_above_object $DYOM_trigger_mhandle[$found] 

Player.CanMove($PLAYER_CHAR) = True
return



//===============================
// DELETE TRIGGER
//===============================
:DELETE_TRIGGER
Player.CanMove($PLAYER_CHAR) = True
gosub @FIND_NEAR_TRIGGER
if $found == -1
then
  return
end
$TEMPVAR_FLOAT_1 = $DYOM_trigger_location_x[$found]
$TEMPVAR_FLOAT_2 = $DYOM_trigger_location_y[$found]
$TEMPVAR_FLOAT_3 = $DYOM_trigger_location_z[$found]
$TEMPVAR_FLOAT_3 += 2.0

015F: set_camera_position $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 rotation 0.0 0.0 0.0 
0160: set_camera_point_at $DYOM_trigger_location_x[$found] $DYOM_trigger_location_y[$found] $DYOM_trigger_location_z[$found] mode 2 

0512: permanent_text_box 'DPUHLP'  

gosub @GEN_CONFIRM_ACTION
if $confirm_canceled == 1
then
  return
end

object.Destroy($DYOM_trigger_mhandle[$found])
//marker.Disable($DYOM_trigger_mhandle[$found])
$DYOM_trigger_mhandle[$found] = 0
var
  $this:integer
  $next:integer
  $old_after:integer
end
$old_after = $DYOM_trigger_after[$found]
$DYOM_trigger_count -= 1
$this = $found
while $this < $DYOM_trigger_count 
    wait 0
    $next = $this
    $next += 1
    //  Copy pickup $next to $this
    $DYOM_trigger_icon[$this]=             $DYOM_trigger_icon[$next]       
    $DYOM_trigger_location_x[$this]=       $DYOM_trigger_location_x[$next]  
    $DYOM_trigger_location_y[$this]=       $DYOM_trigger_location_y[$next]  
    $DYOM_trigger_location_z[$this]=       $DYOM_trigger_location_z[$next]  
    $DYOM_trigger_after[$this]=            $DYOM_trigger_after[$next]  
    $DYOM_trigger_mhandle[$this]=          $DYOM_trigger_mhandle[$next]                    
    $DYOM_trigger_reward[$this]=           $DYOM_trigger_reward[$next]                    
    $this += 1
end  

// correct the trigger after values refering one of the shifted triggers
$this = 1
while $this < $DYOM_trigger_count
    wait 0
  if $DYOM_trigger_after[$this] == $found 
  then
    $DYOM_trigger_after[$this] = $old_after
  end
  if $DYOM_trigger_after[$this] > $found 
  then
    $DYOM_trigger_after[$this] -= 1
  end

  $this += 1
end
   
return
    






//===============================
// EDIT OBJECTIVE
//===============================
:EDIT_OBJECTIVE
gosub @FIND_NEAR_OBJECTIVE
if $found == -1
then
  return
end
IF $DYOM_objective_type[$found] == DYOM_objtype_car 
THEN
  gosub @EDIT_OBJECTIVE_CAR
END
IF $DYOM_objective_type[$found] == DYOM_objtype_marker 
THEN
  gosub @EDIT_OBJECTIVE_MARKER
END 
IF $DYOM_objective_type[$found] == DYOM_objtype_pickup 
THEN
  gosub @EDIT_OBJECTIVE_PICKUP
END
IF $DYOM_objective_type[$found] == DYOM_objtype_actor 
THEN
  gosub @EDIT_OBJECTIVE_ACTOR
END
IF $DYOM_objective_type[$found] == DYOM_objtype_cutscene 
THEN
  gosub @EDIT_OBJECTIVE_CUTSCENE
END
IF $DYOM_objective_type[$found] == DYOM_objtype_teleport 
THEN
  gosub @EDIT_OBJECTIVE_TELEPORT
END
IF $DYOM_objective_type[$found] == DYOM_objtype_countdown 
THEN
  gosub @EDIT_OBJECTIVE_COUNTDOWN
END
IF $DYOM_objective_type[$found] == DYOM_objtype_telecar 
THEN
  gosub @EDIT_OBJECTIVE_TELECAR
END
IF $DYOM_objective_type[$found] == DYOM_objtype_timeout 
THEN
  gosub @EDIT_OBJECTIVE_TIMEOUT
END
IF $DYOM_objective_type[$found] == DYOM_objtype_weather 
THEN
  gosub @EDIT_OBJECTIVE_WEATHER
END
IF $DYOM_objective_type[$found] == DYOM_objtype_settime
THEN
  gosub @EDIT_OBJECTIVE_SETTIME
END
IF $DYOM_objective_type[$found] == DYOM_objtype_peds 
THEN
  gosub @EDIT_OBJECTIVE_PEDS
END
IF $DYOM_objective_type[$found] == DYOM_objtype_wanted 
THEN
  gosub @EDIT_OBJECTIVE_WANTED
END
IF $DYOM_objective_type[$found] == DYOM_objtype_timelimit 
THEN
  gosub @EDIT_OBJECTIVE_TIMELIMIT
END
IF $DYOM_objective_type[$found] == DYOM_objtype_timeron 
THEN
  gosub @EDIT_OBJECTIVE_TIMERON
END
IF $DYOM_objective_type[$found] == DYOM_objtype_noweapon 
THEN
  gosub @EDIT_OBJECTIVE_NOWEAPON
END
IF $DYOM_objective_type[$found] == DYOM_objtype_phone 
THEN
  gosub @EDIT_OBJECTIVE_PHONE
END
IF $DYOM_objective_type[$found] == DYOM_objtype_object
THEN
  gosub @EDIT_OBJECTIVE_OBJECT
END
IF $DYOM_objective_type[$found] == DYOM_objtype_addmoney
THEN
  gosub @EDIT_OBJECTIVE_ADDMONEY
END
IF $DYOM_objective_type[$found] == DYOM_objtype_submoney
THEN
  gosub @EDIT_OBJECTIVE_SUBMONEY
END
IF $DYOM_objective_type[$found] == DYOM_objtype_animation
THEN
  gosub @EDIT_OBJECTIVE_ANIMATION
END
return


//===============================
// COPY OBJECTIVE
//===============================
var
  $objective_from:integer
  $objective_to:integer
  $spawnhide_from:integer
  $spawnhide_to:integer
end  
:COPY_OBJECTIVE
$spawnhide_from = $objective_from
$spawnhide_from += 1 
$spawnhide_to = $objective_to
$spawnhide_to   += 1 
//  Copy pickup $next to $this
$DYOM_objective_location_x[$objective_to]=       $DYOM_objective_location_x[$objective_from] 
$DYOM_objective_location_y[$objective_to]=       $DYOM_objective_location_y[$objective_from] 
$DYOM_objective_location_z[$objective_to]=       $DYOM_objective_location_z[$objective_from] 
$DYOM_objective_location_a[$objective_to]=       $DYOM_objective_location_a[$objective_from] 
$DYOM_objective_interior[$objective_to]=         $DYOM_objective_interior[$objective_from]   
$DYOM_objective_type[$objective_to]=             $DYOM_objective_type[$objective_from]       
$DYOM_objective_model[$objective_to]=            $DYOM_objective_model[$objective_from]      
$DYOM_objective_data[$objective_to]=             $DYOM_objective_data[$objective_from]       
$DYOM_objective_ammo[$objective_to]=             $DYOM_objective_ammo[$objective_from]       
$DYOM_objective_markercolor[$objective_to]=      $DYOM_objective_markercolor[$objective_from]
$DYOM_objective_properties[$objective_to]=       $DYOM_objective_properties[$objective_from]  
$DYOM_objective_health[$objective_to]=           $DYOM_objective_health[$objective_from]     
$DYOM_objective_accuracy[$objective_to]=         $DYOM_objective_accuracy[$objective_from]   
$DYOM_objective_timelimit[$objective_to]=        $DYOM_objective_timelimit[$objective_from]  
$DYOM_objective_handle[$objective_to]=           $DYOM_objective_handle[$objective_from]     
$DYOM_objective_animation[$objective_to]=        $DYOM_objective_animation[$objective_from]
$DYOM_objective_distance[$objective_to]=         $DYOM_objective_distance[$objective_from]

// Copy objective TEXT 
var
   $OBJTEXTTO:integer
   $OBJTEXTFROM:integer
end
$OBJTEXTTO = $objective_to 
$OBJTEXTTO  *= 100
$OBJTEXTTO += $TEXTOBJECTIVES
$OBJTEXTFROM = $objective_from 
$OBJTEXTFROM  *= 100
$OBJTEXTFROM += $TEXTOBJECTIVES

repeat
    0A8D: $buffer = read_memory $OBJTEXTFROM size 1 virtual_protect 0 
    0A8C: write_memory $OBJTEXTTO size 1 value $buffer virtual_protect 0
    $OBJTEXTFROM += 1
    $OBJTEXTTO += 1
until $buffer == 0


//dec spawnwith for actor als spawnwith > found
$idx = 0
WHILE $DYOM_actor_count > $idx
  if $DYOM_actor_spawnwith[$idx] == $spawnhide_from
  then
     $DYOM_actor_spawnwith[$idx] = $spawnhide_to
  end
  if $DYOM_actor_hidewith[$idx] == $spawnhide_from
  then
     $DYOM_actor_hidewith[$idx] = $spawnhide_to
  end
  $idx += 1
END

//dec spawnwith for car als = found of groter
$idx = 0
WHILE $DYOM_car_count > $idx
  if $DYOM_car_spawnwith[$idx] == $spawnhide_from
  then
     $DYOM_car_spawnwith[$idx] = $spawnhide_to
  end
  if $DYOM_car_hidewith[$idx] == $spawnhide_from
  then
     $DYOM_car_hidewith[$idx] = $spawnhide_to
  end
  $idx += 1
END

//dec spawnwith for pickup als = found of groter
$idx = 0
WHILE $DYOM_pickup_count > $idx
  if $DYOM_pickup_spawnwith[$idx] == $spawnhide_from
  then
     $DYOM_pickup_spawnwith[$idx] = $spawnhide_to
  end
  if $DYOM_pickup_hidewith[$idx] == $spawnhide_from
  then
     $DYOM_pickup_hidewith[$idx] = $spawnhide_to
  end
  $idx += 1
END

//dec spawnwith for object als = found of groter
$idx = 0
WHILE $DYOM_object_count > $idx
  if $DYOM_object_spawnwith[$idx] == $spawnhide_from
  then
     $DYOM_object_spawnwith[$idx] = $spawnhide_to
  end
  if $DYOM_object_hidewith[$idx] == $spawnhide_from
  then
     $DYOM_object_hidewith[$idx] = $spawnhide_to
  end
  $idx += 1
END

return

:GEN_OBJECTIVE_CAMERA
$TEMPVAR_FLOAT_1 = $DYOM_objective_location_x[$found]
$TEMPVAR_FLOAT_2 = $DYOM_objective_location_y[$found]
$TEMPVAR_FLOAT_3 = $DYOM_objective_location_z[$found]
$TEMPVAR_FLOAT_3 += 2.0
$TEMPVAR_FLOAT_2 += 1.0

015F: set_camera_position $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 rotation 0.0 0.0 0.0 
0160: set_camera_point_at $DYOM_objective_location_x[$found] $DYOM_objective_location_y[$found] $DYOM_objective_location_z[$found] mode 2 
return

//===============================
// DELETE OBJECTIVE
//===============================
:DELETE_OBJECTIVE
Player.CanMove($PLAYER_CHAR) = True
gosub @FIND_NEAR_OBJECTIVE
if $found == -1
then
  return
end


IF $DYOM_objective_type[$found] == DYOM_objtype_car 
THEN
    067A: put_camera_on_car $DYOM_objective_handle[$found] with_offset 0.0 5.0 4.0 point_to_car $DYOM_objective_handle[$found] tilt 0.0 2 
    0512: permanent_text_box 'DCARHLP'  
END
IF $DYOM_objective_type[$found] == DYOM_objtype_marker 
THEN
    $TEMPVAR_FLOAT_3 = $DYOM_objective_location_a[$found]
    $TEMPVAR_FLOAT_3 *= 2.5
    $TEMPVAR_FLOAT_1 = $DYOM_objective_location_x[$found]
    $TEMPVAR_FLOAT_1 += $TEMPVAR_FLOAT_3
    $TEMPVAR_FLOAT_2 = $DYOM_objective_location_y[$found]
    $TEMPVAR_FLOAT_3 += $DYOM_objective_location_z[$found]
    
    015F: set_camera_position $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 rotation 0.0 0.0 0.0 
    0160: set_camera_point_at $DYOM_objective_location_x[$found] $DYOM_objective_location_y[$found] $DYOM_objective_location_z[$found] mode 2 
    
    0512: permanent_text_box 'DCPHLP'  
END 
IF $DYOM_objective_type[$found] == DYOM_objtype_pickup 
THEN
    GOSUB @GEN_OBJECTIVE_CAMERA
    0512: permanent_text_box 'DPUHLP'  
END
IF $DYOM_objective_type[$found] == DYOM_objtype_actor 
THEN
    067E: put_camera_on_actor $DYOM_objective_handle[$found] with_offset 0.0 2.0 2.0 point_to_actor $DYOM_objective_handle[$found] 0.0 mode 2 

    0512: permanent_text_box 'DACTHLP'  
END
IF $DYOM_objective_type[$found] == DYOM_objtype_cutscene 
THEN
    GOSUB @GEN_OBJECTIVE_CAMERA
    0512: permanent_text_box 'DCUTHLP'  
END
IF $DYOM_objective_type[$found] == DYOM_objtype_teleport 
THEN
    067E: put_camera_on_actor $DYOM_objective_handle[$found] with_offset 0.0 2.0 2.0 point_to_actor $DYOM_objective_handle[$found] 0.0 mode 2 

    0512: permanent_text_box 'DTLPHLP'  
END
IF $DYOM_objective_type[$found] == DYOM_objtype_countdown 
THEN
    GOSUB @GEN_OBJECTIVE_CAMERA
    0512: permanent_text_box 'DCNTHLP'  
END
IF $DYOM_objective_type[$found] == DYOM_objtype_telecar 
THEN
    067A: put_camera_on_car $DYOM_objective_handle[$found] with_offset 0.0 5.0 4.0 point_to_car $DYOM_objective_handle[$found] tilt 0.0 2 
    0512: permanent_text_box 'DCARHLP'  
END
IF $DYOM_objective_type[$found] == DYOM_objtype_timeout 
THEN
    GOSUB @GEN_OBJECTIVE_CAMERA
    0512: permanent_text_box 'DTIMHLP'  
END

IF $DYOM_objective_type[$found] == DYOM_objtype_weather 
THEN
    GOSUB @GEN_OBJECTIVE_CAMERA
    0512: permanent_text_box 'DWETHLP'  
END

IF $DYOM_objective_type[$found] == DYOM_objtype_settime 
THEN
    GOSUB @GEN_OBJECTIVE_CAMERA
    0512: permanent_text_box 'DSTHLP'  
END

IF $DYOM_objective_type[$found] == DYOM_objtype_peds 
THEN
    GOSUB @GEN_OBJECTIVE_CAMERA
    0512: permanent_text_box 'DPEDHLP'  
END

IF $DYOM_objective_type[$found] == DYOM_objtype_wanted 
THEN
    GOSUB @GEN_OBJECTIVE_CAMERA
    0512: permanent_text_box 'DWNTHLP'  
END

IF $DYOM_objective_type[$found] == DYOM_objtype_timelimit 
THEN
    GOSUB @GEN_OBJECTIVE_CAMERA
    0512: permanent_text_box 'DTLMHLP'  
END

IF $DYOM_objective_type[$found] == DYOM_objtype_timeron
THEN
    GOSUB @GEN_OBJECTIVE_CAMERA
    0512: permanent_text_box 'DTMOHLP'  
END

IF $DYOM_objective_type[$found] == DYOM_objtype_noweapon
THEN
    GOSUB @GEN_OBJECTIVE_CAMERA
    0512: permanent_text_box 'DNWHLP'  
END

IF $DYOM_objective_type[$found] == DYOM_objtype_phone
THEN
    GOSUB @GEN_OBJECTIVE_CAMERA
    0512: permanent_text_box 'DPHHLP'  
END
IF $DYOM_objective_type[$found] == DYOM_objtype_object
THEN
    GOSUB @GEN_OBJECTIVE_CAMERA
    0512: permanent_text_box 'DOBHLP'  
END
IF $DYOM_objective_type[$found] == DYOM_objtype_addmoney
THEN
    GOSUB @GEN_OBJECTIVE_CAMERA
    0512: permanent_text_box 'DAMHLP'  
END
IF $DYOM_objective_type[$found] == DYOM_objtype_submoney
THEN
    GOSUB @GEN_OBJECTIVE_CAMERA
    0512: permanent_text_box 'DSMHLP'  
END
IF $DYOM_objective_type[$found] == DYOM_objtype_animation
THEN
    GOSUB @GEN_OBJECTIVE_CAMERA
    0512: permanent_text_box 'DANHLP'  
END


gosub @GEN_CONFIRM_ACTION
if $confirm_canceled == 1
then
  return
end

IF or
  $DYOM_objective_type[$found] == DYOM_objtype_car 
  $DYOM_objective_type[$found] == DYOM_objtype_telecar 
THEN
    car.Destroy($DYOM_objective_handle[$found])
END
IF $DYOM_objective_type[$found] == DYOM_objtype_marker 
THEN
    if or 
      $DYOM_objective_model[$found] == 0
      $DYOM_objective_model[$found] == 5
    then
        03BD: destroy_sphere $DYOM_objective_handle[$found]
    else
      if $DYOM_objective_model[$found] == 6
      then
        0A41: destroy_entrance_marker $DYOM_objective_handle[$found] 
      else
        06D6: disable_racing_checkpoint $DYOM_objective_handle[$found]
      end
    end
    if 03CA:   object $DYOM_objective_ammo[$found] exists 
    then
      object.Destroy($DYOM_objective_ammo[$found])
    end
    $DYOM_objective_handle[$found] = -1
END 
IF $DYOM_objective_type[$found] == DYOM_objtype_pickup 
THEN
    pickup.Destroy($DYOM_objective_handle[$found])
END
IF $DYOM_objective_type[$found] == DYOM_objtype_actor 
THEN
    actor.DestroyInstantly($DYOM_objective_handle[$found]) 
    // Remove routepoints if available
    if or 
          $DYOM_objective_animation[$found] == -4
          $DYOM_objective_animation[$found] == -5
          $DYOM_objective_animation[$found] == -6
    then
      if $DYOM_objective_distance[$found] < -500
      then
        0084: $point = $DYOM_objective_distance[$found]
        gosub @FREE_POINT_CHAIN
      end
    end 
    if or 
          $DYOM_objective_animation[$found] == -2
          $DYOM_objective_animation[$found] == -3
          $DYOM_objective_animation[$found] == -9
          $DYOM_objective_animation[$found] == -10
          $DYOM_objective_animation[$found] == -11
    then
      0084: $point = $DYOM_objective_distance[$found]
    end 
END
IF $DYOM_objective_type[$found] == DYOM_objtype_cutscene 
THEN
    object.Destroy($DYOM_objective_handle[$found])
END 
IF $DYOM_objective_type[$found] == DYOM_objtype_teleport
THEN
    actor.DestroyInstantly($DYOM_objective_handle[$found])  
END
IF or
  $DYOM_objective_type[$found] == DYOM_objtype_countdown 
  $DYOM_objective_type[$found] == DYOM_objtype_timeout 
  $DYOM_objective_type[$found] == DYOM_objtype_weather
  $DYOM_objective_type[$found] == DYOM_objtype_settime
  $DYOM_objective_type[$found] == DYOM_objtype_addmoney
  $DYOM_objective_type[$found] == DYOM_objtype_submoney
THEN
    object.Destroy($DYOM_objective_handle[$found])
END 
IF $DYOM_objective_type[$found] == DYOM_objtype_animation 
THEN
    object.Destroy($DYOM_objective_handle[$found]) 
    // Remove routepoints if available
    if or 
          $DYOM_objective_animation[$found] == -4
          $DYOM_objective_animation[$found] == -5
          $DYOM_objective_animation[$found] == -6
    then
      if $DYOM_objective_distance[$found] < -500
      then
        0084: $point = $DYOM_objective_distance[$found]
        gosub @FREE_POINT_CHAIN
      end
    end 
    if or 
          $DYOM_objective_animation[$found] == -2
          $DYOM_objective_animation[$found] == -3
          $DYOM_objective_animation[$found] == -9
          $DYOM_objective_animation[$found] == -10
          $DYOM_objective_animation[$found] == -11
    then
      0084: $point = $DYOM_objective_distance[$found]
    end 
END

IF or
  $DYOM_objective_type[$found] == DYOM_objtype_peds 
  $DYOM_objective_type[$found] == DYOM_objtype_wanted
  $DYOM_objective_type[$found] == DYOM_objtype_timelimit
  $DYOM_objective_type[$found] == DYOM_objtype_timeron
  $DYOM_objective_type[$found] == DYOM_objtype_noweapon
  $DYOM_objective_type[$found] == DYOM_objtype_phone
  $DYOM_objective_type[$found] == DYOM_objtype_object
THEN
    object.Destroy($DYOM_objective_handle[$found])
END 

var
  $this:integer
  $next:integer
  $last:integer
end
$last = $DYOM_objective_count
$last -= 1
$this = $found
while $last > $this
  wait 0
  $next = $this
  $next += 1
  
  $objective_from = $next
  $objective_to = $this
  gosub @COPY_OBJECTIVE

  $this = $next
end  

$DYOM_objective_count -= 1

if $DYOM_selected_obj > $found
then
  $DYOM_selected_obj -= 1
end
 
gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
   
return


//===============================
// MOVE OBJECTIVE
//===============================
:MOVE_OBJECTIVE
Player.CanMove($PLAYER_CHAR) = True
gosub @FIND_NEAR_OBJECTIVE
if $found == -1
then
  return
end

// DYOM_objective_count wil be used as temp location
// The objective at location [$found] must be copied to location [$DYOM_selected_obj]
//--------------------------------
// Found -> DYOM_objective_count
// If $found == $DYOM_selected_obj  -> no action
// If $found < $DYOM_selected_obj -> Found+1 -> found .....  $DYOM_selected_obj -> $DYOM_selected_obj-1
// If $found > $DYOM_selected_obj -> Found-1 -> found .....  $DYOM_selected_obj -> $DYOM_selected_obj+1 ...   
// DYOM_objective_count -> $DYOM_selected_obj     

if NOT $found == $DYOM_selected_obj
then
    $objective_from = $found
    $objective_to = $DYOM_objective_count
    gosub @COPY_OBJECTIVE

    if $found < $DYOM_selected_obj
    then
      $objective_to = $found
      $objective_from = $found
      $objective_from += 1
      while $objective_to < $DYOM_selected_obj
        gosub @COPY_OBJECTIVE
        $objective_from += 1
        $objective_to += 1
      end       
    end
    
    if $found > $DYOM_selected_obj
    then
      $objective_to = $found
      $objective_from = $found
      $objective_from += -1
      while $objective_to > $DYOM_selected_obj
        gosub @COPY_OBJECTIVE
        $objective_from += -1
        $objective_to += -1
      end       
    end
    
    $objective_from = $DYOM_objective_count
    $objective_to = $DYOM_selected_obj
    gosub @COPY_OBJECTIVE


    if $found > $DYOM_selected_obj
    then
      $DYOM_selected_obj += 1
    end
        
    gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
    gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
end    
   
return


//===============================
// SELECT OBJECTIVE
//===============================
:SELECT_OBJECTIVE
gosub @FIND_NEAR_SELECT
if $found == -1
then
  return
end
$DYOM_selected_obj = $found
gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
return


//===============================
// NEW OBJECTIVE
//===============================
:NEW_OBJECTIVE
$found = $DYOM_selected_obj        // 0 in case the player was selected

var
  $this:integer
  $prev:integer
end
$this = $DYOM_objective_count
while $this > $found
  wait 0
  $prev = $this
  $prev += -1
  
  $objective_from = $prev
  $objective_to = $this
  gosub @COPY_OBJECTIVE
    
  $this = $prev
end  

$DYOM_objective_count += 1
$DYOM_selected_obj += 1
   
return

:NEW_OBJTEXT
$TEXTCUR = $found
$TEXTCUR *= 100
$TEXTCUR += $TEXTOBJECTIVES
gosub @TEXT_clear

:EDIT_OBJTEXT
// Add text for this objective
0512: show_permanent_text_box 'OBJTEXT' 
$TEXTCUR = $found
$TEXTCUR *= 100
$TEXTCUR += $TEXTOBJECTIVES
$TEXTMAX = 99
gosub @TEXT_edit
return

//---------------------------------
// OBJECTIVE ADD ACTOR menu
//---------------------------------
:OBJECTIVE_ACTOR_MENU
Player.CanMove($PLAYER_CHAR) = False
08D4: $menu = create_panel_with_title 'ACTORS' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
08DB: set_panel $menu column 0 header 'ACTORS' data 'READY' 'GANGG' 'HEALTH' 'BEHAV' 'ACC' 'HEADS' 'ALLENEM' 'BAR' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  

gosub @GEN_MENU
if $menu_canceled == 1
then
  $actor_cancel = 1
  return
end

if $menu_choice == 1
then
    //---------------------------------
    // OBJ ACTOR GANG menu
    //---------------------------------
    08D4: $menu = create_panel_with_title 'PROP' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'GANGG' data 'ENEMY1' 'ENEMY2' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
      goto @OBJECTIVE_ACTOR_MENU
    end
    if $menu_choice == 0
    then
      08C0: clear $properties bit DYOM_actorpropbit_enemy2
    else
      08BA: set $properties bit DYOM_actorpropbit_enemy2 
    end
    jump @OBJECTIVE_ACTOR_MENU               
end 

if $menu_choice == 2
then
    //---------------------------------
    // ADD ACTOR HEALTH menu
    //---------------------------------
    08D4: $menu = create_panel_with_title 'HEALTH' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'HEALTH' data '100' '250' '500' '1000' '2500' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
    
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
      goto @OBJECTIVE_ACTOR_MENU
    end
    
    if $menu_choice == 0
    then
        $health = 100
    end
    
    if $menu_choice == 1
    then
        $health = 250
    end
    
    if $menu_choice == 2
    then
        $health = 500
    end
    
    if $menu_choice == 3
    then
        $health = 1000
    end
    
    if $menu_choice == 4
    then
        $health = 2500
    end 
    jump @OBJECTIVE_ACTOR_MENU
end

if $menu_choice == 3
then
    //---------------------------------
    // ADD ACTOR enemy behaviour menu
    //---------------------------------
    08D4: $menu = create_panel_with_title 'ENEMY' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'BEHAV' data 'NORMAL' 'HOLD' 'BEHA' 'BEHAH' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 
    
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
      goto @OBJECTIVE_ACTOR_MENU
    end
    
    if $menu_choice == 0
    then
        08C0: clear $properties bit DYOM_actorpropbit_aware 
        08C0: clear $properties  bit DYOM_actorpropbit_hold
        08C0: clear $properties  bit DYOM_actorpropbit_follow
    end
    
    if $menu_choice == 1
    then
        08C0: clear $properties bit DYOM_actorpropbit_aware 
        08BA: set $properties bit DYOM_actorpropbit_hold 
        08C0: clear $properties  bit DYOM_actorpropbit_follow
    end
    
    if $menu_choice == 2
    then
        08BA: set $properties bit DYOM_actorpropbit_aware 
        08C0: clear $properties bit DYOM_actorpropbit_hold
        08C0: clear $properties  bit DYOM_actorpropbit_follow
    end
    
    if $menu_choice == 3
    then
        08BA: set $properties bit DYOM_actorpropbit_aware 
        08BA: set $properties bit DYOM_actorpropbit_hold 
        08C0: clear $properties  bit DYOM_actorpropbit_follow
    end
    jump @OBJECTIVE_ACTOR_MENU
end

if $menu_choice == 4
then
    //---------------------------------
    // ADD ACTOR ACCURACY menu
    //---------------------------------
    08D4: $menu = create_panel_with_title 'ACC' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'ACC' data '10' '25' '50' '75' '100' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
    
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
      goto @OBJECTIVE_ACTOR_MENU
    end
    
    if $menu_choice == 0
    then
        $accuracy = 10
    end
    
    if $menu_choice == 1
    then
        $accuracy = 25
    end
    
    if $menu_choice == 2
    then
        $accuracy = 50
    end
    
    if $menu_choice == 3
    then
        $accuracy = 75
    end
    
    if $menu_choice == 4
    then
        $accuracy = 100
    end 
    jump @OBJECTIVE_ACTOR_MENU
end

if $menu_choice == 5
then
    //---------------------------------
    // ADD ACTOR ACCURACY menu
    //---------------------------------
    08D4: $menu = create_panel_with_title 'ACTORS' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'HEADS' data 'ON' 'OFF' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
      goto @OBJECTIVE_ACTOR_MENU
    end
    
    if $menu_choice == 0
    then
      08C0: clear $properties bit DYOM_actorpropbit_headshot
    else
      08BA: set $properties bit DYOM_actorpropbit_headshot 
    end
    jump @OBJECTIVE_ACTOR_MENU               
end

if $menu_choice == 6
then
    //---------------------------------
    // ADD ACTOR KILL ALL ACTORS menu
    //---------------------------------
    08D4: $menu = create_panel_with_title 'ACTORS' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'ALLENEM' data 'ON' 'OFF' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
      goto @OBJECTIVE_ACTOR_MENU
    end
    
    if $menu_choice == 0
    then
      08BA: set $properties bit DYOM_actorpropbit_allenemies 
    else
      08C0: clear $properties bit DYOM_actorpropbit_allenemies
    end
    jump @OBJECTIVE_ACTOR_MENU               
end

if $menu_choice == 7
then
    //---------------------------------
    // ADD HEALTHBAR menu
    //---------------------------------
    08D4: $menu = create_panel_with_title 'ACTORS' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'BAR' data 'ON' 'OFF' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
      goto @OBJECTIVE_ACTOR_MENU
    end
    
    if $menu_choice == 0
    then
      08BA: set $properties bit DYOM_actorpropbit_bar 
    else
      08C0: clear $properties bit DYOM_actorpropbit_bar
    end
    jump @OBJECTIVE_ACTOR_MENU               
end


if $menu_choice == 0
then
    //ready
    08DA: remove_panel $menu
    03E6: remove text box
    // And proceed with storing the Actor below
end

return




//===============================
// ADD OBJECTIVE: ACTOR
//===============================
:ADD_OBJECTIVE_ACTOR
$health = 100          // zodat als health niet opgegeven wordt, die niet gelijk wordt gesteld aan 0 (= dood).
$accuracy = 50         // zodat als accuracy niet opgegeven wordt, die gelijk wordt gesteld aan 50.
$properties = 0

Player.CanMove($PLAYER_CHAR) = True
048F: actor $PLAYER_ACTOR remove_weapons 
gosub @SELECT_ACTOR_MODEL
if $actor_cancel == 1
then
  09C7: set_player $PLAYER_CHAR modelID_to #NULL 
  return
end

gosub @SELECT_WEAPON_MODEL 
if $weapon_cancel == 1
then
  09C7: set_player $PLAYER_CHAR modelID_to #NULL 
  048F: actor $PLAYER_ACTOR remove_weapons 
  return
end
$anim_edit = 0
gosub @SELECT_ANIMATION 
if $anim_cancel == 1
then
  09C7: set_player $PLAYER_CHAR modelID_to #NULL 
  048F: actor $PLAYER_ACTOR remove_weapons 
  return
end

Player.CanMove($PLAYER_CHAR) = False

gosub @OBJECTIVE_ACTOR_MENU
if $actor_cancel == 1
then
  09C7: set_player $PLAYER_CHAR modelID_to #NULL 
  048F: actor $PLAYER_ACTOR remove_weapons 
  Player.CanMove($PLAYER_CHAR) = True
  return
end


gosub @SELECT_MARKER_COLOR
if $marker_cancel == 1
then
  09C7: set_player $PLAYER_CHAR modelID_to #NULL 
  048F: actor $PLAYER_ACTOR remove_weapons 
  Player.CanMove($PLAYER_CHAR) = True
  return
end

gosub @NEW_OBJECTIVE
// $found will be the location for this objective

gosub @NEW_OBJTEXT

fade 0 300
wait 300

04C4: store_coords_to $DYOM_objective_location_x[$found] $DYOM_objective_location_y[$found] $DYOM_objective_location_z[$found] from_actor $PLAYER_ACTOR with_offset 0.0 0.0 -1.0 
0172: $DYOM_objective_location_a[$found] = actor $PLAYER_ACTOR Z_angle 
077E: get_active_interior_to $DYOM_objective_interior[$found]

// restore player
09C7: set_player $PLAYER_CHAR modelID_to #NULL
048F: actor $PLAYER_ACTOR remove_weapons 
//0663: "actor ammo" $weapon_ammo

$DYOM_objective_type[$found]        = DYOM_objtype_actor
$DYOM_objective_model[$found]       = $actor_model
$DYOM_objective_animation[$found]   = $anim_id
$DYOM_objective_distance[$found]    = $anim_dist
$DYOM_objective_data[$found]        = $weapon_model
$DYOM_objective_ammo[$found]        = $weapon_ammo
$DYOM_objective_accuracy[$found]    = $accuracy
$DYOM_objective_markercolor[$found] = $marker_color
$DYOM_objective_timelimit[$found]   = 0
$DYOM_objective_properties[$found]  = $properties
$DYOM_objective_health[$found]      = $health
$DYOM_objective_handle[$found]      = -1



gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
Player.CanMove($PLAYER_CHAR) = True

fade 1 500
wait 500

$found += 1
01E4: show_text_1number_lowpriority GXT 'NEWOBJ' number $found time 1000 flag 1 
return



//===============================
// EDIT OBJECTIVE: ACTOR
//===============================
:EDIT_OBJECTIVE_ACTOR
Player.CanMove($PLAYER_CHAR) = True
actor.DestroyInstantly($DYOM_objective_handle[$found])
$actor_model = $DYOM_objective_model[$found]
$weapon_model = $DYOM_objective_data[$found]
$weapon_ammo = $DYOM_objective_ammo[$found]
00A1: put_actor $PLAYER_ACTOR at $DYOM_objective_location_x[$found] $DYOM_objective_location_y[$found] $DYOM_objective_location_z[$found] 
0173: set_actor $PLAYER_ACTOR Z_angle_to $DYOM_objective_location_a[$found]
//09C7: set_player $PLAYER_CHAR modelID_to $actor_model
048F: actor $PLAYER_ACTOR remove_weapons 
//01B2: give_actor $PLAYER_CHAR $weapon_model ammo 9999  
$health       = $DYOM_objective_health[$found]
$accuracy     = $DYOM_objective_accuracy[$found] 
$properties   = $DYOM_objective_properties[$found]
$marker_color = $DYOM_objective_markercolor[$found]
$timelimit    = $DYOM_objective_timelimit[$found]
$anim_id      = $DYOM_objective_animation[$found]
$anim_dist      = $DYOM_objective_distance[$found]

gosub @SELECT_ACTOR_MODEL
if $actor_cancel == 0
then
    gosub @SELECT_WEAPON_MODEL 
    if $weapon_cancel == 0
    then
        $anim_edit = 1
        gosub @SELECT_ANIMATION 
        if $anim_cancel == 0
        then
            gosub @OBJECTIVE_ACTOR_MENU
            if $actor_cancel == 0
            then
                gosub @SELECT_MARKER_COLOR
                if $marker_cancel == 0
                then

                    //0663: "actor ammo" $weapon_ammo
                    $DYOM_objective_model[$found]       = $actor_model
                    $DYOM_objective_animation[$found]   = $anim_id

                    if $anim_route == 2   //Extend route
                    then
                       0084: $last_point = $DYOM_objective_distance[$found]             
                       while $last_point < 0
                          $last_point += 1000
                       end
                       repeat
                          0663: printint "link" $last_point
                          if $DYOM_POINT_LINK[$last_point] < 0
                          then
                            while $anim_dist < 0
                              $anim_dist += 1000
                            end
                            0084: $DYOM_POINT_LINK[$last_point] = $anim_dist
                            0663: printint "attach" $anim_dist
                            break
                          end
                          $last_point = $DYOM_POINT_LINK[$last_point]
                        until false
                     else
                        // Remove routepoints if available
                        if NOT $has_list == 1
                        then
                            if or 
                                  $DYOM_objective_animation[$found] == -4
                                  $DYOM_objective_animation[$found] == -5
                                  $DYOM_objective_animation[$found] == -6
                            then
                              if $DYOM_objective_distance[$found] < -500
                              then
                                0084: $point = $DYOM_objective_distance[$found]
                                gosub @FREE_POINT_CHAIN
                              end
                            end 
                            if or 
                                  $DYOM_objective_animation[$found] == -2
                                  $DYOM_objective_animation[$found] == -3
                            then
                              0084: $point = $DYOM_objective_distance[$found]
                              gosub @FREE_POINT_CHAIN
                            end 
                        end
                       $DYOM_objective_distance[$found]      = $anim_dist
                     end

                    $DYOM_objective_data[$found]        = $weapon_model
                    $DYOM_objective_ammo[$found]        = $weapon_ammo
                    $DYOM_objective_accuracy[$found]    = $accuracy
                    $DYOM_objective_markercolor[$found] = $marker_color
                    $DYOM_objective_properties[$found]  = $properties
                    $DYOM_objective_health[$found]      = $health
                    $DYOM_objective_markercolor[$found] = $marker_color
                    $DYOM_objective_timelimit[$found]   = $timelimit
                    
                    // store location
                    04C4: store_coords_to $DYOM_objective_location_x[$found] $DYOM_objective_location_y[$found] $DYOM_objective_location_z[$found] from_actor $PLAYER_ACTOR with_offset 0.0 0.0 -1.0 
                    0172: $DYOM_objective_location_a[$found] = actor $PLAYER_ACTOR Z_angle 
                    077E: get_active_interior_to $DYOM_objective_interior[$found]
                    
                    Player.CanMove($PLAYER_CHAR) = False
                    gosub @EDIT_OBJTEXT
                end
            end
        end    
    end
end
Player.CanMove($PLAYER_CHAR) = False

fade 0 300
wait 300

// restore player
00A1: put_actor $PLAYER_ACTOR at $DYOM_objective_location_x[$found] $DYOM_objective_location_y[$found] $DYOM_objective_location_z[$found] 
0173: set_actor $PLAYER_ACTOR Z_angle_to $DYOM_objective_location_a[$found]
09C7: set_player $PLAYER_CHAR modelID_to #NULL
048F: actor $PLAYER_ACTOR remove_weapons 

gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY

fade 1 500
wait 500

Player.CanMove($PLAYER_CHAR) = True

return

//---------------
// OBJECTIVE CAR MENU
//---------------
:OBJECTIVE_CAR_MENU
Player.CanMove($PLAYER_CHAR) = False
if $carmenu_normal == 1
then
 s$extitem1 = 'CARDEST'
 s$extitem2 = 'DUMMY'
else
 s$extitem1 = 'SELSEAT'
 s$extitem2 = 'DRIVEBY'
end
08D4: $menu = create_panel_with_title 'CARS' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
08DB: set_panel $menu column 0 header 'CARS' data 'READY' 'HEALTH' 'BPROOF' 'EPROOF' 'DPROOF' 'TINV' s$extitem1 s$extitem2 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
gosub @GEN_MENU
if $menu_canceled == 1
then
  $car_cancel = 1
  return
end

if $menu_choice == 1
then
    //---------------------------------
    // ADD CAR HEALTH menu
    //---------------------------------
    08D4: $menu = create_panel_with_title 'HEALTH' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'HEALTH' data '100' '250' '500' '1000' '2500' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
      goto @OBJECTIVE_CAR_MENU
    end
    
    if $menu_choice == 0
    then
        $car_health = 100
    end
    
    if $menu_choice == 1
    then
        $car_health = 250
    end
    
    if $menu_choice == 2
    then
        $car_health = 500
    end
    
    if $menu_choice == 3
    then
        $car_health = 1000
    end
    
    if $menu_choice == 4
    then
        $car_health = 2500
    end 
    $menu_choice = 1  // restore toplevel choice
end


if $menu_choice == 2
then
    //---------------------------------
    // CAR BULLETPROOF
    //---------------------------------
    08D4: $menu = create_panel_with_title 'BPROOF' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'BPROOF' data 'YES' 'NO' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
      goto @OBJECTIVE_CAR_MENU
    end
    
    if $menu_choice == 0
    then
        08BA: set $car_properties bit DYOM_carpropbit_bulletproof 
    end
    
    if $menu_choice == 1
    then
        08C0: clear $car_properties bit DYOM_carpropbit_bulletproof  
    end
    $menu_choice = 2  // restore toplevel choice
end

if $menu_choice == 3
then
    //---------------------------------
    // CAR EXPLOSIONPROOF
    //---------------------------------
    08D4: $menu = create_panel_with_title 'EPROOF' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'EPROOF' data 'YES' 'NO' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
      goto @OBJECTIVE_CAR_MENU
    end
    
    if $menu_choice == 0
    then
        08BA: set $car_properties bit DYOM_carpropbit_explproof 
    end
    
    if $carchoice4 == 1
    then
         08C0: clear $car_properties bit DYOM_carpropbit_explproof  
    end
    $menu_choice = 3  // restore toplevel choice
end

if $menu_choice == 4
then
    //---------------------------------
    // CAR DAMAGEPROOF
    //---------------------------------
    08D4: $menu = create_panel_with_title 'DPROOF' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'DPROOF' data 'YES' 'NO' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
      goto @OBJECTIVE_CAR_MENU
    end
    
    if $menu_choice == 0
    then
        08BA: set $car_properties bit DYOM_carpropbit_damproof 
    end
    
    if $menu_choice == 1
    then
         08C0: clear $car_properties bit DYOM_carpropbit_damproof  
    end
    $menu_choice = 4  // restore toplevel choice
end

if $menu_choice == 5
then
    //---------------------------------
    // CAR TIRES
    //---------------------------------
    08D4: $menu = create_panel_with_title 'TINV' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'TINV' data 'YES' 'NO' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
      goto @OBJECTIVE_CAR_MENU
    end
    
    if $menu_choice == 0
    then
        08BA: set $car_properties bit DYOM_carpropbit_popproof 
    end
    
    if $menu_choice == 1
    then
         08C0: clear $car_properties bit DYOM_carpropbit_popproof  
    end
    $menu_choice = 5  // restore toplevel choice
end

if $menu_choice == 6
then
    if $carmenu_normal == 1
    then
        //---------------------------------
        // MUST DESTROY
        //---------------------------------
        08D4: $menu = create_panel_with_title 'CARDEST' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'CARDEST' data 'YES' 'NO' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'
        
        gosub @GEN_MENU
        if $menu_canceled == 1
        then
          goto @OBJECTIVE_CAR_MENU
        end
        
        if $menu_choice == 0
        then
            08BA: set $car_properties bit DYOM_carpropbit_mustdestroy 
        end
        
        if $menu_choice == 1
        then
             08C0: clear $car_properties bit DYOM_carpropbit_mustdestroy  
        end
    else
        //---------------------------------
        // SEAT
        //---------------------------------
        08D4: $seatmenu = create_panel_with_title 'SELSEAT' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $seatmenu column 0 header 'SELSEAT' data 'SEATD' 'SEAT1' 'SEAT2' 'SEAT3' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
        gosub @GEN_MENU
        if $menu_canceled == 1
        then
          goto @OBJECTIVE_CAR_MENU
        end
        $car_seat = $menu_choice

    end
    $menu_choice = 6  // restore toplevel choice
end

if $menu_choice == 7
then
    //---------------------------------
    // DRIVEBY
    //---------------------------------
    08D4: $menu = create_panel_with_title 'DRIVEBY' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'DRIVEBY' data 'YES' 'NO' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
      goto @OBJECTIVE_CAR_MENU
    end
    
    if $menu_choice == 0
    then
        0662: "SET DRIVEBY"
        08BA: set $car_properties bit DYOM_carpropbit_driveby 
    end
    
    if $menu_choice == 1
    then
        0662: "clear DRIVEBY"
       08C0: clear $car_properties bit DYOM_carpropbit_driveby  
    end
    $menu_choice = 7  // restore toplevel choice
end

    
if $menu_choice == 0
then
    08DA: remove_panel $menu
    03E6: remove text box 
    return    
end  
jump @OBJECTIVE_CAR_MENU


//===============================
// ADD OBJECTIVE: CAR
//===============================
:ADD_OBJECTIVE_CAR
$car_health = 1000
$car_properties = 0

gosub @SELECT_CAR_MODEL
if $car_cancel == 1
then
  return
end

if 00DB:   actor $PLAYER_ACTOR in_car $car 
then
  00AA: store_car $car position_to 21@ 22@ 23@ 
  02CE: 24@ = ground_z_at 21@ 22@ 23@ 
  0063: 23@ -= 24@ 
  if 23@ < 5.0
  then
    05CD: AS_actor $PLAYER_ACTOR exit_car $car 
    repeat
       wait 0
    until 80DB: NOT  actor $PLAYER_ACTOR in_car $car  
  else
    0362: remove_actor $PLAYER_ACTOR from_car_and_place_at 21@ 22@ 24@
  end
end
Car.DoorStatus($car) = 4  
car.LockInCurrentPosition($car,TRUE)
02AC: set_car $car immunities BP 1 FP 1 EP 1 CP 1 MP 1 
099A: set_car $car collision_detection 0 

Player.CanMove($PLAYER_CHAR) = False
$carmenu_normal = 1
gosub @OBJECTIVE_CAR_MENU
if $car_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  car.Destroy($car)
  return
end
gosub @SELECT_MARKER_COLOR
if $marker_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  car.Destroy($car)
  return
end

gosub @NEW_OBJECTIVE
// $found will be the location for this objective

//---------------
// Store CAR
//---------------
//00AA: store_car $car position_to $DYOM_objective_location_x[$found] $DYOM_objective_location_y[$found] $DYOM_objective_location_z[$found]
0407: store_coords_to $DYOM_objective_location_x[$found] $DYOM_objective_location_y[$found] $DYOM_objective_location_z[$found] from_car $car with_offset 0.0 0.0 -1.0 
0174: $DYOM_objective_location_a[$found]  = car $car Z_angle 
077E: get_active_interior_to $DYOM_objective_interior[$found]

$DYOM_objective_type[$found]        = DYOM_objtype_car
$DYOM_objective_model[$found]       = $car_model  
$DYOM_objective_data[$found]        = $car_color  
$DYOM_objective_accuracy[$found]    = $car_color2  
$DYOM_objective_markercolor[$found] = $marker_color
$DYOM_objective_timelimit[$found]   = 0
$DYOM_objective_properties[$found]  = $car_properties
$DYOM_objective_health[$found]      = $car_health
$DYOM_objective_handle[$found]      = $car 

gosub @NEW_OBJTEXT


gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
Player.CanMove($PLAYER_CHAR) = True

$found += 1
01E4: show_text_1number_lowpriority GXT 'NEWOBJ' number $found time 1000 flag 1 
return


//===============================
// EDIT OBJECTIVE: CAR
//===============================
:EDIT_OBJECTIVE_CAR

$TEMPVAR_FLOAT_1 = $DYOM_objective_location_x[$found]
$TEMPVAR_FLOAT_2 = $DYOM_objective_location_y[$found]
$TEMPVAR_FLOAT_3 = $DYOM_objective_location_z[$found] 
$TEMP_INTERIOR   = $DYOM_objective_interior[$found] 
$TEMPVAR_ANGLE   = $DYOM_objective_location_a[$found]
$car_model       = $DYOM_objective_model[$found] 
$car_color       = $DYOM_objective_data[$found]
$car_color2      = $DYOM_objective_accuracy[$found]
$car_properties  = $DYOM_objective_properties[$found]
$car_health      = $DYOM_objective_health[$found]
$marker_color    = $DYOM_objective_markercolor[$found]
$timelimit        = $DYOM_objective_timelimit[$found]

06BA: AS_actor $PLAYER_ACTOR turn_to_and_look_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3
wait 1000
0373: set_camera_directly_behind_player 
02EB: restore_camera_with_jumpcut
car.Destroy($DYOM_objective_handle[$found])

$car_cancel = 0
$marker_cancel = 0
gosub @SELECT_CAR_MODEL_EDIT
if $car_cancel == 0
then
    Player.CanMove($PLAYER_CHAR) = False
    if 00DB:   actor $PLAYER_ACTOR in_car $car 
    then
      00AA: store_car $car position_to 21@ 22@ 23@ 
      02CE: 24@ = ground_z_at 21@ 22@ 23@  
      0063: 23@ -= 24@ 
      if 23@ < 5.0
      then
        05CD: AS_actor $PLAYER_ACTOR exit_car $car 
        repeat
           wait 0
        until 80DB: NOT  actor $PLAYER_ACTOR in_car $car  
      else
        0362: remove_actor $PLAYER_ACTOR from_car_and_place_at 21@ 22@ 24@
      end
    end
    $carmenu_normal = 1
    gosub @OBJECTIVE_CAR_MENU
    if $car_cancel == 0
    then
        gosub @SELECT_MARKER_COLOR
        if $marker_cancel == 0
        then
            0407: store_coords_to $DYOM_objective_location_x[$found] $DYOM_objective_location_y[$found] $DYOM_objective_location_z[$found] from_car $car with_offset 0.0 0.0 -1.0 
            0174: $DYOM_objective_location_a[$found]  = car $car Z_angle 
            077E: get_active_interior_to $DYOM_objective_interior[$found]
            
            gosub @EDIT_OBJTEXT
            $DYOM_objective_model[$found]             = $car_model  
            $DYOM_objective_handle[$found]            = $car 
            $DYOM_objective_data[$found]              = $car_color
            $DYOM_objective_accuracy[$found]          = $car_color2
               
            $DYOM_objective_health[$found]            = $car_health
            $DYOM_objective_properties[$found]        = $car_properties
            $DYOM_objective_markercolor[$found]       = $marker_color
            $DYOM_objective_timelimit[$found]         = $timelimit

        end
    end
end


gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
Player.CanMove($PLAYER_CHAR) = TRUE

return




//---------------
// OBJECTIVE PICKUP MENU
//---------------
var
   $pu_properties: Integer
end
:OBJECTIVE_PICKUP_MENU
Player.CanMove($PLAYER_CHAR) = False
08D4: $menu = create_panel_with_title 'PICKUPS' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
08DB: set_panel $menu column 0 header 'PICKUPS' data 'READY' 'MULPU' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
gosub @GEN_MENU
if $menu_canceled == 1
then
  $pickup_cancel = 1
  return
end

if $menu_choice == 1
then
    //---------------------------------
    // pickup ALL PICKUPS menu
    //---------------------------------
    08D4: $menu = create_panel_with_title 'PICKUPS' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'MULPU' data 'OFF' 'ON' 'ONCNT' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
      goto @OBJECTIVE_PICKUP_MENU
    end
    
    if $menu_choice == 0
    then
      08C0: clear $pu_properties bit DYOM_pickuppropbit_pickall
      08C0: clear $pu_properties bit DYOM_pickuppropbit_counter
    else
        08BA: set $pu_properties bit DYOM_pickuppropbit_pickall 
        if $menu_choice == 1
        then
          08C0: clear $pu_properties bit DYOM_pickuppropbit_counter
        else
          08BA: set $pu_properties bit DYOM_pickuppropbit_counter 
        end
    end
    jump @OBJECTIVE_PICKUP_MENU               
end

    
if $menu_choice == 0
then
    08DA: remove_panel $menu
    03E6: remove text box 
    return    
end  
jump @OBJECTIVE_PICKUP_MENU

//===============================
// ADD OBJECTIVE: PICKUP
//===============================
:ADD_OBJECTIVE_PICKUP
Player.CanMove($PLAYER_CHAR) = False
$pu_properties = 0
04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 1.5 0.0
gosub @SELECT_PICKUP_MODEL
if $pickup_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  return
end
gosub @OBJECTIVE_PICKUP_MENU
if $pickup_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  return
end
gosub @SELECT_MARKER_COLOR
if $marker_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  return
end

gosub @NEW_OBJECTIVE
// $found will be the location for this objective


$DYOM_objective_location_x[$found] = $TEMPVAR_FLOAT_1
$DYOM_objective_location_y[$found] = $TEMPVAR_FLOAT_2 
$DYOM_objective_location_z[$found] = $TEMPVAR_FLOAT_3
077E: get_active_interior_to $DYOM_objective_interior[$found]

$DYOM_objective_type[$found]        = DYOM_objtype_pickup
$DYOM_objective_model[$found]       = $pickup_model  
$DYOM_objective_data[$found]        = 0  
$DYOM_objective_ammo[$found]        = $pickup_ammo  
$DYOM_objective_markercolor[$found] = $marker_color
$DYOM_objective_timelimit[$found]   = 0
$DYOM_objective_handle[$found]      = $pickup
$DYOM_objective_properties[$found]  = $pu_properties

gosub @NEW_OBJTEXT

 
$found += 1
01E4: show_text_1number_lowpriority GXT 'NEWOBJ' number $found time 1000 flag 1 
gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY

Player.CanMove($PLAYER_CHAR) = True
return



//===============================
// EDIT OBJECTIVE PICKUP
//===============================
:EDIT_OBJECTIVE_PICKUP
Player.CanMove($PLAYER_CHAR) = False

$pickup = $DYOM_objective_handle[$found]

$TEMPVAR_FLOAT_1 = $DYOM_objective_location_x[$found]
$TEMPVAR_FLOAT_2 = $DYOM_objective_location_y[$found]
$TEMPVAR_FLOAT_3 = $DYOM_objective_location_z[$found] 
$pickup_model    = $DYOM_objective_model[$found]
$pickup_ammo     = $DYOM_objective_ammo[$found]
$marker_color    = $DYOM_objective_markercolor[$found]
$timelimit       = $DYOM_objective_timelimit[$found]
$pu_properties   = $DYOM_objective_properties[$found]


06BA: AS_actor $PLAYER_ACTOR turn_to_and_look_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3
wait 1000
0373: set_camera_directly_behind_player 
02EB: restore_camera_with_jumpcut

gosub @SELECT_PICKUP_MODEL
if $pickup_cancel == 0
then
    gosub @OBJECTIVE_PICKUP_MENU
    if $pickup_cancel == 0
    then
        gosub @SELECT_MARKER_COLOR
        if $pickup_cancel == 0
        then
            gosub @EDIT_OBJTEXT
    
            $DYOM_objective_location_x[$found] = $TEMPVAR_FLOAT_1
            $DYOM_objective_location_y[$found] = $TEMPVAR_FLOAT_2 
            $DYOM_objective_location_z[$found] = $TEMPVAR_FLOAT_3
            
            $DYOM_objective_model[$found]       = $pickup_model
            $DYOM_objective_ammo[$found]        = $pickup_ammo
            $DYOM_objective_markercolor[$found] = $marker_color
            $DYOM_objective_timelimit[$found]   = $timelimit
            $DYOM_objective_properties[$found]  = $pu_properties
            pickup.Destroy($pickup)
        end  
    end
end



gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY

Player.CanMove($PLAYER_CHAR) = True


return


//===============================
// ADD OBJECTIVE: MARKER
//===============================
:ADD_OBJECTIVE_MARKER
Player.CanMove($PLAYER_CHAR) = False
04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 0.0 0.0

gosub @SELECT_MARKER_MODEL
if $marker_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  return
end

gosub @SELECT_MARKER_COLOR
if $marker_cancel == 1
then
  if $marker_model == 0
  then
        03BD: destroy_sphere $marker
  else
    if $marker_model == 6
    then
      0A41: destroy_entrance_marker $marker
    else
      06D6: disable_racing_checkpoint $marker 
    end
  end
  
  Player.CanMove($PLAYER_CHAR) = True
  return
end

gosub @NEW_OBJECTIVE
// $found will be the location for this objective

$DYOM_objective_location_x[$found] = $TEMPVAR_FLOAT_1
$DYOM_objective_location_y[$found] = $TEMPVAR_FLOAT_2 
$DYOM_objective_location_z[$found] = $TEMPVAR_FLOAT_3
077E: get_active_interior_to $DYOM_objective_interior[$found]

$DYOM_objective_handle[$found] = $marker 

// Store OBJECTIVE
$DYOM_objective_location_a[$found]   =  $marker_size   
$DYOM_objective_distance[$found]     =  $TEMPVAR_ANGLE  
$DYOM_objective_type[$found]         =  DYOM_objtype_marker
$DYOM_objective_model[$found]        =  $marker_model
$DYOM_objective_markercolor[$found]  =  $marker_color
$DYOM_objective_timelimit[$found]    = 0

$DYOM_objective_ammo[$found] = object.Init(#CIGAR_GLOW,$DYOM_objective_location_x[$found], $DYOM_objective_location_y[$found], $DYOM_objective_location_z[$found])
Object.KeepInMemory($DYOM_objective_ammo[$found]) = True
Object.ToggleInMovingList($DYOM_objective_ammo[$found]) = False
Object.RemoveFromMissionCleanupList($DYOM_objective_ammo[$found])

0566: link_object $DYOM_objective_ammo[$found] to_interior $DYOM_objective_interior[$found] 

gosub @NEW_OBJTEXT
Player.CanMove($PLAYER_CHAR) = True

$found += 1
01E4: show_text_1number_lowpriority GXT 'NEWOBJ' number $found time 1000 flag 1 
gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY


return


//===============================
// EDIT OBJECTIVE: MARKER
//===============================
:EDIT_OBJECTIVE_MARKER
if or 
   $DYOM_objective_model[$found] == 0
   $DYOM_objective_model[$found] == 5
then
  03BD: destroy_sphere $DYOM_objective_handle[$found]
else
  if $DYOM_objective_model[$found] == 6
  then
    0A41: destroy_entrance_marker $DYOM_objective_handle[$found]
  else
    06D6: disable_racing_checkpoint $DYOM_objective_handle[$found]
  end  
end
$DYOM_objective_handle[$found] = -1
if 03CA:   object $DYOM_objective_ammo[$found] exists 
then
  object.Destroy($DYOM_objective_ammo[$found])
end

$TEMPVAR_FLOAT_1 = $DYOM_objective_location_x[$found]
$TEMPVAR_FLOAT_2 = $DYOM_objective_location_y[$found]
$TEMPVAR_FLOAT_3 = $DYOM_objective_location_z[$found] 
$TEMPVAR_ANGLE   = $DYOM_objective_distance[$found]
$marker_size     = $DYOM_objective_location_a[$found]   
$marker_color    = $DYOM_objective_markercolor[$found]
$timelimit       = $DYOM_objective_timelimit[$found]
$marker_model    = $DYOM_objective_model[$found]  

06BA: AS_actor $PLAYER_ACTOR turn_to_and_look_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3
wait 1000
0373: set_camera_directly_behind_player 
02EB: restore_camera_with_jumpcut

gosub @SELECT_MARKER_MODEL
if $marker_cancel == 0
then
    gosub @SELECT_MARKER_COLOR
    if $marker_cancel == 0
    then
        gosub @EDIT_OBJTEXT
        $DYOM_objective_location_x[$found] = $TEMPVAR_FLOAT_1
        $DYOM_objective_location_y[$found] = $TEMPVAR_FLOAT_2 
        $DYOM_objective_location_z[$found] = $TEMPVAR_FLOAT_3
        $DYOM_objective_handle[$found]     = 0 
        $DYOM_objective_location_a[$found]  = $marker_size   
        $DYOM_objective_distance[$found]    = $TEMPVAR_ANGLE   
        $DYOM_objective_model[$found]       = $marker_model
        $DYOM_objective_markercolor[$found] = $marker_color
        $DYOM_objective_timelimit[$found]   = $timelimit
    end
end


gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY

Player.CanMove($PLAYER_CHAR) = True



return




//===============================
// ADD OBJECTIVE: TELEPORT
//===============================
:ADD_OBJECTIVE_TELEPORT
Player.CanMove($PLAYER_CHAR) = True
048F: actor $PLAYER_ACTOR remove_weapons  

$health = 100
gosub @SELECT_ACTOR_MODEL
if $actor_cancel == 1
then
  09C7: set_player $PLAYER_CHAR modelID_to #NULL 
  return
end
gosub @SELECT_WEAPON_MODEL
if $weapon_cancel == 1
then
  09C7: set_player $PLAYER_CHAR modelID_to #NULL 
  048F: actor $PLAYER_ACTOR remove_weapons 
  return
end
gosub @PLAYER_MENU
if $player_cancel == 1
then
  09C7: set_player $PLAYER_CHAR modelID_to #NULL 
  048F: actor $PLAYER_ACTOR remove_weapons 
  return
end   

gosub @NEW_OBJECTIVE
// $found will be the location for this objective

// Clear text for this objective (teleports don't show it anyway :)  )
// 0512: show_permanent_text_box 'OBJTEXT' 
$TEXTCUR = $found
$TEXTCUR *= 100
$TEXTCUR += $TEXTOBJECTIVES
gosub @TEXT_clear

fade 0 300
wait 300

04C4: store_coords_to $DYOM_objective_location_x[$found] $DYOM_objective_location_y[$found] $DYOM_objective_location_z[$found] from_actor $PLAYER_ACTOR with_offset 0.0 0.0 -1.0 
0172: $DYOM_objective_location_a[$found] = actor $PLAYER_ACTOR Z_angle 
077E: get_active_interior_to $DYOM_objective_interior[$found]

// restore player
09C7: set_player $PLAYER_CHAR modelID_to #NULL
048F: actor $PLAYER_ACTOR remove_weapons 

$DYOM_objective_type[$found]        = DYOM_objtype_teleport
$DYOM_objective_model[$found]       = $actor_model
$DYOM_objective_animation[$found]   = 0
$DYOM_objective_distance[$found]    = 0
$DYOM_objective_data[$found]        = $weapon_model
$DYOM_objective_ammo[$found]        = $weapon_ammo
$DYOM_objective_accuracy[$found]    = 0
$DYOM_objective_markercolor[$found] = 0
$DYOM_objective_timelimit[$found]   = 0
$DYOM_objective_properties[$found]  = 0
$DYOM_objective_health[$found]      = $health
$DYOM_objective_handle[$found]      = -1



gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
Player.CanMove($PLAYER_CHAR) = True

fade 1 500
wait 500

$found += 1
01E4: show_text_1number_lowpriority GXT 'NEWOBJ' number $found time 1000 flag 1 
return



//===============================
// EDIT OBJECTIVE: TELEPORT
//===============================
:EDIT_OBJECTIVE_TELEPORT
Player.CanMove($PLAYER_CHAR) = True
048F: actor $PLAYER_ACTOR remove_weapons 

// Remove Player_dummy, if already exist
if 056D:   actor $DYOM_objective_handle[$found] defined 
then
  actor.DestroyInstantly($DYOM_objective_handle[$found])
end

$actor_model = $DYOM_objective_model[$found]
$weapon_model = $DYOM_objective_data[$found]
$weapon_ammo = $DYOM_objective_ammo[$found] 
00A1: put_actor $PLAYER_ACTOR at $DYOM_objective_location_x[$found] $DYOM_objective_location_y[$found] $DYOM_objective_location_z[$found] 
0173: set_actor $PLAYER_ACTOR Z_angle_to $DYOM_objective_location_a[$found]
048F: actor $PLAYER_ACTOR remove_weapons 
$health      = $DYOM_objective_health[$found]

gosub @SELECT_ACTOR_MODEL
if $actor_cancel == 0
then
    gosub @SELECT_WEAPON_MODEL
    if $weapon_cancel == 0
    then
        gosub @PLAYER_MENU
        if $player_cancel == 0
        then
            04C4: store_coords_to $DYOM_objective_location_x[$found] $DYOM_objective_location_y[$found] $DYOM_objective_location_z[$found] from_actor $PLAYER_ACTOR with_offset 0.0 0.0 -1.0 
            0172: $DYOM_objective_location_a[$found] = actor $PLAYER_ACTOR Z_angle 
            077E: get_active_interior_to $DYOM_objective_interior[$found]
            $DYOM_objective_type[$found]        = DYOM_objtype_teleport
            $DYOM_objective_model[$found]       = $actor_model
            $DYOM_objective_animation[$found]   = 0
            $DYOM_objective_distance[$found]    = 0
            $DYOM_objective_data[$found]        = $weapon_model
            $DYOM_objective_ammo[$found]        = $weapon_ammo
            $DYOM_objective_accuracy[$found]    = 0
            $DYOM_objective_markercolor[$found] = 0
            $DYOM_objective_timelimit[$found]   = 0
            $DYOM_objective_properties[$found]  = 0
            $DYOM_objective_health[$found]      = $health
            $DYOM_objective_handle[$found]      = -1
           
        end
    end    
end

fade 0 300
wait 300

// restore player
00A1: put_actor $PLAYER_ACTOR at $DYOM_objective_location_x[$found] $DYOM_objective_location_y[$found] $DYOM_objective_location_z[$found] 
0173: set_actor $PLAYER_ACTOR Z_angle_to $DYOM_objective_location_a[$found]
09C7: set_player $PLAYER_CHAR modelID_to #NULL
048F: actor $PLAYER_ACTOR remove_weapons 

gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
Player.CanMove($PLAYER_CHAR) = True

fade 1 500
wait 500

return

//---------------
// CUTSCENE MENU
//---------------
var
   $cs_cancel: Integer
   $cs_properties: Integer
end
:CSMENU
$cs_cancel = 0
Player.CanMove($PLAYER_CHAR) = False
    08D4: $menu = create_panel_with_title 'ADDCUT' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
    08DB: set_panel $menu column 0 header 'PROP' data 'READY' 'CSSLO' 'CSSHK' 'CSFDS' 'CSWDS' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
    
    gosub @GEN_MENU
    if $menu_canceled == 1
    then
        $cs_cancel = 1 
        return                                              
    end
    
    if $menu_choice == 1
    then
        //---------------------------------
        // cutscene slowmo
        //---------------------------------
        08D4: $menu = create_panel_with_title 'PROP' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'CSSLO' data 'YES' 'NO' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'
      
        gosub @GEN_MENU
        if $menu_canceled == 1
        then
          goto @CSMENU
        end
        
        if $menu_choice == 0
        then
            08BA: set $cs_properties bit DYOM_cutscene_prop_slowmo 
        else
            08C0: clear $cs_properties bit DYOM_cutscene_prop_slowmo  
        end
        $menu_choice = 1 // restore toplevel choice
    end
    
    if $menu_choice == 2
    then
        //---------------------------------
        // cutscene shake 
        //---------------------------------
        08D4: $menu = create_panel_with_title 'PROP' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'CSSHK' data 'YES' 'NO' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'
      
        gosub @GEN_MENU
        if $menu_canceled == 1
        then
          goto @CSMENU
        end
        
        if $menu_choice == 0
        then
            08BA: set $cs_properties bit DYOM_cutscene_prop_shake 
        else
             08C0: clear $cs_properties bit DYOM_cutscene_prop_shake  
        end
        $menu_choice = 2 // restore toplevel choice
    end
    
    if $menu_choice == 3
    then
        //---------------------------------
        // cutscene skip fade 
        //---------------------------------
        08D4: $menu = create_panel_with_title 'PROP' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'CSFDS' data 'YES' 'NO' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'
      
        gosub @GEN_MENU
        if $menu_canceled == 1
        then
          goto @CSMENU
        end
        
        if $menu_choice == 0
        then
            08BA: set $cs_properties bit DYOM_cutscene_skip_fade 
        else
             08C0: clear $cs_properties bit DYOM_cutscene_skip_fade  
        end
        $menu_choice = 3 // restore toplevel choice
    end
    if $menu_choice == 4
    then
        //---------------------------------
        // cutscene skip fade 
        //---------------------------------
        08D4: $menu = create_panel_with_title 'PROP' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'CSWDS' data 'YES' 'NO' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'
      
        gosub @GEN_MENU
        if $menu_canceled == 1
        then
          goto @CSMENU
        end
        
        if $menu_choice == 0
        then
            08BA: set $cs_properties bit DYOM_cutscene_skip_wide 
        else
             08C0: clear $cs_properties bit DYOM_cutscene_skip_wide  
        end
        $menu_choice = 4 // restore toplevel choice
    end
    

        
    if $menu_choice == 0
    then
        08DA: remove_panel $menu
        03E6: remove text box 
        return    
    end  
    jump @CSMENU
// CSMENU_END    

//===============================
// ADD OBJECTIVE: CUTSCENE
//===============================
:ADD_OBJECTIVE_CUTSCENE
Player.CanMove($PLAYER_CHAR) = False
04C4: store_coords_to $CAM_X $CAM_Y $CAM_Z from_actor $PLAYER_ACTOR with_offset 0.0 0.0 2.0
04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 5.0 2.0
gosub @SELECT_CAMERA_MODE
if $camera_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  return
end

gosub @SELECT_CAMERA_POSITION
if $camera_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  return
end

$time_value = 5
0512: permanent_text_box 'CUTTIM'
gosub @SELECT_SPECIAL_DURATION
if $time_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  return
end

$cs_properties = 0
gosub @CSMENU
if $cs_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  return
end


gosub @NEW_OBJECTIVE
// found will be the location for this objective

$DYOM_objective_location_x[$found] = $CAM_X 
$DYOM_objective_location_y[$found] = $CAM_Y 
02CE: $DYOM_objective_location_z[$found] = ground_z_at $CAM_X $CAM_Y $CAM_Z 
$DYOM_objective_location_z[$found] += 1.0
077E: get_active_interior_to $DYOM_objective_interior[$found]


$DYOM_objective_handle[$found]     = object.init(#CAMERAPICKUP,$DYOM_objective_location_x[$found],$DYOM_objective_location_y[$found],$DYOM_objective_location_z[$found])
0382: set_object $DYOM_objective_handle[$found] collision_detection 0 


// Store OBJECTIVE
$DYOM_objective_type[$found]              = DYOM_objtype_cutscene
0086: $DYOM_objective_location_a[$found]  = $CAM_Z   
0086: $DYOM_objective_model[$found]       = $TEMPVAR_FLOAT_1
0086: $DYOM_objective_markercolor[$found] = $TEMPVAR_FLOAT_2
0086: $DYOM_objective_ammo[$found]        = $TEMPVAR_FLOAT_3
$DYOM_objective_data[$found]              = $time_value
$DYOM_objective_timelimit[$found]         = 0
$DYOM_objective_properties[$found]        = $camera_mode
$DYOM_objective_properties[$found]        += $cs_properties
$DYOM_objective_animation[$found]         = $camera_actor

gosub @NEW_OBJTEXT
Player.CanMove($PLAYER_CHAR) = True

$found += 1
01E4: show_text_1number_lowpriority GXT 'NEWOBJ' number $found time 1000 flag 1 
gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY


return


//===============================
// EDIT OBJECTIVE: CUTSCENE
//===============================
:EDIT_OBJECTIVE_CUTSCENE
object.Destroy($DYOM_objective_handle[$found])

Player.CanMove($PLAYER_CHAR) = False
$CAM_X = $DYOM_objective_location_x[$found]
$CAM_Y = $DYOM_objective_location_y[$found]
$CAM_Z = $DYOM_objective_location_a[$found]
0086: $TEMPVAR_FLOAT_1 = $DYOM_objective_model[$found]
0086: $TEMPVAR_FLOAT_2 = $DYOM_objective_markercolor[$found] 
0086: $TEMPVAR_FLOAT_3 = $DYOM_objective_ammo[$found]     
$time_value = $DYOM_objective_data[$found]
$camera_mode = $DYOM_objective_properties[$found]
$cs_properties = $DYOM_objective_properties[$found]
08C0: clear $camera_mode bit DYOM_cutscene_prop_slowmo  
08C0: clear $camera_mode bit DYOM_cutscene_prop_shake  
08C0: clear $camera_mode bit DYOM_cutscene_skip_fade  
08C0: clear $camera_mode bit DYOM_cutscene_skip_wide  
08C0: clear $cs_properties bit 0  
08C0: clear $cs_properties bit 1  
08C0: clear $cs_properties bit 2  
08C0: clear $cs_properties bit 3  

$camera_actor = $DYOM_objective_animation[$found]
gosub @SELECT_CAMERA_MODE
if $camera_cancel == 0
then
    gosub @SELECT_CAMERA_POSITION
    if $camera_cancel == 0
    then
        0512: permanent_text_box 'CUTTIM'
        gosub @SELECT_SPECIAL_DURATION
        if $time_cancel == 0
        then
            gosub @CSMENU
            if $cs_cancel == 0
            then
                gosub @EDIT_OBJTEXT
                $DYOM_objective_location_x[$found]        = $CAM_X 
                $DYOM_objective_location_y[$found]        = $CAM_Y 
                02CE: $DYOM_objective_location_z[$found]  = ground_z_at $CAM_X $CAM_Y $CAM_Z 
                $DYOM_objective_location_z[$found]        += 1.0
                $DYOM_objective_type[$found]              = DYOM_objtype_cutscene
                0086: $DYOM_objective_location_a[$found]  = $CAM_Z   
                0086: $DYOM_objective_model[$found]       = $TEMPVAR_FLOAT_1
                0086: $DYOM_objective_markercolor[$found] = $TEMPVAR_FLOAT_2
                0086: $DYOM_objective_ammo[$found]        = $TEMPVAR_FLOAT_3
                $DYOM_objective_data[$found]              = $time_value
                $DYOM_objective_properties[$found]        = $camera_mode
                $DYOM_objective_properties[$found]        += $cs_properties
                $DYOM_objective_animation[$found]         = $camera_actor
            end
        end
    end 
end

Player.CanMove($PLAYER_CHAR) = True

gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY


return





//===============================
// ADD COUNTDOWN
//===============================
:ADD_OBJECTIVE_COUNTDOWN
Player.CanMove($PLAYER_CHAR) = False
04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 0.0 0.0
$time_value = 5
0512: permanent_text_box 'CNTTIM'
gosub @SELECT_SPECIAL_DURATION
if $time_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  return
end

gosub @NEW_OBJECTIVE
// found will be the location for this objective

$DYOM_objective_location_x[$found] = $TEMPVAR_FLOAT_1 
$DYOM_objective_location_y[$found] = $TEMPVAR_FLOAT_2 
02CE: $DYOM_objective_location_z[$found] = ground_z_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 
$DYOM_objective_location_z[$found] += 1.0
077E: get_active_interior_to $DYOM_objective_interior[$found]

// Store OBJECTIVE
$DYOM_objective_type[$found]        = DYOM_objtype_countdown
$DYOM_objective_data[$found]              = $time_value

gosub @NEW_OBJTEXT
Player.CanMove($PLAYER_CHAR) = True

$found += 1
01E4: show_text_1number_lowpriority GXT 'NEWOBJ' number $found time 1000 flag 1 
gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
return

//===============================
// EDIT COUNTDOWN
//===============================
:EDIT_OBJECTIVE_COUNTDOWN
object.Destroy($DYOM_objective_handle[$found])

Player.CanMove($PLAYER_CHAR) = False
$time_value = $DYOM_objective_data[$found]
0512: show_permanent_text_box 'CNTTIM'
gosub @SELECT_SPECIAL_DURATION
if $time_cancel == 1
then
    $time_value = $DYOM_objective_data[$found]
else
    gosub @EDIT_OBJTEXT
end 

$DYOM_objective_data[$found]              = $time_value

Player.CanMove($PLAYER_CHAR) = True

gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
return

//===============================
// ADD TELEPORT TO CAR
//===============================
:ADD_OBJECTIVE_TELECAR
$car_health = 1000
$car_seat = 0
$car_properties = 0

gosub @SELECT_CAR_MODEL
if $car_cancel == 1
then
  return
end

Player.CanMove($PLAYER_CHAR) = False
$carmenu_normal = 0
gosub @OBJECTIVE_CAR_MENU
if $car_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  00A6: destroy_car $car
  return
end

gosub @SELECT_MARKER_COLOR
if $marker_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  00A6: destroy_car $car
  return
end


if 00DB:   actor $PLAYER_ACTOR in_car $car 
then
  00AA: store_car $car position_to 21@ 22@ 23@ 
  02CE: 24@ = ground_z_at 21@ 22@ 23@  
  0063: 23@ -= 24@
  if 23@ < 5.0
  then
    05CD: AS_actor $PLAYER_ACTOR exit_car $car 
    repeat
       wait 0
    until 80DB: NOT  actor $PLAYER_ACTOR in_car $car  
  else
    0362: remove_actor $PLAYER_ACTOR from_car_and_place_at 21@ 22@ 24@
  end
end

gosub @NEW_OBJECTIVE
// $found will be the location for this objective

//---------------
// Store CAR
//---------------
//00AA: store_car $car position_to $DYOM_objective_location_x[$found] $DYOM_objective_location_y[$found] $DYOM_objective_location_z[$found]
0407: store_coords_to $DYOM_objective_location_x[$found] $DYOM_objective_location_y[$found] $DYOM_objective_location_z[$found] from_car $car with_offset 0.0 0.0 -1.0 
0174: $DYOM_objective_location_a[$found]  = car $car Z_angle 
077E: get_active_interior_to $DYOM_objective_interior[$found]
$DYOM_objective_type[$found]        = DYOM_objtype_telecar
$DYOM_objective_model[$found]       = $car_model  
$DYOM_objective_data[$found]        = $car_color  
$DYOM_objective_accuracy[$found]    = $car_color2  
$DYOM_objective_ammo[$found]        = $car_seat  
$DYOM_objective_markercolor[$found] = $marker_color
$DYOM_objective_timelimit[$found]   = 0
$DYOM_objective_properties[$found]  = $car_properties
$DYOM_objective_health[$found]      = $car_health
$DYOM_objective_handle[$found]      = $car 

gosub @NEW_OBJTEXT


gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
Player.CanMove($PLAYER_CHAR) = True

$found += 1
01E4: show_text_1number_lowpriority GXT 'NEWOBJ' number $found time 1000 flag 1 
return


//===============================
// EDIT TELEPORT TO CAR
//===============================
:EDIT_OBJECTIVE_TELECAR
$TEMPVAR_FLOAT_1 = $DYOM_objective_location_x[$found]
$TEMPVAR_FLOAT_2 = $DYOM_objective_location_y[$found]
$TEMPVAR_FLOAT_3 = $DYOM_objective_location_z[$found] 
$TEMP_INTERIOR   = $DYOM_objective_interior[$found] 
$TEMPVAR_ANGLE   = $DYOM_objective_location_a[$found]
$car_model       = $DYOM_objective_model[$found] 
$car_color       = $DYOM_objective_data[$found]
$car_color2      = $DYOM_objective_accuracy[$found]
$car_properties  = $DYOM_objective_properties[$found]
$car_health      = $DYOM_objective_health[$found]
$car_seat        = $DYOM_objective_ammo[$found]
$marker_color    = $DYOM_objective_markercolor[$found]
$timelimit       = $DYOM_objective_timelimit[$found]

06BA: AS_actor $PLAYER_ACTOR turn_to_and_look_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3
wait 1000
0373: set_camera_directly_behind_player 
02EB: restore_camera_with_jumpcut
car.Destroy($DYOM_objective_handle[$found])

$car_cancel = 0
$marker_cancel = 0
gosub @SELECT_CAR_MODEL_EDIT
if $car_cancel == 0
then
    Player.CanMove($PLAYER_CHAR) = False
    if 00DB:   actor $PLAYER_ACTOR in_car $car 
    then
      00AA: store_car $car position_to 21@ 22@ 23@ 
      02CE: 24@ = ground_z_at 21@ 22@ 23@  
      0063: 23@ -= 24@
      if 23@ < 5.0
      then
        05CD: AS_actor $PLAYER_ACTOR exit_car $car 
        repeat
           wait 0
        until 80DB: NOT  actor $PLAYER_ACTOR in_car $car  
      else
        0362: remove_actor $PLAYER_ACTOR from_car_and_place_at 21@ 22@ 24@
      end
    end
    $carmenu_normal = 0
    gosub @OBJECTIVE_CAR_MENU
    if $car_cancel == 0
    then
        gosub @SELECT_MARKER_COLOR
        if $marker_cancel == 0
        then
            0407: store_coords_to $DYOM_objective_location_x[$found] $DYOM_objective_location_y[$found] $DYOM_objective_location_z[$found] from_car $car with_offset 0.0 0.0 -1.0 
            0174: $DYOM_objective_location_a[$found]  = car $car Z_angle 
            077E: get_active_interior_to $DYOM_objective_interior[$found]
            
            gosub @EDIT_OBJTEXT
            $DYOM_objective_model[$found]             = $car_model  
            $DYOM_objective_handle[$found]            = $car 
            $DYOM_objective_data[$found]              = $car_color
            $DYOM_objective_accuracy[$found]          = $car_color2
               
            $DYOM_objective_health[$found]            = $car_health
            $DYOM_objective_ammo[$found]              = $car_seat
            $DYOM_objective_properties[$found]        = $car_properties
            $DYOM_objective_markercolor[$found]       = $marker_color
            $DYOM_objective_timelimit[$found]         = $timelimit

        end
    end
end


gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
Player.CanMove($PLAYER_CHAR) = TRUE

return
//===============================
// ADD TIMEOUT
//===============================
:ADD_OBJECTIVE_TIMEOUT
Player.CanMove($PLAYER_CHAR) = False
04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 0.0 0.0
$time_value = 5
0512: show_permanent_text_box 'TIMTIM'
gosub @SELECT_SPECIAL_DURATION
if $time_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  return
end

gosub @SELECT_SHOW_TIMEOUT
if $show_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  return
end

gosub @NEW_OBJECTIVE
// found will be the location for this objective

$DYOM_objective_location_x[$found] = $TEMPVAR_FLOAT_1 
$DYOM_objective_location_y[$found] = $TEMPVAR_FLOAT_2 
02CE: $DYOM_objective_location_z[$found] = ground_z_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 
$DYOM_objective_location_z[$found] += 1.0
077E: get_active_interior_to $DYOM_objective_interior[$found]

// Store OBJECTIVE
$DYOM_objective_type[$found]              = DYOM_objtype_timeout
$DYOM_objective_data[$found]              = $time_value
$DYOM_objective_model[$found]             = $show_choice
$DYOM_objective_timelimit[$found]         = 0

gosub @NEW_OBJTEXT
Player.CanMove($PLAYER_CHAR) = True

$found += 1
01E4: show_text_1number_lowpriority GXT 'NEWOBJ' number $found time 1000 flag 1 
gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY  
return

//===============================
// EDIT TIMEOUT
//===============================
:EDIT_OBJECTIVE_TIMEOUT
object.Destroy($DYOM_objective_handle[$found])

Player.CanMove($PLAYER_CHAR) = False
$time_value = $DYOM_objective_data[$found]
$show_choice  = $DYOM_objective_model[$found]           
0512: show_permanent_text_box 'TIMTIM'
gosub @SELECT_SPECIAL_DURATION
if $time_cancel == 1
then
    $time_value = $DYOM_objective_data[$found]
else
    gosub @SELECT_SHOW_TIMEOUT
    if $show_cancel == 1
    then
        $time_value = $DYOM_objective_data[$found]
        $show_choice  = $DYOM_objective_model[$found]           
    else
        gosub @EDIT_OBJTEXT
    end
end 

$DYOM_objective_data[$found]              = $time_value
$DYOM_objective_model[$found]             = $show_choice

Player.CanMove($PLAYER_CHAR) = True

gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY

return

//===============================
// ADD WEATHER
//===============================
:ADD_OBJECTIVE_WEATHER
Player.CanMove($PLAYER_CHAR) = False
04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 0.0 0.0
gosub @SELECT_OBJECTIVE_WEATHER
if $weather_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  return
end

gosub @NEW_OBJECTIVE
// found will be the location for this objective
// Clear text for this objective 
$TEXTCUR = $found
$TEXTCUR *= 100
$TEXTCUR += $TEXTOBJECTIVES
gosub @TEXT_clear

$DYOM_objective_location_x[$found] = $TEMPVAR_FLOAT_1 
$DYOM_objective_location_y[$found] = $TEMPVAR_FLOAT_2 
02CE: $DYOM_objective_location_z[$found] = ground_z_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 
$DYOM_objective_location_z[$found] += 1.0
077E: get_active_interior_to $DYOM_objective_interior[$found]

// Store OBJECTIVE
$DYOM_objective_type[$found]              = DYOM_objtype_weather
$DYOM_objective_data[$found]              = $weather_choice
$DYOM_objective_timelimit[$found]         = 0

Player.CanMove($PLAYER_CHAR) = True

$found += 1
01E4: show_text_1number_lowpriority GXT 'NEWOBJ' number $found time 1000 flag 1 
gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
return

//===============================
// EDIT WEATHER
//===============================
:EDIT_OBJECTIVE_WEATHER
object.Destroy($DYOM_objective_handle[$found])

Player.CanMove($PLAYER_CHAR) = False
$weather_choice = $DYOM_objective_data[$found]
gosub @SELECT_OBJECTIVE_WEATHER
if $weather_cancel == 1
then
    $weather_choice = $DYOM_objective_data[$found]
end 

$DYOM_objective_data[$found]              = $weather_choice

Player.CanMove($PLAYER_CHAR) = True

gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
return

//===============================
// ADD SET TIME
//===============================
:ADD_OBJECTIVE_SETTIME
Player.CanMove($PLAYER_CHAR) = False
04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 0.0 0.0
gosub @SELECT_OBJECTIVE_DAYTIME
if $daytime_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  return
end

gosub @NEW_OBJECTIVE
// found will be the location for this objective
// Clear text for this objective 
$TEXTCUR = $found
$TEXTCUR *= 100
$TEXTCUR += $TEXTOBJECTIVES
gosub @TEXT_clear

$DYOM_objective_location_x[$found] = $TEMPVAR_FLOAT_1 
$DYOM_objective_location_y[$found] = $TEMPVAR_FLOAT_2 
02CE: $DYOM_objective_location_z[$found] = ground_z_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 
$DYOM_objective_location_z[$found] += 1.0
077E: get_active_interior_to $DYOM_objective_interior[$found]

// Store OBJECTIVE
$DYOM_objective_type[$found]              = DYOM_objtype_settime
$DYOM_objective_data[$found]              = $daytime_choice
$DYOM_objective_timelimit[$found]         = 0

Player.CanMove($PLAYER_CHAR) = True

$found += 1
01E4: show_text_1number_lowpriority GXT 'NEWOBJ' number $found time 1000 flag 1 
gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
return

//===============================
// EDIT SET TIME
//===============================
:EDIT_OBJECTIVE_SETTIME
object.Destroy($DYOM_objective_handle[$found])

Player.CanMove($PLAYER_CHAR) = False
$daytime_choice = $DYOM_objective_data[$found]
gosub @SELECT_OBJECTIVE_DAYTIME
if $daytime_cancel == 1
then
    $daytime_choice = $DYOM_objective_data[$found]
end 

$DYOM_objective_data[$found]              = $daytime_choice

Player.CanMove($PLAYER_CHAR) = True

gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
return

//===============================
// ADD PEDS/CARS BEHAVIOUR
//===============================
:ADD_OBJECTIVE_PEDS
Player.CanMove($PLAYER_CHAR) = False
04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 0.0 0.0
gosub @SELECT_OBJECTIVE_PEDS
if $peds_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  return
end

gosub @NEW_OBJECTIVE
// found will be the location for this objective
// Clear text for this objective 
$TEXTCUR = $found
$TEXTCUR *= 100
$TEXTCUR += $TEXTOBJECTIVES
gosub @TEXT_clear

$DYOM_objective_location_x[$found] = $TEMPVAR_FLOAT_1 
$DYOM_objective_location_y[$found] = $TEMPVAR_FLOAT_2 
02CE: $DYOM_objective_location_z[$found] = ground_z_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 
$DYOM_objective_location_z[$found] += 1.0
077E: get_active_interior_to $DYOM_objective_interior[$found]

// Store OBJECTIVE
$DYOM_objective_type[$found]              = DYOM_objtype_peds
$DYOM_objective_data[$found]              = $peds_choice
$DYOM_objective_timelimit[$found]         = 0

Player.CanMove($PLAYER_CHAR) = True

$found += 1
01E4: show_text_1number_lowpriority GXT 'NEWOBJ' number $found time 1000 flag 1 
gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
return

//===============================
// EDIT PEDS/CARS BEHAVIOUR
//===============================
:EDIT_OBJECTIVE_PEDS
object.Destroy($DYOM_objective_handle[$found])

Player.CanMove($PLAYER_CHAR) = False
$peds_choice = $DYOM_objective_data[$found]
gosub @SELECT_OBJECTIVE_PEDS
if $peds_cancel == 1
then
    $peds_choice = $DYOM_objective_data[$found]
end 

$DYOM_objective_data[$found]              = $peds_choice

Player.CanMove($PLAYER_CHAR) = True

gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
return

//===============================
// ADD WANTED LEVEL
//===============================
:ADD_OBJECTIVE_WANTED
Player.CanMove($PLAYER_CHAR) = False
04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 0.0 0.0
gosub @SELECT_OBJECTIVE_WANTED
if $wanted_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  return
end

gosub @SELECT_OBJECTIVE_WANTEDMAX
if $wanted_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  return
end

gosub @SELECT_OBJECTIVE_WANTEDMIN
if $wanted_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  return
end

gosub @NEW_OBJECTIVE
// found will be the location for this objective
// Clear text for this objective 
$TEXTCUR = $found
$TEXTCUR *= 100
$TEXTCUR += $TEXTOBJECTIVES
gosub @TEXT_clear

$DYOM_objective_location_x[$found] = $TEMPVAR_FLOAT_1 
$DYOM_objective_location_y[$found] = $TEMPVAR_FLOAT_2 
02CE: $DYOM_objective_location_z[$found] = ground_z_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 
$DYOM_objective_location_z[$found] += 1.0
077E: get_active_interior_to $DYOM_objective_interior[$found]

// Store OBJECTIVE
$DYOM_objective_type[$found]              = DYOM_objtype_wanted
$DYOM_objective_data[$found]              = $wanted_choice
$DYOM_objective_model[$found]             = $wantedmax_choice     
$DYOM_objective_ammo[$found]              = $wantedmin_choice     
$DYOM_objective_timelimit[$found]         = 0

Player.CanMove($PLAYER_CHAR) = True

$found += 1
01E4: show_text_1number_lowpriority GXT 'NEWOBJ' number $found time 1000 flag 1 
gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
return

//===============================
// EDIT WANTED LEVEL
//===============================
:EDIT_OBJECTIVE_WANTED
Player.CanMove($PLAYER_CHAR) = False

$wanted_choice = $DYOM_objective_data[$found]               
$wantedmax_choice  = $DYOM_objective_model[$found]               
$wantedmin_choice  = $DYOM_objective_ammo[$found]         

gosub @SELECT_OBJECTIVE_WANTED

if $wanted_cancel == 0
then
    gosub @SELECT_OBJECTIVE_WANTEDMAX
    if $wanted_cancel == 0
    then
        gosub @SELECT_OBJECTIVE_WANTEDMIN
        if $weather_cancel == 0
        then
            $DYOM_objective_data[$found]              = $wanted_choice
            $DYOM_objective_model[$found]             = $wantedmax_choice     
            $DYOM_objective_ammo[$found]              = $wantedmin_choice     
        end  
    end
end


gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY

Player.CanMove($PLAYER_CHAR) = True
return                                                            


//===============================
// ADD TIMELIMIT OBJECTIVE
//===============================
:ADD_OBJECTIVE_TIMELIMIT
Player.CanMove($PLAYER_CHAR) = False
04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 0.0 0.0
gosub @SELECT_OBJ_TIME_LIMIT
if $time_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  return
end

gosub @NEW_OBJECTIVE
// found will be the location for this objective
// Clear text for this objective 
$TEXTCUR = $found
$TEXTCUR *= 100
$TEXTCUR += $TEXTOBJECTIVES
gosub @TEXT_clear

$DYOM_objective_location_x[$found] = $TEMPVAR_FLOAT_1 
$DYOM_objective_location_y[$found] = $TEMPVAR_FLOAT_2 
02CE: $DYOM_objective_location_z[$found] = ground_z_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 
$DYOM_objective_location_z[$found] += 1.0
077E: get_active_interior_to $DYOM_objective_interior[$found]

// Store OBJECTIVE
$DYOM_objective_type[$found]        = DYOM_objtype_timelimit
$DYOM_objective_data[$found]        = $timelimit
$DYOM_objective_timelimit[$found]   = 0
Player.CanMove($PLAYER_CHAR) = True

$found += 1
01E4: show_text_1number_lowpriority GXT 'NEWOBJ' number $found time 1000 flag 1 
gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
return

//===============================
// EDIT TIMELIMIT OBJECTIVE
//===============================
:EDIT_OBJECTIVE_TIMELIMIT
object.Destroy($DYOM_objective_handle[$found])

Player.CanMove($PLAYER_CHAR) = False
$timelimit = $DYOM_objective_data[$found]
gosub @SELECT_OBJ_TIME_LIMIT
if $time_cancel == 1
then
    $timelimit = $DYOM_objective_data[$found]
end 

$DYOM_objective_data[$found]              = $timelimit

Player.CanMove($PLAYER_CHAR) = True

gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
return

//===============================
// ADD TIMER-ON OBJECTIVE
//===============================
:ADD_OBJECTIVE_TIMERON
Player.CanMove($PLAYER_CHAR) = False
04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 0.0 0.0

gosub @NEW_OBJECTIVE
// found will be the location for this objective
// Clear text for this objective 
$TEXTCUR = $found
$TEXTCUR *= 100
$TEXTCUR += $TEXTOBJECTIVES
gosub @TEXT_clear

$DYOM_objective_location_x[$found] = $TEMPVAR_FLOAT_1 
$DYOM_objective_location_y[$found] = $TEMPVAR_FLOAT_2 
02CE: $DYOM_objective_location_z[$found] = ground_z_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 
$DYOM_objective_location_z[$found] += 1.0
077E: get_active_interior_to $DYOM_objective_interior[$found]

// Store OBJECTIVE
$DYOM_objective_type[$found]        = DYOM_objtype_timeron
$DYOM_objective_timelimit[$found]   = 0

Player.CanMove($PLAYER_CHAR) = True

$found += 1
01E4: show_text_1number_lowpriority GXT 'NEWOBJ' number $found time 1000 flag 1 
gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
return
//===============================
// EDIT TIMER-ON OBJECTIVE
//===============================
:EDIT_OBJECTIVE_TIMERON
object.Destroy($DYOM_objective_handle[$found])

Player.CanMove($PLAYER_CHAR) = False

Player.CanMove($PLAYER_CHAR) = True

gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
return

//===============================
// ADD NO WEAPON OBJECTIVE
//===============================
:ADD_OBJECTIVE_NOWEAPON
Player.CanMove($PLAYER_CHAR) = False
04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 0.0 0.0

gosub @NEW_OBJECTIVE
// found will be the location for this objective
// Clear text for this objective 
$TEXTCUR = $found
$TEXTCUR *= 100
$TEXTCUR += $TEXTOBJECTIVES
gosub @TEXT_clear

$DYOM_objective_location_x[$found] = $TEMPVAR_FLOAT_1 
$DYOM_objective_location_y[$found] = $TEMPVAR_FLOAT_2 
02CE: $DYOM_objective_location_z[$found] = ground_z_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 
$DYOM_objective_location_z[$found] += 1.0
077E: get_active_interior_to $DYOM_objective_interior[$found]

// Store OBJECTIVE
$DYOM_objective_type[$found]        = DYOM_objtype_noweapon
$DYOM_objective_timelimit[$found]   = 0

Player.CanMove($PLAYER_CHAR) = True

$found += 1
01E4: show_text_1number_lowpriority GXT 'NEWOBJ' number $found time 1000 flag 1 
gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
return
//===============================
// EDIT NOWEAPON OBJECTIVE
//===============================
:EDIT_OBJECTIVE_NOWEAPON
object.Destroy($DYOM_objective_handle[$found])

Player.CanMove($PLAYER_CHAR) = False

Player.CanMove($PLAYER_CHAR) = True

gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
return

//===============================
// ADD PHONE OBJECTIVE
//===============================
:ADD_OBJECTIVE_PHONE
Player.CanMove($PLAYER_CHAR) = False
04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 0.0 0.0
$time_value = 5
0512: show_permanent_text_box 'PHTIM'
gosub @SELECT_SPECIAL_DURATION
if $time_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  return
end

gosub @NEW_OBJECTIVE
// found will be the location for this objective

$DYOM_objective_location_x[$found] = $TEMPVAR_FLOAT_1 
$DYOM_objective_location_y[$found] = $TEMPVAR_FLOAT_2 
02CE: $DYOM_objective_location_z[$found] = ground_z_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 
$DYOM_objective_location_z[$found] += 1.0
077E: get_active_interior_to $DYOM_objective_interior[$found]

// Store OBJECTIVE
$DYOM_objective_type[$found]              = DYOM_objtype_phone
$DYOM_objective_data[$found]              = $time_value
$DYOM_objective_timelimit[$found]         = 0

gosub @NEW_OBJTEXT
Player.CanMove($PLAYER_CHAR) = True

$found += 1
01E4: show_text_1number_lowpriority GXT 'NEWOBJ' number $found time 1000 flag 1 
gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY  
return

//===============================
// EDIT PHONE OBJECTIVE
//===============================
:EDIT_OBJECTIVE_PHONE
object.Destroy($DYOM_objective_handle[$found])

Player.CanMove($PLAYER_CHAR) = False
$time_value = $DYOM_objective_data[$found]
$show_choice  = $DYOM_objective_model[$found]           
0512: show_permanent_text_box 'PHTIM'
gosub @SELECT_SPECIAL_DURATION
if $time_cancel == 1
then
    $time_value = $DYOM_objective_data[$found]
else
    gosub @EDIT_OBJTEXT
end 

$DYOM_objective_data[$found]              = $time_value

Player.CanMove($PLAYER_CHAR) = True

gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY

return


var
  $object_cancel:Integer
  $object_properties:Integer
end
//---------------
// OBJECTIVE OBJECT MENU
//---------------
:OBJECTIVE_OBJECT_MENU
Player.CanMove($PLAYER_CHAR) = False
08D4: $menu = create_panel_with_title 'OBJECTS' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
08DB: set_panel $menu column 0 header 'OBJTV' data 'OOTCH' 'OODMG' 'OOPHT' 'OOSHT' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
gosub @GEN_MENU
if $menu_canceled == 1
then
  $object_cancel = 1
  return
end
$object_properties = $menu_choice
return

//===============================
// ADD OBJECT OBJECTIVE
//===============================
:ADD_OBJECTIVE_OBJECT
04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 7.0 0.0
$TEMPVAR_ANGLE = actor.Angle($PLAYER_ACTOR)
$TEMPVAR_ANGLE += 90.0
$TEMPVAR_ANGLE_X = 0.0
$TEMPVAR_ANGLE_Y = 0.0
$OBJ_M = 0 
$OBJOBJ_FLAG = 1
gosub @SELECT_OBJECT
$OBJOBJ_FLAG = 0
if $object_cancel == 1
then
  return
end  

gosub @OBJECTIVE_OBJECT_MENU
if $object_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  object.Destroy($object)
  return
end
gosub @SELECT_MARKER_COLOR
if $marker_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  object.Destroy($object)
  return
end
gosub @NEW_OBJECTIVE
// found will be the location for this objective


$DYOM_objective_model[$found]            = $object_model
$DYOM_objective_location_x[$found]       = $TEMPVAR_FLOAT_1
$DYOM_objective_location_y[$found]       = $TEMPVAR_FLOAT_2 
$DYOM_objective_location_z[$found]       = $TEMPVAR_FLOAT_3
0086: $DYOM_objective_ammo[$found]       = $TEMPVAR_ANGLE_X
0086: $DYOM_objective_accuracy[$found]   = $TEMPVAR_ANGLE_Y
$DYOM_objective_location_a[$found]       = $TEMPVAR_ANGLE
$DYOM_objective_properties[$found]       = $object_properties
$DYOM_objective_markercolor[$found]      = $marker_color
077E: get_active_interior_to $DYOM_objective_interior[$found]

object.Destroy($object)
// Store OBJECTIVE
$DYOM_objective_type[$found]        = DYOM_objtype_object
$DYOM_objective_data[$found]        = $time_value
$DYOM_objective_timelimit[$found]   = 0

gosub @NEW_OBJTEXT
Player.CanMove($PLAYER_CHAR) = True

$found += 1
01E4: show_text_1number_lowpriority GXT 'NEWOBJ' number $found time 1000 flag 1 
gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY  
return

//===============================
// EDIT OBJECT OBJECTIVE
//===============================
:EDIT_OBJECTIVE_OBJECT

$TEMPVAR_FLOAT_1 = $DYOM_objective_location_x[$found]
$TEMPVAR_FLOAT_2 = $DYOM_objective_location_y[$found]
$TEMPVAR_FLOAT_3 = $DYOM_objective_location_z[$found] 
$TEMP_INTERIOR   = $DYOM_objective_interior[$found] 
$TEMPVAR_ANGLE   = $DYOM_objective_location_a[$found]
0086: $TEMPVAR_ANGLE_X = $DYOM_objective_ammo[$found]
0086: $TEMPVAR_ANGLE_Y = $DYOM_objective_accuracy[$found]
$object_model          = $DYOM_objective_model[$found] 
$object_properties     = $DYOM_objective_properties[$found]
$marker_color          = $DYOM_objective_markercolor[$found]
$timelimit             = $DYOM_objective_timelimit[$found]

06BA: AS_actor $PLAYER_ACTOR turn_to_and_look_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3
wait 1000
0373: set_camera_directly_behind_player 
02EB: restore_camera_with_jumpcut
object.Destroy($DYOM_objective_handle[$found])
$object_cancel = 0
$marker_cancel = 0
$OBJOBJ_FLAG = 1
gosub @SELECT_OBJECT
$OBJOBJ_FLAG = 0
if $object_cancel == 0
then
    gosub @OBJECTIVE_OBJECT_MENU
    if $object_cancel == 0
    then
        gosub @SELECT_MARKER_COLOR
        if $marker_cancel == 0
        then
            gosub @EDIT_OBJTEXT
            $DYOM_objective_model[$found]            = $object_model
            $DYOM_objective_location_x[$found]       = $TEMPVAR_FLOAT_1
            $DYOM_objective_location_y[$found]       = $TEMPVAR_FLOAT_2 
            $DYOM_objective_location_z[$found]       = $TEMPVAR_FLOAT_3
            0086: $DYOM_objective_ammo[$found]       = $TEMPVAR_ANGLE_X
            0086: $DYOM_objective_accuracy[$found]   = $TEMPVAR_ANGLE_Y
            $DYOM_objective_location_a[$found]       = $TEMPVAR_ANGLE
            $DYOM_objective_properties[$found]       = $object_properties
            $DYOM_objective_markercolor[$found]      = $marker_color
            077E: get_active_interior_to $DYOM_objective_interior[$found]
            
            object.Destroy($object)
        end
    end
end


gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
Player.CanMove($PLAYER_CHAR) = TRUE

return

//===============================
// ADD ADDMONEY OBJECTIVE
//===============================
:ADD_OBJECTIVE_ADDMONEY
Player.CanMove($PLAYER_CHAR) = False
04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 0.0 0.0

00BB: show_text_lowpriority GXT 'ADMHLP' time 10000 flag 1 
$TEXTCUR = $TEXTNUMIMPUT
$TEXTMAX = 9
$num_input = 1000
gosub @TEXT_num_input
00BE: text_clear_all 

gosub @NEW_OBJECTIVE
// found will be the location for this objective
// Clear text for this objective 
$TEXTCUR = $found
$TEXTCUR *= 100
$TEXTCUR += $TEXTOBJECTIVES
gosub @TEXT_clear

$DYOM_objective_location_x[$found] = $TEMPVAR_FLOAT_1 
$DYOM_objective_location_y[$found] = $TEMPVAR_FLOAT_2 
02CE: $DYOM_objective_location_z[$found] = ground_z_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 
$DYOM_objective_location_z[$found] += 1.0
077E: get_active_interior_to $DYOM_objective_interior[$found]

// Store OBJECTIVE
$DYOM_objective_type[$found]        = DYOM_objtype_addmoney
$DYOM_objective_data[$found]        = $num_input
$DYOM_objective_timelimit[$found]   = 0
Player.CanMove($PLAYER_CHAR) = True

$found += 1
01E4: show_text_1number_lowpriority GXT 'NEWOBJ' number $found time 1000 flag 1 
gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
return

//===============================
// EDIT ADDMONEY OBJECTIVE
//===============================
:EDIT_OBJECTIVE_ADDMONEY
object.Destroy($DYOM_objective_handle[$found])

Player.CanMove($PLAYER_CHAR) = False
00BB: show_text_lowpriority GXT 'AMHELP' time 10000 flag 1 
$TEXTCUR = $TEXTNUMIMPUT
$TEXTMAX = 9
$num_input = $DYOM_objective_data[$found]
gosub @TEXT_num_input
00BE: text_clear_all 



$DYOM_objective_data[$found]              = $num_input

Player.CanMove($PLAYER_CHAR) = True

gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
return

//===============================
// ADD SUBMONEY OBJECTIVE
//===============================
:ADD_OBJECTIVE_SUBMONEY
Player.CanMove($PLAYER_CHAR) = False
04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 0.0 0.0

00BB: show_text_lowpriority GXT 'SMHELP' time 10000 flag 1 
$TEXTCUR = $TEXTNUMIMPUT
$TEXTMAX = 9
$num_input = 1000
gosub @TEXT_num_input
00BE: text_clear_all 


gosub @NEW_OBJECTIVE
// found will be the location for this objective
// Clear text for this objective 
$TEXTCUR = $found
$TEXTCUR *= 100
$TEXTCUR += $TEXTOBJECTIVES
gosub @TEXT_clear

$DYOM_objective_location_x[$found] = $TEMPVAR_FLOAT_1 
$DYOM_objective_location_y[$found] = $TEMPVAR_FLOAT_2 
02CE: $DYOM_objective_location_z[$found] = ground_z_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 
$DYOM_objective_location_z[$found] += 1.0
077E: get_active_interior_to $DYOM_objective_interior[$found]

// Store OBJECTIVE
$DYOM_objective_type[$found]        = DYOM_objtype_submoney
$DYOM_objective_data[$found]        = $num_input
$DYOM_objective_timelimit[$found]   = 0
Player.CanMove($PLAYER_CHAR) = True

$found += 1
01E4: show_text_1number_lowpriority GXT 'NEWOBJ' number $found time 1000 flag 1 
gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
return

//===============================
// EDIT SUBMONEY OBJECTIVE
//===============================
:EDIT_OBJECTIVE_SUBMONEY
object.Destroy($DYOM_objective_handle[$found])

Player.CanMove($PLAYER_CHAR) = False
00BB: show_text_lowpriority GXT 'SMHELP' time 10000 flag 1 
$TEXTCUR = $TEXTNUMIMPUT
$TEXTMAX = 9
$num_input = $DYOM_objective_data[$found]
gosub @TEXT_num_input
00BE: text_clear_all 


$DYOM_objective_data[$found]              = $num_input

Player.CanMove($PLAYER_CHAR) = True

gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY
return


//===============================
// ADD OBJECTIVE: ANIMATION
//===============================
:ADD_OBJECTIVE_ANIMATION

$anim_edit = 0
gosub @SELECT_ANIMATION 
if $anim_cancel == 1
then
  Player.CanMove($PLAYER_CHAR) = True
  return
end

gosub @NEW_OBJECTIVE
// $found will be the location for this objective
Player.CanMove($PLAYER_CHAR) = False
// found will be the location for this objective
// Clear text for this objective 
$TEXTCUR = $found
$TEXTCUR *= 100
$TEXTCUR += $TEXTOBJECTIVES
gosub @TEXT_clear

fade 0 300
wait 300

04C4: store_coords_to $DYOM_objective_location_x[$found] $DYOM_objective_location_y[$found] $DYOM_objective_location_z[$found] from_actor $PLAYER_ACTOR with_offset 0.0 0.0 0.0 
0172: $DYOM_objective_location_a[$found] = actor $PLAYER_ACTOR Z_angle 
077E: get_active_interior_to $DYOM_objective_interior[$found]


$DYOM_objective_type[$found]        = DYOM_objtype_animation
$DYOM_objective_animation[$found]   = $anim_id
$DYOM_objective_distance[$found]    = $anim_dist

gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY

fade 1 500
wait 500

$found += 1
01E4: show_text_1number_lowpriority GXT 'NEWOBJ' number $found time 1000 flag 1 
Player.CanMove($PLAYER_CHAR) = True
return



//===============================
// EDIT OBJECTIVE: ANIMATION
//===============================
:EDIT_OBJECTIVE_ANIMATION
Player.CanMove($PLAYER_CHAR) = False
$anim_id        = $DYOM_objective_animation[$found]
$anim_dist      = $DYOM_objective_distance[$found]

$anim_edit = 1
gosub @SELECT_ANIMATION 
if $anim_cancel == 0
then
   $DYOM_objective_animation[$found]   = $anim_id

    if $anim_route == 2   //Extend route
    then
       0084: $last_point = $DYOM_objective_distance[$found]             
       while $last_point < 0
          $last_point += 1000
       end
       repeat
          0663: printint "link" $last_point
          wait 0
          if $DYOM_POINT_LINK[$last_point] < 0
          then
            while $anim_dist < 0
              $anim_dist += 1000
            end
            0084: $DYOM_POINT_LINK[$last_point] = $anim_dist
            0663: printint "attach" $anim_dist
            break
          end
          $last_point = $DYOM_POINT_LINK[$last_point]
        until false
     else
        // Remove routepoints if available
        if NOT $has_list == 1
        then
            if or 
                  $DYOM_objective_animation[$found] == -4
                  $DYOM_objective_animation[$found] == -5
                  $DYOM_objective_animation[$found] == -6
            then
              if $DYOM_objective_distance[$found] < -500
              then
                0084: $point = $DYOM_objective_distance[$found]
                gosub @FREE_POINT_CHAIN
              end
            end 
            if or 
                  $DYOM_objective_animation[$found] == -2
                  $DYOM_objective_animation[$found] == -3
            then
              0084: $point = $DYOM_objective_distance[$found]
              gosub @FREE_POINT_CHAIN
            end 
        end
       $DYOM_objective_distance[$found]     = $anim_dist
     end
            
end    

fade 0 300
wait 300

// restore player
00A1: put_actor $PLAYER_ACTOR at $DYOM_objective_location_x[$found] $DYOM_objective_location_y[$found] $DYOM_objective_location_z[$found] 
0173: set_actor $PLAYER_ACTOR Z_angle_to $DYOM_objective_location_a[$found]
09C7: set_player $PLAYER_CHAR modelID_to #NULL
048F: actor $PLAYER_ACTOR remove_weapons 

gosub @CLEAR_DESIGN_ITEMS_OBJECTIVESONLY
gosub @SHOW_DESIGN_ITEMS_OBJECTIVESONLY

fade 1 500
wait 500

Player.CanMove($PLAYER_CHAR) = True

return




//================================================================================
//                        H E L P E R - T H R E A D S
//================================================================================

//===============================
// DYOMINTRO THREAD
//===============================
:DYOMINTRO_THREAD
03E5: show_text_box 'DYOMIN1'
//03E5: show_text_box 'DYOMIB1'
wait 10000
while $IN_MENU == 1
  wait 200
end
03E5: show_text_box 'DYOMIN2'
//03E5: show_text_box 'DYOMIB2'
wait 10000
while $IN_MENU == 1
  wait 200
end
03E5: show_text_box 'DYOMIN3'
//03E5: show_text_box 'DYOMIB3'
end_thread

//===============================
// INTRO THREAD
//===============================
:INTRO_THREAD
$TEXTCUR = $TEXTINTRO
0A8D: 0@ = read_memory $TEXTCUR size 1 virtual_protect 0 
if not 0@ == 0
then 
  gosub @TEXT_show
  wait 5000
end
$TEXTCUR = $TEXTINTRO
$TEXTCUR += 100
0A8D: 0@ = read_memory $TEXTCUR size 1 virtual_protect 0 
if not 0@ == 0
then 
  gosub @TEXT_show
  wait 5000
end
$TEXTCUR = $TEXTINTRO
$TEXTCUR += 200
0A8D: 0@ = read_memory $TEXTCUR size 1 virtual_protect 0 
if not 0@ == 0
then 
  gosub @TEXT_show
  wait 5000
end
$TEXTCUR = $TEXTCREDIT
gosub @TEXT_show
end_thread

//===============================
// SPHERE THREAD
//===============================
// Display Sphere/checkpoint for 
// the selected and the 3 nearest non-selected checkpoint
// Other option:  Cycle through all checkpoint and blink them instead of constant display...
var
  0@:Float  // min distance
  1@:Integer // found1
  2@:Float  // distance
  3@:Integer // index
  4@:Float
  5@:Float
  6@:Integer
  7@:Float // mindist2
  8@:Integer // found2
end
:SPHERE_THREAD
while true
    wait 100
    if and
        $ONMISSION == 0
        $IN_MENU == 0
        $DYOM_IN_STORY == 0
        player.Defined($PLAYER_CHAR)
    then
        04C4: store_coords_to 11@ 12@ 13@ from_actor $PLAYER_ACTOR with_offset 0.0 0.5 0.0

        0@ = 9999.9
        1@ = -1    
        7@ = 9999.9
        8@ = -1    
        3@ = 0
        // Find the nearest non selected checkpoint
        while $DYOM_objective_count > 3@
            008b: 6@ = 3@
            6@ += 1
            if and 
              NOT $DYOM_selected_obj == 6@
              $DYOM_objective_type[3@] == DYOM_objtype_marker
            then
                050A: 2@ = distance_between_XYZ 11@ 12@ 13@ and_XYZ $DYOM_objective_location_x[3@] $DYOM_objective_location_y[3@] $DYOM_objective_location_z[3@]
                if 7@ > 2@       // mindist2 > dist
                then
                    if 0@ > 2@   // mindist > dist
                    then
                        7@ = 0@  // mindist2 = mindist1
                        8@ = 1@  // found2 = found1
                        0@ = 2@  // mindist 1 = this dist
                        1@ = 3@  // found 1 = this CP
                    else
                        7@ = 2@  // mindist2 = this dist
                        8@ = 3@  // found2 = this CP
                    end 
                end
            end 
            3@ += 1
        end
        // remove other checkpoints
        3@ = 0
        while $DYOM_objective_count > 3@
            008b: 6@ = 3@
            6@ += 1
            if $DYOM_objective_type[3@] == DYOM_objtype_marker            
            then
                if AND 
                  NOT 3@ == 1@
                  NOT 3@ == 8@
                  NOT $DYOM_selected_obj == 6@
                then   
                  // remove sphere  
                  if or
                    $DYOM_objective_model[3@] == 0
                    $DYOM_objective_model[3@] == 5
                  then
                      03BD: destroy_sphere $DYOM_objective_handle[3@]
                  else
                    if $DYOM_objective_model[3@] == 6
                    then
                      0A41: destroy_entrance_marker $DYOM_objective_handle[3@]
                    else
                      06D6: disable_racing_checkpoint $DYOM_objective_handle[3@]
                    end
                  end
                  $DYOM_objective_handle[3@] = -1
                end      
            end
            3@ += 1
        end
        // Display nearest and selected checkpoint
        3@ = 0
        while $DYOM_objective_count > 3@
            008b: 6@ = 3@
            6@ += 1
            if $DYOM_objective_type[3@] == DYOM_objtype_marker            
            then
                if or 
                  3@ == 1@
                  3@ == 8@
                  $DYOM_selected_obj == 6@
                then   

                    if    $DYOM_objective_handle[3@] == -1
                    then
                        // display sphere
                        02F6: 4@ = cosine $DYOM_objective_distance[3@] // (float) 
                        02F7: 5@ = sine $DYOM_objective_distance[3@] // (float)
                        4@ += $DYOM_objective_location_x[3@] 
                        5@ += $DYOM_objective_location_y[3@] 
                        
                        if or 
                          $DYOM_objective_model[3@] == 0
                          $DYOM_objective_model[3@] == 5
                        then
                          03BC: $DYOM_objective_handle[3@] = create_sphere_at $DYOM_objective_location_x[3@] $DYOM_objective_location_y[3@] $DYOM_objective_location_z[3@] radius $DYOM_objective_location_a[3@] 
                        end
                        if $DYOM_objective_model[3@] == 1
                        then
                          if 003c: $DYOM_selected_obj == 6@
                          then
                            06D5: $DYOM_objective_handle[3@] = create_racing_checkpoint_at $DYOM_objective_location_x[3@] $DYOM_objective_location_y[3@] $DYOM_objective_location_z[3@] point_to 4@ 5@ $DYOM_objective_location_z[3@] type 0 radius $DYOM_objective_location_a[3@]
                          else
                            06D5: $DYOM_objective_handle[3@] = create_racing_checkpoint_at $DYOM_objective_location_x[3@] $DYOM_objective_location_y[3@] $DYOM_objective_location_z[3@] point_to 4@ 5@ $DYOM_objective_location_z[3@] type 2 radius $DYOM_objective_location_a[3@]
                          end
                        end
                        if $DYOM_objective_model[3@] == 2
                        then
                          06D5: $DYOM_objective_handle[3@] = create_racing_checkpoint_at $DYOM_objective_location_x[3@] $DYOM_objective_location_y[3@] $DYOM_objective_location_z[3@] point_to 4@ 5@ $DYOM_objective_location_z[3@] type 1 radius $DYOM_objective_location_a[3@]
                        end
                        if $DYOM_objective_model[3@] == 3
                        then
                          06D5: $DYOM_objective_handle[3@] = create_racing_checkpoint_at $DYOM_objective_location_x[3@] $DYOM_objective_location_y[3@] $DYOM_objective_location_z[3@] point_to 4@ 5@ $DYOM_objective_location_z[3@] type 2 radius $DYOM_objective_location_a[3@]
                        end
                        if $DYOM_objective_model[3@] == 4
                        then
                          06D5: $DYOM_objective_handle[3@] = create_racing_checkpoint_at $DYOM_objective_location_x[3@] $DYOM_objective_location_y[3@] $DYOM_objective_location_z[3@] point_to 4@ 5@ $DYOM_objective_location_z[3@] type 4 radius $DYOM_objective_location_a[3@]
                        end
                        if $DYOM_objective_model[3@] == 6
                        then
                          0A40: $DYOM_objective_handle[3@] = create_entrance_marker_at $DYOM_objective_location_x[3@] $DYOM_objective_location_y[3@] $DYOM_objective_location_z[3@] color 4 
                        end
                    end
                 end   
            end
            3@ += 1
        end
    end 
end
end_thread

//===============================
// HUNGER THREAD
//===============================
:HUNGER_THREAD
0652: 0@ = integer_stat 21 
while true
  wait 500
  if and
     $ONMISSION == 0
     $DYOM_IN_STORY == 0
  then
      0623: add 1 to_integer_stat 245 
      042E: downdate_integer_stat 21 to 0@ 
  end
end
end_thread


//===============================
// INFO THREAD
//===============================
:INFO_THREAD
var
  0@ :float     // cur_min
  1@ :integer   // cur_type
  2@ :integer  // cur_found
end
while true

  wait 200
  if and
     $ONMISSION == 0
     $IN_MENU == 0
     $DYOM_IN_STORY == 0
     player.Defined($PLAYER_CHAR)
  then
    1@ = -1
    0@ = 2.0
    gosub @FIND_NEAR_ACTOR
    if $mindist < 0@
    then
       0@ = $mindist 
       1@ = 1
       2@ = $found
    end
    gosub @FIND_NEAR_CAR
    if $mindist < 0@
    then
       0@ = $mindist 
       1@ = 2
       2@ = $found
    end
    gosub @FIND_NEAR_PICKUP
    if $mindist < 0@
    then
       0@ = $mindist 
       1@ = 3
       2@ = $found
    end
    gosub @FIND_NEAR_OBJECT
    if $mindist < 0@
    then
       0@ = $mindist 
       1@ = 4
       2@ = $found
    end
    gosub @FIND_NEAR_SELECT
    if $mindist < 0@
    then
       0@ = $mindist 
       1@ = 5
       2@ = $found
    end
    gosub @FIND_NEAR_TRIGGER
    if $mindist < 0@
    then
       0@ = $mindist 
       1@ = 6
       2@ = $found
    end
    
    if 1@ == 1
    then
      if $DYOM_actor_hidewith[2@] < 900
      then
        02FD: show_text_2numbers_lowpriority GXT 'INF_ACT' numbers $DYOM_actor_spawnwith[2@] $DYOM_actor_hidewith[2@] time 1000 flag 1  // Actor spawn with #, Hide with #
      else
        01E4: show_text_1number_lowpriority GXT 'INF_AC2' number $DYOM_actor_spawnwith[2@] time 1000 flag 1  // Actor spawn with #
      end
      wait 800
    end
    if 1@ == 2
    then
      if $DYOM_car_hidewith[2@] < 900
      then
        02FD: show_text_2numbers_lowpriority GXT 'INF_CAR' numbers $DYOM_car_spawnwith[2@] $DYOM_car_hidewith[2@] time 1000 flag 1  // Vehicle spawn with #, Hide with #
      else
        01E4: show_text_1number_lowpriority GXT 'INF_CA2' number $DYOM_car_spawnwith[2@] time 1000 flag 1  // Vehicle spawn with #
      end
      wait 800
    end
    if 1@ == 3
    then
      if $DYOM_pickup_hidewith[2@] < 900
      then
        02FD: show_text_2numbers_lowpriority GXT 'INF_PU' numbers $DYOM_pickup_spawnwith[2@] $DYOM_pickup_hidewith[2@] time 1000 flag 1  // Pickup spawn with #, Hide with #
      else
        01E4: show_text_1number_lowpriority GXT 'INF_PU2' number $DYOM_pickup_spawnwith[2@] time 1000 flag 1  // Pickup spawn with #
      end
      wait 800
    end
    if 1@ == 4
    then
      if $DYOM_object_hidewith[2@] < 900
      then
        02FD: show_text_2numbers_lowpriority GXT 'INF_OB' numbers $DYOM_object_spawnwith[2@] $DYOM_object_hidewith[2@] time 1000 flag 1  // Object spawn with #, Hide with #
      else
        01E4: show_text_1number_lowpriority GXT 'INF_OB2' number $DYOM_object_spawnwith[2@] time 1000 flag 1  // Object spawn with #
      end
      wait 800
    end
    if 1@ == 5
    then
      if $DYOM_selected_obj == 2@
      then
        01E4: show_text_1number_lowpriority GXT 'INF_OBS' number 2@ time 1000 flag 1  // Objective #
      else
        01E4: show_text_1number_lowpriority GXT 'INF_OBJ' number 2@ time 1000 flag 1  // Objective #
      end
      wait 800
    end
    if 1@ == 6
    then
      if $DYOM_trigger_after[2@] > 0
      then
        02FD: show_text_2number_lowpriority GXT 'INF_MT' numbers 2@ $DYOM_trigger_after[2@] time 1000 flag 1  // Mission trigger #
      else
        01e4: show_text_1number_lowpriority GXT 'INF_MT0' numbers 2@ time 1000 flag 1  // Mission trigger #
      end  
      wait 800
    end
  end
end
end_thread

//===============================
// HELI PILOT THREAD
//===============================
:HELI_PILOT
thread 'HELI' 
var
  0@ :Actor // 0@ = actor
  1@ :Car // 1@ = heli
  2@ :Integer// 2@ = startpoint ssssss
  3@ :Integer //action: -4 -> enter  -5 -> leave
  10@ :Integer// 10@ = Current target point
  11@ :Integer// 11@ = tmp_point
  12@ :Float// 12@ = target groundlevel
  13@  :Float// 13@ = target altitude low
  14@  :Float// 13@ = target altitude high
  21@ : Float
  22@ : float
  23@ : float
  24@ : float
end
10@ = 2@
if 3@ == -4
then
   05CB: AS_actor 0@ enter_car 1@ as_driver 2900 ms 
   wait 3000 ms
end

00AA: store_car 1@ position_to 21@ 22@ 23@ 
02CE: 24@ = ground_z_at 21@ 22@ 23@  
0063: 23@ -= 24@
if 23@ > 5.0
then
  04BA: set_car 1@ speed_to 50.0 
end

REPEAT
    11@ = 10@
    10@ = $DYOM_POINT_LINK[11@]
    
    // End of looping route reached, fly back to startpoint
    if 10@ == -2
    then
      10@ = 2@
    end 
    
    // End of non-looping route reached, get out of heli if needed and stop this thread.
    if 10@ < 0
    then
       wait 500
       04BA: set car 1@ speed instantly  0.0
       wait 100
       00AD: set_car 1@ max_speed_to 10.0 
       24@ = car.Angle(1@)
       04D0: force_heli 1@ looking_angle_to 24@


       car.StorePos(1@,20@,21@,22@)
       
       02CE: 23@ = ground_z_at 20@ 21@ 22@
       22@ = $DYOM_POINT_Z[11@]
       0063: 22@ -= 23@ 
       if 22@ < 5.0
       then
           04A2: set_heli 1@ fly_to 20@  21@ 23@ altitude  0.0 0.0
           repeat 
             wait 20
             gosub @HELI_CHECK
           until 01AF:   car 1@ sphere 0 in_sphere 20@  21@ 23@ radius 25.0 25.0 5.0
           02D4: car 1@ turn_off_engine 
           wait 4000 ms
           car.LockInCurrentPosition(1@) = 1
           02D4: car 1@ turn_off_engine 
       else
           04A2: set_heli 1@ fly_to 20@  21@ $DYOM_POINT_Z[11@] altitude  0.0 0.0
           repeat 
             wait 20
             gosub @HELI_CHECK
           until 01AF:   car 1@ sphere 0 in_sphere 20@  21@ $DYOM_POINT_Z[11@] radius 25.0 25.0 5.0
       end
       
       if 3@ == -5
       then
         0633: AS_actor 0@ exit_car
       end   
       end_thread
    end   
    
        // Calculate the altitude of the targetpoint and Fly to the target
    02CE: 12@ = ground_z_at $DYOM_POINT_X[11@] $DYOM_POINT_Y[11@] $DYOM_POINT_Z[11@] 
    13@ = $DYOM_POINT_Z[11@]
    0063: 13@ -= 12@
    14@ = 13@
    13@ -= 1.0
    14@ += 1.0
    
    04A2: set_heli 1@ fly_to $DYOM_POINT_X[11@] $DYOM_POINT_Y[11@] $DYOM_POINT_Z[11] altitude  13@ 14@ 
    
    repeat 
      wait 10
      gosub @HELI_CHECK
    until 01AF:   car 1@ sphere 0 in_sphere $DYOM_POINT_X[11@] $DYOM_POINT_Y[11@] $DYOM_POINT_Z[11@] radius 5.0 5.0 200.0
    // We're near, reduce speed to prevent major overshoots
    04BA: set car 1@ speed instantly  5.0

    
UNTIL FALSE
end_thread

//----------- Checks to determine if helithread must be terminate ------------
:HELI_CHECK
if 856E: NOT   car 1@ defined 
then
  end_thread 
end
if 856D:   not actor 0@ defined 
then
  end_thread 
end
if car.Wrecked(1@)
then
  end_thread
end
IF AND 
  003c: $PLAYER_ACTOR == 0@
  NOT $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_cutscene 
  NOT $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_animation 
THEN
  0662: printstring "PLAYER ANIMATION THREAD ENDED"
  end_thread
  
END

return

//===============================
// PLANE PILOT THREAD
//===============================
:PLANE_PILOT
thread 'PLANE' 
var
  0@ :Actor // 0@ = actor
  1@ :Car // 1@ = heli
  2@ :Integer// 2@ = startpoint
  3@ :Integer //action: -4 -> enter  -5 -> leave
  10@ :Integer// 11@ = Current target point
  11@ :Integer// 10@ = next target point
  12@ :Float// 12@ = target groundlevel
  13@  :Float// 13@ = target altitude low
  14@  :Float// 13@ = target altitude high
  21@ : Float
  22@ : float
  23@ : float
  24@ : float
end
10@ = 2@
if 3@ == -4
then
   05CB: AS_actor 0@ enter_car 1@ as_driver 2900 ms 
   wait 3000 ms
end

00AA: store_car 1@ position_to 21@ 22@ 23@ 
02CE: 24@ = ground_z_at 21@ 22@ 23@  
0063: 23@ -= 24@
if 23@ > 5.0
then
  04BA: set_car 1@ speed_to 50.0 
end

REPEAT
    11@ = 10@
    10@ = $DYOM_POINT_LINK[11@]
    
    // End of looping route reached, wrap to startpoint
    if 10@ == -2
    then
      10@ = 2@
    end 
    
    // End of non-looping route reached, initiate landing.
    if 10@ < 0
    then
        // Calculate the altitude of the targetpoint and Fly to the target
        02CE: 12@ = ground_z_at $DYOM_POINT_X[11@] $DYOM_POINT_Y[11@] $DYOM_POINT_Z[11@] 
        13@ = $DYOM_POINT_Z[11@]
        0063: 13@ -= 12@
        // Check if the final targetpoint is near the ground, to decide between landing and circling
        if 13@ > 10.0
        then
            // keep circling the final targetpoint
            14@ = 13@
            13@ -= 1.0
            14@ += 1.0
            04D2: set_plane 1@ fly_autopilot_around_point $DYOM_POINT_X[11@] $DYOM_POINT_Y[11@] $DYOM_POINT_Z[11@] altitude_between 13@ and 14@ 
        else
           // Tower, we're preparing to land, clean the runway :P
           var
             15@:Float
             16@:Float
             17@:Float   // angle
             18@:Float   // distance
             19@:Float
             23@:Float
           end 
    
           0407: store_coords_to 15@ 16@ 17@ from_car 1@ with_offset 0.0 0.0 0.0
           // Determine angle to final point
           15@ -= $DYOM_POINT_X[11@]
           16@ -= $DYOM_POINT_Y[11@]
           15@ *= -1.0 
           16@ *= -1.0 
           0604: get_Z_angle_for_point 15@ 16@ store_to 17@ 
           // Adjust angle of plane
           car.Angle(1@) = 17@
           23@ = $DYOM_POINT_Y[11@]
           23@ += 2.0
           02c2: drive_car_to 1@ $DYOM_POINT_X[11@] $DYOM_POINT_Y[11@] 23@
           08E6: set_plane 1@ landing_gear 0 
           02D4: car 1@ turn_off_engine 
           repeat
             wait 200
             0407: store_coords_to 15@ 16@ 17@ from_car 1@ with_offset 0.0 0.0 0.0
             // Determine distance to final point
             0509: 18@ = distance_between_XY 15@ 16@ and_XY $DYOM_POINT_X[11@] 23@ 
             // Determine angle to final point
             15@ -= $DYOM_POINT_X[11@]
             16@ -= $DYOM_POINT_Y[11@]
             15@ *= -1.0 
             16@ *= -1.0 
             0604: get_Z_angle_for_point 15@ 16@ store_to 17@ 
             // Adjust angle of plane
             car.Angle(1@) = 17@
             18@ /= 20.0
             18@ += 15.0
             if 18@ < 65.0
             then
                04BA: set_car 1@ speed_to 18@
             else
                04BA: set_car 1@ speed_to 65.0        
             end      
             gosub @HELI_CHECK
           until 01AF:   car 1@ sphere 1 in_sphere $DYOM_POINT_X[11@] $DYOM_POINT_Y[11@] $DYOM_POINT_Z[11@] radius 10.0 10.0 10.0
    
           04BA: set_car 1@ speed_to 5.0 
           wait 1000 ms       
           04BA: set_car 1@ speed_to 2.0        
           wait 1000 ms
           if 3@ == -5
           then
             0633: AS_actor 0@ exit_car
           end  
        end 
        end_thread
    end   
    
    // Calculate the altitude of the targetpoint and Fly to the target
    02CE: 12@ = ground_z_at $DYOM_POINT_X[11@] $DYOM_POINT_Y[11@] $DYOM_POINT_Z[11@] 
    13@ = $DYOM_POINT_Z[11@]
    0063: 13@ -= 12@
    14@ = 13@
    13@ -= 1.0
    14@ += 1.0
    04D2: set_plane 1@ fly_autopilot_around_point $DYOM_POINT_X[11@] $DYOM_POINT_Y[11@] $DYOM_POINT_Z[11@] altitude_between 13@ and 14@ 
    
    repeat 
      wait 10
      gosub @HELI_CHECK
    until 01AF:   car 1@ sphere 0 in_sphere $DYOM_POINT_X[11@] $DYOM_POINT_Y[11@] $DYOM_POINT_Z[11@] radius 50.0 50.0 200.0
   
UNTIL FALSE
end_thread

//===============================
// CAR DRIVER THREAD
//===============================
:CAR_DRIVER
thread 'CAR' 
var
  0@ :Actor // 0@ = actor
  1@ :Car // 1@ = car
  2@ :Integer// 2@ = startpoint
  3@ :Integer //action: -4 -> enter  -5 -> leave
  4@ :float // speed
  5@ :integer // type
  6@ :float // goal distance
  9@ :integer //actor index
  10@ :Integer// 11@ = Current target point
  11@ :Integer// 10@ = next target point
  12@ :Float// 12@ = target groundlevel
  13@  :Float// 13@ = target altitude low
  14@  :Float// 13@ = target altitude high
  21@ : Float  //x
  22@ : float  //y
  23@ : float  //  altitude
  24@ : float  // ground z
end
10@ = 2@
if 3@ == -4
then
   05CB: AS_actor 0@ enter_car 1@ as_driver 2900 ms 
   wait 3000 ms
end

00AA: store_car 1@ position_to 21@ 22@ 23@ 
02CE: 24@ = ground_z_at 21@ 22@ 23@  
0063: 23@ -= 24@

REPEAT
    // End of non-looping route reached, get out of car if needed and stop this thread.
    0663: NOP "CARPNT" 10@ 
    if 10@ < 0
    then
       06C7: AS_actor 0@ driver_of_car 1@ perform_action 6 timelimit 1000     //a fast stop                     

       wait 1000
       //04BA: set car 1@ speed instantly  0.0       
        //loop through all actors
        9@ = 0
        WHILE  $DYOM_actor_count > 9@
            0663: NOP "ACTCHK" 9@ 
            wait 0
            if and
                056D:   actor $DYOM_actor_handle[9@] defined
                $DYOM_actor_animation[9@] == -5
            then 
                if and                
                    8118:   not actor $DYOM_actor_handle[9@] dead 
                    00DB:   actor $DYOM_actor_handle[9@] in_car 1@ 
                then
                     0662: NOP "EXITCAR" 
                     0633: AS_actor $DYOM_actor_handle[9@] exit_car 
                //                 077A: set_actor $DYOM_actor_handle[9@] acquaintance 4 to_actors_pedtype 0 // see ped.dat 
                //05CD: AS_actor $DYOM_actor_handle[9@] exit_car 1@ 
                //01C2: remove_references_to_actor $DYOM_actor_handle[9@] // Like turning an actor into a random pedestrian 
                     if 08B4:   test $DYOM_actor_properties[9@] bit DYOM_actorpropbit_aware 
                     then
                        // actor is always aware of player, issue kill command
                        05E2: AS_actor $DYOM_actor_handle[9@] kill_actor $PLAYER_ACTOR
                     end
                end
            end
            9@ += 1
        END
       end_thread
    end  
     
    11@ = 10@
    10@ = $DYOM_POINT_LINK[11@]
    // End of looping route reached, wrap to startpoint
    if 10@ == -2
    then
      10@ = 2@
    end 
    // based on distance of target point to a vehicle path, chose to drive along path or not..
    // along paths is smoother, but may not reach off-path points
    02C1: store_to 21@ 22@ 23@ car_path_coords_closest_to $DYOM_POINT_X[11@] $DYOM_POINT_Y[11@] $DYOM_POINT_Z[11@]
    0509: 24@ = distance_between_XY $DYOM_POINT_X[11@] $DYOM_POINT_Y[11@] and_XY 21@ 22@ 
    if 24@ > 10.0
    then
       0662: NOP "offroad" 
       05D1: AS_actor 0@ drive_car 1@ to $DYOM_POINT_X[11@] $DYOM_POINT_Y[11@] $DYOM_POINT_Z[11@] speed 4@ 2 model #NULL 5@ 
    else
       0662: NOP "on path" 
       05D1: AS_actor 0@ drive_car 1@ to $DYOM_POINT_X[11@] $DYOM_POINT_Y[11@] $DYOM_POINT_Z[11@] speed 4@ 3 model #NULL 8
    end
    03AB: set_car 1@ stability_on_turning_movements 1 
    //Car.SetMaxSpeed(1@, 100.0)
    //Car.SetToNormalDriver(1@)
//%7h% is a value 0 to 3 AI behavior? 
//0 - Obey lights, stay in your lane, never pass (goody two shoes)
//1 - Obey lights but will pass traffic
//2 - Straight path A to B, drive through parked cars, empty lots, and buildings
//3 - Run lights, avoid cars and traffic, buildings, hits peds, who cares(maniac) 

//%8o% will reference how the car should handle through the HANDLING.CFG file 
//but if set to #NULL it sets the car to automatic. 
//(I am not 100%, I am still experimenting.)

//%9h% is some type of drivers skill. 
//The MAIN.SCM uses number 0 to 5 for this value in various missions. I have noticed setting the value higher seems to make the driver/car brake better on high speed turns and skids.    
    repeat 
      wait 10
      gosub @HELI_CHECK
    until 01AD:   car 1@ sphere 0 near_point $DYOM_POINT_X[11@] $DYOM_POINT_Y[11@] radius 6@ 6@ 
UNTIL FALSE
end_thread

//===============================
// OBJECT PROXIMITY MOVEMENT THREAD
//===============================
// 0 object
var
 1@:float   //  x
 2@:float   //  y
 3@:float   //  z
 4@:float   //  rx
 5@:float   //  ry
 6@:float   //  rz
 7@:float   //  ox
 8@:float   //  oy
 9@:float   //  oz
 10@:float  //  orx
 11@:float  //  ory
 12@:float  //  orz
 13@:float  //  t
 14@:float  //  d
 15@:float  //  dx
 16@:float  //  dy
 17@:float  //  dz
 18@:float  //  drx
 19@:float  //  dry
 20@:float  //  drz
 21@:float  //  px
 22@:float  //  py
 23@:float  //  pz
 24@:integer // = nof_steps
 25@:integer // = current_step
 26@:float // dist
end 
:PROX_MOVE
thread 'PROXM' 
13@ *= 20.0
15@ = 7@
15@ -= 1@
15@ /= 13@
16@ = 8@
16@ -= 2@
16@ /= 13@
17@ = 9@
17@ -= 3@
17@ /= 13@
18@ = 10@
18@ -= 4@
18@ /= 13@
19@ = 11@
19@ -= 5@
19@ /= 13@
20@ = 12@
20@ -= 6@
20@ /= 13@
008E: 24@ = float 13@ to_integer 
//0663: - PRINTINT "steps" 24@
25@ = 0
01BB: get_object 0@ position_3D_coord_to 7@ 8@ 9@ 
while 03CA:  is 0@ valid_object_handle  
    actor.StorePos($PLAYER_ACTOR,21@,22@,23@)
    //050A: 26@ = distance_between_XYZ 7@ 8@ 9@ and_XYZ 21@ 22@ 23@ 
    0509: 26@ = distance_between_XY 7@ 8@ and_XY 21@ 22@ 

    if 0025: 14@ > 26@
    then
      // move to open position
      if 25@ < 24@
      then      
        1@ += 15@ 
        2@ += 16@ 
        3@ += 17@ 
        4@ += 18@ 
        5@ += 19@ 
        6@ += 20@ 
        25@ += 1
        Object.PutAt(0@, 1@, 2@, 3@)
        //034E: move_object 0@ to 1@ 2@ 3@ speed 15@ 16@ 17@ flag 1 
        0453: set_object 0@ XY_rotation 4@ 5@ angle 6@ 
      end
    else
      if 25@ > 0
      then 
        1@ -= 15@ 
        2@ -= 16@ 
        3@ -= 17@ 
        4@ -= 18@ 
        5@ -= 19@ 
        6@ -= 20@ 
        25@ -= 1
//   0664: - PRINTFLOAT "rz" 6@
//   0664: - PRINTFLOAT "ry" 5@
//   0664: - PRINTFLOAT "rx" 4@
//   0664: - PRINTFLOAT "z" 3@
//   0664: - PRINTFLOAT "y" 2@
//   0664: - PRINTFLOAT "x" 1@
//   0663: - PRINTFLOAT "step" 25@
        Object.PutAt(0@, 1@, 2@, 3@)
        //034E: move_object 0@ to 7@ 8@ 9@ speed 15@ 16@ 17@ flag 1 
        0453: set_object 0@ XY_rotation 4@ 5@ angle 6@ 
      end
   end
   wait 30
end
end_thread
//===============================
// OBJECT PERMANENT MOVEMENT THREAD
//===============================
var
 1@:float   //  x
 2@:float   //  y
 3@:float   //  z
 4@:float   //  rx
 5@:float   //  ry
 6@:float   //  rz
 7@:integer //  link
 8@:float   //  speed   (m/s)
 9@:float   //  tx
 10@:float  //  ty
 11@:float  //  tz
 12@:float  //  trx
 13@:float  //  try
 14@:float  //  trz
 15@:float  //  dx
 16@:float  //  dy
 17@:float  //  dz
 18@:float  //  drx
 19@:float  //  dry
 20@:float  //  drz
 21@:float  //  dist
 22@:float  //  rotation distance   
 23@:float  //  time
 24@:integer // = nof_steps
 25@:integer // = current_step
 26@:integer   // curlink
 27@:float   // rotational time
end 
:PERM_MOVE
thread 'PERMM' 
26@ = 7@
while      NOT 26@ == -1
  9@ = $DYOM_POINT_X[26@]
  10@ = $DYOM_POINT_Y[26@]
  11@ = $DYOM_POINT_Z[26@]
  26@ = $DYOM_POINT_LINK[26@]
  12@ = $DYOM_POINT_X[26@]
  13@ = $DYOM_POINT_Y[26@]
  14@ = $DYOM_POINT_Z[26@]
  // move to next point
  // 0664: - PRINTFLOAT "rz" 6@
  // 0664: - PRINTFLOAT "ry" 5@
 //  0664: - PRINTFLOAT "rx" 4@
  // 0664: - PRINTFLOAT "z" 3@
  // 0664: - PRINTFLOAT "y" 2@
  // 0664: - PRINTFLOAT "x" 1@
  // 0664: - PRINTFLOAT "rz" 14@
 //  0664: - PRINTFLOAT "ry" 13@
 //  0664: - PRINTFLOAT "rx" 12@
 //  0664: - PRINTFLOAT "z" 11@
 //  0664: - PRINTFLOAT "y" 10@
 //  0664: - PRINTFLOAT "x" 9@
  //====================
  // calculate distance
  050A: 21@ = distance_between_XYZ 1@ 2@ 3@ and_XYZ 9@ 10@ 11@ 
  050A: 22@ = distance_between_XYZ 4@ 5@ 6@ and_XYZ 12@ 13@ 14@    // rotational dummy dist 
 // 0664: - PRINTINT "dist" 21@
 // 0664: - PRINTINT "distr" 22@

  // calculate movetime
  23@ = 21@
  23@ /= 8@ 
  27@ = 22@ 
  27@ /= 57.2
  27@ /= 8@
  if 27@ > 23@
  then
    23@ = 27@
  end  
  //0664: - PRINTINT "time" 23@
  // calculate nof_steps
  23@ *= 20.0
  // calculate 6D stepsize
  15@ = 9@
  15@ -= 1@
  15@ /= 23@
  16@ = 10@
  16@ -= 2@
  16@ /= 23@
  17@ = 11@
  17@ -= 3@
  17@ /= 23@
  18@ = 12@
  18@ -= 4@
  18@ /= 23@
  19@ = 13@
  19@ -= 5@
  19@ /= 23@
  20@ = 14@
  20@ -= 6@
  20@ /= 23@
  
  // Iterate until arrived. 
  008E: 24@ = float 23@ to_integer 
  //0663: - PRINTINT "steps" 24@
  25@ = 0  
  while 25@ < 24@
    1@ += 15@ 
    2@ += 16@ 
    3@ += 17@ 
    4@ += 18@ 
    5@ += 19@ 
    6@ += 20@ 
    25@ += 1
    Object.PutAt(0@, 1@, 2@, 3@)
    0453: set_object 0@ XY_rotation 4@ 5@ angle 6@ 
    wait 30
    if    83CA: NOT  is 0@ valid_object_handle
    then
      end_thread
    end
  end    
    
  // next point
  26@ = $DYOM_POINT_LINK[26@]
  if 26@ == -2
  then
    26@ = 7@
  end
  0663: - PRINTINT "next" 26@
  wait 10
  if    83CA: NOT  is 0@ valid_object_handle
  then
    end_thread
  end
end

end_thread



//===============================
// PARACHUTE THREAD
//===============================
:PLCHUTE
thread 'PLCHUTE' 
Model.Load(#GUN_PARA)

:PLCHUTE_10
if 
   not Model.Available(#GUN_PARA)
else_jump @PLCHUTE_2B 
wait 0 
jump @PLCHUTE_10 

:PLCHUTE_2B
if 
   not Actor.Dead($PLAYER_ACTOR)
else_jump @PLCHUTE_3B 

:PLCHUTE_3B
$1498 = 0 
$FREEFALL_STAGE = 0 
$PARACHUTE_CREATION_STAGE = 0 
if 
  $1498 == 999 
else_jump @PLCHUTE_76 
$PICKUP_PARACHUTE = Pickup.Create(#GUN_PARA, 3, $TEMPVAR_X_COORD, $TEMPVAR_Y_COORD, $TEMPVAR_Z_COORD)

:PLCHUTE_76
repeat
  wait 0
until Player.Defined($PLAYER_CHAR)

if 
   not Actor.Dead($PLAYER_ACTOR)
else_jump @PLCHUTE_154F 
if 
8800:   not unknown_check 
else_jump @PLCHUTE_154F 
if 
   not $FREEFALL_STAGE == 0 
else_jump @PLCHUTE_B0 
0992: set_player $PLAYER_CHAR weapons_scrollable 0 

:PLCHUTE_B0
if 
  $PARACHUTE_CREATION_STAGE > 0 
else_jump @PLCHUTE_DB 
if 
   not Actor.HasWeapon($PLAYER_ACTOR, 46)
else_jump @PLCHUTE_DB 
gosub @PLCHUTE_1591 

:PLCHUTE_DB
if 
  $PARACHUTE_CREATION_STAGE == 0 
else_jump @PLCHUTE_112 
if 
   Actor.HasWeapon($PLAYER_ACTOR, 46)
else_jump @PLCHUTE_112 
Model.Load(#PARACHUTE)
$PARACHUTE_CREATION_STAGE = 1 
$1498 = 0 

:PLCHUTE_112
if 
  $PARACHUTE_CREATION_STAGE == 1 
else_jump @PLCHUTE_179 
if 
   Model.Available(#PARACHUTE)
else_jump @PLCHUTE_179 
17@ = Object.Create(#PARACHUTE, $TEMPVAR_X_COORD, $TEMPVAR_Y_COORD, $TEMPVAR_Z_COORD)
069B: attach_object 17@ to_actor $PLAYER_ACTOR with_offset 0.0 0.0 0.0 rotation 0.0 0.0 0.0 
0750: toggle_object 17@ visibility 0 
$PARACHUTE_CREATION_STAGE = 2 

:PLCHUTE_179
if and
  $PARACHUTE_CREATION_STAGE == 2 
  $FREEFALL_STAGE == 1 
else_jump @PLCHUTE_199 
$PARACHUTE_CREATION_STAGE = 3 

:PLCHUTE_199
if and
  $FREEFALL_STAGE == 0 
  $PARACHUTE_CREATION_STAGE > 0 
else_jump @PLCHUTE_235 
if 
0818:   actor $PLAYER_ACTOR in_air 
else_jump @PLCHUTE_235 
083D: get_actor $PLAYER_ACTOR velocity_in_direction_XYZ $1507 $1508 $1509 
if 
  -10.0 > $1509 
else_jump @PLCHUTE_235 
0819: 7@ = actor $PLAYER_ACTOR distance_from_ground 
if 
  7@ > 20.0 
else_jump @PLCHUTE_235 
097A: play_audio_at -1000.0 -1000.0 -1000.0 event 1037 
$FREEFALL_STAGE = 1 
01B9: set_actor $PLAYER_ACTOR armed_weapon_to 46 
0@ = 0 
$8268 = 0.0 

:PLCHUTE_235
if 
  $FREEFALL_STAGE == 1 
else_jump @PLCHUTE_952 
if 
  0@ == 0 
else_jump @PLCHUTE_260 
0@ = 2 

:PLCHUTE_260
if 
  0@ == 2 
else_jump @PLCHUTE_2D9 
062E: unknown_get_actor $PLAYER_ACTOR task 2066 status_store_to 27@ // ret 7 if not found 
if 
04A4:   27@ == 7 // @ == any 
else_jump @PLCHUTE_2D9 
0812: AS_actor $PLAYER_ACTOR perform_animation "FALL_SKYDIVE" IFP_file "PED" 1.0 loopA 1 lockX 0 lockY 0 lockF 0 time -1 // versionB 
04ED: load_animation "PARACHUTE" 
15@ = 1 
1@ = Actor.Angle($PLAYER_ACTOR)
0@ = 3 

:PLCHUTE_2D9
if 
  0@ == 3 
else_jump @PLCHUTE_952 
062E: unknown_get_actor $PLAYER_ACTOR task 2066 status_store_to 27@ // ret 7 if not found 
if 
04A4:   27@ == 7 // @ == any 
else_jump @PLCHUTE_32F 
0812: AS_actor $PLAYER_ACTOR perform_animation "FALL_SKYDIVE" IFP_file "PED" 1.0 loopA 1 lockX 0 lockY 0 lockF 0 time -1 // versionB 

:PLCHUTE_32F
0819: 7@ = actor $PLAYER_ACTOR distance_from_ground 
if and
  100.0 > 7@ 
  7@ > 60.0 
else_jump @PLCHUTE_390 
if 
04EE:   animation "PARACHUTE" loaded 
else_jump @PLCHUTE_390 
if 
  $ONMISSION == 0 
else_jump @PLCHUTE_390 
00BC: show_text_highpriority GXT 'PARA_01' time 1000 flag 1  // ~s~Open your parachute!

:PLCHUTE_390
0494: get_joystick 0 data_to 10@ 11@ 12@ 12@ 
if 
  $1511 == 1 
else_jump @PLCHUTE_3C0 
10@ = 0 
11@ = 0 

:PLCHUTE_3C0
0093: 21@ = integer 10@ to_float 
21@ /= 4.267 
0063: 21@ -= 2@ // (float) 
21@ /= 20.0 
005B: 2@ += 21@ // (float) 
0087: 21@ = 2@ // (float) 
21@ /= 5.0 
0063: 1@ -= 21@ // (float) 
if 
  1@ > 180.0 
else_jump @PLCHUTE_425 
1@ -= 360.0 

:PLCHUTE_425
if 
  -180.0 > 1@ 
else_jump @PLCHUTE_444 
1@ += 360.0 

:PLCHUTE_444
0093: 22@ = integer 11@ to_float 
22@ /= 4.267 
0063: 22@ -= 3@ // (float) 
22@ /= 20.0 
005B: 3@ += 22@ // (float) 
083D: get_actor $PLAYER_ACTOR velocity_in_direction_XYZ 8@ 9@ $1509 
if 
0024:   $1504 > $1509 // (float) 
else_jump @PLCHUTE_499 
0086: $1509 = $1504 // (float) 

:PLCHUTE_499
if 
0024:   $8268 > $1509 // (float) 
else_jump @PLCHUTE_4B4 
0086: $8268 = $1509 // (float) 

:PLCHUTE_4B4
if 
0024:   $1504 > $8268 // (float) 
else_jump @PLCHUTE_4CF 
0086: $8268 = $1504 // (float) 

:PLCHUTE_4CF
if and
0024:   $1509 > $8268 // (float) 
   not $1902 == 1 
else_jump @PLCHUTE_57F 
if 
84AD:   not actor $PLAYER_ACTOR in_water 
else_jump @PLCHUTE_551 
if 
  -20.0 > $8268 
else_jump @PLCHUTE_51C 
$FREEFALL_STAGE = 2 
jump @PLCHUTE_54A 

:PLCHUTE_51C
0812: AS_actor $PLAYER_ACTOR perform_animation "FALL_SKYDIVE" IFP_file "PED" 1.0 loopA 1 lockX 0 lockY 0 lockF 0 time 100 // versionB 
$FREEFALL_STAGE = 7 

:PLCHUTE_54A
jump @PLCHUTE_57F 

:PLCHUTE_551
0812: AS_actor $PLAYER_ACTOR perform_animation "FALL_SKYDIVE" IFP_file "PED" 1.0 loopA 1 lockX 0 lockY 0 lockF 0 time 100 // versionB 
$FREEFALL_STAGE = 7 

:PLCHUTE_57F
0087: 4@ = 3@ // (float) 
4@ /= 30.0 
006F: 4@ *= $1505 // (float) 
02F6: $1507 = cosine 1@ // (float) 
02F7: $1508 = sine 1@ // (float) 
006D: $1507 *= 4@ // (float) 
006D: $1508 *= 4@ // (float) 
$1508 *= -1.0 
0059: $1508 += $1506 // (float) 
0087: 21@ = 8@ // (float) 
0065: 21@ -= $1507 // (float) 
21@ *= 0.01 
0088: $1507 = 8@ // (float) 
0067: $1507 -= 21@ // (float) 
0087: 21@ = 9@ // (float) 
0065: 21@ -= $1508 // (float) 
21@ *= 0.01 
0088: $1508 = 9@ // (float) 
0067: $1508 -= 21@ // (float) 
0085: 12@ = 10@ // (int) 
0085: 13@ = 11@ // (int) 
0095: make 12@ absolute_integer 
0095: make 13@ absolute_integer 
if or
  12@ > 40 
  13@ > 40 
else_jump @PLCHUTE_83D 
if 
001D:   12@ > 13@ // (int) 
else_jump @PLCHUTE_750 
if 
  10@ >= 0 
else_jump @PLCHUTE_6D7 
if 
   not 15@ == 2 
else_jump @PLCHUTE_6D7 
if 
04EE:   animation "PARACHUTE" loaded 
else_jump @PLCHUTE_6D0 
0812: AS_actor $PLAYER_ACTOR perform_animation "FALL_SKYDIVE_R" IFP_file "PARACHUTE" 1.0 loopA 1 lockX 0 lockY 0 lockF 1 time -2 // versionB 

:PLCHUTE_6D0
15@ = 2 

:PLCHUTE_6D7
if 
  0 > 10@ 
else_jump @PLCHUTE_749 
if 
   not 15@ == 3 
else_jump @PLCHUTE_749 
if 
04EE:   animation "PARACHUTE" loaded 
else_jump @PLCHUTE_742 
0812: AS_actor $PLAYER_ACTOR perform_animation "FALL_SKYDIVE_L" IFP_file "PARACHUTE" 1.0 loopA 1 lockX 0 lockY 0 lockF 1 time -2 // versionB 

:PLCHUTE_742
15@ = 3 

:PLCHUTE_749
jump @PLCHUTE_836 

:PLCHUTE_750
if 
  11@ >= 0 
else_jump @PLCHUTE_7C0 
if 
   not 15@ == 4 
else_jump @PLCHUTE_7C0 
if 
04EE:   animation "PARACHUTE" loaded 
else_jump @PLCHUTE_7B9 
0812: AS_actor $PLAYER_ACTOR perform_animation "FALL_SKYDIVE" IFP_file "PARACHUTE" 1.0 loopA 1 lockX 0 lockY 0 lockF 1 time -2 // versionB 

:PLCHUTE_7B9
15@ = 4 

:PLCHUTE_7C0
if 
  0 > 11@ 
else_jump @PLCHUTE_836 
if 
   not 15@ == 5 
else_jump @PLCHUTE_836 
if 
04EE:   animation "PARACHUTE" loaded 
else_jump @PLCHUTE_82F 
0812: AS_actor $PLAYER_ACTOR perform_animation "FALL_SKYDIVE_ACCEL" IFP_file "PARACHUTE" 1.0 loopA 1 lockX 0 lockY 0 lockF 1 time -2 // versionB 

:PLCHUTE_82F
15@ = 5 

:PLCHUTE_836
jump @PLCHUTE_89B 

:PLCHUTE_83D
if 
   not 15@ == 1 
else_jump @PLCHUTE_89B 
if 
04EE:   animation "PARACHUTE" loaded 
else_jump @PLCHUTE_89B 
0812: AS_actor $PLAYER_ACTOR perform_animation "FALL_SKYDIVE" IFP_file "PARACHUTE" 1.0 loopA 1 lockX 0 lockY 0 lockF 1 time -2 // versionB 
15@ = 1 

:PLCHUTE_89B
if or
00E1:   player 0 pressed_key 17 
  $1512 == 1 
else_jump @PLCHUTE_952 
if 
   not $1902 == 1 
else_jump @PLCHUTE_952 
if 
04EE:   animation "PARACHUTE" loaded 
else_jump @PLCHUTE_952 
if and
  $PARACHUTE_CREATION_STAGE == 3 
  $1511 == 0 
else_jump @PLCHUTE_952 
0812: AS_actor $PLAYER_ACTOR perform_animation "PARA_OPEN" IFP_file "PARACHUTE" 8.0 loopA 0 lockX 0 lockY 0 lockF 1 time -2 // versionB 
097A: play_audio_at -1000.0 -1000.0 -1000.0 event 1038 
008A: $8270 = 32@ // (int) 
$8270 += 1100 
$FREEFALL_STAGE = 3 
0@ = 0 

:PLCHUTE_952
if 
  $FREEFALL_STAGE == 2 
else_jump @PLCHUTE_9C8 
if 
04EE:   animation "PARACHUTE" loaded 
else_jump @PLCHUTE_9BC 
Actor.Angle($PLAYER_ACTOR) = 1@
0829: actor $PLAYER_ACTOR perform_animation "FALL_SKYDIVE_DIE" IFP_file "PARACHUTE" 1000.0 time 0 and_dies 
09F1: play_audio_at_actor $PLAYER_ACTOR event 1189 
jump @PLCHUTE_9C1 

:PLCHUTE_9BC
05BE: AS_kill_actor $PLAYER_ACTOR 

:PLCHUTE_9C1
gosub @PLCHUTE_1591 

:PLCHUTE_9C8
if 
  $FREEFALL_STAGE == 3 
else_jump @PLCHUTE_12AD 
if 
  $8270 > 0 
else_jump @PLCHUTE_A1A 
if 
001F:   32@ > $8270 // (int) 
else_jump @PLCHUTE_A1A 
097A: play_audio_at -1000.0 -1000.0 -1000.0 event 1039 
$8270 = 0 

:PLCHUTE_A1A
if 
  0@ == 0 
else_jump @PLCHUTE_A81 
0087: 25@ = 3@ // (float) 
25@ /= 500.0 
0087: 26@ = 2@ // (float) 
26@ /= 500.0 
0085: 18@ = 32@ // (int) 
0085: 19@ = 32@ // (int) 
0087: 5@ = 4@ // (float) 
5@ *= -1.0 
0089: 6@ = $1509 // (float) 
0@ = 1 

:PLCHUTE_A81
if 
  0@ == 1 
else_jump @PLCHUTE_B28 
0085: 10@ = 32@ // (int) 
0062: 10@ -= 19@ // (int) 
if 
  500 > 10@ 
else_jump @PLCHUTE_B0D 
0085: 10@ = 32@ // (int) 
0062: 10@ -= 18@ // (int) 
0085: 18@ = 32@ // (int) 
0093: 21@ = integer 10@ to_float 
0087: 22@ = 25@ // (float) 
006B: 22@ *= 21@ // (float) 
0087: 23@ = 26@ // (float) 
006B: 23@ *= 21@ // (float) 
0063: 3@ -= 22@ // (float) 
0063: 2@ -= 23@ // (float) 
jump @PLCHUTE_B28 

:PLCHUTE_B0D
2@ = 0.0 
3@ = 0.0 
0@ = 2 

:PLCHUTE_B28
if 
  0@ == 2 
else_jump @PLCHUTE_B94 
if 
03CA:   object 17@ exists 
else_jump @PLCHUTE_B94 
0750: toggle_object 17@ visibility 1 
08D2: object 17@ scale_model 0.0 
0085: 19@ = 32@ // (int) 
repeat
  wait 0
until Player.Defined($PLAYER_CHAR)
075A: set_object 17@ animation "PARA_OPEN_O" IFP_file "PARACHUTE" 1000.0 lockF 0 loop 1 // IF AND SET 
0@ = 3 

:PLCHUTE_B94
if 
  0@ == 3 
else_jump @PLCHUTE_BFB 
0085: 10@ = 32@ // (int) 
0062: 10@ -= 19@ // (int) 
if 
  500 > 10@ 
else_jump @PLCHUTE_BEA 
0093: 21@ = integer 10@ to_float 
21@ /= 500.0 
08D2: object 17@ scale_model 21@ 
jump @PLCHUTE_BFB 

:PLCHUTE_BEA
08D2: object 17@ scale_model 1.0 
0@ = 4 

:PLCHUTE_BFB
if 
  0@ == 5 
else_jump @PLCHUTE_C40 
20@ = Object.Create(#PARA_COLLISION, 0.0, 0.0, 0.0)
0750: toggle_object 20@ visibility 0 
Object.ToggleInMovingList(20@) = True
04D9: object 20@ set_scripted_collision_check 1 
0@ = 6 

:PLCHUTE_C40
if 
  0@ == 6 
else_jump @PLCHUTE_1102 
0494: get_joystick 0 data_to 10@ 11@ 12@ 12@ 
if 
  $1511 == 1 
else_jump @PLCHUTE_C82 
10@ = 0 
11@ = 0 

:PLCHUTE_C82
0093: 21@ = integer 10@ to_float 
21@ /= 4.267 
0063: 21@ -= 2@ // (float) 
21@ /= 20.0 
005B: 2@ += 21@ // (float) 
0087: 21@ = 2@ // (float) 
21@ /= 15.0 
0063: 1@ -= 21@ // (float) 
if 
  1@ > 180.0 
else_jump @PLCHUTE_CE7 
1@ -= 360.0 

:PLCHUTE_CE7
if 
  -180.0 > 1@ 
else_jump @PLCHUTE_D06 
1@ += 360.0 

:PLCHUTE_D06
02F6: $1507 = cosine 1@ // (float) 
02F7: $1508 = sine 1@ // (float) 
0069: $1507 *= $1500 // (float) 
0069: $1508 *= $1500 // (float) 
$1507 *= -1.0 
0085: 12@ = 10@ // (int) 
0085: 13@ = 11@ // (int) 
0095: make 12@ absolute_integer 
0095: make 13@ absolute_integer 
if or
  12@ > 40 
  13@ > 40 
else_jump @PLCHUTE_FE2 
if 
001D:   12@ > 13@ // (int) 
else_jump @PLCHUTE_E9D 
0089: 21@ = $1501 // (float) 
0065: 21@ -= $1509 // (float) 
21@ /= 20.0 
005F: $1509 += 21@ // (float) 
if 
  10@ >= 0 
else_jump @PLCHUTE_E17 
if 
   not 15@ == 2 
else_jump @PLCHUTE_E17 
0812: AS_actor $PLAYER_ACTOR perform_animation "PARA_STEERR" IFP_file "PARACHUTE" 1.0 loopA 1 lockX 0 lockY 0 lockF 1 time -2 // versionB 
075A: set_object 17@ animation "PARA_STEERR_O" IFP_file "PARACHUTE" 1.0 lockF 1 loop 1 // IF AND SET 
15@ = 2 

:PLCHUTE_E17
if 
  0 > 10@ 
else_jump @PLCHUTE_E96 
if 
   not 15@ == 3 
else_jump @PLCHUTE_E96 
0812: AS_actor $PLAYER_ACTOR perform_animation "PARA_STEERL" IFP_file "PARACHUTE" 1.0 loopA 1 lockX 0 lockY 0 lockF 1 time -2 // versionB 
075A: set_object 17@ animation "PARA_STEERL_O" IFP_file "PARACHUTE" 1.0 lockF 1 loop 1 // IF AND SET 
15@ = 3 

:PLCHUTE_E96
jump @PLCHUTE_FDB 

:PLCHUTE_E9D
if 
  11@ >= 0 
else_jump @PLCHUTE_F3C 
0089: 21@ = $1503 // (float) 
0065: 21@ -= $1509 // (float) 
21@ /= 20.0 
005F: $1509 += 21@ // (float) 
if 
   not 15@ == 4 
else_jump @PLCHUTE_F3C 
0812: AS_actor $PLAYER_ACTOR perform_animation "PARA_DECEL" IFP_file "PARACHUTE" 1.0 loopA 1 lockX 0 lockY 0 lockF 1 time -2 // versionB 
075A: set_object 17@ animation "PARA_DECEL_O" IFP_file "PARACHUTE" 1.0 lockF 1 loop 1 // IF AND SET 
15@ = 4 

:PLCHUTE_F3C
if 
  0 > 11@ 
else_jump @PLCHUTE_FDB 
0089: 21@ = $1501 // (float) 
0065: 21@ -= $1509 // (float) 
21@ /= 20.0 
005F: $1509 += 21@ // (float) 
if 
   not 15@ == 5 
else_jump @PLCHUTE_FDB 
0812: AS_actor $PLAYER_ACTOR perform_animation "PARA_FLOAT" IFP_file "PARACHUTE" 1.0 loopA 1 lockX 0 lockY 0 lockF 1 time -2 // versionB 
075A: set_object 17@ animation "PARA_FLOAT_O" IFP_file "PARACHUTE" 1.0 lockF 1 loop 1 // IF AND SET 
15@ = 5 

:PLCHUTE_FDB
jump @PLCHUTE_1081 

:PLCHUTE_FE2
0089: 21@ = $1501 // (float) 
0065: 21@ -= $1509 // (float) 
21@ /= 20.0 
005F: $1509 += 21@ // (float) 
if 
   not 15@ == 5 
else_jump @PLCHUTE_1081 
if 
   not 15@ == 1 
else_jump @PLCHUTE_1081 
0812: AS_actor $PLAYER_ACTOR perform_animation "PARA_FLOAT" IFP_file "PARACHUTE" 1.0 loopA 1 lockX 0 lockY 0 lockF 1 time -2 // versionB 
075A: set_object 17@ animation "PARA_FLOAT_O" IFP_file "PARACHUTE" 1.0 lockF 1 loop 1 // IF AND SET 
15@ = 1 

:PLCHUTE_1081
Object.StorePos(17@, $TEMPVAR_FLOAT_1, $TEMPVAR_FLOAT_2, $TEMPVAR_FLOAT_3)
0815: put_object 20@ at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 and_keep_rotation 
if 
04DA:   has_object 20@ collided 
else_jump @PLCHUTE_10DE 
075A: set_object 17@ animation "PARA_RIP_LOOP_O" IFP_file "PARACHUTE" 8.0 lockF 1 loop 1 // IF AND SET 
0@ = 7 

:PLCHUTE_10DE
if 
00E1:   player 0 pressed_key 15 
else_jump @PLCHUTE_1102 
0792: disembark_instantly_actor $PLAYER_ACTOR 
$FREEFALL_STAGE = 6 
$1498 = 3 

:PLCHUTE_1102
if 
03CA:   object 17@ exists 
else_jump @PLCHUTE_11F1 
if 
0837:   object 17@ animation == "PARA_OPEN_O" 
else_jump @PLCHUTE_11F1 
0839: get_object 17@ animation "PARA_OPEN_O" progress_to 21@ 
0087: 22@ = 6@ // (float) 
0065: 22@ -= $1501 // (float) 
0087: 23@ = 22@ // (float) 
006B: 23@ *= 21@ // (float) 
0088: $1509 = 6@ // (float) 
0067: $1509 -= 23@ // (float) 
0087: 22@ = 5@ // (float) 
0065: 22@ -= $1500 // (float) 
0087: 23@ = 22@ // (float) 
006B: 23@ *= 21@ // (float) 
0087: 4@ = 5@ // (float) 
0063: 4@ -= 23@ // (float) 
02F6: $1507 = cosine 1@ // (float) 
02F7: $1508 = sine 1@ // (float) 
006D: $1507 *= 4@ // (float) 
006D: $1508 *= 4@ // (float) 
$1507 *= -1.0 
if and
  21@ == 1.0 
  0@ == 4 
else_jump @PLCHUTE_11F1 
0@ = 5 

:PLCHUTE_11F1
if 
   not Actor.Dead($PLAYER_ACTOR)
else_jump @PLCHUTE_12AD 
if 
04AD:   actor $PLAYER_ACTOR in_water 
else_jump @PLCHUTE_127C 
0812: AS_actor $PLAYER_ACTOR perform_animation "PARA_LAND_WATER" IFP_file "PARACHUTE" 8.0 loopA 1 lockX 1 lockY 0 lockF 0 time 1000 // versionB 
075A: set_object 17@ animation "PARA_LAND_WATER_O" IFP_file "PARACHUTE" 1000.0 lockF 0 loop 1 // IF AND SET 
$FREEFALL_STAGE = 5 
0@ = 0 

:PLCHUTE_127C
083D: get_actor $PLAYER_ACTOR velocity_in_direction_XYZ 21@ 21@ 23@ 
if 
  23@ > -0.1 
else_jump @PLCHUTE_12AD 
$FREEFALL_STAGE = 4 
0@ = 0 

:PLCHUTE_12AD
if 
  $FREEFALL_STAGE == 4 
else_jump @PLCHUTE_1497 
if 
  0@ == 0 
else_jump @PLCHUTE_1430 
$1498 = 1 
Actor.StorePos($PLAYER_ACTOR, $TEMPVAR_X_COORD, $TEMPVAR_Y_COORD, $TEMPVAR_Z_COORD)
$TEMPVAR_Z_COORD -= 1.0 
Actor.PutAt($PLAYER_ACTOR, $TEMPVAR_X_COORD, $TEMPVAR_Y_COORD, $TEMPVAR_Z_COORD)
083E: set_actor $PLAYER_ACTOR rotation 0.0 0.0 1@ while_in_air 
if 
  -10.0 > $1509 
else_jump @PLCHUTE_133A 
$FREEFALL_STAGE = 2 
0@ = 0 
jump @PLCHUTE_13E4 

:PLCHUTE_133A
if 
  -4.0 > $1509 
else_jump @PLCHUTE_13B7 
0615: define_AS_pack_begin 14@ 
0812: AS_actor -1 perform_animation "FALL_FRONT" IFP_file "PED" 20.0 loopA 0 lockX 0 lockY 0 lockF 1 time 700 // versionB 
0812: AS_actor -1 perform_animation "GETUP_FRONT" IFP_file "PED" 8.0 loopA 0 lockX 1 lockY 0 lockF 0 time -2 // versionB 
0616: define_AS_pack_end 14@ 
0618: assign_actor $PLAYER_ACTOR to_AS_pack 14@ 
061B: remove_references_to_AS_pack 14@ 
jump @PLCHUTE_13DD 

:PLCHUTE_13B7
0812: AS_actor $PLAYER_ACTOR perform_animation "RUN_PLAYER" IFP_file "PED" 8.0 loopA 1 lockX 1 lockY 0 lockF 0 time 1000 // versionB 

:PLCHUTE_13DD
0@ = 1 

:PLCHUTE_13E4
075A: set_object 17@ animation "PARA_LAND_O" IFP_file "PARACHUTE" 1000.0 lockF 0 loop 1 // IF AND SET 
0682: detach_object 17@ 0.0 0.0 0.0 collision_detection 0 
0085: 18@ = 32@ // (int) 
18@ += 1000 

:PLCHUTE_1430
if 
  0@ == 1 
else_jump @PLCHUTE_1497 
if 
0837:   object 17@ animation == "PARA_LAND_O" 
else_jump @PLCHUTE_1497 
0839: get_object 17@ animation "PARA_LAND_O" progress_to 21@ 
if 
  21@ == 1.0 
else_jump @PLCHUTE_1497 
$1498 = 2 
gosub @PLCHUTE_1591 

:PLCHUTE_1497
if 
  $FREEFALL_STAGE == 5 
else_jump @PLCHUTE_14D0 
$1498 = 1 
if 
  0@ == 0 
else_jump @PLCHUTE_14D0 
$1498 = 2 
gosub @PLCHUTE_1591 

:PLCHUTE_14D0
if and
  $FREEFALL_STAGE > 0 
  4 > $FREEFALL_STAGE 
else_jump @PLCHUTE_151D 
if 
   not Actor.Dead($PLAYER_ACTOR)
else_jump @PLCHUTE_151D 
083C: set_actor $PLAYER_ACTOR velocity_in_direction_XYZ $1507 $1508 $1509 
Actor.Angle($PLAYER_ACTOR) = 1@
083E: set_actor $PLAYER_ACTOR rotation 3@ 2@ 1@ while_in_air 

:PLCHUTE_151D
if 
  $FREEFALL_STAGE == 6 
else_jump @PLCHUTE_1536 
gosub @PLCHUTE_1591 

:PLCHUTE_1536
if 
  $FREEFALL_STAGE == 7 
else_jump @PLCHUTE_154F 
gosub @PLCHUTE_1556 

:PLCHUTE_154F
jump @PLCHUTE_76 

:PLCHUTE_1556
$FREEFALL_STAGE = 0 
0@ = 0 
Model.Destroy(#PARACHUTE)
04EF: release_animation "PARACHUTE" 
083E: set_actor $PLAYER_ACTOR rotation 0.0 0.0 1@ while_in_air 
0992: set_player $PLAYER_CHAR weapons_scrollable 1 
return 

:PLCHUTE_1591
0682: detach_object 17@ 0.0 0.0 0.0 collision_detection 0 
09A2: destroy_object_with_fade 17@ 
Object.Destroy(20@)
0555: remove_weapon 46 from_actor $PLAYER_ACTOR 
$FREEFALL_STAGE = 0 
$PARACHUTE_CREATION_STAGE = 0 
0@ = 0 
Model.Destroy(#PARACHUTE)
04EF: release_animation "PARACHUTE" 
Model.Destroy(#GUN_PARA)
083E: set_actor $PLAYER_ACTOR rotation 0.0 0.0 1@ while_in_air 
0992: set_player $PLAYER_CHAR weapons_scrollable 1 
end_thread 


//===============================
// STORYLINE HANDLING
//===============================
var
  $cur_mission :Integer
  $mission_idx :integer
  $missions_available :Integer
end
//======================================
// ENABLE_MISSIONS after current mission
//======================================
:story_enable_missions
$mission_idx = 1
while $mission_idx < $DYOM_trigger_count
  if $DYOM_trigger_after[$mission_idx] == $cur_mission
  then
      $missions_available += 1
      marker.CreateIconAndSphere($DYOM_trigger_mhandle[$mission_idx],$DYOM_trigger_icon[$mission_idx],$DYOM_trigger_location_x[$mission_idx],$DYOM_trigger_location_y[$mission_idx],$DYOM_trigger_location_z[$mission_idx])
  end
  $mission_idx += 1
end
return
//======================================
// LOAD_MISSION
//======================================
:load_mission
$TEXTCUR = $cur_mission
$TEXTCUR *= 16
$TEXTCUR += $TEXTTRIGGERS
// Calculate address of this string,
// and copy the input string at offset 4 into it
1@v = "DSL/            "        
0A9F: 0@ = current_thread_pointer
0@ += 0x3C
0@ += 8 // variable 1@s => 1 * 4  ( +4 for "DSL/" )
if 0AA9:   is_game_version_original 
then 
    0AA5: call 0x718600 num_params 2 pop 2 0@ $TEXTCUR // cpystr
else
    0AA5: call 0x718E90 num_params 2 pop 2 0@ $TEXTCUR // cpystr
end
// Now save the current mission under this name 
v$filename = 1@v
gosub @LOAD_NAMED_FILE
if $LOAD_RESULT == 0
then
    // File could not be load
    00BC: show_text_highpriority GXT 'FILERRL' time 3000 flag 1
end  
return
//======================================
// RUN_MISSION
//======================================
:run_mission
$ONMISSION = 1
0ACB: show_styled_text $TEXTNAME time 1000 style 2

while not player.Defined($PLAYER_CHAR) 
wait 100
end
fade 0 500
Player.CanMove($PLAYER_CHAR) = True

start_mission 1 
repeat
wait 200
until $ONMISSION == 0
01EB: set_traffic_density_multiplier_to 1.0 
03DE: set_pedestrians_density_multiplier_to 1.0 

return


//===============================
// STORYLINE THREAD
//===============================
:STORYLINE_THREAD
$missions_available = 0
$cur_mission = 0
gosub @CLEAR_DESIGN_ITEMS
$DYOM_IN_STORY = 1

// Clean the handles
$mission_idx = 1 
while $mission_idx < $DYOM_trigger_count
  $DYOM_trigger_mhandle[$mission_idx] = 0
  $mission_idx += 1
end

//Prepare environment and player
01EB: set_traffic_density_multiplier_to 1.0 
03DE: set_pedestrians_density_multiplier_to 1.0 
// Start storyline with $100
$my_money = Player.Money($PLAYER_CHAR)
$my_money -= 100
$my_money *= -1
Player.Money($PLAYER_CHAR) += $my_money 

048F: actor $PLAYER_ACTOR remove_weapons 
0223: set_actor $PLAYER_ACTOR health_to 1000
gosub @DESIGNMODE_OFF


//run intro mission
v$filename = "DSL/_intro.dat"
gosub @LOAD_NAMED_FILE
if $LOAD_RESULT == 1
then
  $DYOM_IN_INTRO = 1
  repeat
    gosub @run_mission
    wait 0
  until $DYOM_MISSION_RESULT == 1  
  $DYOM_IN_INTRO = 0
end  
// Enable initial mission(s)
gosub @story_enable_missions
while $missions_available > 0
   // Check if any enabled mission is triggered
 while not player.Defined($PLAYER_CHAR) 
    wait 100
 end
 04C4: store_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 from_actor $PLAYER_ACTOR with_offset 0.0 0.5 0.0
   $cur_mission = 1 
   while $cur_mission < $DYOM_trigger_count
     if NOT $DYOM_trigger_mhandle[$cur_mission] == 0
     then
       050A: $dist = distance_between_XYZ $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 and_XYZ $DYOM_trigger_location_x[$cur_mission] $DYOM_trigger_location_y[$cur_mission] $DYOM_trigger_location_z[$cur_mission]
       if $dist < 1.0
        then
          //01E5: show_text_1number_highpriority GXT 'NUMBER' number $cur_mission time 1000 flag 1
          gosub @load_mission
          gosub @run_mission
          if  $DYOM_MISSION_RESULT == 1
          then
            $missions_available -= 1
            // disable marker
            marker.Disable($DYOM_trigger_mhandle[$cur_mission])
            $DYOM_trigger_mhandle[$cur_mission] = 0

            // Give out rewards
            $trigger_reward =  $DYOM_trigger_reward[$cur_mission]
            gosub @DECODE_REWARD
            01E3: show_text_1number_styled GXT 'M_PASSS' number $reward_money time 5000 style 1  // MISSION PASSED!~n~~w~$~1~~n~~w~RESPECT +
            Player.Money($PLAYER_CHAR) += $reward_money
            0998: add_respect 5
            if $reward_weather > 0
            then
                $reward_weather -= 1
                01B6: set_weather $reward_weather               
            end
            if $reward_riot_c ==1
            then
                06C8: enable_riot $reward_riot_v 
            end
            if $reward_wanted_c  == 1
            then
                if $reward_wanted_v == 1
                then
                    01F0: set_max_wanted_level_to 6   
                else
                    01F0: set_max_wanted_level_to 0   
                end
            end
            if $reward_enable_c == 1
            then
                if $reward_enable_vv == 1
                then
                    01EB: set_traffic_density_multiplier_to 1.0 
                else
                    03BA: clear_cars_from_cube_cornerA -3000.0 -3000.0 -100.0 cornerB 3000.0 3000.0 2000.0
                    01EB: set_traffic_density_multiplier_to 0.0 
                end
                if $reward_enable_vp == 1
                then
                    03DE: set_pedestrians_density_multiplier_to 1.0 
                else
                    042B: clear_peds_from_cube_cornerA -3000.0 -3000.0 -100.0 cornerB 3000.0 3000.0 2000.0 
                    03DE: set_pedestrians_density_multiplier_to 0.0 
                end
            end

            // enable followup mission(s)
            gosub @story_enable_missions            
          end
        end
     end
     $cur_mission += 1
   end
   // y and n will cancel the storyline
   if and
   0AB0:  key_pressed 89
   0AB0:  key_pressed 78
   then
        while 0AB0:  key_pressed 89
          wait 20
        end  
        Player.CanMove($PLAYER_CHAR) = False

        08D4: $menu = create_panel_with_title 'SLINE' position 29.0 170.0 width 180.0 columns 1 interactive 1 background 1 alignment 0  
        08DB: set_panel $menu column 0 header 'SMENU' data 'SABORT' 'LPROG' 'SPROG' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY' 'DUMMY'  
        gosub @GEN_MENU
        if $menu_canceled == 0
        then
            if $menu_choice == 0
            then
                // Clean the markers
                $mission_idx = 1 
                while $mission_idx < $DYOM_trigger_count
                  if NOT $DYOM_trigger_mhandle[$mission_idx] == 0
                  then
                    marker.Disable($DYOM_trigger_mhandle[$mission_idx])
                    $DYOM_trigger_mhandle[$cur_mission] = 0
                  end
                  $mission_idx += 1
                end        
              Player.CanMove($PLAYER_CHAR) = True
                wait 500
                goto @STORYLINE_CLEANUP 
            end       
            if $menu_choice == 1
            then
                gosub @LOAD_PROGRESS
            end       
            if $menu_choice == 2
            then
                gosub @SAVE_PROGRESS
            end       
        end
        Player.CanMove($PLAYER_CHAR) = True
        
   end
   wait 0
end
// run outro mission
v$filename = "DSL/_outro.dat"
gosub @LOAD_NAMED_FILE
if $LOAD_RESULT == 1
then
  $DYOM_IN_INTRO = 1
  gosub @run_mission
  $DYOM_IN_INTRO = 0
end  

:STORYLINE_CLEANUP
gosub @CLEAR_DESIGN_ITEMS
$INITDONE = 0
0417: start_mission 0  // Initial 
repeat
  wait 10
until $INITDONE == 1

01F0: set_max_wanted_level_to 0
01B6: set_weather 0               

gosub @DESIGNMODE_ON

// handling for a finished storyline
$DYOM_IN_STORY = 0
gosub @SHOW_DESIGN_ITEMS
//end_thread

while not player.Defined($PLAYER_CHAR) 
    wait 100
end
$my_money = Player.Money($PLAYER_CHAR)
$my_money -= 100
$my_money *= -1
Player.Money($PLAYER_CHAR) += $my_money 

//09C7: set_player $PLAYER_CHAR modelID_to #NULL
0373: set_camera_directly_behind_player 
02EB: restore_camera_with_jumpcut
048F: actor $PLAYER_ACTOR remove_weapons 
06C8: enable_riot 0
03BA: clear_cars_from_cube_cornerA -3000.0 -3000.0 -100.0 cornerB 3000.0 3000.0 2000.0
042B: clear_peds_from_cube_cornerA -3000.0 -3000.0 -100.0 cornerB 3000.0 3000.0 2000.0 
01EB: set_traffic_density_multiplier_to 0.0 
03DE: set_pedestrians_density_multiplier_to 0.0 

end_thread

:XPLO_THREAD
020C: create_explosion_with_radius 6 at 0@ 1@ 2@
wait 100
020C: create_explosion_with_radius 1 at 0@ 1@ 2@
wait 100
020C: create_explosion_with_radius 2 at 0@ 1@ 2@
wait 100
020C: create_explosion_with_radius 3 at 0@ 1@ 2@
end_thread




//=====================================
//-------------------------------------
//-------------Mission 0---------------
//-------------------------------------
//=====================================
:INITIAL
//===============================
// FILE version number
//===============================
$DYOM_file_version = 5
$PARTIAL_PLAY = 0
gosub @CLEAR_DESIGN_ITEMS

// enable all wasted and busted respawn point
016C: restart_if_wasted_at 2027.77 -1420.52 15.99 angle 137.0 town_number 0 
016C: restart_if_wasted_at 1180.85 -1325.57 12.58 angle 271.4 town_number 0 
016D: restart_if_busted_at 1550.68 -1675.49 14.51 angle 90.0 town_number 0 
016C: restart_if_wasted_at 1244.437 331.2261 18.5547 angle 7.5465 town_number 1 
016D: restart_if_busted_at 632.2344 -571.7104 15.3515 angle 267.2 town_number 1 
016C: restart_if_wasted_at -2199.719 -2308.075 29.6181 angle 322.8928 town_number 1 
016D: restart_if_busted_at -2163.829 -2387.817 29.625 angle 134.2066 town_number 1 
016C: restart_if_wasted_at -2670.285 616.4364 13.4531 angle 183.1042 town_number 1 
016D: restart_if_busted_at -1605.792 716.8598 11.0241 angle 355.2978 town_number 1 
016C: restart_if_wasted_at -316.3832 1056.045 18.7344 angle 1.6017 town_number 2 
016D: restart_if_busted_at -212.1889 979.4168 18.3219 angle 278.0478 town_number 2 
016C: restart_if_wasted_at -1514.823 2527.119 54.7443 angle 2.3546 town_number 2 
016D: restart_if_busted_at -1393.072 2633.116 54.9491 angle 86.0424 town_number 2 
016C: restart_if_wasted_at 1578.446 1770.682 9.8358 angle 99.7567 town_number 2 
016D: restart_if_busted_at 2337.083 2453.802 13.9765 angle 90.7643 town_number 2 

// These interiours are not solid
07FB: toggle_interior 'FDREST1' access 0  // World of Coq
07FB: toggle_interior 'REST2' access 0  // Secret Valley
07FB: toggle_interior 'DINER1' access 0  // Diner
07FB: toggle_interior 'DINER2' access 0  // Diner
07FB: toggle_interior 'TSDINER' access 0  // Truck Stop
07FB: toggle_interior 'GF1' access 0 
07FB: toggle_interior 'GF2' access 0 
07FB: toggle_interior 'GF3' access 0 
07FB: toggle_interior 'GF4' access 0 
07FB: toggle_interior 'GF5' access 0 
07FB: toggle_interior 'GF6' access 0 
                                      
//wall of big smoke factory
$2721 = Object.Init(#IMY_SHASH_WALL, 2522.008, -1272.93, 35.609)
Object.Indestructibility($2721) = False
Object.KeepInMemory($2721) = True
Object.RemoveFromMissionCleanupList($2721)

08CA: reset_zones_info 
0767: set_zone 'MARKST' popcycle_group_for_peds_and_cars_to 14  // Market Station
0767: set_zone 'UNITY' popcycle_group_for_peds_and_cars_to 5  // Unity Station
0767: set_zone 'LAIR1' popcycle_group_for_peds_and_cars_to 16 
0767: set_zone 'LAIR2A' popcycle_group_for_peds_and_cars_to 16 
0767: set_zone 'LAIR2B' popcycle_group_for_peds_and_cars_to 16 
0767: set_zone 'LBAG1' popcycle_group_for_peds_and_cars_to 19 
0767: set_zone 'LBAG2' popcycle_group_for_peds_and_cars_to 19 
0767: set_zone 'LBAG3' popcycle_group_for_peds_and_cars_to 19 
0767: set_zone 'BLUF1A' popcycle_group_for_peds_and_cars_to 10 
0767: set_zone 'BLUF2' popcycle_group_for_peds_and_cars_to 10 
0767: set_zone 'SUN1' popcycle_group_for_peds_and_cars_to 2 
0767: set_zone 'SUN1' popcycle_group_for_peds_and_cars_to 2 
0767: set_zone 'SUN3A' popcycle_group_for_peds_and_cars_to 2 
0767: set_zone 'SUN3B' popcycle_group_for_peds_and_cars_to 2 
0767: set_zone 'SUN3C' popcycle_group_for_peds_and_cars_to 2 
0767: set_zone 'SUN4' popcycle_group_for_peds_and_cars_to 2 
0767: set_zone 'COM1A' popcycle_group_for_peds_and_cars_to 9 
0767: set_zone 'COM1B' popcycle_group_for_peds_and_cars_to 9 
0767: set_zone 'COM2' popcycle_group_for_peds_and_cars_to 9 
0767: set_zone 'COM3' popcycle_group_for_peds_and_cars_to 9 
0767: set_zone 'COM4' popcycle_group_for_peds_and_cars_to 9 
0767: set_zone 'PER1' popcycle_group_for_peds_and_cars_to 9  // Pershing Square
0767: set_zone 'CHC1A' popcycle_group_for_peds_and_cars_to 6 
0767: set_zone 'CHC1B' popcycle_group_for_peds_and_cars_to 6 
0767: set_zone 'CHC2A' popcycle_group_for_peds_and_cars_to 6 
0767: set_zone 'CHC2B' popcycle_group_for_peds_and_cars_to 6 
0767: set_zone 'CHC3' popcycle_group_for_peds_and_cars_to 7 
0767: set_zone 'CHC4A' popcycle_group_for_peds_and_cars_to 7 
0767: set_zone 'CHC4B' popcycle_group_for_peds_and_cars_to 7 
0874: set_zone 'CHC1A' popcycle_group_for_peds_to 9 
0874: set_zone 'CHC1B' popcycle_group_for_peds_to 9 
0874: set_zone 'CHC2A' popcycle_group_for_peds_to 9 
0874: set_zone 'CHC2B' popcycle_group_for_peds_to 9 
0874: set_zone 'CHC3' popcycle_group_for_peds_to 9 
0874: set_zone 'CHC4A' popcycle_group_for_peds_to 9 
0874: set_zone 'CHC4B' popcycle_group_for_peds_to 9 
0767: set_zone 'CONF1A' popcycle_group_for_peds_and_cars_to 0 
0767: set_zone 'CONF1B' popcycle_group_for_peds_and_cars_to 0 
0767: set_zone 'THALL1' popcycle_group_for_peds_and_cars_to 0 
0767: set_zone 'LDOC1A' popcycle_group_for_peds_and_cars_to 11 
0767: set_zone 'LDOC1B' popcycle_group_for_peds_and_cars_to 11 
0767: set_zone 'LDOC2' popcycle_group_for_peds_and_cars_to 11 
0767: set_zone 'LDOC3A' popcycle_group_for_peds_and_cars_to 11 
0767: set_zone 'LDOC3B' popcycle_group_for_peds_and_cars_to 11 
0767: set_zone 'LDOC3C' popcycle_group_for_peds_and_cars_to 11 
0767: set_zone 'LDOC4' popcycle_group_for_peds_and_cars_to 11 
0767: set_zone 'LDT1A' popcycle_group_for_peds_and_cars_to 0 
0767: set_zone 'LDT1B' popcycle_group_for_peds_and_cars_to 0 
0767: set_zone 'LDT1C' popcycle_group_for_peds_and_cars_to 0 
0767: set_zone 'LDT3' popcycle_group_for_peds_and_cars_to 0 
0767: set_zone 'LDT4' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'LDT5' popcycle_group_for_peds_and_cars_to 0 
0767: set_zone 'LDT6' popcycle_group_for_peds_and_cars_to 0 
0767: set_zone 'LDT7' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'EBE1' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'EBE2A' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'EBE2B' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'EBE3C' popcycle_group_for_peds_and_cars_to 8 
0767: set_zone 'ELCO1' popcycle_group_for_peds_and_cars_to 6 
0767: set_zone 'ELCO2' popcycle_group_for_peds_and_cars_to 7 
0874: set_zone 'ELCO1' popcycle_group_for_peds_to 9 
0874: set_zone 'ELCO2' popcycle_group_for_peds_to 9 
0767: set_zone 'GAN1' popcycle_group_for_peds_and_cars_to 7 
0767: set_zone 'GAN2' popcycle_group_for_peds_and_cars_to 7 
0874: set_zone 'GAN1' popcycle_group_for_peds_to 1 
0874: set_zone 'GAN2' popcycle_group_for_peds_to 1 
0767: set_zone 'GLN1' popcycle_group_for_peds_and_cars_to 7 
0767: set_zone 'GLN2A' popcycle_group_for_peds_and_cars_to 7 
0767: set_zone 'LIND1A' popcycle_group_for_peds_and_cars_to 7 
0767: set_zone 'LIND1B' popcycle_group_for_peds_and_cars_to 11 
0767: set_zone 'LIND2A' popcycle_group_for_peds_and_cars_to 11 
0767: set_zone 'LIND2B' popcycle_group_for_peds_and_cars_to 11 
0767: set_zone 'LIND3' popcycle_group_for_peds_and_cars_to 11 
0767: set_zone 'IWD1' popcycle_group_for_peds_and_cars_to 7 
0767: set_zone 'IWD2' popcycle_group_for_peds_and_cars_to 7 
0767: set_zone 'IWD3A' popcycle_group_for_peds_and_cars_to 7 
0767: set_zone 'IWD3B' popcycle_group_for_peds_and_cars_to 7 
0767: set_zone 'IWD4' popcycle_group_for_peds_and_cars_to 7 
0767: set_zone 'IWD5' popcycle_group_for_peds_and_cars_to 7 
0874: set_zone 'IWD1' popcycle_group_for_peds_to 1 
0874: set_zone 'IWD2' popcycle_group_for_peds_to 1 
0874: set_zone 'IWD3A' popcycle_group_for_peds_to 1 
0874: set_zone 'IWD3B' popcycle_group_for_peds_to 1 
0874: set_zone 'IWD4' popcycle_group_for_peds_to 1 
0874: set_zone 'IWD5' popcycle_group_for_peds_to 1 
0767: set_zone 'JEF1A' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'JEF1B' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'JEF2' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'JEF3A' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'JEF3B' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'JEF3C' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'LFL1A' popcycle_group_for_peds_and_cars_to 7 
0767: set_zone 'LFL1B' popcycle_group_for_peds_and_cars_to 7 
0874: set_zone 'LFL1A' popcycle_group_for_peds_to 9 
0874: set_zone 'LFL1B' popcycle_group_for_peds_to 9 
0767: set_zone 'LMEX1A' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'LMEX1B' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'ELS1A' popcycle_group_for_peds_and_cars_to 7 
0767: set_zone 'ELS1B' popcycle_group_for_peds_and_cars_to 7 
0767: set_zone 'ELS2' popcycle_group_for_peds_and_cars_to 7 
0767: set_zone 'ELS3A' popcycle_group_for_peds_and_cars_to 7 
0767: set_zone 'ELS3B' popcycle_group_for_peds_and_cars_to 7 
0767: set_zone 'ELS4' popcycle_group_for_peds_and_cars_to 7 
0874: set_zone 'ELS1A' popcycle_group_for_peds_to 10 
0874: set_zone 'ELS1B' popcycle_group_for_peds_to 10 
0874: set_zone 'ELS2' popcycle_group_for_peds_to 10 
0874: set_zone 'ELS3A' popcycle_group_for_peds_to 10 
0874: set_zone 'ELS3B' popcycle_group_for_peds_to 10 
0874: set_zone 'ELS4' popcycle_group_for_peds_to 10 
0767: set_zone 'MAR1' popcycle_group_for_peds_and_cars_to 4 
0767: set_zone 'MAR2' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'MAR3' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'MKT1' popcycle_group_for_peds_and_cars_to 14 
0767: set_zone 'MKT2' popcycle_group_for_peds_and_cars_to 14 
0767: set_zone 'MKT3' popcycle_group_for_peds_and_cars_to 14 
0767: set_zone 'MKT4' popcycle_group_for_peds_and_cars_to 14 
0767: set_zone 'MUL1A' popcycle_group_for_peds_and_cars_to 15 
0767: set_zone 'MUL1B' popcycle_group_for_peds_and_cars_to 15 
0767: set_zone 'MUL1C' popcycle_group_for_peds_and_cars_to 15 
0767: set_zone 'MUL2A' popcycle_group_for_peds_and_cars_to 10 
0767: set_zone 'MUL2B' popcycle_group_for_peds_and_cars_to 10 
0767: set_zone 'MUL3' popcycle_group_for_peds_and_cars_to 10 
0767: set_zone 'MUL4' popcycle_group_for_peds_and_cars_to 15 
0767: set_zone 'MUL5A' popcycle_group_for_peds_and_cars_to 15 
0767: set_zone 'MUL5B' popcycle_group_for_peds_and_cars_to 15 
0767: set_zone 'MUL5C' popcycle_group_for_peds_and_cars_to 15 
0767: set_zone 'MUL6' popcycle_group_for_peds_and_cars_to 15 
0767: set_zone 'MUL7A' popcycle_group_for_peds_and_cars_to 15 
0767: set_zone 'MUL7B' popcycle_group_for_peds_and_cars_to 15 
0767: set_zone 'PLS' popcycle_group_for_peds_and_cars_to 8  // Playa del Seville
0767: set_zone 'RIH1A' popcycle_group_for_peds_and_cars_to 15 
0767: set_zone 'RIH1B' popcycle_group_for_peds_and_cars_to 15 
0767: set_zone 'RIH2' popcycle_group_for_peds_and_cars_to 15 
0767: set_zone 'RIH3A' popcycle_group_for_peds_and_cars_to 15 
0767: set_zone 'RIH3B' popcycle_group_for_peds_and_cars_to 15 
0767: set_zone 'RIH4' popcycle_group_for_peds_and_cars_to 4 
0767: set_zone 'RIH5A' popcycle_group_for_peds_and_cars_to 4 
0767: set_zone 'RIH6B' popcycle_group_for_peds_and_cars_to 4 
0767: set_zone 'RIH5A' popcycle_group_for_peds_and_cars_to 4 
0767: set_zone 'RIH6B' popcycle_group_for_peds_and_cars_to 4 
0767: set_zone 'ROD1A' popcycle_group_for_peds_and_cars_to 14 
0767: set_zone 'ROD1B' popcycle_group_for_peds_and_cars_to 14 
0767: set_zone 'ROD1C' popcycle_group_for_peds_and_cars_to 14 
0767: set_zone 'ROD2A' popcycle_group_for_peds_and_cars_to 14 
0767: set_zone 'ROD2B' popcycle_group_for_peds_and_cars_to 14 
0767: set_zone 'ROD3A' popcycle_group_for_peds_and_cars_to 14 
0767: set_zone 'ROD3B' popcycle_group_for_peds_and_cars_to 14 
0767: set_zone 'ROD4A' popcycle_group_for_peds_and_cars_to 14 
0767: set_zone 'ROD4B' popcycle_group_for_peds_and_cars_to 14 
0767: set_zone 'ROD4C' popcycle_group_for_peds_and_cars_to 14 
0767: set_zone 'ROD5A' popcycle_group_for_peds_and_cars_to 4 
0767: set_zone 'ROD5B' popcycle_group_for_peds_and_cars_to 4 
0767: set_zone 'SMB1' popcycle_group_for_peds_and_cars_to 8 
0767: set_zone 'SMB2' popcycle_group_for_peds_and_cars_to 8 
0767: set_zone 'VIN2' popcycle_group_for_peds_and_cars_to 2 
0767: set_zone 'VIN3' popcycle_group_for_peds_and_cars_to 2 
0767: set_zone 'VIN1A' popcycle_group_for_peds_and_cars_to 2 
0767: set_zone 'VIN1B' popcycle_group_for_peds_and_cars_to 2 
0767: set_zone 'VERO1' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'VERO2' popcycle_group_for_peds_and_cars_to 9 
0767: set_zone 'VERO3' popcycle_group_for_peds_and_cars_to 9 
0767: set_zone 'VERO4A' popcycle_group_for_peds_and_cars_to 8 
0767: set_zone 'VERO4B' popcycle_group_for_peds_and_cars_to 8 
0767: set_zone 'CRANB' popcycle_group_for_peds_and_cars_to 5  // Cranberry Station
0767: set_zone 'CALT' popcycle_group_for_peds_and_cars_to 5  // Calton Heights
0767: set_zone 'SUNMA' popcycle_group_for_peds_and_cars_to 4  // Bayside Marina
0767: set_zone 'SUNNN' popcycle_group_for_peds_and_cars_to 5  // Bayside
0767: set_zone 'BATTP' popcycle_group_for_peds_and_cars_to 2  // Battery Point
0767: set_zone 'ESPN1' popcycle_group_for_peds_and_cars_to 9 
0767: set_zone 'ESPN2' popcycle_group_for_peds_and_cars_to 9 
0767: set_zone 'ESPN3' popcycle_group_for_peds_and_cars_to 9 
0767: set_zone 'BAYV' popcycle_group_for_peds_and_cars_to 5  // Palisades
0767: set_zone 'PARA' popcycle_group_for_peds_and_cars_to 4  // Paradiso
0767: set_zone 'JUNIHO' popcycle_group_for_peds_and_cars_to 5  // Juniper Hollow
0767: set_zone 'JUNIHI' popcycle_group_for_peds_and_cars_to 5  // Juniper Hill
0767: set_zone 'CIVI' popcycle_group_for_peds_and_cars_to 5  // Santa Flora
0767: set_zone 'CHINA' popcycle_group_for_peds_and_cars_to 9  // Chinatown
0874: set_zone 'CHINA' popcycle_group_for_peds_to 6  // Chinatown
0767: set_zone 'SFDWT1' popcycle_group_for_peds_and_cars_to 0 
0767: set_zone 'SFDWT2' popcycle_group_for_peds_and_cars_to 0 
0767: set_zone 'SFDWT3' popcycle_group_for_peds_and_cars_to 0 
0767: set_zone 'SFDWT4' popcycle_group_for_peds_and_cars_to 9 
0767: set_zone 'SFDWT5' popcycle_group_for_peds_and_cars_to 9 
0767: set_zone 'SFDWT6' popcycle_group_for_peds_and_cars_to 9 
0767: set_zone 'FINA' popcycle_group_for_peds_and_cars_to 0  // Financial
0767: set_zone 'CITYS' popcycle_group_for_peds_and_cars_to 0  // City Hall
0767: set_zone 'WESTP1' popcycle_group_for_peds_and_cars_to 4 
0767: set_zone 'WESTP2' popcycle_group_for_peds_and_cars_to 4 
0767: set_zone 'WESTP3' popcycle_group_for_peds_and_cars_to 4 
0767: set_zone 'THEA1' popcycle_group_for_peds_and_cars_to 2 
0767: set_zone 'THEA2' popcycle_group_for_peds_and_cars_to 2 
0767: set_zone 'THEA3' popcycle_group_for_peds_and_cars_to 2 
0767: set_zone 'GARC' popcycle_group_for_peds_and_cars_to 7  // Garcia
0767: set_zone 'HASH' popcycle_group_for_peds_and_cars_to 6  // Hashbury
0767: set_zone 'OCEAF1' popcycle_group_for_peds_and_cars_to 8 
0767: set_zone 'OCEAF2' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'OCEAF3' popcycle_group_for_peds_and_cars_to 8 
0767: set_zone 'DOH1' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'DOH2' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'CUNTC1' popcycle_group_for_peds_and_cars_to 4 
0767: set_zone 'CUNTC2' popcycle_group_for_peds_and_cars_to 4 
0767: set_zone 'CUNTC3' popcycle_group_for_peds_and_cars_to 4 
0767: set_zone 'SFGLF1' popcycle_group_for_peds_and_cars_to 17 
0767: set_zone 'SFGLF2' popcycle_group_for_peds_and_cars_to 17 
0767: set_zone 'SFGLF3' popcycle_group_for_peds_and_cars_to 17 
0767: set_zone 'SFGLF4' popcycle_group_for_peds_and_cars_to 17 
0767: set_zone 'HILLP' popcycle_group_for_peds_and_cars_to 10  // Missionary Hill
0767: set_zone 'SILLY1' popcycle_group_for_peds_and_cars_to 0 
0767: set_zone 'SILLY2' popcycle_group_for_peds_and_cars_to 0 
0767: set_zone 'SILLY3' popcycle_group_for_peds_and_cars_to 0 
0767: set_zone 'SILLY4' popcycle_group_for_peds_and_cars_to 0 
0767: set_zone 'SFAIR1' popcycle_group_for_peds_and_cars_to 16 
0767: set_zone 'SFAIR2' popcycle_group_for_peds_and_cars_to 16 
0767: set_zone 'SFAIR3' popcycle_group_for_peds_and_cars_to 16 
0767: set_zone 'SFAIR4' popcycle_group_for_peds_and_cars_to 16 
0767: set_zone 'SFAIR5' popcycle_group_for_peds_and_cars_to 16 
0767: set_zone 'SFBAG1' popcycle_group_for_peds_and_cars_to 19 
0767: set_zone 'SFBAG2' popcycle_group_for_peds_and_cars_to 19 
0767: set_zone 'SFBAG3' popcycle_group_for_peds_and_cars_to 19 
0767: set_zone 'EASB1' popcycle_group_for_peds_and_cars_to 11 
0767: set_zone 'EASB2' popcycle_group_for_peds_and_cars_to 11 
0767: set_zone 'ESPE1' popcycle_group_for_peds_and_cars_to 9 
0767: set_zone 'ESPE2' popcycle_group_for_peds_and_cars_to 9 
0767: set_zone 'ESPE3' popcycle_group_for_peds_and_cars_to 9 
0767: set_zone 'LINDEN' popcycle_group_for_peds_and_cars_to 5  // Linden Station
0767: set_zone 'YELLOW' popcycle_group_for_peds_and_cars_to 4  // Yellow Bell Station
0767: set_zone 'BFC1' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'BFC2' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'RIE' popcycle_group_for_peds_and_cars_to 0  // Randolph Industrial Estate
0767: set_zone 'LDM' popcycle_group_for_peds_and_cars_to 6  // Last Dime Motel
0767: set_zone 'RSW1' popcycle_group_for_peds_and_cars_to 6 
0767: set_zone 'RSW2' popcycle_group_for_peds_and_cars_to 6 
0767: set_zone 'RSE' popcycle_group_for_peds_and_cars_to 6  // Rockshore East
0767: set_zone 'LDS' popcycle_group_for_peds_and_cars_to 11  // Linden Side
0767: set_zone 'SRY' popcycle_group_for_peds_and_cars_to 5  // Sobell Rail Yards
0767: set_zone 'JTS1' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'JTS2' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'LVA1' popcycle_group_for_peds_and_cars_to 11 
0767: set_zone 'LVA2' popcycle_group_for_peds_and_cars_to 18 
0767: set_zone 'LVA3' popcycle_group_for_peds_and_cars_to 11 
0767: set_zone 'LVA4' popcycle_group_for_peds_and_cars_to 11 
0767: set_zone 'VAIR1' popcycle_group_for_peds_and_cars_to 16 
0767: set_zone 'VAIR2' popcycle_group_for_peds_and_cars_to 16 
0767: set_zone 'VAIR3' popcycle_group_for_peds_and_cars_to 16 
0767: set_zone 'LVBAG' popcycle_group_for_peds_and_cars_to 19 
0767: set_zone 'GGC1' popcycle_group_for_peds_and_cars_to 10 
0767: set_zone 'GGC2' popcycle_group_for_peds_and_cars_to 2 
0767: set_zone 'BFLD1' popcycle_group_for_peds_and_cars_to 10 
0767: set_zone 'BFLD2' popcycle_group_for_peds_and_cars_to 2 
0767: set_zone 'WWE' popcycle_group_for_peds_and_cars_to 5  // Whitewood Estates
0767: set_zone 'WWE1' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'PINT' popcycle_group_for_peds_and_cars_to 5  // Pilson Intersection
0767: set_zone 'YBELL2' popcycle_group_for_peds_and_cars_to 4 
0767: set_zone 'YBELL1' popcycle_group_for_peds_and_cars_to 17 
0767: set_zone 'JTW1' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'JTW2' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'JTN1' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'JTN2' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'JTN3' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'JTN4' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'JTN5' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'JTN6' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'JTN7' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'JTN8' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'JTE1' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'JTE2' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'JTE3' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'JTE4' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'HGP' popcycle_group_for_peds_and_cars_to 4  // Harry Gold Parkway
0767: set_zone 'SPIN' popcycle_group_for_peds_and_cars_to 11  // Spinybed
0767: set_zone 'BINT1' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'BINT2' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'BINT3' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'BINT4' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'PRP1' popcycle_group_for_peds_and_cars_to 4 
0767: set_zone 'PRP2' popcycle_group_for_peds_and_cars_to 4 
0767: set_zone 'PRP3' popcycle_group_for_peds_and_cars_to 4 
0767: set_zone 'PRP4' popcycle_group_for_peds_and_cars_to 4 
0767: set_zone 'REDE1' popcycle_group_for_peds_and_cars_to 0 
0767: set_zone 'REDE2' popcycle_group_for_peds_and_cars_to 0 
0767: set_zone 'REDE3' popcycle_group_for_peds_and_cars_to 2 
0767: set_zone 'REDW1' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'REDW2' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'REDW3' popcycle_group_for_peds_and_cars_to 11 
0767: set_zone 'REDW4' popcycle_group_for_peds_and_cars_to 5 
0767: set_zone 'ROCE1' popcycle_group_for_peds_and_cars_to 0 
0767: set_zone 'ROCE2' popcycle_group_for_peds_and_cars_to 0 
0767: set_zone 'OVS' popcycle_group_for_peds_and_cars_to 12  // Old Venturas Strip
0767: set_zone 'CREE' popcycle_group_for_peds_and_cars_to 9  // Creek
0767: set_zone 'STRIP1' popcycle_group_for_peds_and_cars_to 12 
0767: set_zone 'STRIP2' popcycle_group_for_peds_and_cars_to 12  // Strip Club
0767: set_zone 'STRIP3' popcycle_group_for_peds_and_cars_to 12 
0767: set_zone 'STRIP4' popcycle_group_for_peds_and_cars_to 12 
0767: set_zone 'PILL1' popcycle_group_for_peds_and_cars_to 9 
0767: set_zone 'PILL2' popcycle_group_for_peds_and_cars_to 9 
0767: set_zone 'RING' popcycle_group_for_peds_and_cars_to 12  // The Clown's Pocket
0767: set_zone 'ISLE' popcycle_group_for_peds_and_cars_to 12  // The Emerald Isle
0767: set_zone 'STAR1' popcycle_group_for_peds_and_cars_to 12 
0767: set_zone 'STAR2' popcycle_group_for_peds_and_cars_to 12 
0767: set_zone 'ROY' popcycle_group_for_peds_and_cars_to 12  // Royal Casino
0767: set_zone 'CAM' popcycle_group_for_peds_and_cars_to 12  // The Camel's Toe
0767: set_zone 'LOT' popcycle_group_for_peds_and_cars_to 12  // Come-A-Lot
0767: set_zone 'PIRA' popcycle_group_for_peds_and_cars_to 12  // Pirates in Men's Pants
0767: set_zone 'VISA1' popcycle_group_for_peds_and_cars_to 12 
0767: set_zone 'VISA2' popcycle_group_for_peds_and_cars_to 12 
0767: set_zone 'CALI1' popcycle_group_for_peds_and_cars_to 12 
0767: set_zone 'CALI2' popcycle_group_for_peds_and_cars_to 12 
0767: set_zone 'DRAG' popcycle_group_for_peds_and_cars_to 12  // The Four Dragons Casino
0767: set_zone 'PINK' popcycle_group_for_peds_and_cars_to 12  // The Pink Swan
0767: set_zone 'HIGH' popcycle_group_for_peds_and_cars_to 12  // The High Roller
0767: set_zone 'CONST1' popcycle_group_for_peds_and_cars_to 18 
0767: set_zone 'ANGPI' popcycle_group_for_peds_and_cars_to 3  // Angel Pine
0767: set_zone 'SHACA' popcycle_group_for_peds_and_cars_to 3  // Shady Cabin
0767: set_zone 'BACKO' popcycle_group_for_peds_and_cars_to 3  // Back o Beyond
0767: set_zone 'BEACO' popcycle_group_for_peds_and_cars_to 3  // Beacon Hill
0767: set_zone 'FARM' popcycle_group_for_peds_and_cars_to 3  // The Farm
0767: set_zone 'PALO' popcycle_group_for_peds_and_cars_to 3  // Palomino Creek
0767: set_zone 'MONT' popcycle_group_for_peds_and_cars_to 3  // Montgomery
0767: set_zone 'MONT1' popcycle_group_for_peds_and_cars_to 3  // Montgomery
0767: set_zone 'MTCHI1' popcycle_group_for_peds_and_cars_to 3 
0767: set_zone 'MTCHI2' popcycle_group_for_peds_and_cars_to 3 
0767: set_zone 'MTCHI3' popcycle_group_for_peds_and_cars_to 3 
0767: set_zone 'MTCHI4' popcycle_group_for_peds_and_cars_to 3 
0767: set_zone 'HBARNS' popcycle_group_for_peds_and_cars_to 3  // Hampton Barns
0767: set_zone 'DILLI' popcycle_group_for_peds_and_cars_to 3  // Dillimore
0767: set_zone 'TOPFA' popcycle_group_for_peds_and_cars_to 3  // Hilltop Farm
0767: set_zone 'BLUEB' popcycle_group_for_peds_and_cars_to 3  // Blueberry
0767: set_zone 'BLUEB1' popcycle_group_for_peds_and_cars_to 3 
0767: set_zone 'PANOP' popcycle_group_for_peds_and_cars_to 3  // The Panopticon
0767: set_zone 'BLUAC' popcycle_group_for_peds_and_cars_to 3  // Blueberry Acres
0767: set_zone 'CREEK' popcycle_group_for_peds_and_cars_to 3  // Shady Creeks
0767: set_zone 'CREEK1' popcycle_group_for_peds_and_cars_to 3 
0767: set_zone 'MAKO' popcycle_group_for_peds_and_cars_to 3  // The Mako Span
0767: set_zone 'TOPFA' popcycle_group_for_peds_and_cars_to 3  // Hilltop Farm
0767: set_zone 'FERN' popcycle_group_for_peds_and_cars_to 3  // Fern Ridge
0767: set_zone 'NROCK' popcycle_group_for_peds_and_cars_to 3  // North Rock
0767: set_zone 'HANKY' popcycle_group_for_peds_and_cars_to 3  // Hankypanky Point
0767: set_zone 'LEAFY' popcycle_group_for_peds_and_cars_to 3  // Leafy Hollow
0767: set_zone 'RED' popcycle_group_for_peds_and_cars_to 3  // Red County
0767: set_zone 'FLINTC' popcycle_group_for_peds_and_cars_to 3  // Flint County
0767: set_zone 'WHET' popcycle_group_for_peds_and_cars_to 3  // Whetstone
0767: set_zone 'BIGE' popcycle_group_for_peds_and_cars_to 1  // 'The Big Ear'
0767: set_zone 'ELQUE' popcycle_group_for_peds_and_cars_to 1  // El Quebrados
0767: set_zone 'BARRA' popcycle_group_for_peds_and_cars_to 1  // Las Barrancas
0767: set_zone 'CARSO' popcycle_group_for_peds_and_cars_to 1  // Fort Carson
0767: set_zone 'PAYAS' popcycle_group_for_peds_and_cars_to 1  // Las Payasadas
0767: set_zone 'PROBE' popcycle_group_for_peds_and_cars_to 1  // Lil' Probe Inn
0767: set_zone 'ELCA' popcycle_group_for_peds_and_cars_to 1  // El Castillo del Diablo
0767: set_zone 'FLINTR' popcycle_group_for_peds_and_cars_to 1  // Flint Range
0767: set_zone 'ARCO' popcycle_group_for_peds_and_cars_to 1  // Arco del Oeste
0767: set_zone 'VALLE' popcycle_group_for_peds_and_cars_to 1  // Valle Ocultado
0767: set_zone 'FLINTI' popcycle_group_for_peds_and_cars_to 1  // Flint Intersection
0767: set_zone 'MONINT' popcycle_group_for_peds_and_cars_to 1  // Montgomery Intersection
0767: set_zone 'ROBINT' popcycle_group_for_peds_and_cars_to 1  // Robada Intersection
0767: set_zone 'TOM' popcycle_group_for_peds_and_cars_to 1  // Regular Tom
0767: set_zone 'ALDEA' popcycle_group_for_peds_and_cars_to 1  // Aldea Malvada
0767: set_zone 'BRUJA' popcycle_group_for_peds_and_cars_to 1  // Las Brujas
0767: set_zone 'ROBAD' popcycle_group_for_peds_and_cars_to 1  // Tierra Robada
0767: set_zone 'BONE' popcycle_group_for_peds_and_cars_to 1  // Bone County
0767: set_zone 'HAUL' popcycle_group_for_peds_and_cars_to 18  // Fallen Tree
0767: set_zone 'QUARY' popcycle_group_for_peds_and_cars_to 18  // Hunter Quarry
0767: set_zone 'OCTAN' popcycle_group_for_peds_and_cars_to 18  // Octane Springs
0767: set_zone 'PALMS' popcycle_group_for_peds_and_cars_to 18  // Green Palms
0767: set_zone 'EBAY' popcycle_group_for_peds_and_cars_to 18  // Easter Bay Chemicals
0767: set_zone 'EBAY2' popcycle_group_for_peds_and_cars_to 18 
0767: set_zone 'DAM' popcycle_group_for_peds_and_cars_to 18  // The Sherman Dam


//===============================
// WEAPONMODEL mapping
//===============================
var
 $myindex :Integer
end
$DYOM_Weapon_model[0] = 7   // dummy
$DYOM_Weapon_model[1] = #BRASSKNUCKLE
$DYOM_Weapon_model[2] = #GOLFCLUB
$DYOM_Weapon_model[3] = #NITESTICK
$DYOM_Weapon_model[4] = #KNIFECUR
$DYOM_Weapon_model[5] = #BAT
$DYOM_Weapon_model[6] = #SHOVEL
$DYOM_Weapon_model[7] = #POOLCUE
$DYOM_Weapon_model[8] = #KATANA
$DYOM_Weapon_model[9] = #CHNSAW
$DYOM_Weapon_model[10] = #GUN_DILDO1
$DYOM_Weapon_model[11] = #GUN_DILDO2
$DYOM_Weapon_model[12] = #GUN_VIBE1
$DYOM_Weapon_model[13] = #GUN_VIBE2
$DYOM_Weapon_model[14] = #FLOWERA
$DYOM_Weapon_model[15] = #GUN_CANE
$DYOM_Weapon_model[16] = #GRENADE
$DYOM_Weapon_model[17] = #TEARGAS
$DYOM_Weapon_model[18] = #MOLOTOV
$DYOM_Weapon_model[19] = 7   // dummy
$DYOM_Weapon_model[20] = 7   // dummy
$DYOM_Weapon_model[21] = 7   // dummy
$DYOM_Weapon_model[22] = #COLT45
$DYOM_Weapon_model[23] = #SILENCED
$DYOM_Weapon_model[24] = #DESERT_EAGLE
$DYOM_Weapon_model[25] = #CHROMEGUN
$DYOM_Weapon_model[26] = #SAWNOFF
$DYOM_Weapon_model[27] = #SHOTGSPA
$DYOM_Weapon_model[28] = #MICRO_UZI
$DYOM_Weapon_model[29] = #MP5LNG
$DYOM_Weapon_model[30] = #AK47
$DYOM_Weapon_model[31] = #M4
$DYOM_Weapon_model[32] = #TEC9
$DYOM_Weapon_model[33] = #CUNTGUN
$DYOM_Weapon_model[34] = #SNIPER
$DYOM_Weapon_model[35] = #ROCKETLA
$DYOM_Weapon_model[36] = #HEATSEEK
$DYOM_Weapon_model[37] = #FLAME
$DYOM_Weapon_model[38] = #MINIGUN
$DYOM_Weapon_model[39] = #SATCHEL
$DYOM_Weapon_model[40] = #BOMB
$DYOM_Weapon_model[41] = #SPRAYCAN
$DYOM_Weapon_model[42] = #FIRE_EX
$DYOM_Weapon_model[43] = #CAMERA
$DYOM_Weapon_model[44] = #NVGOGGLES
$DYOM_Weapon_model[45] = #IRGOGGLES
$DYOM_Weapon_model[46] = #GUN_PARA
$DYOM_Weapon_model[47] = #JETPACK
$DYOM_Weapon_model[48] = 7 //dummy


//===============================
// Initial model selection 
//===============================
$actor_model = 0          // Initial actor model in model selection
$weapon_model = 0           // Initial weapon model in model selection
$weapon_ammo = 9999        // Initial weapon model in model selection
$car_model = 400            // Initial car model in model selection
$car_color = 0              // Initial car color in model selection
$car_color2 = 0              // Initial car color in model selection
$pickup_model = #KEYCARD    // Initial pickup model in model selection
$pickup_id = 1              // MUST match $pickup_model
$marker_size = 2.0          // Initial size in marker_size selection   
$trigger_icon = 23
$anim_id     = -1
$anim_dist   = 5.0
$object_model = -17
$interior_number = 0
$interior_selected = 0
$weather_choice = 0
$wanted_choice = 0
$wantedmax_choice = 6
$wantedmin_choice = 0
$daytime_choice = 8
$ped_choice = 0

//===============================
// GANG relations
//===============================
// ENEMY    24  Attacks on sight : Player and FRIENDS, ENEMY2
// FRIENDS  25  Attacks on sight : ENEMY, ENEMY2
// ENEMY2   26  Attacks on sight : Player and FRIENDS, ENEMY
// NEUTRAL  4
// PLAYER   0
0746: set_default_action 4 for_actors_pedtype DYOM_gang_enemy to_actors_pedtype 0 
0746: set_default_action 4 for_actors_pedtype DYOM_gang_enemy to_actors_pedtype DYOM_gang_friend 
0746: set_default_action 4 for_actors_pedtype DYOM_gang_enemy to_actors_pedtype DYOM_gang_enemy2 
0746: set_default_action 1 for_actors_pedtype DYOM_gang_enemy to_actors_pedtype DYOM_gang_neutral 
0746: set_default_action 1 for_actors_pedtype DYOM_gang_friend to_actors_pedtype 0 
0746: set_default_action 4 for_actors_pedtype DYOM_gang_friend to_actors_pedtype DYOM_gang_enemy 
0746: set_default_action 4 for_actors_pedtype DYOM_gang_friend to_actors_pedtype DYOM_gang_enemy2 
0746: set_default_action 1 for_actors_pedtype DYOM_gang_friend to_actors_pedtype DYOM_gang_neutral 
0746: set_default_action 4 for_actors_pedtype DYOM_gang_enemy2 to_actors_pedtype 0 
0746: set_default_action 4 for_actors_pedtype DYOM_gang_enemy2 to_actors_pedtype DYOM_gang_friend 
0746: set_default_action 4 for_actors_pedtype DYOM_gang_enemy2 to_actors_pedtype DYOM_gang_enemy 
0746: set_default_action 1 for_actors_pedtype DYOM_gang_enemy2 to_actors_pedtype DYOM_gang_neutral 
0746: set_default_action 1 for_actors_pedtype DYOM_gang_neutral to_actors_pedtype 0 
0746: set_default_action 1 for_actors_pedtype DYOM_gang_neutral to_actors_pedtype DYOM_gang_enemy 
0746: set_default_action 1 for_actors_pedtype DYOM_gang_neutral to_actors_pedtype DYOM_gang_enemy2 
0746: set_default_action 1 for_actors_pedtype DYOM_gang_neutral to_actors_pedtype DYOM_gang_friend 
0746: set_default_action 1 for_actors_pedtype 7 to_actors_pedtype 0 
0746: set_default_action 1 for_actors_pedtype 8 to_actors_pedtype 0 
0746: set_default_action 1 for_actors_pedtype 9 to_actors_pedtype 0 

//===============================
// MISSION data Initialisation
//===============================
$DYOM_objective_count = 0
$DYOM_actor_count     = 0
$DYOM_car_count       = 0
$DYOM_pickup_count    = 0 
$DYOM_object_count    = 0 
$DYOM_trigger_count   = 1  // trigger entry 0 is not used :)

$DYOM_timelimit       = 0  
$DYOM_timeofday       = 8
$DYOM_weather         = 0
$DYOM_minwantedlevel  = 0
$DYOM_maxwantedlevel  = 6
$DYOM_properties      = 0

04C4: store_coords_to $DYOM_player_location_x $DYOM_player_location_y $DYOM_player_location_z from_actor $PLAYER_ACTOR with_offset 0.0 0.0 -1.0 
0172: $DYOM_player_location_a = actor $PLAYER_ACTOR Z_angle 
077E: get_active_interior_to $DYOM_player_interior


$DYOM_player_model      = 0
$DYOM_player_weapon     = 0
$DYOM_player_ammo       = 0
$DYOM_player_health     = 100

$DYOM_selected_obj = 0
$DYOM_selected_slot = 0
// inits for parachute
$1499 = 0 
$1500 = 5.0 
$1501 = -5.0 
$1502 = 8.5 
$1503 = -1.5 
$1504 = -30.0 
$1505 = 32.0 
$1506 = 0.0 
$1510 = 1 
$1512 = 0 
$FREEFALL_STAGE = 0 
$PARACHUTE_CREATION_STAGE = 0 
$1515 = 0 


// Clear the points array.
$myindex = 0
while $myindex < 400
  $myindex2 = 0
  while $myindex2 < 40
    $DYOM_POINT_LINK[$myindex] = 0
    $myindex += 1
    $myindex2 += 1
  end
  wait 0  
end 
$empty_point = 399

// Clear the trigger markerhandles
$myindex = 0
while $myindex < 25
    $DYOM_trigger_mhandle[$cur_mission] = 0
    $myindex += 1
end 

// Clear objective handles
$myindex = 0
while DYOM_objective_max > $myindex
    $DYOM_objective_handle[$myindex] = -1
    $myindex += 1
end



 
$TEXTCUR = $TEXTDYOM
$TEXTTARGET = $TEXTNAME
gosub @TEXT_copy

$TEXTCUR = $TEXTDYOM
$TEXTTARGET = $TEXTAUTHOR
gosub @TEXT_copy

// Clear Intro Texts
$TEXTCUR = $TEXTINTRO
gosub @TEXT_clear
$TEXTCUR += 100
gosub @TEXT_clear
$TEXTCUR += 100
gosub @TEXT_clear

gosub @LOAD_STORYLINE
v$filename = "DSL/_autorun"
gosub @GET_NAMED_FILE
if and
  $LOAD_RESULT == 1
  $INITIAL_STARTUP == 1
then
  // Autostart Storyline
  016A: fade 0 time 0 
  $DYOM_IN_STORY = 1
  $DYOM_AUTORUN = 1
  create_thread @STORYLINE_THREAD 
else
  016A: fade 1 time 0 
end
$INITIAL_STARTUP = 0


$INITDONE = 1
end_thread




//=====================================
//-------------------------------------
//-------------Mission 1---------------
//-------------------------------------
//=====================================
// Mission wrapper
:DYOM_MISSION
thread 'DYOM' 
gosub @DYOM_MISSION_MAIN 
if wasted_or_busted 
then 
  gosub @DYOM_MISSION_FAIL 
end
gosub @DYOM_MISSION_CLEANUP 
end_thread 

//-------------------------------------
:DYOM_MISSION_MAIN
var
$DYOM_current_weapon : Integer
$DYOM_objective_ready : Integer
$DYOM_idx : Integer
$lastmarker : Integer
$mission_timer  : Integer
$OBJTEXT : Integer
$DYOM_mission_car :integer
$DYOM_player_anim :integer
$DYOM_player_anim_dist :integer
$timed_mission: Integer
1@:Float
2@:Float
$ML_actors   : array 100 of Integer 
$ML_cars     : array 50 of Integer  
$ML_actor_count :integer
$ML_car_count :integer
$bar_health :integer
$bar_value :integer
$bar_full :integer
$bar_act :integer
$CS_ABORTED :integer
$CAM_target_ACTOR :integer
end

// Set gang relations
0746: set_default_action 4 for_actors_pedtype DYOM_gang_enemy to_actors_pedtype 0 
0746: set_default_action 4 for_actors_pedtype DYOM_gang_enemy to_actors_pedtype DYOM_gang_friend 
0746: set_default_action 4 for_actors_pedtype DYOM_gang_enemy to_actors_pedtype DYOM_gang_enemy2 
0746: set_default_action 1 for_actors_pedtype DYOM_gang_enemy to_actors_pedtype DYOM_gang_neutral 
0746: set_default_action 1 for_actors_pedtype DYOM_gang_friend to_actors_pedtype 0 
0746: set_default_action 4 for_actors_pedtype DYOM_gang_friend to_actors_pedtype DYOM_gang_enemy 
0746: set_default_action 4 for_actors_pedtype DYOM_gang_friend to_actors_pedtype DYOM_gang_enemy2 
0746: set_default_action 1 for_actors_pedtype DYOM_gang_friend to_actors_pedtype DYOM_gang_neutral 
0746: set_default_action 4 for_actors_pedtype DYOM_gang_enemy2 to_actors_pedtype 0 
0746: set_default_action 4 for_actors_pedtype DYOM_gang_enemy2 to_actors_pedtype DYOM_gang_friend 
0746: set_default_action 4 for_actors_pedtype DYOM_gang_enemy2 to_actors_pedtype DYOM_gang_enemy 
0746: set_default_action 1 for_actors_pedtype DYOM_gang_enemy2 to_actors_pedtype DYOM_gang_neutral 
0746: set_default_action 1 for_actors_pedtype DYOM_gang_neutral to_actors_pedtype 0 
0746: set_default_action 1 for_actors_pedtype DYOM_gang_neutral to_actors_pedtype DYOM_gang_enemy 
0746: set_default_action 1 for_actors_pedtype DYOM_gang_neutral to_actors_pedtype DYOM_gang_enemy2 
0746: set_default_action 1 for_actors_pedtype DYOM_gang_neutral to_actors_pedtype DYOM_gang_friend 
0746: set_default_action 1 for_actors_pedtype 7 to_actors_pedtype 0 
0746: set_default_action 1 for_actors_pedtype 8 to_actors_pedtype 0 
0746: set_default_action 1 for_actors_pedtype 9 to_actors_pedtype 0 

//--------------------
// Mission Settings
//--------------------
04E4: unknown_refresh_game_renderer_at $DYOM_player_location_x $DYOM_player_location_y
03CB: set_rendering_origin_at $DYOM_player_location_x $DYOM_player_location_y $DYOM_player_location_z 
00C0: set_current_time_hours_to $DYOM_timeofday minutes_to 0 
01B6: set_weather $DYOM_weather 
01F0: set_max_wanted_level_to $DYOM_maxwantedlevel   
010E: set_player $PLAYER_CHAR minimum_wanted_level_to $DYOM_minwantedlevel 
010D: set_player $PLAYER_CHAR wanted_level_to $DYOM_minwantedlevel 

if 08B4:   test $DYOM_properties bit DYOM_propbit_riot 
then
    06C8: enable_riot 1 
else
    06C8: enable_riot 0 
end    
01EB: set_traffic_density_multiplier_to 1.0 
03DE: set_pedestrians_density_multiplier_to 1.0 
 
$ML_actor_count = 0
$ML_car_count = 0
$bar_act = 0
$CS_ABORTED = 0

wait 1500

if $PARTIAL_PLAY == 0
then
    //--------------------
    // SPAWN PLAYER 
    //--------------------
    048F: actor $PLAYER_ACTOR remove_weapons 
    0980: extinguish_all_fires_at $DYOM_player_location_x $DYOM_player_location_y $DYOM_player_location_z radius 1.0    
    
    //$actor_model_req -> $actor_model_loaded
    $actor_model_loaded = -1
    $actor_model_req = $DYOM_player_model
    repeat
      wait 20
    until not $actor_model_loaded == -1
    
    $DYOM_current_weapon = $DYOM_player_weapon  
    if $DYOM_current_weapon == 48
    then
      0209: $DYOM_current_weapon = random_int_in_ranges 1 43 
      if $DYOM_current_weapon > 18
      then
        $DYOM_current_weapon += 3 
      end
    end

    model.Load($DYOM_Weapon_model[$DYOM_current_weapon])                                                                                                              
    038B: load_requested_models                                                                                                                                  
    repeat
    wait 0 ms                                                                     
    until model.Available($DYOM_Weapon_model[$DYOM_current_weapon])                                                          
    Player.CanMove($PLAYER_CHAR) = False
    
    09C7: set_player $PLAYER_CHAR modelID_to $actor_model_loaded
    09BC: put_actor $PLAYER_ACTOR at $DYOM_player_location_x $DYOM_player_location_y $DYOM_player_location_z 
    04C4: store_coords_to $TEMPVAR_FLOAT_4 $TEMPVAR_FLOAT_5 $TEMPVAR_FLOAT_6 from_actor $PLAYER_ACTOR with_offset 0.0 0.0 1.0 
    09BC: put_actor $PLAYER_ACTOR at $TEMPVAR_FLOAT_4 $TEMPVAR_FLOAT_5 $TEMPVAR_FLOAT_6 
    //0575: set_actor $PLAYER_ACTOR pinned_position 1 
    0173: set_actor $PLAYER_ACTOR Z_angle_to $DYOM_player_location_a 
    01B2: give_actor  $PLAYER_ACTOR weapon $DYOM_current_weapon ammo $DYOM_player_ammo 
    0653: 1@ = float_stat 24 
    0092: 2@ = float 1@ to_integer 
     
    if $DYOM_player_health > 100
    then
      062A: change_float_stat 24 to 1138.0
      055E: set_player $PLAYER_CHAR max_health += 100
    else
      062A: change_float_stat 24 to 569.0
    end 
    //08AF: set_actor $PLAYER_ACTOR max_health_to $DYOM_player_health 
    0223: set_actor $PLAYER_ACTOR health_to $DYOM_player_health
    
    
    select_interior $DYOM_player_interior
    0860: link_actor $PLAYER_ACTOR to_interior $DYOM_player_interior 
    if $DYOM_player_interior == 0
    then
      //0581: enable_radar 1
      //057E: set_radar_grey 0
    else
      //0581: enable_radar 0
      //057E: set_radar_grey 1
    end

    0373: set_camera_directly_behind_player 
    
    $mission_timer = $DYOM_timelimit
    33@ = 0
    $limit_on = 0
    $timed_mission = 0
    if 0018: $mission_timer > 0
    then
      $limit_on = 1
      03C3: set_timer_to $mission_timer type 1 GXT 'RTIME' // global_variable  // Time
      0890: enable_sound_when_timer $253 reach 3 seconds // global_variable 
      0396: pause_timer 0 
    else
      if 08B4:   test $DYOM_properties bit DYOM_propbit_timed 
      then
        $timed_mission = 1
        008a: $mission_clock = 33@
        03C3: set_timer_to $mission_clock type 0 GXT 'BB_19' // global_variable  // Time
        0396: pause_timer 0 
      end
    end
    
    004F: create_thread @INTRO_THREAD 
    
    Player.CanMove($PLAYER_CHAR) = TRUE
    
    if $actor_model_loaded == #SPECIAL01
    then
        0296: unload_special_actor 1 
    else
        0249: release_model $actor_model_loaded
    end
    model.Destroy($DYOM_Weapon_model[$DYOM_player_weapon]) 
    
    
    $DYOM_current_objective = 0
    $OBJTEXT = $TEXTOBJECTIVES
else
    // Partial play
    33@ = 0
    $limit_on = 0
    $timed_mission = 0
    $DYOM_current_objective = $DYOM_selected_obj
    $DYOM_current_objective += -1
    $OBJTEXT = $DYOM_current_objective 
    $OBJTEXT  *= 100
    $OBJTEXT += $TEXTOBJECTIVES
end

$DYOM_faded = 1
$DYOM_in_cutscene = 0
$DYOM_player_anim = -1
$DYOM_player_anim_dist = 0
$DYOM_on_phone    = 0
$DYOM_mission_car = -1
$DYOM_objective_ready = 0
$CAM_target_ACTOR = -1
//++++++++++++++++++++++++++++++
// MAIN objective LOOP
//++++++++++++++++++++++++++++++
gosub @AMB_GO
$hMP3 == -1
WHILE NOT $DYOM_current_objective == $DYOM_objective_count
  gosub @SOUND_GO
  
  IF AND 
      NOT $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_cutscene 
      NOT $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_animation 
  THEN
    $CS_ABORTED = 0  
  END  
  
  // ====================== end of cutscene sequence =====================
  if and
    $DYOM_in_cutscene == 1 
    NOT $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_cutscene 
    NOT $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_animation 
  then                 
    if NOT $DYOM_faded == 1
    then
      016A: fade 0 time 500 
      wait 600 ms
      $DYOM_faded = 1
    end
    $DYOM_in_cutscene = 0
    02A3: enable_widescreen 0 
    select_interior 21@
    0860: link_actor $PLAYER_ACTOR to_interior 21@
    if 21@ == 0
    then
      //0581: enable_radar 1
      //057E: set_radar_grey 0
    else
      //0581: enable_radar 0
      //057E: set_radar_grey 1
    end
    
    player.CanMove($PLAYER_CHAR,true)
    
    // make sure player has vehicle control after a player driving animation
    if 00DF:   actor $PLAYER_ACTOR driving
    then
       00D9: 68@ = actor $PLAYER_ACTOR car // add to mission cleanup
       046C: 72@ = car 68@ driver
       if 07d6: 72@ == $PLAYER_ACTOR
       then
           02E3: 73@ = car 68@ speed
           00A0: store_actor $PLAYER_ACTOR position_to 69@ 70@ 71@
           0362: remove_actor $PLAYER_ACTOR from_car_and_place_at 69@ 70@ 71@
           0687: clear_actor $PLAYER_ACTOR task
           036A: put_actor $PLAYER_ACTOR in_car 68@
           04BA: set_car 68@ speed_to 73@
       end
    else
       0687: clear_actor $PLAYER_ACTOR task
    end
       
    015D: set_gamespeed 1.0
    099C: set_cam_shake 1 time 0.0 intensity 0.0

    // end any existing non-static cameramode
    0925: restore_camera_to_user_defined 
    Camera.Restore
    092F: lock_camera_target_point 0 
    0930: lock_camera_position 0 
    0373: set_camera_directly_behind_player 
    Camera.Restore_WithJumpCut
    if 056D:   actor $camman defined 
    then
      Actor.DestroyInstantly($camman)
    end
  end 
   
  // ====================== start of cutscene sequence =====================
  if AND
     $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_cutscene 
     NOT $DYOM_in_cutscene == 1 
  then
    player.CanMove($PLAYER_CHAR,false)
    if 88B4: NOT  test $DYOM_objective_properties[$DYOM_current_objective] bit DYOM_cutscene_skip_fade 
    then
       016A: fade 0 time 500 
       wait 600 ms
    end
    077E: get_active_interior_to 21@

    $DYOM_faded = 1
    $DYOM_in_cutscene = 1
    if 08B4: test $DYOM_objective_properties[$DYOM_current_objective] bit DYOM_cutscene_skip_wide 
    then
      02A3: enable_widescreen 0 
    else
      02A3: enable_widescreen 1 
    end
  end  
  
  // ====================== cutscene player animations =====================
  if AND
      $DYOM_in_cutscene == 1
      NOT $DYOM_player_anim == -1
  then
    repeat
        wait 0
    until $anim_req == -1
    0084: $anim_distance = $DYOM_player_anim_dist
    0084: $anim_actor = $PLAYER_ACTOR
    $anim_gang = DYOM_gang_friend
    0084: $anim_req = $DYOM_player_anim
    $DYOM_player_anim = -1
  end

  // ====================== fade for teleports =====================
  if or
    $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_teleport 
    $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_telecar 
  then
    016A: fade 0 time 500 
    player.CanMove($PLAYER_CHAR,false)
    $DYOM_faded = 0         // DO NOT Fade back after the items have been spawned :)
    wait 600 ms
  end  
  
  // ====================== load/unload phone=====================
  if and 
     $DYOM_on_phone == 1
     NOT $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_phone
  then
      0729: AS_actor $PLAYER_ACTOR hold_cellphone 0 
      Model.Destroy(#CELLPHONE)
      $DYOM_on_phone = 0 
  end   
  if and 
     $DYOM_on_phone == 0
     $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_phone
  then
      Model.Load(#CELLPHONE)

      while not Model.Available(#CELLPHONE)
        wait 0 
      end 

      0729: AS_actor $PLAYER_ACTOR hold_cellphone 1 
      $DYOM_on_phone = 1 
      wait 2000 ms
  end   

  // ====================== mute non-CJ player=====================
  0665: get_actor $PLAYER_ACTOR modelID_to $plmodel
  if $plmodel > 0
  then
    0489: set_actor $PLAYER_ACTOR muted 1
  else
    0489: set_actor $PLAYER_ACTOR muted 0
  end


  //======================
  // SPAWN CAR OBJECTIVE  (to enable actors to use it) 
  //======================
  IF or
    $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_car 
    $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_telecar 
  THEN
    // setup objective
    0980: extinguish_all_fires_at $DYOM_objective_location_x[$DYOM_current_objective] $DYOM_objective_location_y[$DYOM_current_objective] $DYOM_objective_location_z[$DYOM_current_objective] radius 1.0 

    model.Load($DYOM_objective_model[$DYOM_current_objective]) 
    038B: load_requested_models                                                   
                                                                               
    REPEAT
      wait 0 ms                                                                     
    UNTIL model.Available($DYOM_objective_model[$DYOM_current_objective])                                                          

    00A5: $DYOM_objective_handle[$DYOM_current_objective] = create_car $DYOM_objective_model[$DYOM_current_objective] at $DYOM_objective_location_x[$DYOM_current_objective] $DYOM_objective_location_y[$DYOM_current_objective] $DYOM_objective_location_z[$DYOM_current_objective] 
    0175: set_car $DYOM_objective_handle[$DYOM_current_objective] Z_angle_to $DYOM_objective_location_a[$DYOM_current_objective]  
    0229: set_car $DYOM_objective_handle[$DYOM_current_objective] primary_color_to $DYOM_objective_data[$DYOM_current_objective] secondary_color_to $DYOM_objective_accuracy[$DYOM_current_objective]
    0840: link_car $DYOM_objective_handle[$DYOM_current_objective] to_interior $DYOM_objective_interior[$DYOM_current_objective] 
    Car.DoorStatus($DYOM_objective_handle[$DYOM_current_objective]) = 1  
    car.Health($DYOM_objective_handle[$DYOM_current_objective]) = $DYOM_objective_health[$DYOM_current_objective]
    if 08B4:   test $DYOM_objective_properties[$DYOM_current_objective] bit DYOM_carpropbit_bulletproof 
    then
        $p1 = 1
    else
        $p1 = 0
    end    
    if 08B4:   test $DYOM_objective_properties[$DYOM_current_objective] bit DYOM_carpropbit_explproof 
    then
        $p2 = 1  // fireproof and expl proof
    else
        $p2 = 0
    end    
    if 08B4:   test $DYOM_objective_properties[$DYOM_current_objective] bit DYOM_carpropbit_damproof 
    then
        $p3 = 1  // damage proof
    else
        $p3 = 0
    end    
    car.SetImmunities($DYOM_objective_handle[$DYOM_current_objective],$p1,$p2,$p2,$p3,0)
    if 08B4: test $DYOM_objective_properties[$DYOM_current_objective] bit DYOM_carpropbit_popproof 
    then
        053F: set_car $DYOM_objective_handle[$DYOM_current_objective] tires_vulnerability 0 
    end
    wait 0 ms
      
    if not $DYOM_objective_markercolor[$DYOM_current_objective] == -1
    then
        marker.CreateAboveCar($objmarker,$DYOM_objective_handle[$DYOM_current_objective])
        if $DYOM_objective_markercolor[$DYOM_current_objective] == 2
        then
          07E0: set_marker $objmarker type_to 1 
        else
          marker.SetColor($objmarker,$DYOM_objective_markercolor[$DYOM_current_objective])
        end 
    end    
  END

  //--------------------
  // MANAGE ACTORS for this objective
  //--------------------
  $DYOM_idx = 0
  WHILE  $DYOM_actor_count > $DYOM_idx
    IF $DYOM_actor_hidewith[$DYOM_idx] == $DYOM_current_objective
    THEN
      if 056D:   actor $DYOM_actor_handle[$DYOM_idx] defined 
      then
          if 08B4:   test $DYOM_actor_properties[$DYOM_idx] bit DYOM_actorpropbit_bar 
          then
            if $bar_act == $DYOM_actor_handle[$DYOM_idx]
            then
              0151: remove_status_text $bar_value 
              $bar_act = 0
            end 
          end
          if $DYOM_actor_mustlive[$DYOM_idx] == 1
          then
            // Remove from ML list
            var
              $idx:integer
              $idx2:integer
            end  
            $idx = 0
            while $idx < $ML_actor_count

              if $ML_actors[$idx] == $DYOM_actor_handle[$DYOM_idx]
              then
                $ML_actor_count += -1
                while $idx < $ML_actor_count

                  $idx2=$idx
                  $idx2 += 1
                  $ML_actors[$idx] = $ML_actors[$idx2]
                  $idx += 1
                end
              end
              $idx += 1
            end
          end
          if $CAM_target_ACTOR == $DYOM_actor_handle[$DYOM_idx]
          then
               068D: get_camera_position_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3
               068E: get_camera_target_point_to $TEMPVAR_FLOAT_4 $TEMPVAR_FLOAT_5 $TEMPVAR_FLOAT_6
               015F: set_camera_position $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 rotation 0.0 0.0 0.0 
               0160: set_camera_point_at $TEMPVAR_FLOAT_4 $TEMPVAR_FLOAT_5 $TEMPVAR_FLOAT_6 mode 2 
          end
          actor.DestroyInstantly($DYOM_actor_handle[$DYOM_idx])
      end

    END
    $DYOM_idx += 1
  END
  repeat
    wait 0
  until $anim_req == -1
  $CAM_target_ACTOR = -1
  
  //--------------------
  // MANAGE CARS for this objective
  //--------------------
  $DYOM_idx = 0
  WHILE  $DYOM_car_count > $DYOM_idx
    IF $DYOM_car_spawnwith[$DYOM_idx] == $DYOM_current_objective
    THEN
      0980: extinguish_all_fires_at $DYOM_car_location_x[$DYOM_idx] $DYOM_car_location_y[$DYOM_idx] $DYOM_car_location_z[$DYOM_idx] radius 1.0 

      model.Load($DYOM_car_model[$DYOM_idx]) 
      038B: load_requested_models                                                   
      REPEAT
          wait 0 ms                                                                     
      UNTIL model.Available($DYOM_car_model[$DYOM_idx])                                                          
      Car.Create($DYOM_car_handle[$DYOM_idx],$DYOM_car_model[$DYOM_idx], $DYOM_car_location_x[$DYOM_idx], $DYOM_car_location_y[$DYOM_idx], $DYOM_car_location_z[$DYOM_idx])
      car.Angle($DYOM_car_handle[$DYOM_idx]) = $DYOM_car_location_a[$DYOM_idx]
      0229: set_car $DYOM_car_handle[$DYOM_idx] primary_color_to $DYOM_car_color1[$DYOM_idx] secondary_color_to $DYOM_car_color2[$DYOM_idx]
      0840: link_car $DYOM_car_handle[$DYOM_idx] to_interior $DYOM_car_interior[$DYOM_idx] 
      Car.DoorStatus($DYOM_car_handle[$DYOM_idx]) = 1  
      car.Health($DYOM_car_handle[$DYOM_idx]) = $DYOM_car_health[$DYOM_idx]
      if 08B4:   test $DYOM_car_properties[$DYOM_idx] bit DYOM_carpropbit_bulletproof 
      then
        $p1 = 1
      else
        $p1 = 0
      end    
      if 08B4:   test $DYOM_car_properties[$DYOM_idx] bit DYOM_carpropbit_explproof 
      then
        $p2 = 1  // fireproof and expl proof
      else
        $p2 = 0
      end    
      if 08B4:   test $DYOM_car_properties[$DYOM_idx] bit DYOM_carpropbit_damproof 
      then
        $p3 = 1  // damage proof
      else
        $p3 = 0
      end    
      car.SetImmunities($DYOM_car_handle[$DYOM_idx],$p1,$p2,$p2,$p3,0)
      if 08B4: test $DYOM_car_properties[$DYOM_idx] bit DYOM_carpropbit_popproof 
      then
        053F: set_car $DYOM_car_handle[$DYOM_idx] tires_vulnerability 0 
      end
      if 08B4: test $DYOM_car_properties[$DYOM_idx] bit DYOM_carpropbit_locked 
      then
        Car.DoorStatus($DYOM_car_handle[$DYOM_idx]) = 4  
      end
      if 08B4: test $DYOM_car_properties[$DYOM_idx] bit DYOM_carpropbit_hunt 
      then
        // Make this car hunt and attack player
        //06E1: AS_actor 50@ using_car 51@ target_car 69@ with_order 29 max_speed 30.0 traffic_flag 2 
        //0713: actor 52@ driveby_actor -1 car -1 point 952.92 -1102.99 22.85 radius 100.0 4 1 firing_rate 90 
        00AF: set_car $DYOM_car_handle[$DYOM_idx] driver_behaviour_to 10 
      end
      wait 0 ms
      model.Destroy($DYOM_car_model[$DYOM_idx]) 
      
      if $DYOM_car_mustlive[$DYOM_idx] == 1
      then
        // Add to ML list
        $ML_cars[$ML_car_count] = $DYOM_car_handle[$DYOM_idx]
        $ML_car_count += 1
      end

    END 
    IF $DYOM_car_hidewith[$DYOM_idx] == $DYOM_current_objective
    THEN
      if $DYOM_car_mustlive[$DYOM_idx] == 1
      then
        // Remove from ML list
        var
          $idx:integer
          $idx2:integer
        end  
        $idx = 0
        while $idx < $ML_car_count
          if $ML_cars[$idx] == $DYOM_car_handle[$DYOM_idx]
          then
            $ML_car_count += -1
            while $idx < $ML_car_count
              $idx2=$idx
              $idx2 += 1
              $ML_cars[$idx] = $ML_cars[$idx2]
              $idx += 1
            end
          end
          $idx += 1
        end
      end

      if 056E:   car $DYOM_car_handle[$DYOM_idx] defined 
      then
        car.Destroy($DYOM_car_handle[$DYOM_idx])
      end
    END 
    $DYOM_idx += 1
  END
                                     
  //--------------------
  // MANAGE ACTORS for this objective
  //--------------------
  $DYOM_idx = 0
  WHILE  $DYOM_actor_count > $DYOM_idx
    IF $DYOM_actor_spawnwith[$DYOM_idx] == $DYOM_current_objective
    THEN
      0980: extinguish_all_fires_at $DYOM_actor_location_x[$DYOM_idx] $DYOM_actor_location_y[$DYOM_idx] $DYOM_actor_location_z[$DYOM_idx] radius 1.0 

      //$actor_model_req -> $actor_model_loaded
      $actor_model_loaded = -1
      $actor_model_req = $DYOM_actor_model[$DYOM_idx]
      $DYOM_current_weapon = $DYOM_actor_weapon[$DYOM_idx]  
      
      if $DYOM_current_weapon == 48
      then
        0209: $DYOM_current_weapon = random_int_in_ranges 1 43 
        if $DYOM_current_weapon > 18
        then
           $DYOM_current_weapon += 3 
        end
      end
      model.Load($DYOM_Weapon_model[$DYOM_current_weapon])                                                                                                              
      038B: load_requested_models  
                                                                                   
      repeat
        wait 0 ms                                                                     
      until model.Available($DYOM_Weapon_model[$DYOM_current_weapon]) 
                                                               
      repeat
        wait 0
      until not $actor_model_loaded == -1
    
      $DYOM_actor_handle[$DYOM_idx] = Actor.Create($DYOM_actor_gang[$DYOM_idx], $actor_model_loaded, $DYOM_actor_location_x[$DYOM_idx], $DYOM_actor_location_y[$DYOM_idx], $DYOM_actor_location_z[$DYOM_idx])
      0173: set_actor $DYOM_actor_handle[$DYOM_idx] Z_angle_to $DYOM_actor_location_a[$DYOM_idx] 
      
      077E: get_active_interior_to $ACTINT 
      if 803A: NOT  $ACTINT == $DYOM_actor_interior[$DYOM_idx] 
      then
         0860: link_actor $DYOM_actor_handle[$DYOM_idx] to_interior $DYOM_actor_interior[$DYOM_idx] 
      end
      //0663: "actor ammo" $DYOM_actor_ammo[$DYOM_idx]

      01B2: give_actor $DYOM_actor_handle[$DYOM_idx] weapon $DYOM_current_weapon ammo $DYOM_actor_ammo[$DYOM_idx]
      0223: set_actor $DYOM_actor_handle[$DYOM_idx] health_to $DYOM_actor_health[$DYOM_idx] 
      Actor.WeaponAccuracy($DYOM_actor_handle[$DYOM_idx]) = $DYOM_actor_accuracy[$DYOM_idx]
      if 08B4:   test $DYOM_actor_properties[$DYOM_idx] bit DYOM_actorpropbit_headshot
      then
        0446: set_actor $DYOM_actor_handle[$DYOM_idx] immune_to_headshots 0 
      end
                                 
      if 08B4:   test $DYOM_actor_properties[$DYOM_idx] bit DYOM_actorpropbit_hold 
      then
        0638: AS_actor $DYOM_actor_handle[$DYOM_idx] stay_put 1 
      end
      if 08B4:   test $DYOM_actor_properties[$DYOM_idx] bit DYOM_actorpropbit_aware 
      then
        // actor is always aware of player, issue kill command
        05E2: AS_actor $DYOM_actor_handle[$DYOM_idx] kill_actor $PLAYER_ACTOR
      end
      if 08B4:   test $DYOM_actor_properties[$DYOM_idx] bit DYOM_actorpropbit_follow 
      then
        // actor will follow player
        0631: put_actor $DYOM_actor_handle[$DYOM_idx] in_group $PLAYER_GROUP 
      end
      //0662: - PRINTSTRING "spawn actor"

      if 08B4:   test $DYOM_actor_properties[$DYOM_idx] bit DYOM_actorpropbit_bar 
      then
        $bar_act = $DYOM_actor_handle[$DYOM_idx]
        $bar_health = actor.Health($bar_act)
        $bar_full = $bar_health
        $bar_health *= 100
        $bar_health /= $bar_full
        $bar_value = $bar_health
        03C4:print_status $bar_value type 1 GXT_reference 'HEALTH'
      end
      
      repeat
        wait 0
      until $anim_req == -1
      $anim_distance = $DYOM_actor_distance[$DYOM_idx]
      $anim_actor = $DYOM_actor_handle[$DYOM_idx]
      $anim_gang = $DYOM_actor_gang[$DYOM_idx]
      $anim_req = $DYOM_actor_animation[$DYOM_idx]  


      wait 0 ms 
      if $actor_model_loaded == #SPECIAL01
      then
        0296: unload_special_actor 1 
      else
        0249: release_model $actor_model_loaded
      end
      model.Destroy($DYOM_Weapon_model[$DYOM_current_weapon])  
      
      if $DYOM_actor_mustlive[$DYOM_idx] == 1
      then
        // Add to ML list
        $ML_actors[$ML_actor_count] = $DYOM_actor_handle[$DYOM_idx]
        $ML_actor_count += 1
      end
                                                                                                                  
    END 
    $DYOM_idx += 1
  END
  repeat
    wait 0
  until $anim_req == -1
  $CAM_target_ACTOR = -1
  
  //--------------------
  // MANAGE PICKUPS for this objective
  //--------------------
  $DYOM_idx = 0
  WHILE  $DYOM_pickup_count > $DYOM_idx
    IF $DYOM_pickup_spawnwith[$DYOM_idx] == $DYOM_current_objective
    THEN
        if $DYOM_pickup_ammo[$DYOM_idx] == 0
        then
          0213: $DYOM_pickup_handle[$DYOM_idx] = create_pickup $DYOM_pickup_model[$DYOM_idx] type $DYOM_pickup_mode[$DYOM_idx] at $DYOM_pickup_location_x[$DYOM_idx]  $DYOM_pickup_location_y[$DYOM_idx]  $DYOM_pickup_location_z[$DYOM_idx]
        else
            0663: printint "PU TYPE" $DYOM_pickup_mode[$DYOM_idx]
          032B: $DYOM_pickup_handle[$DYOM_idx] = create_weapon_pickup $DYOM_pickup_model[$DYOM_idx] group $DYOM_pickup_mode[$DYOM_idx] ammo $DYOM_pickup_ammo[$DYOM_idx] at $DYOM_pickup_location_x[$DYOM_idx]  $DYOM_pickup_location_y[$DYOM_idx]  $DYOM_pickup_location_z[$DYOM_idx] 
         // 032B: $DYOM_pickup_handle[$DYOM_idx] = create_weapon_pickup $DYOM_pickup_model[$DYOM_idx] group 15 ammo $DYOM_pickup_ammo[$DYOM_idx] at $DYOM_pickup_location_x[$DYOM_idx]  $DYOM_pickup_location_y[$DYOM_idx]  $DYOM_pickup_location_z[$DYOM_idx] 
        end
    END 
    IF $DYOM_pickup_hidewith[$DYOM_idx] == $DYOM_current_objective
    THEN
      if 09D1:   pickup $DYOM_pickup_handle[$DYOM_idx] created 
      then
        pickup.Destroy($DYOM_pickup_handle[$DYOM_idx])
      end
    END
    $DYOM_idx += 1
  END
  
  //--------------------
  // MANAGE OBJECTS for this objective
  //--------------------  
  $DYOM_idx = 0
  WHILE  $DYOM_object_count > $DYOM_idx
    IF $DYOM_object_spawnwith[$DYOM_idx] == $DYOM_current_objective
    THEN
      if and
        not $DYOM_object_model[$DYOM_idx] == -16
        not $DYOM_object_model[$DYOM_idx] == -15
        $DYOM_object_model[$DYOM_idx] > -455
      then
        if $DYOM_object_model[$DYOM_idx] > -388
        then
          object.Init($DYOM_object_handle[$DYOM_idx],$DYOM_object_model[$DYOM_idx],$DYOM_object_location_x[$DYOM_idx], $DYOM_object_location_y[$DYOM_idx], $DYOM_object_location_z[$DYOM_idx])
          0453: set_object $DYOM_object_handle[$DYOM_idx] XY_rotation $DYOM_object_location_rx[$DYOM_idx] $DYOM_object_location_ry[$DYOM_idx] angle $DYOM_object_location_rz[$DYOM_idx]
          Object.KeepInMemory($DYOM_object_handle[$DYOM_idx]) = True
          Object.ToggleInMovingList($DYOM_object_handle[$DYOM_idx]) = False
          Object.RemoveFromMissionCleanupList($DYOM_object_handle[$DYOM_idx])
        else  
          0663: printint "create effect" $DYOM_object_model[$DYOM_idx]
          object.Init($DYOM_object_handle[$DYOM_idx],-16,$DYOM_object_location_x[$DYOM_idx], $DYOM_object_location_y[$DYOM_idx], 1500.0) // somewhere far far away
          Object.Indestructibility($DYOM_object_handle[$DYOM_idx]) = True
          Object.CollisionDetection($DYOM_object_handle[$DYOM_idx]) = False
          Object.KeepInMemory($DYOM_object_handle[$DYOM_idx]) = True
          Object.ToggleInMovingList($DYOM_object_handle[$DYOM_idx]) = False
          Object.RemoveFromMissionCleanupList($DYOM_object_handle[$DYOM_idx])
          $object_model = $DYOM_object_model[$DYOM_idx]
          gosub @EFFECT_GETNAME
          064B: $DYOM_object_location_rz[$DYOM_idx] = create_particle v$effect at $DYOM_object_location_x[$DYOM_idx] $DYOM_object_location_y[$DYOM_idx] $DYOM_object_location_z[$DYOM_idx] type 1

          064C: make_particle $DYOM_object_location_rz[$DYOM_idx] visible
        end
        
        $OBJ_I = $DYOM_object_interior[$DYOM_idx] 
        $OBJ_M = $OBJ_I
        $OBJ_M /= 1000
        $OBJ_M *= 1000
        $OBJ_I -= $OBJ_M
        $OBJ_M /= 1000
        $OBJ_P = $OBJ_M
        $OBJ_M /= 1000
        $OBJ_M *= 1000
        $OBJ_P -= $OBJ_M  
        $OBJ_M /= 1000
        //0663: - PRINTINT "MOBJECT i=" $OBJ_I
        //0663: - PRINTINT "MOBJECT m=" $OBJ_M
        //0663: - PRINTINT "MOBJECT p=" $OBJ_P
        0566: link_object $DYOM_object_handle[$DYOM_idx] to_interior $OBJ_I 
        
        if $OBJ_M == 1
        then
            $OBJ_M = $DYOM_POINT_LINK[$OBJ_P]
            $OBJ_I = $DYOM_POINT_LINK[$OBJ_M]
            //0663: - PRINTINT "MOBJECT P2=" $OBJ_M
            //0663: - PRINTINT "MOBJECT p3=" $OBJ_I
            004F: create thread @PROX_MOVE $DYOM_object_handle[$DYOM_idx] $DYOM_object_location_x[$DYOM_idx] $DYOM_object_location_y[$DYOM_idx] $DYOM_object_location_z[$DYOM_idx] $DYOM_object_location_rx[$DYOM_idx] $DYOM_object_location_ry[$DYOM_idx] $DYOM_object_location_rz[$DYOM_idx] $DYOM_POINT_X[$OBJ_P] $DYOM_POINT_Y[$OBJ_P] $DYOM_POINT_Z[$OBJ_P] $DYOM_POINT_X[$OBJ_M] $DYOM_POINT_Y[$OBJ_M] $DYOM_POINT_Z[$OBJ_M] $DYOM_POINT_X[$OBJ_I] $DYOM_POINT_Y[$OBJ_I]
        else
            if $OBJ_M > 1
            then
                if $OBJ_M == 2
                then
                  $TEMPVAR_FLOAT_7 = 0.1
                end
                if $OBJ_M == 3
                then
                  $TEMPVAR_FLOAT_7 = 1.0
                end
                if $OBJ_M == 4
                then
                  $TEMPVAR_FLOAT_7 = 5.0
                end
                //0664: - PRINTINT "Speed=" $TEMPVAR_FLOAT_7
                004F: create thread @PERM_MOVE $DYOM_object_handle[$DYOM_idx] $DYOM_object_location_x[$DYOM_idx] $DYOM_object_location_y[$DYOM_idx] $DYOM_object_location_z[$DYOM_idx] $DYOM_object_location_rx[$DYOM_idx] $DYOM_object_location_ry[$DYOM_idx] $DYOM_object_location_rz[$DYOM_idx] $OBJ_P $TEMPVAR_FLOAT_7
            end
        end
      end
      
      if $DYOM_object_model[$DYOM_idx] == -16
      then
      02CF: $DYOM_object_handle[$DYOM_idx] = create_fire_at $DYOM_object_location_x[$DYOM_idx] $DYOM_object_location_y[$DYOM_idx] $DYOM_object_location_z[$DYOM_idx] propagation 0 size 1 
      end
      
      if $DYOM_object_model[$DYOM_idx] == -15
      then
        004F: create thread @XPLO_THREAD $DYOM_object_location_x[$DYOM_idx] $DYOM_object_location_y[$DYOM_idx] $DYOM_object_location_z[$DYOM_idx]
      end
      
      if $DYOM_object_model[$DYOM_idx] <= -455
      then
        0@ = -455 
        0064: 0@ -= $DYOM_object_model[$DYOM_idx]        
        0663: printint "Explosion Style" 0@
        020C: create_explosion type 0@ at $DYOM_object_location_x[$DYOM_idx] $DYOM_object_location_y[$DYOM_idx] $DYOM_object_location_z[$DYOM_idx]
      end
      
    END
    IF $DYOM_object_hidewith[$DYOM_idx] == $DYOM_current_objective
    THEN
      if NOT $DYOM_object_model[$DYOM_idx] == -16
      then
          if 03CA:   object $DYOM_object_handle[$DYOM_idx] exists 
          then 
            object.Destroy($DYOM_object_handle[$DYOM_idx])
            if AND
               $DYOM_object_model[$DYOM_idx] < -387 
               $DYOM_object_model[$DYOM_idx] > -455
            then
                0976: destroy_particle $DYOM_object_location_rz[$DYOM_idx]
                0663: printint "hide effect" $DYOM_object_model[$DYOM_idx]
            end                
          end
      else    
          if 0973:   fire $DYOM_object_handle[$DYOM_idx] exists 
          then
            02D1: remove_fire $DYOM_object_handle[$DYOM_idx] 
          end
      end
    END
    $DYOM_idx += 1
  END
  
  // ====================== unfade if needed ====================
  if $DYOM_faded == 1
  then
    $DYOM_faded = 0
    fade 1 500
  end
  
  //--------------------
  // DISPLAY objective text
  //--------------------
  if or
    $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_car
    $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_marker
    $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_pickup
    $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_checkp
    $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_actor
    $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_cutscene
  then
    0ACD: show_text_highpriority $OBJTEXT time 5000
  end
  if or
    $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_countdown
    $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_telecar
    $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_timeout
    $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_phone
    $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_object
  then
    0ACD: show_text_highpriority $OBJTEXT time 5000
  end
    
  //======================
  // ENTER CAR OBJECTIVE 
  //======================
  IF and 
    $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_car 
    88B4: NOT  test $DYOM_objective_properties[$DYOM_current_objective] bit DYOM_carpropbit_mustdestroy
  THEN
    0A8D: $objtextmissing = read_memory $OBJTEXT size 1 virtual_protect 0 
    if $objtextmissing == 0
    then 
     00BC: show_text_highpriority GXT 'OBJCAR' time 3000 flag 1
    end
    
    //The objective car has been spawned before, to enable actors to act upon it.

    // OBJECTIVE LOOP
    REPEAT
      wait 0 ms
      // MUSTLIVE CHECK
      $DYOM_idx = 0
      WHILE  $ML_actor_count > $DYOM_idx
        wait 0
        IF 0118:  $ML_actors[$DYOM_idx] dead 
        THEN
          jump @DYOM_MISSION_FAIL
        END 
        $DYOM_idx += 1
      END
      $DYOM_idx = 0
      WHILE  $ML_car_count > $DYOM_idx
        wait 0
        IF 0119:   car $ML_cars[$DYOM_idx] wrecked 
        THEN
          jump @DYOM_MISSION_FAIL
        END 
        $DYOM_idx += 1
      END
      gosub @AMB_RESTART
      if $bar_act > 0
      then
          if and 
            056D:   actor $bar_act defined 
            NOT actor.Dead($bar_act)
          then
               $bar_health = actor.Health($bar_act)
               $bar_health /= 10
               $bar_value = $bar_health
          else
               0151: remove_status_text $bar_value
               $bar_act = 0 
          end
      end
      
      IF AND
          $limit_on == 1
          NOT $mission_timer > 0
      THEN
          jump @DYOM_MISSION_FAIL         
      END
      
      // This car must not be destroyed, that fails the mission
      if 0119:   car $DYOM_objective_handle[$DYOM_current_objective] wrecked 
      then
          jump @DYOM_MISSION_FAIL
      end
    UNTIL 00DB:   actor $PLAYER_ACTOR in_car $DYOM_objective_handle[$DYOM_current_objective] 
    
    
    $DYOM_mission_car = $DYOM_objective_handle[$DYOM_current_objective]

    // clean objective
    model.Destroy($DYOM_objective_model[$DYOM_current_objective])
    if not $DYOM_objective_markercolor[$DYOM_current_objective] == -1
    then
      marker.Disable($objmarker)
    end
  END 

  //======================
  // DESTROY CAR OBJECTIVE 
  //======================
  IF and 
    $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_car 
    08B4: test $DYOM_objective_properties[$DYOM_current_objective] bit DYOM_carpropbit_mustdestroy
  THEN
    if NOT $DYOM_mission_car == -1
    then 
      $DYOM_mission_car = -1
      01C3: remove_references_to_car $DYOM_mission_car
    end  
    0A8D: $objtextmissing = read_memory $OBJTEXT size 1 virtual_protect 0 
    if $objtextmissing == 0
    then 
     00BC: show_text_highpriority GXT 'OBJDCAR' time 3000 flag 1
    end
    
    //The objective car has been spawned before, to enable actors to act upon it.

    // OBJECTIVE LOOP
    REPEAT
      wait 0 ms
      // MUSTLIVE CHECK
      $DYOM_idx = 0
      WHILE  $ML_actor_count > $DYOM_idx
        wait 0
        IF 0118:  $ML_actors[$DYOM_idx] dead 
        THEN
          jump @DYOM_MISSION_FAIL
        END 
        $DYOM_idx += 1
      END
      $DYOM_idx = 0
      WHILE  $ML_car_count > $DYOM_idx
        wait 0
        IF 0119:   car $ML_cars[$DYOM_idx] wrecked 
        THEN
          jump @DYOM_MISSION_FAIL
        END 
        $DYOM_idx += 1
      END
      gosub @AMB_RESTART
      if $bar_act > 0
      then
          if and 
            056D:   actor $bar_act defined 
            NOT actor.Dead($bar_act)
          then
               $bar_health = actor.Health($bar_act)
               $bar_health *= 100
               $bar_health /= $bar_full
               $bar_value = $bar_health
          else
               0151: remove_status_text $bar_value
               $bar_act = 0 
          end
      end
      
      IF AND
          $limit_on == 1
          NOT $mission_timer > 0
      THEN
          jump @DYOM_MISSION_FAIL         
      END

    UNTIL 0119:   car $DYOM_objective_handle[$DYOM_current_objective] wrecked 
    01C3: remove_references_to_car $DYOM_objective_handle[$DYOM_current_objective]
    
    // clean objective
    model.Destroy($DYOM_objective_model[$DYOM_current_objective])
    if not $DYOM_objective_markercolor[$DYOM_current_objective] == -1
    then
      marker.Disable($objmarker)
    end

  END 

  
  //======================
  // MARKER OBJECTIVE
  //======================
  IF $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_marker 
  THEN
    0A8D: $objtextmissing = read_memory $OBJTEXT size 1 virtual_protect 0 
    if $objtextmissing == 0
    then 
      00BC: show_text_highpriority GXT 'OBJMARK' time 3000 flag 1
    end
    
    // setup objective
    02F6: 1@ = cosine $DYOM_objective_distance[$DYOM_current_objective] // (float) 
    02F7: 2@ = sine $DYOM_objective_distance[$DYOM_current_objective] // (float)
    1@ += $DYOM_objective_location_x[$DYOM_current_objective] 
    2@ += $DYOM_objective_location_y[$DYOM_current_objective] 
    
    if $DYOM_objective_model[$DYOM_current_objective] == 0
    then
     wait 50
     03BC: $DYOM_objective_handle[$DYOM_current_objective] = create_sphere_at $DYOM_objective_location_x[$DYOM_current_objective] $DYOM_objective_location_y[$DYOM_current_objective] $DYOM_objective_location_z[$DYOM_current_objective] radius $DYOM_objective_location_a[$DYOM_current_objective] 
    end
    if $DYOM_objective_model[$DYOM_current_objective] == 1
    then
      06D5: $DYOM_objective_handle[$DYOM_current_objective] = create_racing_checkpoint_at $DYOM_objective_location_x[$DYOM_current_objective] $DYOM_objective_location_y[$DYOM_current_objective] $DYOM_objective_location_z[$DYOM_current_objective] point_to 1@ 2@ $DYOM_objective_location_z[$DYOM_current_objective] type 0 radius $DYOM_objective_location_a[$DYOM_current_objective]
    end
    if $DYOM_objective_model[$DYOM_current_objective] == 2
    then
      06D5: $DYOM_objective_handle[$DYOM_current_objective] = create_racing_checkpoint_at $DYOM_objective_location_x[$DYOM_current_objective] $DYOM_objective_location_y[$DYOM_current_objective] $DYOM_objective_location_z[$DYOM_current_objective] point_to 1@ 2@ $DYOM_objective_location_z[$DYOM_current_objective] type 1 radius $DYOM_objective_location_a[$DYOM_current_objective]
    end
    if $DYOM_objective_model[$DYOM_current_objective] == 3
    then
      06D5: $DYOM_objective_handle[$DYOM_current_objective] = create_racing_checkpoint_at $DYOM_objective_location_x[$DYOM_current_objective] $DYOM_objective_location_y[$DYOM_current_objective] $DYOM_objective_location_z[$DYOM_current_objective] point_to 1@ 2@ $DYOM_objective_location_z[$DYOM_current_objective] type 2 radius $DYOM_objective_location_a[$DYOM_current_objective]
    end
    if $DYOM_objective_model[$DYOM_current_objective] == 4
    then
      06D5: $DYOM_objective_handle[$DYOM_current_objective] = create_racing_checkpoint_at $DYOM_objective_location_x[$DYOM_current_objective] $DYOM_objective_location_y[$DYOM_current_objective] $DYOM_objective_location_z[$DYOM_current_objective] point_to 1@ 2@ $DYOM_objective_location_z[$DYOM_current_objective] type 4 radius $DYOM_objective_location_a[$DYOM_current_objective]
    end
    // no visible checkpoint for type 5
    if $DYOM_objective_model[$DYOM_current_objective] == 6
    then
      0A40: $DYOM_objective_handle[$DYOM_current_objective] = create_entrance_marker_at $DYOM_objective_location_x[$DYOM_current_objective] $DYOM_objective_location_y[$DYOM_current_objective] $DYOM_objective_location_z[$DYOM_current_objective] color 14
    end

    //03BC: $DYOM_objective_handle[$DYOM_current_objective] = create_sphere_at $DYOM_objective_location_x[$DYOM_current_objective] $DYOM_objective_location_y[$DYOM_current_objective] $DYOM_objective_location_z[$DYOM_current_objective] radius $DYOM_objective_location_a[$DYOM_current_objective] 
    if not $DYOM_objective_markercolor[$DYOM_current_objective] == -1
    then
       018A: $objmarker = create_checkpoint_at $DYOM_objective_location_x[$DYOM_current_objective], $DYOM_objective_location_y[$DYOM_current_objective], $DYOM_objective_location_z[$DYOM_current_objective] 
       marker.SetColor($objmarker,$DYOM_objective_markercolor[$DYOM_current_objective])
    end 
    var
      1@: integer
    end
    1@ = $DYOM_current_objective
    1@ += 1
    $nextmarker = -1
    if and
      not $DYOM_mission_car == -1
      1@ < $DYOM_objective_count
      $DYOM_objective_type[1@] == DYOM_objtype_marker
      not $DYOM_objective_markercolor[1@] == -1  
    then
       018A: $nextmarker = create_checkpoint_at $DYOM_objective_location_x[1@], $DYOM_objective_location_y[1@], $DYOM_objective_location_z[1@] 
       marker.SetColor($nextmarker,$DYOM_objective_markercolor[1@])    
    end 

    wait 200
    $marker_reached = 0
    $in_car = 1
    REPEAT
      wait 0 ms
      // MUSTLIVE CHECK
      $DYOM_idx = 0
      WHILE  $ML_actor_count > $DYOM_idx
        IF 0118:  $ML_actors[$DYOM_idx] dead 
        THEN
          jump @DYOM_MISSION_FAIL
        END 
        $DYOM_idx += 1
      END    
      
      IF and
        $DYOM_mission_car == -1
        00FE:   actor $PLAYER_ACTOR sphere 0 in_sphere $DYOM_objective_location_x[$DYOM_current_objective] $DYOM_objective_location_y[$DYOM_current_objective] $DYOM_objective_location_z[$DYOM_current_objective] radius $DYOM_objective_location_a[$DYOM_current_objective] $DYOM_objective_location_a[$DYOM_current_objective] $DYOM_objective_location_a[$DYOM_current_objective]
      THEN
        $marker_reached = 1
      END 
       
      IF and
        NOT $DYOM_mission_car == -1
        00DB:   actor $PLAYER_ACTOR in_car $DYOM_mission_car
        00FE:   actor $PLAYER_ACTOR sphere 0 in_sphere $DYOM_objective_location_x[$DYOM_current_objective] $DYOM_objective_location_y[$DYOM_current_objective] $DYOM_objective_location_z[$DYOM_current_objective] radius $DYOM_objective_location_a[$DYOM_current_objective] $DYOM_objective_location_a[$DYOM_current_objective] $DYOM_objective_location_a[$DYOM_current_objective]
      THEN
        $marker_reached = 1
      END  
      wait 0
              
      $DYOM_idx = 0
      WHILE  $ML_car_count > $DYOM_idx
        IF 0119:   car $ML_cars[$DYOM_idx] wrecked 
        THEN
          jump @DYOM_MISSION_FAIL
        END 
        $DYOM_idx += 1
      END

      IF and
        $DYOM_mission_car == -1
        00FE:   actor $PLAYER_ACTOR sphere 0 in_sphere $DYOM_objective_location_x[$DYOM_current_objective] $DYOM_objective_location_y[$DYOM_current_objective] $DYOM_objective_location_z[$DYOM_current_objective] radius $DYOM_objective_location_a[$DYOM_current_objective] $DYOM_objective_location_a[$DYOM_current_objective] $DYOM_objective_location_a[$DYOM_current_objective]
      THEN
        $marker_reached = 1
      END 
       
      IF and
        NOT $DYOM_mission_car == -1
        00DB:   actor $PLAYER_ACTOR in_car $DYOM_mission_car
        00FE:   actor $PLAYER_ACTOR sphere 0 in_sphere $DYOM_objective_location_x[$DYOM_current_objective] $DYOM_objective_location_y[$DYOM_current_objective] $DYOM_objective_location_z[$DYOM_current_objective] radius $DYOM_objective_location_a[$DYOM_current_objective] $DYOM_objective_location_a[$DYOM_current_objective] $DYOM_objective_location_a[$DYOM_current_objective]
      THEN
        $marker_reached = 1
      END  
      wait 0

      gosub @AMB_RESTART
      if $bar_act > 0
      then
          if and 
            056D:   actor $bar_act defined 
            NOT actor.Dead($bar_act)
          then
               $bar_health = actor.Health($bar_act)
               $bar_health *= 100
               $bar_health /= $bar_full
               $bar_value = $bar_health
          else
               0151: remove_status_text $bar_value
               $bar_act = 0 
          end
      end
      
      IF AND
          $limit_on == 1
          NOT $mission_timer > 0
      THEN
          jump @DYOM_MISSION_FAIL         
      END
      
      IF and
        not $DYOM_mission_car == -1
        0119:   car $DYOM_mission_car wrecked 
      THEN
          jump @DYOM_MISSION_FAIL         
      END
      
      IF and
        NOT $DYOM_mission_car == -1
        $in_car == 0
        00DB: actor $PLAYER_ACTOR in_car $DYOM_mission_car
      THEN
        marker.Disable($car_mark)
        $in_car = 1
        if not $DYOM_objective_markercolor[$DYOM_current_objective] == -1
        then
          018A: $objmarker = create_checkpoint_at $DYOM_objective_location_x[$DYOM_current_objective], $DYOM_objective_location_y[$DYOM_current_objective], $DYOM_objective_location_z[$DYOM_current_objective] 
          //marker.SetColor($objmarker,$DYOM_objective_markercolor[$DYOM_current_objective])
        if $DYOM_objective_markercolor[$DYOM_current_objective] == 2
        then
          07E0: set_marker $objmarker type_to 1 
        else
          marker.SetColor($objmarker,$DYOM_objective_markercolor[$DYOM_current_objective])
        end 
        end    
        if and
          1@ < $DYOM_objective_count
          $DYOM_objective_type[1@] == DYOM_objtype_marker
          not $DYOM_objective_markercolor[1@] == -1  
        then
           018A: $nextmarker = create_checkpoint_at $DYOM_objective_location_x[1@], $DYOM_objective_location_y[1@], $DYOM_objective_location_z[1@] 
           //marker.SetColor($nextmarker,$DYOM_objective_markercolor[1@])    
            if $DYOM_objective_markercolor[1@] == 2
            then
              07E0: set_marker $nextmarker type_to 1 
            else
              marker.SetColor($nextmarker,$DYOM_objective_markercolor[1@])
            end 
        end 
      END 
       
      IF and
        NOT $DYOM_mission_car == -1
        $in_car == 1
        80DB: NOT  actor $PLAYER_ACTOR in_car $DYOM_mission_car
      THEN
        $car_mark = marker.CreateAboveCar($DYOM_mission_car) 
        $in_car = 0
        00BC: show_text_highpriority GXT 'GOCAR' time 2000 flag 1  
        if not $DYOM_objective_markercolor[$DYOM_current_objective] == -1
        then
          marker.Disable($objmarker)
        end
        if and
          1@ < $DYOM_objective_count
          $DYOM_objective_type[1@] == DYOM_objtype_marker
          not $DYOM_objective_markercolor[1@] == -1  
        then
           marker.Disable($nextmarker)
        end 
      END  
      
      IF and
        $DYOM_mission_car == -1
        00FE:   actor $PLAYER_ACTOR sphere 0 in_sphere $DYOM_objective_location_x[$DYOM_current_objective] $DYOM_objective_location_y[$DYOM_current_objective] $DYOM_objective_location_z[$DYOM_current_objective] radius $DYOM_objective_location_a[$DYOM_current_objective] $DYOM_objective_location_a[$DYOM_current_objective] $DYOM_objective_location_a[$DYOM_current_objective]
      THEN
        $marker_reached = 1
      END 
       
      IF and
        NOT $DYOM_mission_car == -1
        00DB:   actor $PLAYER_ACTOR in_car $DYOM_mission_car
        00FE:   actor $PLAYER_ACTOR sphere 0 in_sphere $DYOM_objective_location_x[$DYOM_current_objective] $DYOM_objective_location_y[$DYOM_current_objective] $DYOM_objective_location_z[$DYOM_current_objective] radius $DYOM_objective_location_a[$DYOM_current_objective] $DYOM_objective_location_a[$DYOM_current_objective] $DYOM_objective_location_a[$DYOM_current_objective]
      THEN
        $marker_reached = 1
      END  
      
    UNTIL $marker_reached == 1

    // clean objective
    if or
      $DYOM_objective_model[$DYOM_current_objective] == 0
      $DYOM_objective_model[$DYOM_current_objective] == 5
    then
        03BD: destroy_sphere $DYOM_objective_handle[$DYOM_current_objective]
    else
      if $DYOM_objective_model[$DYOM_current_objective] == 6
      then
        0A41: destroy_entrance_marker $DYOM_objective_handle[$DYOM_current_objective]
      else
        06D6: disable_racing_checkpoint $DYOM_objective_handle[$DYOM_current_objective] 
      end
    end 
    $DYOM_objective_handle[$DYOM_current_objective] = -1 
    if not $DYOM_objective_markercolor[$DYOM_current_objective] == -1
    then
      marker.Disable($objmarker)
    end
    if and
      1@ < $DYOM_objective_count
      $DYOM_objective_type[1@] == DYOM_objtype_marker
      not $DYOM_objective_markercolor[1@] == -1  
    then
       marker.Disable($nextmarker)
    end 
  END 
  
  
  //======================
  // PICKUP OBJECTIVE
  //======================
  IF $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_pickup 
  THEN
    if NOT $DYOM_mission_car == -1
    then 
      $DYOM_mission_car = -1
      01C3: remove_references_to_car $DYOM_mission_car
    end  
    0A8D: $objtextmissing = read_memory $OBJTEXT size 1 virtual_protect 0 
    if $objtextmissing == 0
    then 
      00BC: show_text_highpriority GXT 'OBJPU' time 3000 flag 1
    end
    
    if $DYOM_objective_ammo[$DYOM_current_objective] == 0   
    then
      0213: $pickup = create_pickup $DYOM_objective_model[$DYOM_current_objective] type 3 at $DYOM_objective_location_x[$DYOM_current_objective] $DYOM_objective_location_y[$DYOM_current_objective] $DYOM_objective_location_z[$DYOM_current_objective]
    else
      032B: $pickup = create_weapon_pickup $DYOM_objective_model[$DYOM_current_objective] group 3 ammo $DYOM_objective_ammo[$DYOM_current_objective] at $DYOM_objective_location_x[$DYOM_current_objective] $DYOM_objective_location_y[$DYOM_current_objective] $DYOM_objective_location_z[$DYOM_current_objective] 
    end
    $objmarker = 0
    if not $DYOM_objective_markercolor[$DYOM_current_objective] == -1
    then
        03DC: $objmarker = create_marker_above_pickup $pickup 
        //marker.SetColor($objmarker,$DYOM_objective_markercolor[$DYOM_current_objective])
        if $DYOM_objective_markercolor[$DYOM_current_objective] == 2
        then
          07E0: set_marker $objmarker type_to 1 
        else
          marker.SetColor($objmarker,$DYOM_objective_markercolor[$DYOM_current_objective])
        end 
        if 08B4:   test $DYOM_objective_properties[$DYOM_current_objective] bit DYOM_pickuppropbit_pickall
        then
            $DYOM_idx = 0
            WHILE  $DYOM_pickup_count > $DYOM_idx
                wait 0
                IF and 
                    $DYOM_pickup_model[$DYOM_idx] == $DYOM_objective_model[$DYOM_current_objective]
                    $DYOM_pickup_mode[$DYOM_idx] == 3
                    NOT $DYOM_pickup_spawnwith[$DYOM_idx] > $DYOM_current_objective
                    $DYOM_pickup_hidewith[$DYOM_idx] > $DYOM_current_objective
                    NOT pickup.Picked_up($DYOM_pickup_handle[$DYOM_idx])
                THEN
                    03DC: $DYOM_temp_markers[$DYOM_idx] = create_marker_above_pickup $DYOM_pickup_handle[$DYOM_idx] 
                    //marker.SetColor($DYOM_temp_markers[$DYOM_idx],$DYOM_objective_markercolor[$DYOM_current_objective])
                    if $DYOM_objective_markercolor[$DYOM_current_objective] == 2
                    then
                      07E0: set_marker $DYOM_temp_markers[$DYOM_idx] type_to 1 
                    else
                      marker.SetColor($DYOM_temp_markers[$DYOM_idx],$DYOM_objective_markercolor[$DYOM_current_objective])
                    end 
                END 
                $DYOM_idx += 1
            END
        end
    end    

    // OBJECTIVE LOOP
    var
      $pickups_togo : integer
      $pickups_cnt : integer
    end  
    if 
    if 08B4:   test $DYOM_objective_properties[$DYOM_current_objective] bit DYOM_pickuppropbit_counter
    then
        03C4:print_status $pickups_cnt type 0 GXT_reference 'TOGO'
    end
    REPEAT
      $pickups_togo = 0
      wait 0 ms
      // MUSTLIVE CHECK
      $DYOM_idx = 0
      WHILE  $ML_actor_count > $DYOM_idx
        wait 0
        IF 0118:  $ML_actors[$DYOM_idx] dead 
        THEN
          jump @DYOM_MISSION_FAIL
        END 
        $DYOM_idx += 1
      END
      $DYOM_idx = 0
      WHILE  $ML_car_count > $DYOM_idx
        wait 0
        IF 0119:   car $ML_cars[$DYOM_idx] wrecked 
        THEN
          jump @DYOM_MISSION_FAIL
        END 
        $DYOM_idx += 1
      END
      gosub @AMB_RESTART
      if $bar_act > 0
      then
          if and 
            056D:   actor $bar_act defined 
            NOT actor.Dead($bar_act)
          then
               $bar_health = actor.Health($bar_act)
               $bar_health *= 100
               $bar_health /= $bar_full
               $bar_value = $bar_health
          else
               0151: remove_status_text $bar_value
               $bar_act = 0 
          end
      end
      
        if 08B4:   test $DYOM_objective_properties[$DYOM_current_objective] bit DYOM_pickuppropbit_pickall
        then
            $DYOM_idx = 0
            WHILE  $DYOM_pickup_count > $DYOM_idx
                wait 0
                IF and 
                    $DYOM_pickup_model[$DYOM_idx] == $DYOM_objective_model[$DYOM_current_objective]
                    NOT $DYOM_pickup_spawnwith[$DYOM_idx] > $DYOM_current_objective
                    $DYOM_pickup_hidewith[$DYOM_idx] > $DYOM_current_objective
                    NOT $DYOM_pickup_handle[$DYOM_idx] == 0
                THEN
                    if  pickup.Picked_up($DYOM_pickup_handle[$DYOM_idx])
                    then
                        Pickup.Destroy($DYOM_pickup_handle[$DYOM_idx])
                        $DYOM_pickup_handle[$DYOM_idx] = 0
                        if not $DYOM_objective_markercolor[$DYOM_current_objective] == -1
                        then
                           marker.Disable($DYOM_temp_markers[$DYOM_idx])
                           $DYOM_temp_markers[$DYOM_idx] = 0
                        end
                    else
                       $pickups_togo += 1
                    end 
                END
                $DYOM_idx += 1
            END
        end

      IF AND
          $limit_on == 1
          NOT $mission_timer > 0
      THEN
          jump @DYOM_MISSION_FAIL         
      END
      
      IF NOT $pickup == 0
      THEN
          IF  pickup.Picked_up($pickup) 
          THEN  
            if NOT $objmarker == 0
            then
               marker.Disable($objmarker)
               $objmarker = 0
            end
            Pickup.Destroy($pickup)
            $pickup = 0
          ELSE 
             $pickups_togo += 1 
          END
      END
      $pickups_cnt = $pickups_togo
      //0663: - PRINTINT "TOGO" $pickups_togo

      
    UNTIL $pickups_togo  == 0
    
    if 08B4:   test $DYOM_objective_properties[$DYOM_current_objective] bit DYOM_pickuppropbit_counter
    then
        0151:remove_status_text $pickups_cnt
    end

  END 
  
  //======================
  // ACTOR OBJECTIVE
  //======================
  IF $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_actor 
  THEN
    if NOT $DYOM_mission_car == -1
    then 
      $DYOM_mission_car = -1
      01C3: remove_references_to_car $DYOM_mission_car
    end  
    0A8D: $objtextmissing = read_memory $OBJTEXT size 1 virtual_protect 0 
    if $objtextmissing == 0
    then 
      00BC: show_text_highpriority GXT 'OBJACT' time 3000 flag 1
    end
    
    // setup objective
    0980: extinguish_all_fires_at $DYOM_objective_location_x[$DYOM_current_objective] $DYOM_objective_location_y[$DYOM_current_objective] $DYOM_objective_location_z[$DYOM_current_objective] radius 1.0 

    //$actor_model_req -> $actor_model_loaded
    $actor_model_loaded = -1
    $actor_model_req = $DYOM_objective_model[$DYOM_current_objective]
    $DYOM_current_weapon = $DYOM_objective_data[$DYOM_current_objective] 
    if $DYOM_current_weapon == 48
    then
      0209: $DYOM_current_weapon = random_int_in_ranges 1 43 
      if $DYOM_current_weapon > 18
      then
         $DYOM_current_weapon += 3 
      end
    end
 
    model.Load($DYOM_Weapon_model[$DYOM_current_weapon])                                                                                                              
    038B: load_requested_models                                                   
                                                                               
    repeat
    wait 0 ms                                                                     
    until  model.Available($DYOM_Weapon_model[$DYOM_current_weapon])                                                          
    repeat
        wait 20
    until not $actor_model_loaded == -1

    var
      $gang:integer
    end
    if 08B4:   test $DYOM_objective_properties[$DYOM_current_objective] bit DYOM_actorpropbit_enemy2 
    then
        $gang = DYOM_gang_enemy2
    else
        $gang = DYOM_gang_enemy
    end
    //0663: "actor ammo" $DYOM_objective_ammo[$DYOM_current_objective]

    $DYOM_objective_handle[$DYOM_current_objective] = Actor.Create($gang, $actor_model_loaded, $DYOM_objective_location_x[$DYOM_current_objective], $DYOM_objective_location_y[$DYOM_current_objective], $DYOM_objective_location_z[$DYOM_current_objective])
    0173: set_actor $DYOM_objective_handle[$DYOM_current_objective] Z_angle_to $DYOM_objective_location_a[$DYOM_current_objective] 
    0860: link_actor $DYOM_objective_handle[$DYOM_current_objective] to_interior $DYOM_objective_interior[$DYOM_current_objective] 
    01B2: give_actor $DYOM_objective_handle[$DYOM_current_objective] weapon $DYOM_current_weapon ammo $DYOM_objective_ammo[$DYOM_current_objective]
    actor.Health($DYOM_objective_handle[$DYOM_current_objective]) = $DYOM_objective_health[$DYOM_current_objective]
    actor.WeaponAccuracy($DYOM_objective_handle[$DYOM_current_objective]) = $DYOM_objective_accuracy[$DYOM_current_objective]

    if 08B4:   test $DYOM_objective_properties[$DYOM_current_objective] bit DYOM_actorpropbit_hold 
    then
       //actor should hold his position
       0638: AS_actor $DYOM_objective_handle[$DYOM_current_objective] stay_put 1 
    end
    if 08B4:   test $DYOM_objective_properties[$DYOM_current_objective] bit DYOM_actorpropbit_aware 
    then
        // actor is always aware of player, issue kill command
        05E2: AS_actor $DYOM_objective_handle[$DYOM_current_objective] kill_actor $PLAYER_ACTOR
    end
    if 08B4:   test $DYOM_objective_properties[$DYOM_current_objective] bit DYOM_actorpropbit_headshot 
    then
        0446: set_actor $DYOM_objective_handle[$DYOM_current_objective] immune_to_headshots 0 
    end
    if 08B4:   test $DYOM_objective_properties[$DYOM_current_objective] bit DYOM_actorpropbit_bar 
    then
        $bar_act = $DYOM_objective_handle[$DYOM_current_objective]
        $bar_health = actor.Health($bar_act)
        $bar_full = $bar_health
        $bar_health *= 100
        $bar_health /= $bar_full
        $bar_value = $bar_health
        03C4:print_status $bar_value type 1 GXT_reference 'HEALTH'
    end

    
    if not $DYOM_objective_markercolor[$DYOM_current_objective] == -1
    then
        marker.CreateAboveActor($objmarker,$DYOM_objective_handle[$DYOM_current_objective])
        if $DYOM_objective_markercolor[$DYOM_current_objective] == 2
        then
          07E0: set_marker $objmarker type_to 1 
        else
          marker.SetColor($objmarker,$DYOM_objective_markercolor[$DYOM_current_objective])
        end 
        if 08B4:   test $DYOM_objective_properties[$DYOM_current_objective] bit DYOM_actorpropbit_allenemies
        then
            $DYOM_idx = 0
            WHILE  $DYOM_actor_count > $DYOM_idx
                wait 0
                IF and 
                    $DYOM_actor_gang[$DYOM_idx] == $gang
                    NOT $DYOM_actor_spawnwith[$DYOM_idx] > $DYOM_current_objective
                    $DYOM_actor_hidewith[$DYOM_idx] > $DYOM_current_objective
                    056D:   actor $DYOM_actor_handle[$DYOM_idx] defined 
                    8118: NOT $DYOM_actor_handle[$DYOM_idx] dead 
    
                THEN
                    marker.CreateAboveActor($DYOM_temp_markers[$DYOM_idx],$DYOM_actor_handle[$DYOM_idx])
                    //marker.SetColor($DYOM_temp_markers[$DYOM_idx],$DYOM_objective_markercolor[$DYOM_current_objective])
                    if $DYOM_objective_markercolor[$DYOM_current_objective] == 2
                    then
                      07E0: set_marker $DYOM_temp_markers[$DYOM_idx] type_to 1 
                    else
                      marker.SetColor($DYOM_temp_markers[$DYOM_idx],$DYOM_objective_markercolor[$DYOM_current_objective])
                    end 
                END 
                $DYOM_idx += 1
            END
        end
        
    end
    repeat
        wait 0
    until $anim_req == -1
    $anim_distance = $DYOM_objective_distance[$DYOM_current_objective]
    $anim_actor = $DYOM_objective_handle[$DYOM_current_objective]
    $anim_gang = $gang
    $anim_req = $DYOM_objective_animation[$DYOM_current_objective]
    var
      $living_enemies : integer
      $actorobj_passed : integer
    end  
    REPEAT
      $living_enemies = 0
      $actorobj_passed = 0
      wait 0 ms

      // MUSTLIVE CHECK
      $DYOM_idx = 0
      WHILE  $ML_actor_count > $DYOM_idx
        wait 0
        IF 0118:  $ML_actors[$DYOM_idx] dead 
        THEN
          jump @DYOM_MISSION_FAIL
        END 
        $DYOM_idx += 1
      END
      $DYOM_idx = 0
      WHILE  $ML_car_count > $DYOM_idx
        wait 0
        IF 0119:   car $ML_cars[$DYOM_idx] wrecked 
        THEN
          jump @DYOM_MISSION_FAIL
        END 
        $DYOM_idx += 1
      END
      gosub @AMB_RESTART

      if 08B4:   test $DYOM_objective_properties[$DYOM_current_objective] bit DYOM_actorpropbit_allenemies
      then
          $DYOM_idx = 0
          WHILE  $DYOM_actor_count > $DYOM_idx
            wait 0
            IF and 
               $DYOM_actor_gang[$DYOM_idx] == $gang
               NOT $DYOM_actor_spawnwith[$DYOM_idx] > $DYOM_current_objective
               $DYOM_actor_hidewith[$DYOM_idx] > $DYOM_current_objective
            THEN
              if 0118:  $DYOM_actor_handle[$DYOM_idx] dead 
              then
                if and 
                    NOT $DYOM_temp_markers[$DYOM_idx] == 0
                    not $DYOM_objective_markercolor[$DYOM_current_objective] == -1
                then
                   marker.Disable($DYOM_temp_markers[$DYOM_idx])
                   $DYOM_temp_markers[$DYOM_idx] = 0
                end
              else
                $living_enemies += 1
              end
            END 
            $DYOM_idx += 1
          END
      end
      IF AND
          $limit_on == 1
          NOT $mission_timer > 0
      THEN
          jump @DYOM_MISSION_FAIL         
      END
      
      IF 0118:   $DYOM_objective_handle[$DYOM_current_objective] dead 
      THEN  
        if NOT $objmarker == 0
        then
           marker.Disable($objmarker)
           $objmarker = 0
        end
 
        IF   $living_enemies == 0
        THEN
          $actorobj_passed = 1
        END  
      END
      if $bar_act > 0
      then
          if and 
            056D:   actor $bar_act defined 
            NOT actor.Dead($bar_act)
          then
               $bar_health = actor.Health($bar_act)
               $bar_health *= 100
               $bar_health /= $bar_full
               $bar_value = $bar_health
          else
               0151: remove_status_text $bar_value
               $bar_act = 0 
          end
      end
         
    UNTIL $actorobj_passed == 1
    01C2: remove_references_to_actor $DYOM_objective_handle[$DYOM_current_objective] 

    // clean objective
    if $actor_model_loaded == #SPECIAL01
    then
        0296: unload_special_actor 1 
    else
        0249: release_model $actor_model_loaded
    end
    model.Destroy($DYOM_Weapon_model[$DYOM_current_weapon])
  END 

  var 
     16@ :Integer
     17@ :Integer
  end
  //======================
  // CUTSCENE OBJECTIVE
  //======================
  IF $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_cutscene 
  THEN
    if $CS_ABORTED == 0   
    then 
        if NOT $DYOM_mission_car == -1
        then 
          $DYOM_mission_car = -1
          01C3: remove_references_to_car $DYOM_mission_car
        end  
        var
          27@: integer
        end
        17@ = $DYOM_objective_data[$DYOM_current_objective]
        if 08B4:   test $DYOM_objective_properties[$DYOM_current_objective] bit DYOM_cutscene_prop_slowmo 
        then
           015D: set_gamespeed 0.2
           17@ /= 5
        else
            015D: set_gamespeed 1.0
        end
        
        if 08B4:   test $DYOM_objective_properties[$DYOM_current_objective] bit DYOM_cutscene_prop_shake 
        then
           099C: set_cam_shake 5 time 99000.0 intensity 50.0
           //0003: shake_camera $DYOM_objective_data[$DYOM_current_objective]
        else
           099C: set_cam_shake 1 time 0.0 intensity 0.0
        end
        
        if 08B4: test $DYOM_objective_properties[$DYOM_current_objective] bit DYOM_cutscene_skip_wide 
        then
          02A3: enable_widescreen 0 
        else
          02A3: enable_widescreen 1 
        end

        16@ = $DYOM_objective_properties[$DYOM_current_objective]
        08C0: clear 16@ bit DYOM_cutscene_prop_shake  
        08C0: clear 16@ bit DYOM_cutscene_prop_slowmo  
        08C0: clear 16@ bit DYOM_cutscene_skip_fade  
        08C0: clear 16@ bit DYOM_cutscene_skip_wide  

        0663: - PRINTINT "CS_PROP" $DYOM_objective_properties[$DYOM_current_objective]
        0663: - PRINTINT "CAMMODE" 16@
        if 16@ == DYOM_cutscene_static
        then
            092F: lock_camera_target_point 0 
            0930: lock_camera_position 0 
            015F: set_camera_position $DYOM_objective_location_x[$DYOM_current_objective]  $DYOM_objective_location_y[$DYOM_current_objective]  $DYOM_objective_location_a[$DYOM_current_objective] rotation 0.0 0.0 0.0 
            0160: set_camera_point_at $DYOM_objective_model[$DYOM_current_objective] $DYOM_objective_markercolor[$DYOM_current_objective] $DYOM_objective_ammo[$DYOM_current_objective] mode 2 
        end

        if or
            16@ == DYOM_cutscene_linear
            16@ == DYOM_cutscene_smooth
        then
            0925: restore_camera_to_user_defined 
            092F: lock_camera_target_point 1 
            0930: lock_camera_position 1 
            27@ = 16@
            27@ -= 1 // calculate smoothness value
            068D:get_camera_position_3D_coord_to 28@ 29@ 30@ 
            0936:set_camera_position_3D_coord_to 28@ 29@ 30@ transverse_to $DYOM_objective_location_x[$DYOM_current_objective]  $DYOM_objective_location_y[$DYOM_current_objective]  $DYOM_objective_location_a[$DYOM_current_objective] timelimit $DYOM_objective_data[$DYOM_current_objective] drop_mode 27@ 
            068E:get_camera_target_point_3D_coord_to 28@ 29@ 30@ 
            0920:set_camera_target_point_3D_coord_to 28@ 29@ 30@ transverse_to $DYOM_objective_model[$DYOM_current_objective] $DYOM_objective_markercolor[$DYOM_current_objective] $DYOM_objective_ammo[$DYOM_current_objective] timelimit $DYOM_objective_data[$DYOM_current_objective] mode 27@ 
        end
        
        if 16@ >= DYOM_cutscene_actor
        then
            092F: lock_camera_target_point 0 
            0930: lock_camera_position 0 
            
            if 16@ < DYOM_cutscene_player
            then
                $idx = $DYOM_objective_animation[$DYOM_current_objective]
                //0663: - PRINTINT "POINTAT" $idx
                $CAM_target_ACTOR = $DYOM_actor_handle[$idx]
            else
                0084: $CAM_target_ACTOR = $PLAYER_ACTOR
            end
            if 056D:   actor $CAM_target_ACTOR defined 
            then
                if or
                   16@ == DYOM_cutscene_actor
                   16@ == DYOM_cutscene_player
                then        
                    if 056D:   actor $camman defined 
                    then
                        actor.PutAt($camman,$DYOM_objective_location_x[$DYOM_current_objective],  $DYOM_objective_location_y[$DYOM_current_objective],  $DYOM_objective_location_a[$DYOM_current_objective])
                    else
                        $camman = Actor.Create(DYOM_gang_neutral, #NULL, $DYOM_objective_location_x[$DYOM_current_objective],  $DYOM_objective_location_y[$DYOM_current_objective],  $DYOM_objective_location_a[$DYOM_current_objective])                 
                    end
                    
                    Actor.LockInCurrentPosition($camman) = True
                    0575: set_actor $camman pinned_position 1 
                    02AB: set_actor $camman immunities BP 1 FP 1 EP 1 CP 1 MP 1 
                    0619: enable_actor $camman collision_detection 0 
                    0337: set_actor $camman visibile 0 
                    
                    067E: set_camera_on_actor $camman offset 0.0 0.0 -1.0 point_to_actor $CAM_target_ACTOR tilt 0.0 mode 2
                end
                if or
                    16@ == DYOM_cutscene_actor_pov
                    16@ == DYOM_cutscene_player_pov
                then
                    067C: put_camera_on_actor $CAM_target_ACTOR offset 0.0 0.2 1.0 rotation 0.0 1.0 1.0 tilt 0.0 switchstyle 2
                    099C: jiggle_camera type 3 timelimit 1000000.0 intensity 1.0
                end
                if  or
                    16@ == DYOM_cutscene_actor_3rd
                    16@ == DYOM_cutscene_player_3rd
                then
                    067C: put_camera_on_actor $CAM_target_ACTOR offset 0.0 -4.0 1.0 rotation 0.0 0.0 0.5 tilt 0.0 switchstyle 2
                end
            end
        end 
        select_interior $DYOM_objective_interior[$DYOM_current_objective]
        0860: link_actor $PLAYER_ACTOR to_interior $DYOM_objective_interior[$DYOM_current_objective]
     
        04E4: unknown_refresh_game_renderer_at $DYOM_objective_location_x[$DYOM_current_objective]  $DYOM_objective_location_y[$DYOM_current_objective]
        03CB: set_rendering_origin_at $DYOM_objective_location_x[$DYOM_current_objective]  $DYOM_objective_location_y[$DYOM_current_objective]  $DYOM_objective_location_a[$DYOM_current_objective]
                                    
        32@ = 0
        repeat
          wait 0
          if 00E1:   player 0 pressed_key 16 
          then
            005C: 32@ += 17@
            $CS_ABORTED = 1

          end
        until 001F: 32@ > 17@
        
        if 08B4:   test $DYOM_objective_properties[$DYOM_current_objective] bit DYOM_cutscene_skip_fade 
        then
           $DYOM_faded = 1     // we trick the system that were already faded, to prevent a fade when starting a new objective
        end
    end
  END 
  
  //======================
  // TELEPORT OBJECTIVE
  //======================
  IF $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_teleport 
  THEN
    if NOT $DYOM_mission_car == -1
    then 
      $DYOM_mission_car = -1
      01C3: remove_references_to_car $DYOM_mission_car
    end  
     
    0089: 1@ = $DYOM_objective_location_z[$DYOM_current_objective]
    1@ += 1.0
    if 0449:   actor $PLAYER_ACTOR in_a_car 
    then
      0362: remove_actor $PLAYER_ACTOR from_car_and_place_at $DYOM_objective_location_x[$DYOM_current_objective]  $DYOM_objective_location_y[$DYOM_current_objective]  1@  
      07CC: set_player $PLAYER_CHAR can_enter_exit_vehicles 1 
    else
      09BC: put_actor $PLAYER_ACTOR at $DYOM_objective_location_x[$DYOM_current_objective]  $DYOM_objective_location_y[$DYOM_current_objective]  1@
    end
    0173: set_actor $PLAYER_ACTOR Z_angle_to $DYOM_objective_location_a[$DYOM_current_objective] 
    select_interior $DYOM_objective_interior[$DYOM_current_objective]
    0860: link_actor $PLAYER_ACTOR to_interior $DYOM_objective_interior[$DYOM_current_objective] 

    0373: set_camera_directly_behind_player 
    02EB: restore_camera_with_jumpcut 

    04E4: unknown_refresh_game_renderer_at $DYOM_objective_location_x[$DYOM_current_objective]  $DYOM_objective_location_y[$DYOM_current_objective]
    03CB: set_rendering_origin_at $DYOM_objective_location_x[$DYOM_current_objective]  $DYOM_objective_location_y[$DYOM_current_objective]  1@

    //$actor_model_req -> $actor_model_loaded
    $actor_model_loaded = -1
    $actor_model_req = $DYOM_objective_model[$DYOM_current_objective]
    $DYOM_current_weapon = $DYOM_objective_data[$DYOM_current_objective]  
    if $DYOM_current_weapon == 48
    then
      0209: $DYOM_current_weapon = random_int_in_ranges 1 43 
      if $DYOM_current_weapon > 18
      then
         $DYOM_current_weapon += 3 
      end
    end
    model.Load($DYOM_Weapon_model[$DYOM_current_weapon])                                                                                                              
    038B: load_requested_models                                                                                                                                  
      
    repeat
    wait 0 ms                                                                     
    until model.Available($DYOM_Weapon_model[$DYOM_current_weapon])                                                          
    repeat
      wait 20
    until not $actor_model_loaded == -1
    
    09C7: set_player $PLAYER_CHAR modelID_to $actor_model_loaded
    01B2: give_actor  $PLAYER_ACTOR weapon $DYOM_objective_data[$DYOM_current_objective] ammo $DYOM_objective_ammo[$DYOM_current_objective] 
     
    if $DYOM_objective_health[$DYOM_current_objective] > 100
    then
//      062A: change_float_stat 24 to 853.5
      062A: change_float_stat 24 to 1138.0
    else
      062A: change_float_stat 24 to 569.0
    end 
    0223: set_actor $PLAYER_ACTOR health_to $DYOM_objective_health[$DYOM_current_objective]
        
    player.CanMove($PLAYER_CHAR,true)

      
    $DYOM_faded = 1 // fade back after the next items have been spawned
  END 

  //======================
  // TELEPORT TO CAR OBJECTIVE
  //======================
  IF $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_telecar 
  THEN
    if NOT $DYOM_mission_car == -1
    then 
      $DYOM_mission_car = -1
      01C3: remove_references_to_car $DYOM_mission_car
    end  
     
    select_interior $DYOM_objective_interior[$DYOM_current_objective]
    0860: link_actor $PLAYER_ACTOR to_interior $DYOM_objective_interior[$DYOM_current_objective] 
    if $DYOM_objective_interior[$DYOM_current_objective] == 0
     then
      //0581: enable_radar 1
      //057E: set_radar_grey 0
    else
      //0581: enable_radar 0
      //057E: set_radar_grey 1
    end
     
    if 0449:   actor $PLAYER_ACTOR in_a_car 
    then
      0362: remove_actor $PLAYER_ACTOR from_car_and_place_at $DYOM_objective_location_x[$DYOM_current_objective]  $DYOM_objective_location_y[$DYOM_current_objective]  $DYOM_objective_location_z[$DYOM_current_objective]  
    end

    var
     $seat:integer
    end
    $seat = $DYOM_objective_ammo[$DYOM_current_objective]
    if $seat == 0
    then
        072A: put_actor $PLAYER_ACTOR into_car $DYOM_objective_handle[$DYOM_current_objective] driverseat 
    else
        $seat -= 1
        072B: set_actor $PLAYER_ACTOR  teleport_into_vehicle $DYOM_objective_handle[$DYOM_current_objective] passenger_seat $seat ;;VersionB
    end
    //0A2F: set_camera_first_person_view 1
    if 08B4: test $DYOM_objective_properties[$DYOM_current_objective] bit DYOM_carpropbit_driveby
    then
        0713: actor $PLAYER_ACTOR driveby_actor -1 car -1 point 0.0 0.0 0.0 radius 300.0 8 1 firing_rate 100 
        07CC: set_player $PLAYER_CHAR can_enter_exit_vehicles 0 
    else
        07CC: set_player $PLAYER_CHAR can_enter_exit_vehicles 1 
    end

    04E4: unknown_refresh_game_renderer_at $DYOM_objective_location_x[$DYOM_current_objective]  $DYOM_objective_location_y[$DYOM_current_objective]
    03CB: set_rendering_origin_at $DYOM_objective_location_x[$DYOM_current_objective]  $DYOM_objective_location_y[$DYOM_current_objective]  1@

    $DYOM_mission_car = $DYOM_objective_handle[$DYOM_current_objective]

    player.CanMove($PLAYER_CHAR,true)
    wait 0
      
    $DYOM_faded = 1 // fade back after the next items have been spawned
  END 

  //======================
  // TIMEOUT OBJECTIVE
  //======================
  IF $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_timeout 
  THEN
    if and
       $limit_on == 0
       $DYOM_objective_model[$DYOM_current_objective] == 1
    then
        if $timed_mission == 1
        then
            014F: stop_timer $mission_clock
        end             
        // start a new timer
        $mission_timer = $DYOM_objective_data[$DYOM_current_objective]
        03C3: set_timer_to $mission_timer type 1 GXT 'RTIME' // global_variable  // Time
        0890: enable_sound_when_timer $mission_timer reach 3 seconds // global_variable 
        0396: pause_timer 0                  
    end  
  
    32@ = 0
    repeat
      wait 0
      // MUSTLIVE CHECK
      $DYOM_idx = 0
      WHILE  $ML_actor_count > $DYOM_idx
        wait 0
        IF 0118:  $ML_actors[$DYOM_idx] dead 
        THEN
          jump @DYOM_MISSION_FAIL
        END 
        $DYOM_idx += 1
      END
      $DYOM_idx = 0
      WHILE  $ML_car_count > $DYOM_idx
        wait 0
        IF 0119:   car $ML_cars[$DYOM_idx] wrecked 
        THEN
          jump @DYOM_MISSION_FAIL
        END 
        $DYOM_idx += 1
      END
      gosub @AMB_RESTART
      if $bar_act > 0
      then
          if and 
            056D:   actor $bar_act defined 
            NOT actor.Dead($bar_act)
          then
               $bar_health = actor.Health($bar_act)
               $bar_health *= 100
               $bar_health /= $bar_full
               $bar_value = $bar_health
          else
               0151: remove_status_text $bar_value
               $bar_act = 0 
          end
      end
      
      IF AND
          $limit_on == 1
          NOT $mission_timer > 0
      THEN
          jump @DYOM_MISSION_FAIL         
      END    
    until 001F: 32@ > $DYOM_objective_data[$DYOM_current_objective]
    
    if and
       $limit_on == 0
       $DYOM_objective_model[$DYOM_current_objective] == 1
    then
        // stop timer on screen
        $mission_timer = 0
        014F: stop_timer $mission_timer
        // Switch to mission clock display ?
        if $timed_mission == 1
        then
            008a: $mission_clock = 33@
            03C3: set_timer_to $mission_clock type 0 GXT 'BB_19' // global_variable  // Time
            0396: pause_timer 0 
        end             
    end  

  END 
  
  //======================
  // WEATHER OBJECTIVE
  //======================
  IF $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_weather 
  THEN
     01B6: set_weather $DYOM_objective_data[$DYOM_current_objective]
  END
  
  //======================
  // WANTED OBJECTIVE
  //======================
  IF $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_wanted
  THEN
    010D: set_player $PLAYER_CHAR wanted_level_to $DYOM_objective_data[$DYOM_current_objective]
    01F0: set_max_wanted_level_to $DYOM_objective_model[$DYOM_current_objective] 
    010E: set_player $PLAYER_CHAR minimum_wanted_level_to $DYOM_objective_ammo[$DYOM_current_objective]      
  END

  //======================
  // COUNTDOWN OBJECTIVE
  //======================
  IF $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_countdown 
  THEN
    var
       30@:integer
    end
    Player.CanMove($PLAYER_CHAR, false)
    30@ = $DYOM_objective_data[$DYOM_current_objective]
    30@ /= 1000 
    32@ = 0
    while 30@ > 0
      01E3: show_text_1number_styled GXT 'NUMBER' number 30@ time 900 style 4  // NEW HIGH SCORE!!~n~~w~~1~
      097A: (unknown) 0.0 0.0 0.0 1056 
      repeat
        wait 0
        // MUSTLIVE CHECK
        $DYOM_idx = 0
        WHILE  $ML_actor_count > $DYOM_idx
          wait 0
          IF 0118:  $ML_actors[$DYOM_idx] dead 
          THEN
            jump @DYOM_MISSION_FAIL
          END 
          $DYOM_idx += 1
        END
        $DYOM_idx = 0
        WHILE  $ML_car_count > $DYOM_idx
          wait 0
          IF 0119:   car $ML_cars[$DYOM_idx] wrecked 
          THEN
            jump @DYOM_MISSION_FAIL
          END 
          $DYOM_idx += 1
        END
        gosub @AMB_RESTART
      if $bar_act > 0
      then
          if and 
            056D:   actor $bar_act defined 
            NOT actor.Dead($bar_act)
          then
               $bar_health = actor.Health($bar_act)
               $bar_health *= 100
               $bar_health /= $bar_full
               $bar_value = $bar_health
          else
               0151: remove_status_text $bar_value
               $bar_act = 0 
          end
      end
      
        IF AND
            $limit_on == 1
            NOT $mission_timer > 0
        THEN
            jump @DYOM_MISSION_FAIL               
        END      
      until 0019: 32@ > 1000
      32@ -= 1000
      30@ -= 1 
    end  
  00BA: text_styled 'GO' 900 ms 4  // GO!
  097A: (unknown) 0.0 0.0 0.0 1057 
  Player.CanMove($PLAYER_CHAR, true)
  END   
  
  //======================
  // SETTIME OBJECTIVE
  //======================
  IF $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_settime
  THEN
    00C0: set_current_time_hours_to $DYOM_objective_data[$DYOM_current_objective] minutes_to 0 
  END

  //======================
  // PEDS BEHAVIOUR OBJECTIVE
  //======================
  IF $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_peds
  THEN
    if $DYOM_objective_data[$DYOM_current_objective] == 0
    then
      06C8: enable_riot 0
      01EB: set_traffic_density_multiplier_to 1.0 
      03DE: set_pedestrians_density_multiplier_to 1.0 
    end
    
    if $DYOM_objective_data[$DYOM_current_objective] == 1
    then
      06C8: enable_riot 1
      03DE: set_pedestrians_density_multiplier_to 1.0 
      01EB: set_traffic_density_multiplier_to 1.0 
    end

    if $DYOM_objective_data[$DYOM_current_objective] == 2
    then
      06C8: enable_riot 0
      01EB: set_traffic_density_multiplier_to 0.0 
      03DE: set_pedestrians_density_multiplier_to 1.0 
      03BA: clear_cars_from_cube_cornerA -3000.0 -3000.0 -100.0 cornerB 3000.0 3000.0 2000.0
    end
    
    if $DYOM_objective_data[$DYOM_current_objective] == 3
    then
      06C8: enable_riot 0
      042B: clear_peds_from_cube_cornerA -3000.0 -3000.0 -100.0 cornerB 3000.0 3000.0 2000.0
      01EB: set_traffic_density_multiplier_to 1.0 
      03DE: set_pedestrians_density_multiplier_to 0.0 
    end
    
    if $DYOM_objective_data[$DYOM_current_objective] == 4
    then
      06C8: enable_riot 0
      03BA: clear_cars_from_cube_cornerA -3000.0 -3000.0 -100.0 cornerB 3000.0 3000.0 2000.0
      042B: clear_peds_from_cube_cornerA -3000.0 -3000.0 -100.0 cornerB 3000.0 3000.0 2000.0 
      01EB: set_traffic_density_multiplier_to 0.0 
      03DE: set_pedestrians_density_multiplier_to 0.0 

    end
  END

  //======================
  // TIMERON OBJECTIVE
  //======================
  IF $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_timeron
  THEN
    $timed_mission = 1
    33@ = 0
    008a: $mission_clock = 33@
    03C3: set_timer_to $mission_clock type 0 GXT 'BB_19' // global_variable  // Time
    0396: pause_timer 0 
  END
  
  //======================
  // NOWEAPON OBJECTIVE
  //======================
  IF $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_noweapon
  THEN
    048F: actor $PLAYER_ACTOR remove_weapons 
  END
  
  //======================
  // PHONE OBJECTIVE
  //======================
  IF $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_phone 
  THEN
    32@ = 0
    repeat
      wait 0
      // MUSTLIVE CHECK
      $DYOM_idx = 0
      WHILE  $ML_actor_count > $DYOM_idx
        wait 0
        IF 0118:  $ML_actors[$DYOM_idx] dead 
        THEN
          jump @DYOM_MISSION_FAIL
        END 
        $DYOM_idx += 1
      END
      $DYOM_idx = 0
      WHILE  $ML_car_count > $DYOM_idx
        wait 0
        IF 0119:   car $ML_cars[$DYOM_idx] wrecked 
        THEN
          jump @DYOM_MISSION_FAIL
        END 
        $DYOM_idx += 1
      END
      gosub @AMB_RESTART
      if $bar_act > 0
      then
          if and 
            056D:   actor $bar_act defined 
            NOT actor.Dead($bar_act)
          then
               $bar_health = actor.Health($bar_act)
               $bar_health *= 100
               $bar_health /= $bar_full
               $bar_value = $bar_health
          else
               0151: remove_status_text $bar_value
               $bar_act = 0 
          end
      end
      
      IF AND
          $limit_on == 1
          NOT $mission_timer > 0
      THEN
          jump @DYOM_MISSION_FAIL         
      END    
    until 001F: 32@ > $DYOM_objective_data[$DYOM_current_objective]
  END 
  //======================
  // OBJECT OBJECTIVE
  //======================
  IF $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_object 
  THEN
    if NOT $DYOM_mission_car == -1
    then 
      $DYOM_mission_car = -1
      01C3: remove_references_to_car $DYOM_mission_car
    end  
    
    $DYOM_objective_handle[$DYOM_current_objective] = object.init($DYOM_objective_model[$DYOM_current_objective],$DYOM_objective_location_x[$DYOM_current_objective],$DYOM_objective_location_y[$DYOM_current_objective],$DYOM_objective_location_z[$DYOM_current_objective])
    0453: set_object $DYOM_objective_handle[$DYOM_current_objective] XY_rotation $DYOM_objective_ammo[$DYOM_current_objective] $DYOM_objective_accuracy[$DYOM_current_objective] angle $DYOM_objective_location_a[$DYOM_current_objective] 
    0566: link_object $DYOM_objective_handle[$DYOM_current_objective] to_interior $DYOM_objective_interior[$DYOM_current_objective]
    07F7: set_object $DYOM_objective_handle[$DYOM_current_objective] destructible 1
      071F: set_object $DYOM_objective_handle[$DYOM_current_objective] health_to 1 
      0875: set_object $DYOM_objective_handle[$DYOM_current_objective] immune_to_nonplayer 1
    if not $DYOM_objective_markercolor[$DYOM_current_objective] == -1
    then
        0188: $objmarker = create_marker_above_object $DYOM_objective_handle[$DYOM_current_objective] 
        //marker.SetColor($objmarker,$DYOM_objective_markercolor[$DYOM_current_objective])
        if $DYOM_objective_markercolor[$DYOM_current_objective] == 2
        then
          07E0: set_marker $objmarker type_to 1 
        else
          marker.SetColor($objmarker,$DYOM_objective_markercolor[$DYOM_current_objective])
        end 
    end
    
    // OBJECTIVE LOOP
    REPEAT
      wait 0 ms
      // MUSTLIVE CHECK
      $DYOM_idx = 0
      WHILE  $ML_actor_count > $DYOM_idx
        wait 0
        IF 0118:  $ML_actors[$DYOM_idx] dead 
        THEN
          jump @DYOM_MISSION_FAIL
        END 
        $DYOM_idx += 1
      END
      $DYOM_idx = 0
      WHILE  $ML_car_count > $DYOM_idx
        wait 0
        IF 0119:   car $ML_cars[$DYOM_idx] wrecked 
        THEN
          jump @DYOM_MISSION_FAIL
        END 
        $DYOM_idx += 1
      END
      gosub @AMB_RESTART
      if $bar_act > 0
      then
          if and 
            056D:   actor $bar_act defined 
            NOT actor.Dead($bar_act)
          then
               $bar_health = actor.Health($bar_act)
               $bar_health *= 100
               $bar_health /= $bar_full
               $bar_value = $bar_health
          else
               0151: remove_status_text $bar_value
               $bar_act = 0 
          end
      end
      
      IF AND
          $limit_on == 1
          NOT $mission_timer > 0
      THEN
          jump @DYOM_MISSION_FAIL         
      END
      if and 
         $DYOM_objective_properties[$DYOM_current_objective] == 0    // touch
         0179:   actor $PLAYER_ACTOR colliding_with_object $DYOM_objective_handle[$DYOM_current_objective]
      then
        break
      end   
      if and 
         $DYOM_objective_properties[$DYOM_current_objective] == 1    // damage
         0366:   object $DYOM_objective_handle[$DYOM_current_objective]  damaged
      then
        break
      end   
      if and 
         $DYOM_objective_properties[$DYOM_current_objective] == 2    // photograph
        0833:   object $DYOM_objective_handle[$DYOM_current_objective]  photographed
      then
        break
      end   
      if and 
         $DYOM_objective_properties[$DYOM_current_objective] == 3    // shot ?
         08FF:   object $DYOM_objective_handle[$DYOM_current_objective] received_damage_type 57
      then
        break
      end   
         
    until false
     
    model.Destroy($DYOM_objective_model[$DYOM_current_objective])
    if not $DYOM_objective_markercolor[$DYOM_current_objective] == -1
    then
      marker.Disable($objmarker)
    end
  END 
  
  //======================
  // ADDMONEY OBJECTIVE
  //======================
  IF $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_addmoney
  THEN
    0109: player $PLAYER_CHAR money += $DYOM_objective_data[$DYOM_current_objective]
  END
  
  //======================
  // SUBMONEY OBJECTIVE
  //======================
  IF $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_submoney
  THEN
    $idx = $DYOM_objective_data[$DYOM_current_objective]
    $idx *= -1
    0109: player $PLAYER_CHAR money += $idx
  END

  //======================
  // ANIMATION OBJECTIVE
  //======================
  IF $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_animation 
  THEN
    if NOT $DYOM_mission_car == -1
    then 
      $DYOM_mission_car = -1
      01C3: remove_references_to_car $DYOM_mission_car
    end  
    $DYOM_player_anim      = $DYOM_objective_animation[$DYOM_current_objective]
    0084: $DYOM_player_anim_dist = $DYOM_objective_distance[$DYOM_current_objective]
  END 


  //======================
  // TIMELIMIT OBJECTIVE
  //======================
  IF $DYOM_objective_type[$DYOM_current_objective] == DYOM_objtype_timelimit
  THEN
    //--------------------
    // Evaluate TimeLimit for this objective
    //--------------------
    if not $DYOM_objective_data[$DYOM_current_objective] == 0
    then
      if $DYOM_objective_data[$DYOM_current_objective] == -1
      then
        // stop timelimit
        $mission_timer = 0
        014F: stop_timer $mission_timer
        $limit_on = 0 
        // Switch to mission clock display ?
        if $timed_mission == 1
        then
            008a: $mission_clock = 33@
            03C3: set_timer_to $mission_clock type 0 GXT 'BB_19' // global_variable  // Time
            0396: pause_timer 0 
        end             
      else
        if $DYOM_objective_data[$DYOM_current_objective] > 0
        then
          // set
          $mission_timer = $DYOM_objective_data[$DYOM_current_objective]
        else
          // Add  ( but negative amount, so substract :P )
          $mission_timer -= $DYOM_objective_data[$DYOM_current_objective]
        end
        if $limit_on == 0
        then
          if $timed_mission == 1
          then
            014F: stop_timer $mission_clock
          end             
           // start a new timer
          $limit_on = 1
          03C3: set_timer_to $mission_timer type 1 GXT 'RTIME' // global_variable  // Time
          0890: enable_sound_when_timer $253 reach 3 seconds // global_variable 
          0396: pause_timer 0            
        end 
      end    
    end
  END

  
    //--------------------
    // Evaluate TimeLimit for this objective
    //--------------------
    if not $DYOM_objective_timelimit[$DYOM_current_objective] == 0
    then
      if $DYOM_objective_timelimit[$DYOM_current_objective] == -1
      then
        // stop timelimit
        $mission_timer = 0
        014F: stop_timer $mission_timer
        $limit_on = 0 
        // Switch to mission clock display ?
        if $timed_mission == 1
        then
            008a: $mission_clock = 33@
            03C3: set_timer_to $mission_clock type 0 GXT 'BB_19' // global_variable  // Time
            0396: pause_timer 0 
        end             
      else
        if $DYOM_objective_timelimit[$DYOM_current_objective] > 0
        then
          // set
          $mission_timer = $DYOM_objective_timelimit[$DYOM_current_objective]
        else
          // Add  ( but negative amount, so substract :P )
          $mission_timer -= $DYOM_objective_timelimit[$DYOM_current_objective]
        end
        if $limit_on == 0
        then
          if $timed_mission == 1
          then
            014F: stop_timer $mission_clock
          end             
           // start a new timer
          $limit_on = 1
          03C3: set_timer_to $mission_timer type 1 GXT 'RTIME' // global_variable  // Time
          0890: enable_sound_when_timer $mission_timer reach 3 seconds // global_variable 
          0396: pause_timer 0            
        end 
      end    
    end
    
  gosub @SOUND_STOP



  //---------------------
  // SELECT NEXT OBJECTIVE
  //---------------------

  $DYOM_current_objective += 1
  $OBJTEXT += 100

end  

if $DYOM_faded == 1
then
  $DYOM_faded = 0
  fade 1 500
end

if $DYOM_in_cutscene == 1 
then
    016A: fade 0 time 500 
    wait 600 ms
    $DYOM_in_cutscene = 0
    02A3: enable_widescreen 0 
    select_interior 21@
    0860: link_actor $PLAYER_ACTOR to_interior 21@
    if 21@ == 0
    then
      //0581: enable_radar 1
      //057E: set_radar_grey 0
    else
      //0581: enable_radar 0
      //057E: set_radar_grey 1
    end
     
    player.CanMove($PLAYER_CHAR,true)
    0373: set_camera_directly_behind_player 
    02EB: restore_camera_with_jumpcut
    fade 1 500
end 


//======================
// MISSION PASSED
//======================

//-------------------------------------
:DYOM_MISSION_PASSED
// This subroutine is executed when the mission is passed. 
// Give the rewards, and make new missions available if needed.
//0575: set_actor $PLAYER_ACTOR pinned_position 0      //Initially player is pinned, to wait for objects spawns
if $DYOM_IN_INTRO == 0
then
    0396: pause_timer 1 
    if $timed_mission == 1
    then
      0085: 10@ = 33@
      0016: 10@ /= 1000  //seconds
      0085: 11@ = 10@
      0016: 11@ /= 60    // min
      0085: 12@ = 11@
      0012: 12@ *= 60    // min in seconds
      0062: 10@ -= 12@   // remaining seconds
      014F: stop_timer $mission_clock
      if 
         10 > 10@
      then
        036D: show_text_2numbers_styled GXT 'MPASST2' numbers 11@ 10@ time 5000 style 1 
      else
        036D: show_text_2numbers_styled GXT 'MPASST1' numbers 11@ 10@ time 5000 style 1 
      end
    else
        if $DYOM_IN_STORY == 0
        then
            01E3: show_text_1number_styled GXT 'M_PASSR' number 3 time 5000 style 1  // MISSION PASSED!~n~~w~RESPECT +
            0998: add_respect 3 
        end         
    end
    0394: play_music 1
end
$DYOM_MISSION_RESULT = 1
return

//-------------------------------------
:DYOM_MISSION_FAIL
// This subroutine is executed when the mission fails.
marker.Disable($objmarker)
marker.Disable($nextmarker)
$DYOM_MISSION_RESULT = 0

03BD: destroy_sphere $lastmarker

//0575: set_actor $PLAYER_ACTOR pinned_position 0      //Initially player is pinned, to wait for objects spawns
if $DYOM_IN_INTRO == 0
then
    00BA: show_text_styled GXT 'M_FAIL' time 5000 style 1  // ~r~MISSION FAILED!
end
return 

//-------------------------------------
:DYOM_MISSION_CLEANUP
// This subroutine is always executed at the end of the mission, regardless the outcome.
// This is the place to unload models etc. 
if $limit_on == 1
then
    014F: stop_timer $mission_timer
else
  if or
    08B4:   test $DYOM_properties bit DYOM_propbit_timed
    $timed_mission == 1 
  then
    014F: stop_timer $mission_clock
  end
end

if $bar_act > 0
then
    0151: remove_status_text $bar_value
end

if $DYOM_on_phone == 1
then
    0729: AS_actor $PLAYER_ACTOR hold_cellphone 0 
    $DYOM_on_phone = 0 
end   

if NOT $DYOM_mission_car == -1
then 
  01C3: remove_references_to_car $DYOM_mission_car
  $DYOM_mission_car = -1
end  

if 056D:   actor $camman defined 
then
  Actor.DestroyInstantly($camman)
end

//0575: set_actor $PLAYER_ACTOR pinned_position 0      //Initially player is pinned, to wait for objects spawns
Player.ClearWantedLevel($PLAYER_CHAR)
07CC: set_player $PLAYER_CHAR can_enter_exit_vehicles 1 

gosub @SOUND_STOP
gosub @AMB_STOP


062A: change_float_stat 24 to 569.0
if $DYOM_IN_STORY == 0
then
  01F0: set_max_wanted_level_to 0
end   
092F: lock_camera_target_point 0 
0930: lock_camera_position 0 
0632: release_group $PLAYER_GROUP 

$ONMISSION = 0 


mission_cleanup 
return 


//=====================================
//-------------------------------------
//-------------Mission 2---------------
//-------------------------------------
//=====================================
// Mission wrapper
:INTTOOL_MISSION
thread 'INTTOOL' 
gosub @INTTOOL_MISSION_MAIN 
if wasted_or_busted 
then 
  gosub @INTTOOL_MISSION_FAIL 
end
gosub @INTTOOL_MISSION_CLEANUP 
end_thread 

:INTTOOL_MISSION_MAIN
//===============================
// Interior Jump Tool
//===============================
0512: show_permanent_text_box 'INTHLP'  // If your health reaches zero, you will pass out and you will be treated at the local medical center.  
player.CanMove($PLAYER_CHAR,true)      

$previous_interior = -1

00A0: store_actor $PLAYER_ACTOR position_to 1@ 2@ 3@
077E: get_active_interior_to 4@
 
while 80E1:   not player 0 pressed_key 16 
  if 0AB0:  key_pressed 0x0D
  then
    break  // Accept enter as alternative for 'space' to end the loop
  end  
  wait 0 ms
  
  if
  00E1:   player 0 pressed_key 15    
  then  
    goto @INTTOOL_MISSION_FAIL
    return
  end
  
  if
  00E1:   player 0 pressed_key 11    // Y
  then
     repeat
         wait 0
     until 80E1:   not player 0 pressed_key 11 
     $y_pressed = 1
     0008: $interior_selected += 1
     0008: $interior_number += 1
  end
  
  if
  00E1:   player 0 pressed_key 10    // N
  then
     repeat
         wait 0
     until 80E1:   not player 0 pressed_key 10 
     $y_pressed = 0
     0008: $interior_selected += -1
     0008: $interior_number += -1
  end

  if
  00E1:   player 0 pressed_key 8     // G 
  then
     repeat
         wait 0
     until 80E1:   not player 0 pressed_key 8 
     0008: $interior_selected += 10
     0008: $interior_number += 10
  end
  
  if
  00E1:   player 0 pressed_key 9     // H
  then
     repeat
         wait 0
     until 80E1:   not player 0 pressed_key 9 
     0008: $interior_selected += -10
     0008: $interior_number += -10
  end
  
  if 0018:   $interior_selected > 153
  then
      $interior_selected = 0
      $interior_number = 0
  end
  
  if 001A:   0 > $interior_selected
  then
      $interior_selected = 153
      $interior_number = 153        
  end
    
  if not $interior_selected == $previous_interior // (int) 
  then
        :interior_list
        wait 0
        if and
        0018:   $interior_selected > -1 
        001A:   11 > $interior_selected
        then
            jump @interior_tien
        end
        
        if and
        0018:   $interior_selected > 10 
        001A:   21 > $interior_selected
        then
            jump @interior_twintig
        end
        
        if and
        0018:   $interior_selected > 20 
        001A:   31 > $interior_selected
        then
            jump @interior_dertig
        end
        
        if and
        0018:   $interior_selected > 30 
        001A:   41 > $interior_selected
        then
            jump @interior_veertig
        end
        
        if and
        0018:   $interior_selected > 40 
        001A:   51 > $interior_selected
        then
            jump @interior_vijftig
        end
        
        if and
        0018:   $interior_selected > 50 
        001A:   61 > $interior_selected
        then
            jump @interior_zestig
        end
        
        if and
        0018:   $interior_selected > 60 
        001A:   71 > $interior_selected
        then
            jump @interior_zeventig
        end
        
        if and
        0018:   $interior_selected > 70 
        001A:   81 > $interior_selected
        then
            jump @interior_tachtig
        end
        
        if and
        0018:   $interior_selected > 80 
        001A:   91 > $interior_selected
        then
            jump @interior_negentig
        end
        
        if and
        0018:   $interior_selected > 90 
        001A:   101 > $interior_selected
        then
            jump @interior_honderd
        end
        
        if and
        0018:   $interior_selected > 100 
        001A:   111 > $interior_selected
        then
            jump @interior_honderdtien
        end
        
        if and
        0018:   $interior_selected > 110 
        001A:   121 > $interior_selected
        then
            jump @interior_honderdtwintig
        end
        
        if and
        0018:   $interior_selected > 120 
        001A:   131 > $interior_selected
        then
            jump @interior_honderddertig
        end
        
        if and
        0018:   $interior_selected > 130 
        001A:   141 > $interior_selected
        then
            jump @interior_honderdveertig
        end
        
        if 0018:   $interior_selected > 140 
        then
            jump @interior_honderdvijftig
        end
        
        jump @INTTOOL_MISSION_FAIL
        
        
        :interior_tien
        if
        0038: $interior_selected == 0 // "8TRACK" 
        then
        $interiorcoord_x = -1266.59 
        $interiorcoord_y = -216.34 
        $interiorcoord_z = 1055.58 
        $interior_id = 7 
        end
        
        
        if
        0038: $interior_selected == 1 // "ABATOIR" 
        then
        $interiorcoord_x = 964.38 
        $interiorcoord_y = 2157.33 
        $interiorcoord_z = 1010.02 
        $interior_id = 1 
        end
        
        
        if
        0038: $interior_selected == 2 // "AMMUN1" 
        then
        $interiorcoord_x = 286.15 
        $interiorcoord_y = -40.64 
        $interiorcoord_z = 1000.57 
        $interior_id = 1 
        end
        
        
        if
        0038: $interior_selected == 3 // "AMMUN2" 
        then
        $interiorcoord_x = 285.849 
        $interiorcoord_y = -81.7867 
        $interiorcoord_z = 1001.5156  
        $interior_id = 4 
        end
        
        
        if
        0038: $interior_selected == 4 // "AMMUN3" 
        then
        $interiorcoord_x = 294.3226  
        $interiorcoord_y = -109.3972 
        $interiorcoord_z = 1001.5156  
        $interior_id = 6 
        end
        
        
        if
        0038: $interior_selected == 5 // "AMMUN4" 
        then
        $interiorcoord_x = 313.1814 
        $interiorcoord_y = -141.3382 
        $interiorcoord_z = 999.6016 
        $interior_id = 7 
        end
        
        
        if
        0038: $interior_selected == 6 // "AMMUN5" 
        then
        $interiorcoord_x = 316.5298 
        $interiorcoord_y = -165.9228  
        $interiorcoord_z = 999.601  
        $interior_id = 6 
        end
        
        
        if
        0038: $interior_selected == 7 // "ATRIUME" 
        then
        $interiorcoord_x = 1726.18 
        $interiorcoord_y = -1641.01 
        $interiorcoord_z = 19.27 
        $interior_id = 18 
        end
        
        
        if
        0038: $interior_selected == 8 // "ATRIUMX" 
        then
        $interiorcoord_x = 1703.75 
        $interiorcoord_y = -1668.48 
        $interiorcoord_z = 19.22 
        $interior_id = 18 
        end
        
        
        if
        0038: $interior_selected == 9 // "BAR1" 
        then
        $interiorcoord_x = 493.39 
        $interiorcoord_y = -22.72 
        $interiorcoord_z = 999.69 
        $interior_id = 17 
        end
        
        
        if
        0038: $interior_selected == 10 // "BAR2" 
        then
        $interiorcoord_x = 501.98 
        $interiorcoord_y = -69.15 
        $interiorcoord_z = 997.84 
        $interior_id = 11 
        end
        
        jump @change_interior
        
        :interior_twintig
        if
        0038: $interior_selected == 11 // "BARBER2" 
        then
        $interiorcoord_x = 418.65 
        $interiorcoord_y = -82.64 
        $interiorcoord_z = 1000.96 
        $interior_id = 3 
        end
        
        
        if
        0038: $interior_selected == 12 // "BARBER3" 
        then
        $interiorcoord_x = 412.02 
        $interiorcoord_y = -52.65 
        $interiorcoord_z = 1000.96 
        $interior_id = 12 
        end
        
        
        if
        0038: $interior_selected == 13 // "BARBERS" 
        then
        $interiorcoord_x = 411.63 
        $interiorcoord_y = -21.43 
        $interiorcoord_z = 1000.8 
        $interior_id = 2 
        end
        
        
        if
        0038: $interior_selected == 14 // "BDUPS" 
        then
        $interiorcoord_x = 1527.23 
        $interiorcoord_y = -11.57 
        $interiorcoord_z = 1001.27 
        $interior_id = 3 
        end
        
        
        if
        0038: $interior_selected == 15 // "BDUPS1" 
        then
        $interiorcoord_x = 1523.51 
        $interiorcoord_y = -47.82 
        $interiorcoord_z = 1001.27 
        $interior_id = 2 
        end
        
        
        if
        0038: $interior_selected == 16 // "BIKESCH" 
        then
        $interiorcoord_x = 1494.43 
        $interiorcoord_y = 1305.63 
        $interiorcoord_z = 1092.29 
        $interior_id = 3 
        end
        
        
        if
        0038: $interior_selected == 17 // "BROTHEL" 
        then
        $interiorcoord_x = 744.54 
        $interiorcoord_y = 1437.67 
        $interiorcoord_z = 1101.74 
        $interior_id = 6 
        end
        
        
        if
        0038: $interior_selected == 18 // "BROTHL1" 
        then
        $interiorcoord_x = 940.92 
        $interiorcoord_y = -17.01 
        $interiorcoord_z = 1000.18 
        $interior_id = 3 
        end
        
        
        if
        0038: $interior_selected == 19 // "BROTHL2" 
        then
        $interiorcoord_x = 964.11 
        $interiorcoord_y = -53.21 
        $interiorcoord_z = 1000.18 
        $interior_id = 3 
        end
        
        
        if
        0038: $interior_selected == 20 // "BURHOUS" 
        then
        $interiorcoord_x = 2807.62 
        $interiorcoord_y = -1171.9 
        $interiorcoord_z = 1024.58 
        $interior_id = 8 
        end
        
        jump @change_interior
        
        :interior_dertig
        if
        0038: $interior_selected == 21 // "CARLS" 
        then
        $interiorcoord_x = 2496.05  
        $interiorcoord_y = -1696.009 
        $interiorcoord_z = 1014.7422 
        $interior_id = 3 
        end
        
        
        if
        0038: $interior_selected == 22 // "CARMOD1" 
        then
          if
          0038:   $y_pressed == 1 
          then
          0008: $interior_selected += 1
          end
          
          if
          0038:   $y_pressed == 0
          then
          0008: $interior_selected += -1
          end 
        jump @interior_list
        end
        
        
        if
        0038: $interior_selected == 23 // "CARMOD2" 
        then                                              
          if
          0038:   $y_pressed == 1 
          then
          0008: $interior_selected += 1
          end
          
          if
          0038:   $y_pressed == 0
          then
          0008: $interior_selected += -1
          end 
        jump @interior_list
        end
        
        
        if
        0038: $interior_selected == 24 // "CARMOD3" 
        then
          if
          0038:   $y_pressed == 1 
          then
          0008: $interior_selected += 1
          end
          
          if
          0038:   $y_pressed == 0
          then
          0008: $interior_selected += -1
          end 
        jump @interior_list
        end
        
        
        if
        0038: $interior_selected == 25 // "CARTER" 
        then
        $interiorcoord_x = 2543.66 
        $interiorcoord_y = -1303.63 
        $interiorcoord_z = 1024.07 
        $interior_id = 2 
        end
        
        
        if
        0038: $interior_selected == 26 // "CASINO2" 
        then
        $interiorcoord_x = 1133.07 
        $interiorcoord_y = -9.57 
        $interiorcoord_z = 999.75 
        $interior_id = 12 
        end
        
        
        if
        0038: $interior_selected == 27 // "CHANGER" 
        then
        $interiorcoord_x = 2364.94 
        $interiorcoord_y = -1127.46 
        $interiorcoord_z = 1049.91 
        $interior_id = 8 
        end
        
        
        if
        0038: $interior_selected == 28 // "CHANGER" 
        then
        $interiorcoord_x = 2193.97 
        $interiorcoord_y = -1210.64 
        $interiorcoord_z = 1047.8 
        $interior_id = 6 
        end
        
        
        if
        0038: $interior_selected == 29 // "CHANGER" 
        then
        $interiorcoord_x = 255.14 
        $interiorcoord_y = -41.53 
        $interiorcoord_z = 1001.07 
        $interior_id = 14 
        end
        
        
        if
        0038: $interior_selected == 30 // "CHANGER" 
        then
        $interiorcoord_x = 2317.31 
        $interiorcoord_y = -1010.77 
        $interiorcoord_z = 1053.72 
        $interior_id = 9 
        end
        
        jump @change_interior
        
        :interior_veertig
        if
        0038: $interior_selected == 31 // "CHANGER" 
        then
        $interiorcoord_x = 2285.34 
        $interiorcoord_y = -1137.63 
        $interiorcoord_z = 1049.93 
        $interior_id = 11 
        end
        
        
        if
        0038: $interior_selected == 32 // "CHANGER" 
        then
        $interiorcoord_x = 2262.7769  
        $interiorcoord_y = -1137.9312 
        $interiorcoord_z = 1050.6328 
        $interior_id = 10 
        end
        
        
        if
        0038: $interior_selected == 33 // "CHANGER" 
        then
        $interiorcoord_x = 2257.3521 
        $interiorcoord_y = -1212.0303 
        $interiorcoord_z = 1049.0234 
        $interior_id = 10 
        end
        
        
        if
        0038: $interior_selected == 34 // "CHANGER" 
        then
        $interiorcoord_x = 2492.39 
        $interiorcoord_y = -1707.66 
        $interiorcoord_z = 1017.35 
        $interior_id = 3 
        end
        
        
        if
        0038: $interior_selected == 35 // "CHANGER" 
        then
        $interiorcoord_x = 2333.8 
        $interiorcoord_y = -1073.6 
        $interiorcoord_z = 1048.05 
        $interior_id = 6 
        end
        
        
        if
        0038: $interior_selected == 36 // "CHANGER" 
        then
        $interiorcoord_x = 2332.68 
        $interiorcoord_y = -1142.33 
        $interiorcoord_z = 1053.32 
        $interior_id = 12 
        end
        
        
        if
        0038: $interior_selected == 37 // "CHANGER" 
        then
        $interiorcoord_x = 2319.48 
        $interiorcoord_y = -1210.72 
        $interiorcoord_z = 1048.07 
        $interior_id = 6 
        end
        
        
        if
        0038: $interior_selected == 38 // "CHANGER" 
        then
        $interiorcoord_x = 2252.354  
        $interiorcoord_y = -1139.9025 
        $interiorcoord_z = 1050.6328 
        $interior_id = 9 
        end
        
        
        if
        0038: $interior_selected == 39 // "CHANGER" 
        then
        $interiorcoord_x = 2237.5681 
        $interiorcoord_y = -1072.1497 
        $interiorcoord_z = 1049.0234  
        $interior_id = 2 
        end
        
        
        if
        0038: $interior_selected == 40 // "CHANGER" 
        then
        $interiorcoord_x = 2232.65 
        $interiorcoord_y = -1112.23 
        $interiorcoord_z = 1049.88 
        $interior_id = 5 
        end
        
        jump @change_interior
        
        :interior_vijftig
        if
        0038: $interior_selected == 41 // "CHANGER" 
        then
        $interiorcoord_x = 2215.88 
        $interiorcoord_y = -1075.59 
        $interiorcoord_z = 1049.51 
        $interior_id = 1 
        end
        
        
        if
        0038: $interior_selected == 42 // "CLOTHGP" 
        then
        $interiorcoord_x = 161.2649 
        $interiorcoord_y = -90.9918 
        $interiorcoord_z = 1001.8047 
        $interior_id = 18 
        end
        
        
        if
        0038: $interior_selected == 43 // "CSCHP" 
        then
        $interiorcoord_x = 207.74 
        $interiorcoord_y = -109.02 
        $interiorcoord_z = 1004.27 
        $interior_id = 15 
        end
        
        
        if
        0038: $interior_selected == 44 // "CSDESGN" 
        then
        $interiorcoord_x = 226.29 
        $interiorcoord_y = -7.43 
        $interiorcoord_z = 1001.26 
        $interior_id = 5 
        end
        
        
        if
        0038: $interior_selected == 45 // "CSEXL" 
        then
        $interiorcoord_x = 204.33 
        $interiorcoord_y = -166.7 
        $interiorcoord_z = 999.58 
        $interior_id = 14 
        end
        
        
        if
        0038: $interior_selected == 46 // "CSSPRT" 
        then
        $interiorcoord_x = 207.06 
        $interiorcoord_y = -138.81 
        $interiorcoord_z = 1002.52 
        $interior_id = 3 
        end
        
        
        if
        0038: $interior_selected == 47 // "DINER1" 
        then
        $interiorcoord_x = 460.1 
        $interiorcoord_y = -88.43 
        $interiorcoord_z = 998.62 
        $interior_id = 4 
        end
        
        
        if
        0038: $interior_selected == 48 // "DINER2" 
        then
          if
          0038:   $y_pressed == 1 
          then
          0008: $interior_selected += 1
          end
          
          if
          0038:   $y_pressed == 0
          then
          0008: $interior_selected += -1
          end 
        jump @interior_list
        end
        
        if
        0038: $interior_selected == 49 // "DIRBIKE" 
        then
        $interiorcoord_x = -1320.94 
        $interiorcoord_y = -602.38 
        $interiorcoord_z = 1062.63 
        $interior_id = 4 
        end
        
        
        if
        0038: $interior_selected == 50 // "DRIVES" 
        then
        $interiorcoord_x = -2029.72 
        $interiorcoord_y = -118.07 
        $interiorcoord_z = 1034.17 
        $interior_id = 3 
        end
        
        jump @change_interior
        
        :interior_zestig
        if
        0038: $interior_selected == 51 // "DRIVES" 
        then
        $interiorcoord_x = -2029.72 
        $interiorcoord_y = -122.41 
        $interiorcoord_z = 34.17 
        $interior_id = 0 
        end
        
        
        if
        0038: $interior_selected == 52 // "DRIVES2" 
        then
          if
          0038:   $y_pressed == 1 
          then
          0008: $interior_selected += 1
          end
          
          if
          0038:   $y_pressed == 0
          then
          0008: $interior_selected += -1
          end 
        jump @interior_list
        end
        
        
        if
        0038: $interior_selected == 53 // "DRIVES2" 
        then
        $interiorcoord_x = -2027.92 
        $interiorcoord_y = -105.18 
        $interiorcoord_z = 1034.27 
        $interior_id = 3 
        end
        
        
        if
        0038: $interior_selected == 54 // "FDBURG" 
        then
        $interiorcoord_x = 364.892 
        $interiorcoord_y = -73.1152 
        $interiorcoord_z = 1001.5078  
        $interior_id = 10 
        end
        
        
        if
        0038: $interior_selected == 55 // "FDCHICK" 
        then
        $interiorcoord_x = 365.67 
        $interiorcoord_y = -10.71 
        $interiorcoord_z = 1000.87 
        $interior_id = 9 
        end
        
        
        if
        0038: $interior_selected == 56 // "FDDONUT" 
        then
        $interiorcoord_x = 377.1 
        $interiorcoord_y = -192.44 
        $interiorcoord_z = 999.64 
        $interior_id = 17 
        end
        
        
        if
        0038: $interior_selected == 57 // "FDPIZA" 
        then
        $interiorcoord_x = 372.35 
        $interiorcoord_y = -131.65 
        $interiorcoord_z = 1000.45 
        $interior_id = 5 
        end
        
        
        if
        0038: $interior_selected == 58 // "FDREST1" 
        then
        $interiorcoord_x = 452.49 
        $interiorcoord_y = -18.18 
        $interiorcoord_z = 1000.18 
        $interior_id = 1 
        end
        
        
        if
        0038: $interior_selected == 59 // "GANG" 
        then
        $interiorcoord_x = 2350.34 
        $interiorcoord_y = -1181.65 
        $interiorcoord_z = 1027.0 
        $interior_id = 5 
        end
        
        
        if
        0038: $interior_selected == 60 // "GENOTB" 
        then
        $interiorcoord_x = 833.82 
        $interiorcoord_y = 7.42 
        $interiorcoord_z = 1003.18 
        $interior_id = 3 
        end
        
        jump @change_interior
        
        :interior_zeventig
        if
        0038: $interior_selected == 61 // "GENWRHS" 
        then
        $interiorcoord_x = 1302.52 
        $interiorcoord_y = -1.79 
        $interiorcoord_z = 999.93 
        $interior_id = 18 
        end
        
        
        if
        0038: $interior_selected == 62 // "GF1" 
        then
        $interiorcoord_x = 244.41 
        $interiorcoord_y = 305.03 
        $interiorcoord_z = 998.23 
        $interior_id = 1 
        end
        
        
        if
        0038: $interior_selected == 63 // "GF2" 
        then
        $interiorcoord_x = 271.89 
        $interiorcoord_y = 306.63 
        $interiorcoord_z = 998.33 
        $interior_id = 2 
        end
        
        
        if
        0038: $interior_selected == 64 // "GF3" 
        then
        $interiorcoord_x = 291.28 
        $interiorcoord_y = 310.03 
        $interiorcoord_z = 998.16 
        $interior_id = 3 
        end
        
        
        if
        0038: $interior_selected == 65 // "GF4" 
        then
        $interiorcoord_x = 302.18 
        $interiorcoord_y = 300.72 
        $interiorcoord_z = 998.23 
        $interior_id = 4 
        end
        
        
        if
        0038: $interior_selected == 66 // "GF5" 
        then
        $interiorcoord_x = 322.2 
        $interiorcoord_y = 302.5 
        $interiorcoord_z = 998.23 
        $interior_id = 5 
        end
        
        
        if
        0038: $interior_selected == 67 // "GF6" 
        then
        $interiorcoord_x = 344.92 
        $interiorcoord_y = 305.03 
        $interiorcoord_z = 998.23 
        $interior_id = 6 
        end
        
        
        if
        0038: $interior_selected == 68 // "GYM1" 
        then
        $interiorcoord_x = 772.11 
        $interiorcoord_y = -3.9 
        $interiorcoord_z = 999.69 
        $interior_id = 5 
        end
        
        
        if
        0038: $interior_selected == 69 // "GYM2" 
        then
        $interiorcoord_x = 774.21 
        $interiorcoord_y = -48.92 
        $interiorcoord_z = 999.69 
        $interior_id = 6 
        end
        
        
        if
        0038: $interior_selected == 70 // "GYM3" 
        then
        $interiorcoord_x = 773.58 
        $interiorcoord_y = -77.1 
        $interiorcoord_z = 999.69 
        $interior_id = 7 
        end
        
        jump @change_interior
        
        :interior_tachtig
        if
        0038: $interior_selected == 71 // "JETINT" 
        then
        $interiorcoord_x = 2.38 
        $interiorcoord_y = 33.1 
        $interiorcoord_z = 1198.85 
        $interior_id = 1 
        end
        
        
        if
        0038: $interior_selected == 72 // "JUMP1" 
        then
        $interiorcoord_x = 2265.79 
        $interiorcoord_y = 1619.58 
        $interiorcoord_z = 1089.5 
        $interior_id = 1 
        end
        
        
        if
        0038: $interior_selected == 73 // "JUMP2" 
        then
        $interiorcoord_x = 2265.78 
        $interiorcoord_y = 1675.93 
        $interiorcoord_z = 1089.5 
        $interior_id = 1 
        end
        
        
        if
        0038: $interior_selected == 74 // "LACRAK" 
        then
        $interiorcoord_x = 318.57 
        $interiorcoord_y = 1118.21 
        $interiorcoord_z = 1082.98 
        $interior_id = 5 
        end
        
        
        if
        0038: $interior_selected == 75 // "LACS1" 
        then
        $interiorcoord_x = 203.78 
        $interiorcoord_y = -48.49 
        $interiorcoord_z = 1000.8 
        $interior_id = 1 
        end
        
        
        if
        0038: $interior_selected == 76 // "LAHS1A" 
        then
        $interiorcoord_x = 225.76 
        $interiorcoord_y = 1240.0 
        $interiorcoord_z = 1081.15 
        $interior_id = 2 
        end
        
        
        if
        0038: $interior_selected == 77 // "LAHS1B" 
        then
        $interiorcoord_x = 223.04 
        $interiorcoord_y = 1289.26 
        $interiorcoord_z = 1081.2 
        $interior_id = 1 
        end
        
        
        if
        0038: $interior_selected == 78 // "LAHS2A" 
        then       
        $interiorcoord_x = 260.98 
        $interiorcoord_y = 1286.55 
        $interiorcoord_z = 1079.3 
        $interior_id = 4 
        end
        
        
        if
        0038: $interior_selected == 79 // "LAHS2B" 
        then
        $interiorcoord_x = 260.94 
        $interiorcoord_y = 1238.51 
        $interiorcoord_z = 1083.26 
        $interior_id = 9 
        end
        
        
        if
        0038: $interior_selected == 80 // "LAHSB1" 
        then
        $interiorcoord_x = 234.05 
        $interiorcoord_y = 1064.88 
        $interiorcoord_z = 1083.31 
        $interior_id = 6 
        end
        
        jump @change_interior
        
        :interior_negentig
        if
        0038: $interior_selected == 81 // "LAHSB2" 
        then
        //$interiorcoord_x = 225.63 
        //$interiorcoord_y = 1022.48 
        //$interiorcoord_z = 1083.07 
        //$interior_id = 7 
        if
          0038:   $y_pressed == 1 
          then
          0008: $interior_selected += 1
          end
          
          if
          0038:   $y_pressed == 0
          then
          0008: $interior_selected += -1
          end 
        jump @interior_list
        end
        
        
        if
        0038: $interior_selected == 82 // "LAHSB3" 
        then
        //$interiorcoord_x = 227.72 
        //$interiorcoord_y = 1114.39 
        //$interiorcoord_z = 1080.19 
        //$interior_id = 5 
        if
          0038:   $y_pressed == 1 
          then
          0008: $interior_selected += 1
          end
          
          if
          0038:   $y_pressed == 0
          then
          0008: $interior_selected += -1
          end 
        jump @interior_list
        end
        
        
        if
        0038: $interior_selected == 83 // "LAHSB4" 
        then
        //  $interiorcoord_x = 235.11    
        //  $interiorcoord_y = 1189.77     
        //  $interiorcoord_z = 1079.34      
        //  $interior_id = 3 
          if
          0038:   $y_pressed == 1 
          then
          0008: $interior_selected += 1
          end
          
          if
          0038:   $y_pressed == 0
          then
          0008: $interior_selected += -1
          end 
        jump @interior_list
        end
        
        
        if
        0038: $interior_selected == 84 // "LAHSS6" 
        then
        //$interiorcoord_x = 221.67 
        //$interiorcoord_y = 1143.39 
        //$interiorcoord_z = 1081.68 
        //$interior_id = 4 
          if
          0038:   $y_pressed == 1 
          then
          0008: $interior_selected += 1
          end
          
          if
          0038:   $y_pressed == 0
          then
          0008: $interior_selected += -1
          end 
        jump @interior_list
        end
        
        
        if
        0038: $interior_selected == 85 // "LASTRIP" 
        then
        $interiorcoord_x = 1205.4501 
        $interiorcoord_y = -5.2255 
        $interiorcoord_z = 1000.9219  
        $interior_id = 2 
        end
        
        
        if
        0038: $interior_selected == 86 // "MADDOGS" 
        then
        $interiorcoord_x = 1263.08 
        $interiorcoord_y = -785.31 
        $interiorcoord_z = 1090.96 
        $interior_id = 5 
        end
        
        
        if
        0038: $interior_selected == 87 // "MAFCAS" 
        then
        $interiorcoord_x = 2233.91 
        $interiorcoord_y = 1710.73 
        $interiorcoord_z = 1010.18 
        $interior_id = 1 
        end
        
        
        if
        0038: $interior_selected == 88 // "MAFCAS2" 
        then
        $interiorcoord_x = 2268.74 
        $interiorcoord_y = 1647.52 
        $interiorcoord_z = 1083.23 
        $interior_id = 1 
        end
        
        
        if
        0038: $interior_selected == 89 // "MAFCAS2" 
        then
        $interiorcoord_x = 2138.61 
        $interiorcoord_y = 1599.54 
        $interiorcoord_z = 1007.41 
        $interior_id = 1 
        end
        
        
        if
        0038: $interior_selected == 90 // "MDDOGS" 
        then
        $interiorcoord_x = 1299.08 
        $interiorcoord_y = -795.23 
        $interiorcoord_z = 1083.03 
        $interior_id = 5 
        end
        
        jump @change_interior
        
        :interior_honderd
        if
        0038: $interior_selected == 91 // "MOROOM" 
        then
        $interiorcoord_x = 446.62 
        $interiorcoord_y = 509.32 
        $interiorcoord_z = 1000.42 
        $interior_id = 12 
        end
        
        
        if
        0038: $interior_selected == 92 // "MOTEL1" 
        then
        $interiorcoord_x = 2216.34 
        $interiorcoord_y = -1150.51 
        $interiorcoord_z = 1024.8 
        $interior_id = 15 
        end
        
        
        if
        0038: $interior_selected == 93 // "OFTEST" 
        then
          if
          0038:   $y_pressed == 1 
          then
          0008: $interior_selected += 1
          end
          
          if
          0038:   $y_pressed == 0
          then
          0008: $interior_selected += -1
          end 
        jump @interior_list
        end
        
        
        if
        0038: $interior_selected == 94 // "OGLOCS" 
        then
        $interiorcoord_x = 516.27 
        $interiorcoord_y = -16.61 
        $interiorcoord_z = 1000.46 
        $interior_id = 3 
        end
        
        
        if
        0038: $interior_selected == 95 // "PAPER" 
        then
        $interiorcoord_x = 388.87 
        $interiorcoord_y = 173.81 
        $interiorcoord_z = 1007.39 
        $interior_id = 3 
        end
        
        
        if
        0038: $interior_selected == 96 // "PDOMES" 
        then
        $interiorcoord_x = -2661.85 
        $interiorcoord_y = 1426.39 
        $interiorcoord_z = 23.0 
        $interior_id = 0 
        end
        
        
        if
        0038: $interior_selected == 97 // "PDOMES" 
        then
        $interiorcoord_x = -2661.01 
        $interiorcoord_y = 1415.74 
        $interiorcoord_z = 922.31 
        $interior_id = 3 
        end
        
        
        if
        0038: $interior_selected == 98 // "PDOMES2" 
        then
          if
          0038:   $y_pressed == 1 
          then
          0008: $interior_selected += 1
          end
          
          if
          0038:   $y_pressed == 0
          then
          0008: $interior_selected += -1
          end 
        jump @interior_list
        end
        
        
        if
        0038: $interior_selected == 99 // "PDOMES2" 
        then
        $interiorcoord_x = -2637.45 
        $interiorcoord_y = 1404.63 
        $interiorcoord_z = 905.46 
        $interior_id = 3 
        end
        
        
        if
        0038: $interior_selected == 100 // "POLICE1" 
        then
        $interiorcoord_x = 246.78 
        $interiorcoord_y = 63.9 
        $interiorcoord_z = 1002.64 
        $interior_id = 6 
        end
        
        jump @change_interior
        
        :interior_honderdtien
        if
        0038: $interior_selected == 101 // "POLICE2" 
        then
        $interiorcoord_x = 246.38 
        $interiorcoord_y = 109.25 
        $interiorcoord_z = 1002.28 
        $interior_id = 10 
        end
        
        
        if
        0038: $interior_selected == 102 // "POLICE3" 
        then
        $interiorcoord_x = 288.75 
        $interiorcoord_y = 169.35 
        $interiorcoord_z = 1006.18 
        $interior_id = 3 
        end
        
        
        if
        0038: $interior_selected == 103 // "POLICE4" 
        then
        $interiorcoord_x = 238.66 
        $interiorcoord_y = 141.05 
        $interiorcoord_z = 1002.05 
        $interior_id = 3 
        end
        
        
        if
        0038: $interior_selected == 104 // "RCPLAY" 
        then
        $interiorcoord_x = -2239.57 
        $interiorcoord_y = 130.02 
        $interiorcoord_z = 1034.42 
        $interior_id = 6 
        end
        
        
        if
        0038: $interior_selected == 105 // "RCPLAY" 
        then
          if
          0038:   $y_pressed == 1 
          then
          0008: $interior_selected += 1
          end
          
          if
          0038:   $y_pressed == 0
          then
          0008: $interior_selected += -1
          end 
        jump @interior_list
        end
        
        
        if
        0038: $interior_selected == 106 // "REST2" 
        then
          if
          0038:   $y_pressed == 1 
          then
          0008: $interior_selected += 1
          end
          
          if
          0038:   $y_pressed == 0
          then
          0008: $interior_selected += -1
          end 
        jump @interior_list
        end
        
        
        if
        0038: $interior_selected == 107 // "RYDERS" 
        then
        $interiorcoord_x = 2464.11 
        $interiorcoord_y = -1698.66 
        $interiorcoord_z = 1012.51 
        $interior_id = 2 
        end
        
        
        if
        0038: $interior_selected == 108 // "S1TEST" 
        then
          if
          0038:   $y_pressed == 1 
          then
          0008: $interior_selected += 1
          end
          
          if
          0038:   $y_pressed == 0
          then
          0008: $interior_selected += -1
          end 
        jump @interior_list 
        end
        
        
        if
        0038: $interior_selected == 109 // "SEXSHOP" 
        then
        $interiorcoord_x = -100.33 
        $interiorcoord_y = -22.82 
        $interiorcoord_z = 999.74 
        $interior_id = 3 
        end
        
        
        if
        0038: $interior_selected == 110 // "SFHSB1" 
        then
        $interiorcoord_x = 140.28 
        $interiorcoord_y = 1368.98 
        $interiorcoord_z = 1082.97 
        $interior_id = 5 
        end
        
        jump @change_interior
        :interior_honderdtwintig
        if
        0038: $interior_selected == 111 // "SFHSB2" 
        then
          if
          0038:   $y_pressed == 1 
          then
          0008: $interior_selected += 1
          end
          
          if
          0038:   $y_pressed == 0
          then
          0008: $interior_selected += -1
          end 
        jump @interior_list 
        end
        
        
        if
        0038: $interior_selected == 112 // "SFHSB3" 
        then
        $interiorcoord_x = 83.35 
        $interiorcoord_y = 1324.44 
        $interiorcoord_z = 1082.89 
        $interior_id = 9 
        end
        
        
        if
        0038: $interior_selected == 113 // "SFHSM1" 
        then
        $interiorcoord_x = -285.55 
        $interiorcoord_y = 1470.98 
        $interiorcoord_z = 1083.45 
        $interior_id = 15 
        end
        
        
        if
        0038: $interior_selected == 114 // "SFHSM2" 
        then
        $interiorcoord_x = -262.6 
        $interiorcoord_y = 1456.62 
        $interiorcoord_z = 1083.45 
        $interior_id = 4 
        end
        
        
        if
        0038: $interior_selected == 115 // "SFHSS1" 
        then
        $interiorcoord_x = -42.58 
        $interiorcoord_y = 1408.11 
        $interiorcoord_z = 1083.45 
        $interior_id = 8 
        end
        
        
        if
        0038: $interior_selected == 116 // "SFHSS2" 
        then
        $interiorcoord_x = -68.29 
        $interiorcoord_y = 1353.47 
        $interiorcoord_z = 1079.28 
        $interior_id = 6 
        end
        
        
        if
        0038: $interior_selected == 117 // "SMASHTV" 
        then
        $interiorcoord_x = 1412.64 
        $interiorcoord_y = -1.79 
        $interiorcoord_z = 999.93 
        $interior_id = 1 
        end
        
        
        if
        0038: $interior_selected == 118 // "STRIP2" 
        then
        $interiorcoord_x = 1212.02 
        $interiorcoord_y = -28.66 
        $interiorcoord_z = 1000.09 
        $interior_id = 3 
        end
        
        
        if
        0038: $interior_selected == 119 // "STUDIO" 
        then
        $interiorcoord_x = 1038.51 
        $interiorcoord_y = -0.66 
        $interiorcoord_z = 1000.09 
        $interior_id = 3 
        end
        
        
        if
        0038: $interior_selected == 120 // "SVc*nt" 
        then
        $interiorcoord_x = 2333.11 
        $interiorcoord_y = -1075.1 
        $interiorcoord_z = 1048.04 
        $interior_id = 6 
        end
        jump @change_interior
        
        :interior_honderddertig
        if
        0038: $interior_selected == 121 // "SVGNMT1" 
        then
        $interiorcoord_x = 2253.14 
        $interiorcoord_y = -1140.09 
        $interiorcoord_z = 1049.65 
        $interior_id = 9 
        end
        
        
        if
        0038: $interior_selected == 122 // "SVGNMT2" 
        then
        $interiorcoord_x = 2261.4 
        $interiorcoord_y = -1135.94 
        $interiorcoord_z = 1049.64 
        $interior_id = 10 
        end
        
        
        if
        0038: $interior_selected == 123 // "SVHOT1" 
        then
        $interiorcoord_x = 2233.8 
        $interiorcoord_y = -1113.36 
        $interiorcoord_z = 1049.91 
        $interior_id = 5 
        end
        
        
        if
        0038: $interior_selected == 124 // "SVLABIG" 
        then
        $interiorcoord_x = 2324.42 
        $interiorcoord_y = -1147.54 
        $interiorcoord_z = 1049.72 
        $interior_id = 12 
        end
        
        
        if
        0038: $interior_selected == 125 // "SVLAMD" 
        then
        $interiorcoord_x = 2365.3 
        $interiorcoord_y = -1132.92 
        $interiorcoord_z = 1049.91 
        $interior_id = 8 
        end
        
        
        if
        0038: $interior_selected == 126 // "SVLASM" 
        then
        $interiorcoord_x = 2282.91 
        $interiorcoord_y = -1138.29 
        $interiorcoord_z = 1049.91 
        $interior_id = 11 
        end
        
        
        if
        0038: $interior_selected == 127 // "SVSFBG" 
        then
        $interiorcoord_x = 2194.79 
        $interiorcoord_y = -1204.35 
        $interiorcoord_z = 1048.05 
        $interior_id = 6 
        end
        
        
        if
        0038: $interior_selected == 128 // "SVSFMD" 
        then
        $interiorcoord_x = 2268.39 
        $interiorcoord_y = -1210.45 
        $interiorcoord_z = 1046.57 
        $interior_id = 10 
        end
        
        
        if
        0038: $interior_selected == 129 // "SVSFSM" 
        then
        $interiorcoord_x = 2308.79 
        $interiorcoord_y = -1210.88 
        $interiorcoord_z = 1048.03 
        $interior_id = 6 
        end
        
        
        if
        0038: $interior_selected == 130 // "SVVGHO1" 
        then
        $interiorcoord_x = 2216.54 
        $interiorcoord_y = -1076.29 
        $interiorcoord_z = 1049.52 
        $interior_id = 1 
        end
        jump @change_interior
        
        :interior_honderdveertig
        if
        0038: $interior_selected == 131 // "SVVGHO2" 
        then
        $interiorcoord_x = 2237.59 
        $interiorcoord_y = -1078.87 
        $interiorcoord_z = 1048.07 
        $interior_id = 2 
        end
        
        
        if
        0038: $interior_selected == 132 // "SVVGMD" 
        then
        $interiorcoord_x = 2317.82 
        $interiorcoord_y = -1024.75 
        $interiorcoord_z = 1049.21 
        $interior_id = 9 
        end
        
        
        if
        0038: $interior_selected == 133 // "SWEETS" 
        then
        $interiorcoord_x = 2526.46 
        $interiorcoord_y = -1679.09 
        $interiorcoord_z = 1014.5 
        $interior_id = 1 
        end
        
        
        if
        0038: $interior_selected == 134 // "TATTO2" 
        then
        $interiorcoord_x = -204.44 
        $interiorcoord_y = -8.47 
        $interiorcoord_z = 1001.3 
        $interior_id = 17 
        end
        
        
        if
        0038: $interior_selected == 135 // "TATTO3" 
        then
          if
          0038:   $y_pressed == 1 
          then
          0008: $interior_selected += 1
          end
          
          if
          0038:   $y_pressed == 0
          then
          0008: $interior_selected += -1
          end 
        jump @interior_list
        end
        
        
        if
        0038: $interior_selected == 136 // "TATTOO" 
        then
          if
          0038:   $y_pressed == 1 
          then
          0008: $interior_selected += 1
          end
          
          if
          0038:   $y_pressed == 0
          then
          0008: $interior_selected += -1
          end 
        jump @interior_list
        end
        
        
        if
        0038: $interior_selected == 137 // "TRICAS" 
        then
        $interiorcoord_x = 2015.45 
        $interiorcoord_y = 1017.09 
        $interiorcoord_z = 995.88 
        $interior_id = 10 
        end
        
        
        if
        0038: $interior_selected == 138 // "TSDINER" 
        then
        $interiorcoord_x = 681.48 
        $interiorcoord_y = -451.15 
        $interiorcoord_z = -26.62 
        $interior_id = 1 
        end
        
        
        if
        0038: $interior_selected == 139 // "VGHSB1" 
        then
        $interiorcoord_x = 447.74 
        $interiorcoord_y = 1400.44 
        $interiorcoord_z = 1083.34 
        $interior_id = 2 
        end
        
        
        if
        0038: $interior_selected == 140 // "VGHSB3" 
        then
        $interiorcoord_x = 490.81 
        $interiorcoord_y = 1401.49 
        $interiorcoord_z = 1079.34 
        $interior_id = 2 
        end
        
        jump @change_interior
        
        :interior_honderdvijftig
        if
        0038: $interior_selected == 141 // "VGHSM2" 
        then
        $interiorcoord_x = 22.78 
        $interiorcoord_y = 1404.96 
        $interiorcoord_z = 1083.45 
        $interior_id = 5 
        end
        
        
        if
        0038: $interior_selected == 142 // "VGHSM3" 
        then
        $interiorcoord_x = 27.13 
        $interiorcoord_y = 1341.15 
        $interiorcoord_z = 1083.45 
        $interior_id = 10 
        end
        
        
        if
        0038: $interior_selected == 143 // "VGHSS1" 
        then
        $interiorcoord_x = 295.14 
        $interiorcoord_y = 1474.47 
        $interiorcoord_z = 1079.52 
        $interior_id = 15 
        end
        
        
        if
        0038: $interior_selected == 144 // "VGSHM2" 
        then
        $interiorcoord_x = 385.8 
        $interiorcoord_y = 1471.77 
        $interiorcoord_z = 1079.21 
        $interior_id = 15 
        end
        
        
        if
        0038: $interior_selected == 145 // "VGSHM3" 
        then
        $interiorcoord_x = 375.97 
        $interiorcoord_y = 1417.27 
        $interiorcoord_z = 1080.41 
        $interior_id = 15 
        end
        
        
        if
        0038: $interior_selected == 146 // "VGSHS2" 
        then
        $interiorcoord_x = 328.49 
        $interiorcoord_y = 1480.59 
        $interiorcoord_z = 1083.45 
        $interior_id = 15 
        end
        
        
        if
        0038: $interior_selected == 147 // "WUZIBET" 
        then
        $interiorcoord_x = -2158.72 
        $interiorcoord_y = 641.29 
        $interiorcoord_z = 1051.37 
        $interior_id = 1 
        end
        
        
        if
        0038: $interior_selected == 148 // "X7_11B" 
        then
        $interiorcoord_x = -30.95 
        $interiorcoord_y = -89.61 
        $interiorcoord_z = 1002.55 
        $interior_id = 18 
        end
        
        
        if
        0038: $interior_selected == 149 // "X7_11C" 
        then
        $interiorcoord_x = -25.13 
        $interiorcoord_y = -139.07 
        $interiorcoord_z = 1002.55 
        $interior_id = 16 
        end
        
        
        if
        0038: $interior_selected == 150 // "X7_11D" 
        then
        $interiorcoord_x = -25.88 
        $interiorcoord_y = -185.87 
        $interiorcoord_z = 1002.55 
        $interior_id = 17 
        end
        
        
        if
        0038: $interior_selected == 151 // "X7_11S" 
        then
        $interiorcoord_x = -26.69 
        $interiorcoord_y = -55.71 
        $interiorcoord_z = 1002.55 
        $interior_id = 6 
        end
        
        
        if
        0038: $interior_selected == 152 // "X711S2" 
        then
        $interiorcoord_x = -27.31 
        $interiorcoord_y = -29.28 
        $interiorcoord_z = 1002.55 
        $interior_id = 4 
        end
        
        
        if
        0038: $interior_selected == 153 // "X711S3" 
        then
        $interiorcoord_x = 6.09 
        $interiorcoord_y = -29.27 
        $interiorcoord_z = 1002.55 
        $interior_id = 10 
        end
        
        :change_interior
        fade 0 500
        wait 500
        repeat 
          wait 0
        until player.Defined($PLAYER_CHAR)
        04BB: select_interior $interior_id 
        0860: link_actor $PLAYER_ACTOR to_interior $interior_id  
        if $interior_id == 0
    then
      //0581: enable_radar 1
      //057E: set_radar_grey 0
    else
      //0581: enable_radar 0
      //057E: set_radar_grey 1
    end
        Actor.PutAt($PLAYER_ACTOR, $interiorcoord_x, $interiorcoord_y, $interiorcoord_z)
        0373: set_camera_directly_behind_player 
        02EB: restore_camera_with_jumpcut 
        01E5: show_text_1number_highpriority GXT 'NUMBER' number $interior_selected time 5000 flag 1  //interior nummer
        wait 500
        fade 1 500
        wait 500
        0084: $previous_interior = $interior_selected // (int)
  end 
end

:INTTOOL_MISSION_PASSED
// This subroutine is executed when the mission is passed. 
// Give the rewards, and make new missions available if needed.
return

//-------------------------------------
:INTTOOL_MISSION_FAIL   
fade 0 500
wait 500
04BB: select_interior 4@
0860: link_actor $PLAYER_ACTOR to_interior 4@  
if 4@ == 0
    then
      //0581: enable_radar 1
      //057E: set_radar_grey 0
    else
      //0581: enable_radar 0
      //057E: set_radar_grey 1
    end
Actor.PutAt($PLAYER_ACTOR, 1@,2@,3@)
0373: set_camera_directly_behind_player 
02EB: restore_camera_with_jumpcut 
wait 500
fade 1 500
wait 500
return 

//-------------------------------------
:INTTOOL_MISSION_CLEANUP
// This subroutine is always executed at the end of the mission, regardless the outcome.
// This is the place to unload models etc. 
03E6: remove_text_box 
$ONMISSION = 0 
mission_cleanup 

return 

//=====================================
//-------------------------------------
//-------------Mission 3---------------
//-------------------------------------
//=====================================
:JTOMTOOL_MISSION
thread 'JTOMTOOL' 
gosub @JTOMTOOL_MISSION_MAIN 
if wasted_or_busted 
then 
  gosub @JTOMTOOL_MISSION_FAIL 
end
gosub @JTOMTOOL_MISSION_CLEANUP 
end_thread 

:JTOMTOOL_MISSION_MAIN
$TEMPVAR_FLOAT_1 = -4000.0 
$TEMPVAR_FLOAT_2 = 0.0
$TEMPVAR_FLOAT_3 = 550.0

wait 100 ms
0AB6: store_target_marker_coords_to $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_4 

if -3900.0 > $TEMPVAR_FLOAT_1
then
  00BB: show_text_lowpriority GXT 'TLPHELP' time 3000 flag 1  
  return
end

fade 0 500
wait 500                                                     
04BB: select_interior 0 
0860: link_actor $PLAYER_ACTOR to_interior 0 
0581: enable_radar 1
00A1: put_actor $PLAYER_ACTOR at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3
wait 0
04E4: unknown_refresh_game_renderer_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2
wait 50
02CE: $TEMPVAR_FLOAT_5 = ground_z_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3
03CB: set_rendering_origin_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_5
0980: extinguish_all_fires_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_5 radius 1.0
wait 500
00A1: put_actor $PLAYER_ACTOR at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_5
Camera.SetBehindPlayer
Camera.Restore_WithJumpCut
//wait 500
fade 1 500
wait 500
:JTOMTOOL_MISSION_PASSED
// This subroutine is executed when the mission is passed. 
// Give the rewards, and make new missions available if needed.
return

//-------------------------------------
:JTOMTOOL_MISSION_FAIL   
return 

//-------------------------------------
:JTOMTOOL_MISSION_CLEANUP
// This subroutine is always executed at the end of the mission, regardless the outcome.
// This is the place to unload models etc. 
03E6: remove_text_box 
$ONMISSION = 0 
mission_cleanup 

return 

//=====================================
//-------------------------------------
//-------------Mission 4---------------
//-------------------------------------
//=====================================
// Mission wrapper
:JTOCTOOL_MISSION
thread 'JTOCTOOL' 
gosub @JTOCTOOL_MISSION_MAIN 
if wasted_or_busted 
then 
  gosub @JTOCTOOL_MISSION_FAIL 
end
gosub @JTOCTOOL_MISSION_CLEANUP 
end_thread 

:JTOCTOOL_MISSION_MAIN
if  NOT player.Defined($PLAYER_CHAR)
then
  return
end
$obj_idx = $DYOM_selected_obj
$obj_prev = -1
$obj_cancel = 0

0512: permanent_text_box 'OBJTELE'
01E5: show_text_1number_highpriority GXT 'INF_OBJ' number $obj_idx time 5000 flag 1  // Objective #                                                
077E: get_active_interior_to $obj_int 

actor.StorePos($PLAYER_ACTOR,$x,$y,$z)
$a = actor.Angle($PLAYER_ACTOR)
player.CanMove($PLAYER_CHAR) = false 
gosub @ROUTINE_enterspace_release                                                
repeat
    wait 50 ms
                                                                                                                
    if 00E1:   player 0 pressed_key 15
    then
      repeat
        wait 0
      until player.Defined($PLAYER_CHAR)  
      03E6: remove_text_box 
      04BB: select_interior $obj_int 
      repeat
        wait 0
      until player.Defined($PLAYER_CHAR)  
      0860: link_actor $PLAYER_ACTOR to_interior $obj_int
      wait 0
      04E4: unknown_refresh_game_renderer_at $x $y
      wait 50
      02CE: $ground_z_marker = ground_z_at $x $y $z
      03CB: set_rendering_origin_at $x $y  $ground_z_marker
      repeat
        wait 0
      until player.Defined($PLAYER_CHAR)  
      00A1: put_actor $PLAYER_ACTOR at $x $y $z
      actor.Angle($PLAYER_ACTOR) = $a

      Camera.SetBehindPlayer
      Camera.Restore_WithJumpCut
      return
    end
    
    if 00E1:   player 0 pressed_key 11
    then
    repeat
     wait 20
    until 80E1:   NOT player 0 pressed_key 11
      if $obj_idx > 0
      then
        $obj_idx += -1
      else
        $obj_idx = $DYOM_objective_count
      end  
    end
    
    if 00E1:   player 0 pressed_key 10
    then
    repeat
     wait 20
    until 80E1:   NOT player 0 pressed_key 10
      if $obj_idx < $DYOM_objective_count
      then
        $obj_idx += 1
      else
        $obj_idx = 0
      end  
    end
    
    if 803A:   not  $obj_idx == $obj_prev // (int) 
    then    
        if $obj_idx > 0
        then
            $obj_prev = $obj_idx
            $obj_prev += -1
            $TEMPVAR_FLOAT_1 = $DYOM_objective_location_x[$obj_prev]
            $TEMPVAR_FLOAT_2 = $DYOM_objective_location_y[$obj_prev]
            $TEMPVAR_FLOAT_3 = $DYOM_objective_location_z[$obj_prev]
            $interior_id = $DYOM_objective_interior[$obj_prev]
        else
            $TEMPVAR_FLOAT_1 = $DYOM_player_location_x
            $TEMPVAR_FLOAT_2 = $DYOM_player_location_y
            $TEMPVAR_FLOAT_3 = $DYOM_player_location_z
            $interior_id = $DYOM_player_interior
        end
        $TEMPVAR_FLOAT_4 = $TEMPVAR_FLOAT_1
        $TEMPVAR_FLOAT_5 = $TEMPVAR_FLOAT_2
        $TEMPVAR_FLOAT_6 = $TEMPVAR_FLOAT_3
        $TEMPVAR_FLOAT_5 += 4.0
        $TEMPVAR_FLOAT_6 += 5.0
        $TEMPVAR_FLOAT_3 += 1.5
        // Put camera on  $obj_idx
        fade 0 500
        wait 500                                                     

        repeat
          wait 0
        until player.Defined($PLAYER_CHAR)  
        04BB: select_interior $interior_id 
        0860: link_actor $PLAYER_ACTOR to_interior $interior_id
        
        wait 0
        04E4: unknown_refresh_game_renderer_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2
        wait 50
        02CE: $ground_z_marker = ground_z_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3
        03CB: set_rendering_origin_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $ground_z_marker
        0980: extinguish_all_fires_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $ground_z_marker radius 1.0
        wait 0
        015F: set_camera_position $TEMPVAR_FLOAT_4 $TEMPVAR_FLOAT_5 $TEMPVAR_FLOAT_6 rotation 0.0 0.0 0.0 
        0160: set_camera_point_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3 mode 2 
        wait 0
        $za = $ground_z_marker
        $za += 100.0
        repeat
          wait 0
        until player.Defined($PLAYER_CHAR)  
        00A1: put_actor $PLAYER_ACTOR at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $ground_z_marker  
        01E5: show_text_1number_highpriority GXT 'INF_OBJ' number $obj_idx time 5000 flag 1  // Objective #                                                
         
        fade 1 500
        wait 500
        $obj_prev = $obj_idx  
    end    
    if 0AB0:  key_pressed 0x0D
    then
      break  // Accept enter as alternative for 'space' to end the loop
    end  
until 00E1:   player 0 pressed_key 16
$actor_cancel = 0
03E6: remove_text_box 
00BE: text_clear_all
fade 0 500
wait 500                                                     
repeat
  wait 0
until player.Defined($PLAYER_CHAR)  
04BB: select_interior $interior_id 
0860: link_actor $PLAYER_ACTOR to_interior $interior_id 
if $interior_id == 0
then
  0581: enable_radar 1
else
  0581: enable_radar 0
end 

00A1: put_actor $PLAYER_ACTOR at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3
wait 0
04E4: unknown_refresh_game_renderer_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3
wait 50
02CE: $ground_z_marker = ground_z_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $TEMPVAR_FLOAT_3
03CB: set_rendering_origin_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $ground_z_marker
0980: extinguish_all_fires_at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $ground_z_marker radius 1.0
wait 500
repeat
  wait 0
until player.Defined($PLAYER_CHAR)  
00A1: put_actor $PLAYER_ACTOR at $TEMPVAR_FLOAT_1 $TEMPVAR_FLOAT_2 $ground_z_marker
Camera.SetBehindPlayer
Camera.Restore_WithJumpCut
//wait 500
fade 1 500
wait 500
:JTOCTOOL_MISSION_PASSED
// This subroutine is executed when the mission is passed. 
// Give the rewards, and make new missions available if needed.
return

//-------------------------------------
:JTOCTOOL_MISSION_FAIL   
fade 0 500
wait 500
04BB: select_interior 4@
0860: link_actor $PLAYER_ACTOR to_interior 4@  
if 4@ == 0
then
  0581: enable_radar 1
else
  0581: enable_radar 0
end
Actor.PutAt($PLAYER_ACTOR, 1@,2@,3@)
0373: set_camera_directly_behind_player 
02EB: restore_camera_with_jumpcut 
wait 500
fade 1 500
wait 500
return 

//-------------------------------------
:JTOCTOOL_MISSION_CLEANUP
// This subroutine is always executed at the end of the mission, regardless the outcome.
// This is the place to unload models etc. 
03E6: remove_text_box 
$ONMISSION = 0 
mission_cleanup 

return 